/*
Navicat MySQL Data Transfer

Source Server         : localhost_3306
Source Server Version : 50718
Source Host           : localhost:3306
Source Database       : article_spider

Target Server Type    : MYSQL
Target Server Version : 50718
File Encoding         : 65001

Date: 2017-07-12 21:09:20
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for jobbole_article
-- ----------------------------
DROP TABLE IF EXISTS `jobbole_article`;
CREATE TABLE `jobbole_article` (
  `title` varchar(200) NOT NULL,
  `create_date` date NOT NULL,
  `url` varchar(300) NOT NULL,
  `url_object_id` varchar(50) NOT NULL,
  `front_image_url` varchar(300) NOT NULL,
  `front_image_path` varchar(200) NOT NULL,
  `comments_num` int(11) NOT NULL DEFAULT '0',
  `fav_num` int(11) NOT NULL DEFAULT '0',
  `praise_num` int(11) NOT NULL DEFAULT '0',
  `tags` varchar(200) NOT NULL,
  `content` longtext NOT NULL,
  PRIMARY KEY (`url_object_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of jobbole_article
-- ----------------------------
INSERT INTO `jobbole_article` VALUES ('数据结构中各种树', '2017-07-12', 'http://blog.jobbole.com/111680/', '02798e0da54694b76c5f84ea9e994105', 'http://jbcdn2.b0.upaiyun.com/2017/07/bc42d6b7087d92bf57edac612206395f.jpg', 'full/6032d7dc1233f95d17343e58eeaff17e6a49cb23.jpg', '2', '7', '1', 'IT技术,,数据结构,树', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/maybe2030/p/4732377.html\">Poll的笔记</a>   </div><p>数据结构中有很多树的结构，其中包括二叉树、二叉搜索树、2-3树、红黑树等等。本文中对数据结构中常见的几种树的概念和用途进行了汇总，不求严格精准，但求简单易懂。</p>\n<h1 class=\"First\"><strong>1. 二叉树</strong></h1>\n<p>二叉树是数据结构中一种重要的数据结构，也是树表家族最为基础的结构。</p>\n<p><strong>二叉树的定义：</strong>二叉树的每个结点至多只有二棵子树(不存在度大于2的结点)，二叉树的子树有左右之分，次序不能颠倒。二叉树的第i层至多有2<sup>i-1</sup>个结点；深度为k的二叉树至多有2<sup>k-1</sup>个结点；对任何一棵二叉树T，如果其终端结点数为n<sub>0</sub>，度为2的结点数为n<sub>2</sub>，则n<sub>0</sub>=n<sub>2</sub>+1。</p>\n<p><strong>二叉树的示例</strong>：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/bc42d6b7087d92bf57edac612206395f.jpg\"><img class=\"aligncenter wp-image-111682 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bc42d6b7087d92bf57edac612206395f.jpg\" alt=\"2009050402\" width=\"390\" height=\"312\"></a></p>\n<p><strong>满二叉树和完全二叉树：</strong></p>\n<p>满二叉树：除最后一层无任何子节点外，每一层上的所有结点都有两个子结点。也可以这样理解，除叶子结点外的所有结点均有两个子结点。节点数达到最大值，所有叶子结点必须在同一层上。</p>\n<p>满二叉树的性质：</p>\n<p>1) 一颗树深度为h，最大层数为k，深度与最大层数相同，k=h;</p>\n<p>2) 叶子数为2<sup>h</sup>;</p>\n<p>3) 第k层的结点数是：2<sup>k-1</sup>;</p>\n<p>4) 总结点数是：2<sup>k-1</sup>，且总节点数一定是奇数。</p>\n<p>完全二叉树：若设二叉树的深度为h，除第 h 层外，其它各层 (1～(h-1)层) 的结点数都达到最大个数，第h层所有的结点都连续集中在最左边，这就是完全二叉树。</p>\n<p><strong>注：</strong>完全二叉树是效率很高的数据结构，堆是一种完全二叉树或者近似完全二叉树，所以效率极高，像十分常用的排序算法、Dijkstra算法、Prim算法等都要用堆才能优化，二叉排序树的效率也要借助平衡性来提高，而平衡性基于完全二叉树。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/a5952ec741b60202c7b377bfb8e8f368.png\"><img class=\"aligncenter wp-image-111683 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a5952ec741b60202c7b377bfb8e8f368.png\" alt=\"141749056837546\" width=\"534\" height=\"180\"></a></p>\n<p><strong>二叉树的性质</strong>：</p>\n<p>1) 在非空二叉树中，第i层的结点总数不超过2<sup>i-1</sup>, i&gt;=1;</p>\n<p>2) 深度为h的二叉树最多有2<sup>h</sup>-1个结点(h&gt;=1)，最少有h个结点;</p>\n<p>3) 对于任意一棵二叉树，如果其叶结点数为N<sub>0</sub>，而度数为2的结点总数为N<sub>2</sub>，则N<sub>0</sub>=N<sub>2</sub>+1;</p>\n<p>4) 具有n个结点的完全二叉树的深度为log<sub>2</sub>(n+1);</p>\n<p>5)有N个结点的完全二叉树各结点如果用顺序方式存储，则结点之间有如下关系：</p>\n<p>若I为结点编号则 如果I&gt;1，则其父结点的编号为I/2；</p>\n<p>如果2I&lt;=N，则其左儿子（即左子树的根结点）的编号为2I；若2I&gt;N，则无左儿子；</p>\n<p>如果2I+1&lt;=N，则其右儿子的结点编号为2I+1；若2I+1&gt;N，则无右儿子。</p>\n<p>6)给定N个节点，能构成h(N)种不同的二叉树，其中h(N)为卡特兰数的第N项，h(n)=C(2*n, n)/(n+1)。</p>\n<p>7)设有i个枝点，I为所有枝点的道路长度总和，J为叶的道路长度总和J=I+2<sup>i</sup>。</p>\n<h1 class=\"First\">2. 二叉查找树</h1>\n<p><strong>二叉查找树定义</strong>：又称为是二叉排序树（Binary Sort Tree）或二叉搜索树。二叉排序树或者是一棵空树，或者是具有下列性质的二叉树：</p>\n<p>1) 若左子树不空，则左子树上所有结点的值均小于它的根结点的值；</p>\n<p>2) 若右子树不空，则右子树上所有结点的值均大于或等于它的根结点的值；</p>\n<p>3) 左、右子树也分别为二叉排序树；</p>\n<p>4) 没有键值相等的节点。</p>\n<p><strong>二叉查找树的性质：</strong><strong>对二叉查找树进行中序遍历，即可得到有序的数列。</strong></p>\n<p><strong>二叉查找树的时间复杂度：<strong>它和二分查找一样，插入和查找的时间复杂度均为O(logn)，<span style=\"color: #ff0000\">但是在最坏的情况下仍然会有O(n)的时间复杂度。</span>原因在于插入和删除元素的时候，树没有保持平衡（比如，我们查找上图（b）中的“93”，我们需要进行n次查找操作）。我们追求的是在最坏的情况下仍然有较好的时间复杂度，这就是平衡查找树设计的初衷。</strong></strong></p>\n<p><span style=\"color: #ff0000\"><strong><strong>二叉查找树的高度决定了二叉查找树的查找效率。</strong></strong></span></p>\n<p><strong>二叉查找树的插入过程如下：</strong></p>\n<p>1) 若当前的二叉查找树为空，则插入的元素为根节点;</p>\n<p>2) 若插入的元素值小于根节点值，则将元素插入到左子树中;</p>\n<p>3) 若插入的元素值不小于根节点值，则将元素插入到右子树中。</p>\n<p><strong>二叉查找树的删除，分三种情况进行处理：</strong></p>\n<p>1) p为叶子节点，直接删除该节点，再修改其父节点的指针（注意分是根节点和不是根节点），如图a;</p>\n<p>2) p为单支节点（即只有左子树或右子树）。让p的子树与p的父亲节点相连，删除p即可（注意分是根节点和不是根节点），如图b;</p>\n<p>3) p的左子树和右子树均不空。找到p的后继y，因为y一定没有左子树，所以可以删除y，并让y的父亲节点成为y的右子树的父亲节点，并用y的值代替p的值；或者方法二是找到p的前驱x，x一定没有右子树，所以可以删除x，并让x的父亲节点成为y的左子树的父亲节点。如图c。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/2361a6d889a036b92d6fa44c8984d27e.png\"><img class=\"aligncenter wp-image-111684 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2361a6d889a036b92d6fa44c8984d27e.png\" alt=\"2012032717571645\" width=\"572\" height=\"205\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/05b0ae29caf51cf3aeb26e30ee6996ec.png\"><img class=\"aligncenter wp-image-111685 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/05b0ae29caf51cf3aeb26e30ee6996ec.png\" alt=\"2012032717583358\" width=\"611\" height=\"210\"></a><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/2c51f44d9bfb87f38f9bf040552b6b31.png\"><img class=\"aligncenter wp-image-111686 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2c51f44d9bfb87f38f9bf040552b6b31.png\" alt=\"2012032717584562\" width=\"553\" height=\"148\"></a></p>\n<p>二叉树相关实现源码：</p>\n<p>插入操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d22acb064832809\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct node\r\n{\r\n    int val;\r\n    pnode lchild;\r\n    pnode rchild;\r\n};\r\n\r\npnode BT = NULL;\r\n\r\n\r\n//递归方法插入节点 \r\npnode insert(pnode root, int x)\r\n{\r\n    pnode p = (pnode)malloc(LEN);\r\n    p-&gt;val = x;\r\n    p-&gt;lchild = NULL;\r\n    p-&gt;rchild = NULL;\r\n    if(root == NULL){\r\n        root = p;    \r\n    }    \r\n    else if(x &lt; root-&gt;val){\r\n        root-&gt;lchild = insert(root-&gt;lchild, x);    \r\n    }\r\n    else{\r\n        root-&gt;rchild = insert(root-&gt;rchild, x);    \r\n    }\r\n    return root;\r\n}\r\n\r\n//非递归方法插入节点 \r\nvoid insert_BST(pnode q, int x)\r\n{\r\n    pnode p = (pnode)malloc(LEN);\r\n    p-&gt;val = x;\r\n    p-&gt;lchild = NULL;\r\n    p-&gt;rchild = NULL;\r\n    if(q == NULL){\r\n        BT = p;\r\n        return ;    \r\n    }        \r\n    while(q-&gt;lchild != p &amp;&amp; q-&gt;rchild != p){\r\n        if(x &lt; q-&gt;val){\r\n            if(q-&gt;lchild){\r\n                q = q-&gt;lchild;    \r\n            }    \r\n            else{\r\n                q-&gt;lchild = p;\r\n            }        \r\n        }    \r\n        else{\r\n            if(q-&gt;rchild){\r\n                q = q-&gt;rchild;    \r\n            }    \r\n            else{\r\n                q-&gt;rchild = p;    \r\n            }\r\n        }\r\n    }\r\n    return;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22acb064832809-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22acb064832809-60\">60</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-8\"><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-10\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-11\"><span class=\"crayon-c\">//递归方法插入节点 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-12\"><span class=\"crayon-e\">pnode </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-13\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LEN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-28\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-30\"><span class=\"crayon-c\">//非递归方法插入节点 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-31\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert_BST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-32\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LEN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-47\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22acb064832809-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22acb064832809-60\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p>删除操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d22ad5637794627\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbool delete_BST(pnode p, int x) //返回一个标志，表示是否找到被删元素 \r\n{\r\n    bool find = false;\r\n    pnode q;\r\n    p = BT;\r\n    while(p &amp;&amp; !find){  //寻找被删元素 \r\n        if(x == p-&gt;val){  //找到被删元素 \r\n            find = true;    \r\n        }    \r\n        else if(x &lt; p-&gt;val){ //沿左子树找 \r\n            q = p;\r\n            p = p-&gt;lchild;    \r\n        }\r\n        else{   //沿右子树找 \r\n            q = p;\r\n            p = p-&gt;rchild;    \r\n        }\r\n    }\r\n    if(p == NULL){   //没找到 \r\n        cout &lt;&lt; \"没有找到\" &lt;&lt; x &lt;&lt; endl;    \r\n    }\r\n    \r\n    if(p-&gt;lchild == NULL &amp;&amp; p-&gt;rchild == NULL){  //p为叶子节点 \r\n        if(p == BT){  //p为根节点 \r\n            BT = NULL;    \r\n        }\r\n        else if(q-&gt;lchild == p){   \r\n            q-&gt;lchild = NULL;\r\n        }        \r\n        else{\r\n            q-&gt;rchild = NULL;    \r\n        }\r\n        free(p);  //释放节点p \r\n    }\r\n    else if(p-&gt;lchild == NULL || p-&gt;rchild == NULL){ //p为单支子树 \r\n        if(p == BT){  //p为根节点 \r\n            if(p-&gt;lchild == NULL){\r\n                BT = p-&gt;rchild;    \r\n            }    \r\n            else{\r\n                BT = p-&gt;lchild;    \r\n            }\r\n        }    \r\n        else{\r\n            if(q-&gt;lchild == p &amp;&amp; p-&gt;lchild){ //p是q的左子树且p有左子树 \r\n                q-&gt;lchild = p-&gt;lchild;    //将p的左子树链接到q的左指针上 \r\n            }    \r\n            else if(q-&gt;lchild == p &amp;&amp; p-&gt;rchild){\r\n                q-&gt;lchild = p-&gt;rchild;    \r\n            }\r\n            else if(q-&gt;rchild == p &amp;&amp; p-&gt;lchild){\r\n                q-&gt;rchild = p-&gt;lchild;    \r\n            }\r\n            else{\r\n                q-&gt;rchild = p-&gt;rchild;\r\n            }\r\n        }\r\n        free(p);\r\n    }\r\n    else{ //p的左右子树均不为空 \r\n        pnode t = p;\r\n        pnode s = p-&gt;lchild;  //从p的左子节点开始 \r\n        while(s-&gt;rchild){  //找到p的前驱，即p左子树中值最大的节点 \r\n            t = s;   \r\n            s = s-&gt;rchild;    \r\n        }\r\n        p-&gt;val = s-&gt;val;   //把节点s的值赋给p \r\n        if(t == p){\r\n            p-&gt;lchild = s-&gt;lchild;    \r\n        }    \r\n        else{\r\n            t-&gt;rchild = s-&gt;lchild;    \r\n        }\r\n        free(s); \r\n    }\r\n    return find;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ad5637794627-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ad5637794627-77\">77</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-1\"><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_BST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//返回一个标志，表示是否找到被删元素 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//寻找被删元素 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//找到被删元素 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//沿左子树找 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//沿右子树找 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//没找到 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"没有找到\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-22\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//p为叶子节点 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//p为根节点 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//释放节点p </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//p为单支子树 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//p为根节点 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//p是q的左子树且p有左子树 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//将p的左子树链接到q的左指针上 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-49\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//p的左右子树均不为空 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//从p的左子节点开始 </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//找到p的前驱，即p左子树中值最大的节点 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-64\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-65\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//把节点s的值赋给p </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-69\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">t</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ad5637794627-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ad5637794627-77\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0118 seconds] -->\r\n<p>查找操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d22adb186300104\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npnode search_BST(pnode p, int x)\r\n{\r\n    bool solve = false;\r\n    while(p &amp;&amp; !solve){\r\n        if(x == p-&gt;val){\r\n            solve = true;    \r\n        }    \r\n        else if(x &lt; p-&gt;val){\r\n            p = p-&gt;lchild;    \r\n        }\r\n        else{\r\n            p = p-&gt;rchild;    \r\n        }\r\n    }\r\n    if(p == NULL){\r\n        cout &lt;&lt; \"没有找到\" &lt;&lt; x &lt;&lt; endl;    \r\n    } \r\n    return p;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22adb186300104-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22adb186300104-19\">19</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-1\"><span class=\"crayon-e\">pnode </span><span class=\"crayon-e\">search_BST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">solve</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">solve</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">solve</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"没有找到\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22adb186300104-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22adb186300104-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<h1 class=\"First\">3. 平衡二叉树</h1>\n<p>我们知道，对于一般的二叉搜索树（Binary Search Tree），其期望高度（即为一棵平衡树时）为log<sub>2</sub>n，其各操作的时间复杂度O(log<sub>2</sub>n)同时也由此而决定。但是，在某些极端的情况下（如在插入的序列是有序的时），二叉搜索树将退化成近似链或链，此时，其操作的时间复杂度将退化成线性的，即O(n)。我们可以通过随机化建立二叉搜索树来尽量的避免这种情况，但是在进行了多次的操作之后，由于在删除时，我们总是选择将待删除节点的后继代替它本身，这样就会造成总是右边的节点数目减少，以至于树向左偏沉。这同时也会造成树的平衡性受到破坏，提高它的操作的时间复杂度。于是就有了我们下边介绍的平衡二叉树。</p>\n<p><strong>平衡二叉树定义：</strong>平衡二叉树（Balanced Binary Tree）又被称为AVL树（有别于AVL算法），且具有以下性质：它是一 棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。平衡二叉树的常用算法有红黑树、AVL树等。在平衡二叉搜索树中，我们可以看到，其高度一般都良好地维持在O(log<sub>2</sub>n)，大大降低了操作的时间复杂度。</p>\n<p>最小二叉平衡树的节点的公式如下：</p>\n<p>F(n)=F(n-1)+F(n-2)+1</p>\n<p>这个类似于一个递归的数列，可以参考Fibonacci数列，1是根节点，F(n-1)是左子树的节点数量，F(n-2)是右子树的节点数量。</p>\n<h2 class=\"First\">3.1 平衡查找树之AVL树</h2>\n<p>有关AVL树的具体实现，可以参考<a href=\"http://www.cppblog.com/cxiaojia/archive/2012/08/20/187776.html\" target=\"_blank\">C小加的博客《一步一步写平衡二叉树（AVL）》</a>。</p>\n<p><strong>AVL树定义：</strong>AVL树是最先发明的自平衡二叉查找树。AVL树得名于它的发明者 G.M. Adelson-Velsky 和 E.M. Landis，他们在 1962 年的论文 “An algorithm for the organization of information” 中发表了它。在AVL中任何节点的两个儿子子树的高度最大差别为1，所以它也被称为高度平衡树，n个结点的AVL树最大深度约1.44log<sub>2</sub>n。查找、插入和删除在平均和最坏情况下都是O(logn)。增加和删除可能需要通过一次或多次树旋转来重新平衡这个树。<strong>这个方案很好的解决了二叉查找树退化成链表的问题，把插入，查找，删除的时间复杂度最好情况和最坏情况都维持在O(logN)。但是频繁旋转会使插入和删除牺牲掉O(logN)左右的时间，不过相对二叉查找树来说，时间上稳定了很多。</strong></p>\n<p><strong>AVL树的自平衡操作——旋转：</strong></p>\n<p>AVL树最关键的也是最难的一步操作就是<strong>旋转</strong>。旋转主要是为了实现AVL树在实施了插入和删除操作以后，树重新回到平衡的方法。下面我们重点研究一下AVL树的旋转。</p>\n<p>对于一个平衡的节点，由于任意节点最多有两个儿子，因此高度不平衡时，此节点的两颗子树的高度差2.容易看出，这种不平衡出现在下面四种情况：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbc1d195a4adf1a9cc10bb85b0f1c2c6.jpg\"><img class=\"aligncenter wp-image-111687 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbc1d195a4adf1a9cc10bb85b0f1c2c6.jpg\" alt=\"2012082016021366\" width=\"785\" height=\"306\"></a></p>\n<p>1) 6节点的左子树3节点高度比右子树7节点大2，左子树3节点的左子树1节点高度大于右子树4节点，这种情况成为左左。</p>\n<p>2) 6节点的左子树2节点高度比右子树7节点大2，左子树2节点的左子树1节点高度小于右子树4节点，这种情况成为左右。</p>\n<p>3) 2节点的左子树1节点高度比右子树5节点小2，右子树5节点的左子树3节点高度大于右子树6节点，这种情况成为右左。</p>\n<p>4) 2节点的左子树1节点高度比右子树4节点小2，右子树4节点的左子树3节点高度小于右子树6节点，这种情况成为右右。</p>\n<p>从图2中可以可以看出，1和4两种情况是对称的，这两种情况的旋转算法是一致的，只需要经过一次旋转就可以达到目标，我们称之为单旋转。2和3两种情况也是对称的，这两种情况的旋转算法也是一致的，需要进行两次旋转，我们称之为双旋转。</p>\n<p><strong>单旋转</strong></p>\n<p>单旋转是针对于左左和右右这两种情况的解决方案，这两种情况是对称的，只要解决了左左这种情况，右右就很好办了。图3是左左情况的解决方案，节点k2不满足平衡特性，因为它的左子树k1比右子树Z深2层，而且k1子树中，更深的一层的是k1的左子树X子树，所以属于左左情况。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/61ee0c83b3783cb05eac2ed3528eae3b.jpg\"><img class=\"aligncenter wp-image-111688 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/61ee0c83b3783cb05eac2ed3528eae3b.jpg\" alt=\"avltree35\" width=\"530\" height=\"229\"></a></p>\n<p>为使树恢复平衡，我们把k2变成这棵树的根节点，因为k2大于k1，把k2置于k1的右子树上，而原本在k1右子树的Y大于k1，小于k2，就把Y置于k2的左子树上，这样既满足了二叉查找树的性质，又满足了平衡二叉树的性质。</p>\n<p>这样的操作只需要一部分指针改变，结果我们得到另外一颗二叉查找树，它是一棵AVL树，因为X向上一移动了一层，Y还停留在原来的层面上，Z向下移动了一层。整棵树的新高度和之前没有在左子树上插入的高度相同，插入操作使得X高度长高了。因此，由于这颗子树高度没有变化，所以通往根节点的路径就不需要继续旋转了。</p>\n<p><strong>双旋转</strong></p>\n<p>对于左右和右左这两种情况，单旋转不能使它达到一个平衡状态，要经过两次旋转。双旋转是针对于这两种情况的解决方案，同样的，这样两种情况也是对称的，只要解决了左右这种情况，右左就很好办了。图4是左右情况的解决方案，节点k3不满足平衡特性，因为它的左子树k1比右子树Z深2层，而且k1子树中，更深的一层的是k1的右子树k2子树，所以属于左右情况。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ad609dadbff982036a8e32c792436d7.jpg\"><img class=\"aligncenter wp-image-111690 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ad609dadbff982036a8e32c792436d7.jpg\" alt=\"2012082016534455\" width=\"785\" height=\"247\"></a></p>\n<p>为使树恢复平衡，我们需要进行两步，第一步，把k1作为根，进行一次右右旋转，旋转之后就变成了左左情况，所以第二步再进行一次左左旋转，最后得到了一棵以k2为根的平衡二叉树。</p>\n<p><strong>AVL树实现源码：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d22ae3255266044\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//AVL树节点信息\r\ntemplate&lt;class T&gt;\r\nclass TreeNode\r\n{\r\n    public:\r\n        TreeNode():lson(NULL),rson(NULL),freq(1),hgt(0){}\r\n        T data;//值\r\n        int hgt;//高度\r\n        unsigned int freq;//频率\r\n        TreeNode* lson;//指向左儿子的地址\r\n        TreeNode* rson;//指向右儿子的地址\r\n};\r\n//AVL树类的属性和方法声明\r\ntemplate&lt;class T&gt;\r\nclass AVLTree\r\n{\r\n    private:\r\n        TreeNode&lt;T&gt;* root;//根节点\r\n        void insertpri(TreeNode&lt;T&gt;* &amp;node,T x);//插入\r\n        TreeNode&lt;T&gt;* findpri(TreeNode&lt;T&gt;* node,T x);//查找\r\n        void insubtree(TreeNode&lt;T&gt;* node);//中序遍历\r\n        void Deletepri(TreeNode&lt;T&gt;* &amp;node,T x);//删除\r\n        int height(TreeNode&lt;T&gt;* node);//求树的高度\r\n        void SingRotateLeft(TreeNode&lt;T&gt;* &amp;k2);//左左情况下的旋转\r\n        void SingRotateRight(TreeNode&lt;T&gt;* &amp;k2);//右右情况下的旋转\r\n        void DoubleRotateLR(TreeNode&lt;T&gt;* &amp;k3);//左右情况下的旋转\r\n        void DoubleRotateRL(TreeNode&lt;T&gt;* &amp;k3);//右左情况下的旋转\r\n        int Max(int cmpa,int cmpb);//求最大值\r\n\r\n    public:\r\n        AVLTree():root(NULL){}\r\n        void insert(T x);//插入接口\r\n        TreeNode&lt;T&gt;* find(T x);//查找接口\r\n        void Delete(T x);//删除接口\r\n        void traversal();//遍历接口\r\n\r\n};\r\n//计算节点的高度\r\ntemplate&lt;class T&gt;\r\nint AVLTree&lt;T&gt;::height(TreeNode&lt;T&gt;* node)\r\n{\r\n    if(node!=NULL)\r\n        return node-&gt;hgt;\r\n    return -1;\r\n}\r\n//求最大值\r\ntemplate&lt;class T&gt;\r\nint AVLTree&lt;T&gt;::Max(int cmpa,int cmpb)\r\n{\r\n    return cmpa&gt;cmpb?cmpa:cmpb;\r\n}\r\n//左左情况下的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::SingRotateLeft(TreeNode&lt;T&gt;* &amp;k2)\r\n{\r\n    TreeNode&lt;T&gt;* k1;\r\n    k1=k2-&gt;lson;\r\n    k2-&gt;lson=k1-&gt;rson;\r\n    k1-&gt;rson=k2;\r\n\r\n    k2-&gt;hgt=Max(height(k2-&gt;lson),height(k2-&gt;rson))+1;\r\n    k1-&gt;hgt=Max(height(k1-&gt;lson),k2-&gt;hgt)+1;\r\n}\r\n//右右情况下的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::SingRotateRight(TreeNode&lt;T&gt;* &amp;k2)\r\n{\r\n    TreeNode&lt;T&gt;* k1;\r\n    k1=k2-&gt;rson;\r\n    k2-&gt;rson=k1-&gt;lson;\r\n    k1-&gt;lson=k2;\r\n\r\n    k2-&gt;hgt=Max(height(k2-&gt;lson),height(k2-&gt;rson))+1;\r\n    k1-&gt;hgt=Max(height(k1-&gt;rson),k2-&gt;hgt)+1;\r\n}\r\n//左右情况的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::DoubleRotateLR(TreeNode&lt;T&gt;* &amp;k3)\r\n{\r\n    SingRotateRight(k3-&gt;lson);\r\n    SingRotateLeft(k3);\r\n}\r\n//右左情况的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::DoubleRotateRL(TreeNode&lt;T&gt;* &amp;k3)\r\n{\r\n    SingRotateLeft(k3-&gt;rson);\r\n    SingRotateRight(k3);\r\n}\r\n//插入\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::insertpri(TreeNode&lt;T&gt;* &amp;node,T x)\r\n{\r\n    if(node==NULL)//如果节点为空,就在此节点处加入x信息\r\n    {\r\n        node=new TreeNode&lt;T&gt;();\r\n        node-&gt;data=x;\r\n        return;\r\n    }\r\n    if(node-&gt;data&gt;x)//如果x小于节点的值,就继续在节点的左子树中插入x\r\n    {\r\n        insertpri(node-&gt;lson,x);\r\n        if(2==height(node-&gt;lson)-height(node-&gt;rson))\r\n            if(x&lt;node-&gt;lson-&gt;data)\r\n                SingRotateLeft(node);\r\n            else\r\n                DoubleRotateLR(node);\r\n    }\r\n    else if(node-&gt;data&lt;x)//如果x大于节点的值,就继续在节点的右子树中插入x\r\n    {\r\n        insertpri(node-&gt;rson,x);\r\n        if(2==height(node-&gt;rson)-height(node-&gt;lson))//如果高度之差为2的话就失去了平衡,需要旋转\r\n            if(x&gt;node-&gt;rson-&gt;data)\r\n                SingRotateRight(node);\r\n            else\r\n                DoubleRotateRL(node);\r\n    }\r\n    else ++(node-&gt;freq);//如果相等,就把频率加1\r\n    node-&gt;hgt=Max(height(node-&gt;lson),height(node-&gt;rson));\r\n}\r\n//插入接口\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::insert(T x)\r\n{\r\n    insertpri(root,x);\r\n}\r\n//查找\r\ntemplate&lt;class T&gt;\r\nTreeNode&lt;T&gt;* AVLTree&lt;T&gt;::findpri(TreeNode&lt;T&gt;* node,T x)\r\n{\r\n    if(node==NULL)//如果节点为空说明没找到,返回NULL\r\n    {\r\n        return NULL;\r\n    }\r\n    if(node-&gt;data&gt;x)//如果x小于节点的值,就继续在节点的左子树中查找x\r\n    {\r\n        return findpri(node-&gt;lson,x);\r\n    }\r\n    else if(node-&gt;data&lt;x)//如果x大于节点的值,就继续在节点的左子树中查找x\r\n    {\r\n        return findpri(node-&gt;rson,x);\r\n    }\r\n    else return node;//如果相等,就找到了此节点\r\n}\r\n//查找接口\r\ntemplate&lt;class T&gt;\r\nTreeNode&lt;T&gt;* AVLTree&lt;T&gt;::find(T x)\r\n{\r\n    return findpri(root,x);\r\n}\r\n//删除\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::Deletepri(TreeNode&lt;T&gt;* &amp;node,T x)\r\n{\r\n    if(node==NULL) return ;//没有找到值是x的节点\r\n    if(x &lt; node-&gt;data)\r\n    {\r\n         Deletepri(node-&gt;lson,x);//如果x小于节点的值,就继续在节点的左子树中删除x\r\n         if(2==height(node-&gt;rson)-height(node-&gt;lson))\r\n            if(node-&gt;rson-&gt;lson!=NULL&amp;&amp;(height(node-&gt;rson-&gt;lson)&gt;height(node-&gt;rson-&gt;rson)) )\r\n                DoubleRotateRL(node);\r\n            else\r\n                SingRotateRight(node);\r\n    }\r\n\r\n    else if(x &gt; node-&gt;data)\r\n    {\r\n         Deletepri(node-&gt;rson,x);//如果x大于节点的值,就继续在节点的右子树中删除x\r\n         if(2==height(node-&gt;lson)-height(node-&gt;rson))\r\n            if(node-&gt;lson-&gt;rson!=NULL&amp;&amp; (height(node-&gt;lson-&gt;rson)&gt;height(node-&gt;lson-&gt;lson) ))\r\n                DoubleRotateLR(node);\r\n            else\r\n                SingRotateLeft(node);\r\n    }\r\n\r\n    else//如果相等,此节点就是要删除的节点\r\n    {\r\n        if(node-&gt;lson&amp;&amp;node-&gt;rson)//此节点有两个儿子\r\n        {\r\n            TreeNode&lt;T&gt;* temp=node-&gt;rson;//temp指向节点的右儿子\r\n            while(temp-&gt;lson!=NULL) temp=temp-&gt;lson;//找到右子树中值最小的节点\r\n            //把右子树中最小节点的值赋值给本节点\r\n            node-&gt;data=temp-&gt;data;\r\n            node-&gt;freq=temp-&gt;freq;\r\n            Deletepri(node-&gt;rson,temp-&gt;data);//删除右子树中最小值的节点\r\n            if(2==height(node-&gt;lson)-height(node-&gt;rson))\r\n            {\r\n                if(node-&gt;lson-&gt;rson!=NULL&amp;&amp; (height(node-&gt;lson-&gt;rson)&gt;height(node-&gt;lson-&gt;lson) ))\r\n                    DoubleRotateLR(node);\r\n                else\r\n                    SingRotateLeft(node);\r\n            }\r\n        }\r\n        else//此节点有1个或0个儿子\r\n        {\r\n            TreeNode&lt;T&gt;* temp=node;\r\n            if(node-&gt;lson==NULL)//有右儿子或者没有儿子\r\n            node=node-&gt;rson;\r\n            else if(node-&gt;rson==NULL)//有左儿子\r\n            node=node-&gt;lson;\r\n            delete(temp);\r\n            temp=NULL;\r\n        }\r\n    }\r\n    if(node==NULL) return;\r\n    node-&gt;hgt=Max(height(node-&gt;lson),height(node-&gt;rson))+1;\r\n    return;\r\n}\r\n//删除接口\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::Delete(T x)\r\n{\r\n    Deletepri(root,x);\r\n}\r\n//中序遍历函数\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::insubtree(TreeNode&lt;T&gt;* node)\r\n{\r\n    if(node==NULL) return;\r\n    insubtree(node-&gt;lson);//先遍历左子树\r\n    cout&lt;&lt;node-&gt;data&lt;&lt;\" \";//输出根节点\r\n    insubtree(node-&gt;rson);//再遍历右子树\r\n}\r\n//中序遍历接口\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::traversal()\r\n{\r\n    insubtree(root);\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22ae3255266044-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22ae3255266044-229\">229</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-1\"><span class=\"crayon-c\">//AVL树节点信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-2\"><span class=\"crayon-e\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TreeNode</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">TreeNode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">lson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">rson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">freq</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">hgt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//高度</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//频率</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">TreeNode*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//指向左儿子的地址</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">TreeNode*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//指向右儿子的地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-13\"><span class=\"crayon-c\">//AVL树类的属性和方法声明</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-14\"><span class=\"crayon-e\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-15\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AVLTree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-16\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//根节点</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//插入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//中序遍历</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//求树的高度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//左左情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//右右情况下的旋转</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//左右情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//右左情况下的旋转</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//求最大值</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">AVLTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">root</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//插入接口</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//查找接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除接口</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">traversal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//遍历接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-36\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-37\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-38\"><span class=\"crayon-c\">//计算节点的高度</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-39\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-40\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-41\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-45\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-46\"><span class=\"crayon-c\">//求最大值</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-47\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-48\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-49\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-51\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-52\"><span class=\"crayon-c\">//左左情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-53\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-54\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-55\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-60\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-63\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-64\"><span class=\"crayon-c\">//右右情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-65\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-66\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-67\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-72\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-75\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-76\"><span class=\"crayon-c\">//左右情况的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-77\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-78\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-79\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-82\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-83\"><span class=\"crayon-c\">//右左情况的旋转</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-84\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-85\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-86\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-89\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-90\"><span class=\"crayon-c\">//插入</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-91\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-92\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-93\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果节点为空,就在此节点处加入x信息</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-98\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-99\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x小于节点的值,就继续在节点的左子树中插入x</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-102\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-103\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-104\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-105\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-106\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-107\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-108\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x大于节点的值,就继续在节点的右子树中插入x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果高度之差为2的话就失去了平衡,需要旋转</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-113\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-114\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-115\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-116\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果相等,就把频率加1</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-119\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-120\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-121\"><span class=\"crayon-c\">//插入接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-122\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-123\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-124\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-125\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-126\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-127\"><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-128\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-129\"><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-130\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-131\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果节点为空说明没找到,返回NULL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-133\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-134\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x小于节点的值,就继续在节点的左子树中查找x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-136\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-137\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x大于节点的值,就继续在节点的左子树中查找x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-142\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-143\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果相等,就找到了此节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-144\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-145\"><span class=\"crayon-c\">//查找接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-146\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-147\"><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-148\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-150\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-151\"><span class=\"crayon-c\">//删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-152\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-153\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-154\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-155\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//没有找到值是x的节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-156\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-157\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-158\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果x小于节点的值,就继续在节点的左子树中删除x</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-159\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-160\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-161\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-163\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-164\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-165\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-166\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-167\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-168\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果x大于节点的值,就继续在节点的右子树中删除x</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-169\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-171\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-172\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-173\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-174\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-175\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-c\">//如果相等,此节点就是要删除的节点</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-177\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-178\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//此节点有两个儿子</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-179\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-180\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//temp指向节点的右儿子</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-181\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//找到右子树中值最小的节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//把右子树中最小节点的值赋值给本节点</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-184\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">freq</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-185\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除右子树中最小值的节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-186\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-188\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-189\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-190\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-191\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-192\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-193\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-194\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-c\">//此节点有1个或0个儿子</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-195\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-197\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//有右儿子或者没有儿子</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-198\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//有左儿子</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-204\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-205\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-206\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-207\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-208\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-209\"><span class=\"crayon-c\">//删除接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-210\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-211\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-212\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-213\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-214\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-215\"><span class=\"crayon-c\">//中序遍历函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-216\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-217\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-218\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//先遍历左子树</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-221\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cout</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//输出根节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-222\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//再遍历右子树</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-223\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-224\"><span class=\"crayon-c\">//中序遍历接口</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-225\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-226\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">traversal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-227\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22ae3255266044-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22ae3255266044-229\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0346 seconds] -->\r\n<p></p>\n<h2 class=\"First\">3.2 平衡二叉树之红黑树</h2>\n<p><strong>红黑树的定义：</strong>红黑树是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。它是在1972年由鲁道夫·贝尔发明的，称之为”对称二叉B树”，它现代的名字是在 Leo J. Guibas 和 Robert Sedgewick 于1978年写的一篇论文中获得的。<strong>它是复杂的，但它的操作有着良好的最坏情况运行时间，并且在实践中是高效的: 它可以在O(logn)时间内做查找，插入和删除，这里的n是树中元素的数目。</strong></p>\n<p>红黑树和AVL树一样都对插入时间、删除时间和查找时间提供了最好可能的最坏情况担保。这不只是使它们在时间敏感的应用如实时应用（real time application）中有价值，而且使它们有在提供最坏情况担保的其他数据结构中作为建造板块的价值；例如，在计算几何中使用的很多数据结构都可以基于红黑树。此外，红黑树还是2-3-4树的一种等同，它们的思想是一样的，只不过红黑树是2-3-4树用二叉树的形式表示的。</p>\n<p><strong>红黑树的性质：</strong></p>\n<p>红黑树是每个节点都带有颜色属性的二叉查找树，颜色为红色或黑色。在二叉查找树强制的一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求:</p>\n<p>性质1. 节点是红色或黑色。</p>\n<p>性质2. 根是黑色。</p>\n<p>性质3. 所有叶子都是黑色（叶子是NIL节点）。</p>\n<p>性质4. 每个红色节点必须有两个黑色的子节点。(从每个叶子到根的所有路径上不能有两个连续的红色节点。)</p>\n<p>性质5. 从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点。</p>\n<p>下面是一个具体的红黑树的图例：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9fd5e683147961431e0ecfcffbe5805b.png\"><img class=\"aligncenter wp-image-111691 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9fd5e683147961431e0ecfcffbe5805b.png\" alt=\"450px-Red-black_tree_example.svg\" width=\"450\" height=\"217\"></a></p>\n<p>这些约束确保了红黑树的关键特性: 从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。结果是这个树大致上是平衡的。因为操作比如插入、删除和查找某个值的最坏情况时间都要求与树的高度成比例，这个在高度上的理论上限允许红黑树在最坏情况下都是高效的，而不同于普通的二叉查找树。</p>\n<p>要知道为什么这些性质确保了这个结果，注意到性质4导致了路径不能有两个毗连的红色节点就足够了。最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点。因为根据性质5所有最长的路径都有相同数目的黑色节点，这就表明了没有路径能多于任何其他路径的两倍长。</p>\n<p>以下内容整理自<a href=\"https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91\" target=\"_blank\">wiki百科之红黑树</a>。</p>\n<p><strong>红黑树的自平衡操作：</strong></p>\n<p>因为每一个红黑树也是一个特化的二叉查找树，因此红黑树上的只读操作与普通二叉查找树上的只读操作相同。然而，在红黑树上进行插入操作和删除操作会导致不再符合红黑树的性质。恢复红黑树的性质需要少量(O(logn))的颜色变更(实际是非常快速的)和不超过三次树旋转(对于插入操作是两次)。虽然插入和删除很复杂，但操作时间仍可以保持为O(logn) 次。</p>\n<p><strong>我们首先以二叉查找树的方法增加节点并标记它为红色。如果设为黑色，就会导致根到叶子的路径上有一条路上，多一个额外的黑节点，这个是很难调整的（违背性质5）。</strong>但是设为红色节点后，可能会导致出现两个连续红色节点的冲突，那么可以通过颜色调换（color flips）和树旋转来调整。下面要进行什么操作取决于其他临近节点的颜色。同人类的家族树中一样，我们将使用术语叔父节点来指一个节点的父节点的兄弟节点。注意:</p>\n<ul>\n<li>性质1和性质3总是保持着。</li>\n<li>性质4只在增加红色节点、重绘黑色节点为红色，或做旋转时受到威胁。</li>\n<li>性质5只在增加黑色节点、重绘红色节点为黑色，或做旋转时受到威胁。</li>\n</ul>\n<p><strong>插入操作：</strong></p>\n<p>假设，将要插入的节点标为<strong>N</strong>，N的父节点标为<strong>P</strong>，N的祖父节点标为<strong>G</strong>，N的叔父节点标为<strong>U</strong>。在图中展示的任何颜色要么是由它所处情形这些所作的假定，要么是假定所暗含的。</p>\n<p><strong>情形1: </strong>该树为空树，直接插入根结点的位置，违反性质1，把节点颜色有红改为黑即可。</p>\n<p><strong>情形2:</strong> 插入节点N的父节点P为黑色，不违反任何性质，无需做任何修改。在这种情形下，树仍是有效的。性质5也未受到威胁，尽管新节点N有两个黑色叶子子节点；但由于新节点N是红色，通过它的每个子节点的路径就都有同通过它所取代的黑色的叶子的路径同样数目的黑色节点，所以依然满足这个性质。</p>\n<p>注： 情形1很简单，情形2中P为黑色，一切安然无事，但P为红就不一样了，下边是P为红的各种情况，也是真正难懂的地方。</p>\n<p><strong>情形3: </strong>如果父节点P和叔父节点U二者都是红色，(此时新插入节点N做为P的左子节点或右子节点都属于情形3,这里右图仅显示N做为P左子的情形)则我们可以将它们两个重绘为黑色并重绘祖父节点G为红色(用来保持性质4)。现在我们的新节点N有了一个黑色的父节点P。因为通过父节点P或叔父节点U的任何路径都必定通过祖父节点G，在这些路径上的黑节点数目没有改变。但是，红色的祖父节点G的父节点也有可能是红色的，这就违反了性质4。为了解决这个问题，我们在祖父节点G上递归地进行上述情形的整个过程（把G当成是新加入的节点进行各种情形的检查）。比如，G为根节点，那我们就直接将G变为黑色（情形1）；如果G不是根节点，而它的父节点为黑色，那符合所有的性质，直接插入即可（情形2）；如果G不是根节点，而它的父节点为红色，则递归上述过程（情形3）。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/dc3747336812e9055f958c56ade89eb8.png\"><img class=\"aligncenter wp-image-111692 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dc3747336812e9055f958c56ade89eb8.png\" alt=\"2011120116425251\" width=\"300\" height=\"139\"></a></p>\n<p><strong>情形4:</strong> 父节点P是红色而叔父节点U是黑色或缺少，新节点N是其父节点的左子节点，而父节点P又是其父节点G的左子节点。在这种情形下，我们进行针对祖父节点G的一次右旋转; 在旋转产生的树中，以前的父节点P现在是新节点N和以前的祖父节点G的父节点。我们知道以前的祖父节点G是黑色，否则父节点P就不可能是红色(如果P和G都是红色就违反了性质4，所以G必须是黑色)。我们切换以前的父节点P和祖父节点G的颜色，结果的树满足性质4。性质5也仍然保持满足，因为通过这三个节点中任何一个的所有路径以前都通过祖父节点G，现在它们都通过以前的父节点P。在各自的情形下，这都是三个节点中唯一的黑色节点。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/4986c959603100e41cba2669d9e3ce0c.png\"><img class=\"aligncenter wp-image-111693 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4986c959603100e41cba2669d9e3ce0c.png\" alt=\"Red-black_tree_insert_case_5\" width=\"310\" height=\"138\"></a></p>\n<p><strong>情形5:</strong> 父节点P是红色而叔父节点U是黑色或缺少，并且新节点N是其父节点P的右子节点而父节点P又是其父节点的左子节点。在这种情形下，我们进行一次左旋转调换新节点和其父节点的角色; 接着，我们按<strong>情形4</strong>处理以前的父节点P以解决仍然失效的性质4。注意这个改变会导致某些路径通过它们以前不通过的新节点N（比如图中1号叶子节点）或不通过节点P（比如图中3号叶子节点），但由于这两个节点都是红色的，所以性质5仍有效。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9cfbf62dfdefe5891347de95a976758f.png\"><img class=\"aligncenter wp-image-111694 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9cfbf62dfdefe5891347de95a976758f.png\" alt=\"Red-black_tree_insert_case_5\" width=\"283\" height=\"138\"></a></p>\n<p><strong>注: 插入实际上是原地算法，因为上述所有调用都使用了尾部递归。</strong></p>\n<p><strong>删除操作：</strong></p>\n<p><strong>如果需要删除的节点有两个儿子，那么问题可以被转化成删除另一个只有一个儿子的节点的问题</strong>。对于二叉查找树，在删除带有两个非叶子儿子的节点的时候，我们找到要么在它的左子树中的最大元素、要么在它的右子树中的最小元素，并把它的值转移到要删除的节点中。我们接着删除我们从中复制出值的那个节点，它必定有少于两个非叶子的儿子。因为只是复制了一个值，不违反任何性质，这就把问题简化为如何删除最多有一个儿子的节点的问题。它不关心这个节点是最初要删除的节点还是我们从中复制出值的那个节点。</p>\n<p><strong>我们只需要讨论删除只有一个儿子的节点</strong>(如果它两个儿子都为空，即均为叶子，我们任意将其中一个看作它的儿子)。如果我们删除一个红色节点（此时该节点的儿子将都为叶子节点），它的父亲和儿子一定是黑色的。所以我们可以简单的用它的黑色儿子替换它，并不会破坏性质3和性质4。通过被删除节点的所有路径只是少了一个红色节点，这样可以继续保证性质5。另一种简单情况是在被删除节点是黑色而它的儿子是红色的时候。如果只是去除这个黑色节点，用它的红色儿子顶替上来的话，会破坏性质5，但是如果我们重绘它的儿子为黑色，则曾经通过它的所有路径将通过它的黑色儿子，这样可以继续保持性质5。</p>\n<p><strong>需要进一步讨论的是在要删除的节点和它的儿子二者都是黑色的时候</strong>，这是一种复杂的情况。我们首先把要删除的节点替换为它的儿子。出于方便，称呼这个儿子为<strong>N</strong>(在新的位置上)，称呼它的兄弟(它父亲的另一个儿子)为<strong>S</strong>。在下面的示意图中，我们还是使用<strong>P</strong>称呼N的父亲，<strong>S<sub>L</sub></strong>称呼S的左儿子，<strong>S<sub>R</sub></strong>称呼S的右儿子。</p>\n<p>如果N和它初始的父亲是黑色，则删除它的父亲导致通过N的路径都比不通过它的路径少了一个黑色节点。因为这违反了性质5，树需要被重新平衡。有几种情形需要考虑:</p>\n<p><strong>情形1:</strong> N是新的根。在这种情形下，我们就做完了。我们从所有路径去除了一个黑色节点，而新根是黑色的，所以性质都保持着。</p>\n<p><strong>注意</strong>: 在情形2、5和6下，我们假定N是它父亲的左儿子。如果它是右儿子，则在这些情形下的左和右应当对调。</p>\n<p><strong>情形2:</strong> S是红色。在这种情形下我们在N的父亲上做左旋转，把红色兄弟转换成N的祖父，我们接着对调N的父亲和祖父的颜色。完成这两个操作后，尽管所有路径上黑色节点的数目没有改变，但现在N有了一个黑色的兄弟和一个红色的父亲（它的新兄弟是黑色因为它是红色S的一个儿子），所以我们可以接下去按<strong>情形4</strong>、<strong>情形5</strong>或<strong>情形6</strong>来处理。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce86b0e24e64c35067f5d087dc4c90ae.png\"><img class=\"aligncenter wp-image-111695 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce86b0e24e64c35067f5d087dc4c90ae.png\" alt=\"Red-black_tree_insert_case_5\" width=\"298\" height=\"136\"></a></p>\n<p><strong>情形3:</strong> N的父亲、S和S的儿子都是黑色的。在这种情形下，我们简单的重绘S为红色。结果是通过S的所有路径，它们就是以前<em>不</em>通过N的那些路径，都少了一个黑色节点。因为删除N的初始的父亲使通过N的所有路径少了一个黑色节点，这使事情都平衡了起来。但是，通过P的所有路径现在比不通过P的路径少了一个黑色节点，所以仍然违反性质5。要修正这个问题，我们要从<strong>情形1</strong>开始，在P上做重新平衡处理。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/30759b4136b3cd56ba31eb8d06a434d2.png\"><img class=\"aligncenter wp-image-111696 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/30759b4136b3cd56ba31eb8d06a434d2.png\" alt=\"Red-black_tree_insert_case_5\" width=\"313\" height=\"132\"></a></p>\n<p><strong>情形4:</strong> S和S的儿子都是黑色，但是N的父亲是红色。在这种情形下，我们简单的交换N的兄弟和父亲的颜色。这不影响不通过N的路径的黑色节点的数目，但是它在通过N的路径上对黑色节点数目增加了一，添补了在这些路径上删除的黑色节点。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/61bda9c9a89a3f9ea5f01ed990070a39.png\"><img class=\"aligncenter wp-image-111697 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/61bda9c9a89a3f9ea5f01ed990070a39.png\" alt=\"Red-black_tree_insert_case_5\" width=\"313\" height=\"132\"></a></p>\n<p><strong>情形5:</strong> S是黑色，S的左儿子是红色，S的右儿子是黑色，而N是它父亲的左儿子。在这种情形下我们在S上做右旋转，这样S的左儿子成为S的父亲和N的新兄弟。我们接着交换S和它的新父亲的颜色。所有路径仍有同样数目的黑色节点，但是现在N有了一个黑色兄弟，他的右儿子是红色的，所以我们进入了<strong>情形6</strong>。N和它的父亲都不受这个变换的影响。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9f411d70951995007ad2a59fb747d160.png\"><img class=\"aligncenter wp-image-111698 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9f411d70951995007ad2a59fb747d160.png\" alt=\"Red-black_tree_insert_case_5\" width=\"247\" height=\"133\"></a></p>\n<p> </p>\n<p><strong>情形6:</strong> S是黑色，S的右儿子是红色，而N是它父亲的左儿子。在这种情形下我们在N的父亲上做左旋转，这样S成为N的父亲（P）和S的右儿子的父亲。我们接着交换N的父亲和S的颜色，并使S的右儿子为黑色。子树在它的根上的仍是同样的颜色，所以性质3没有被违反。但是，N现在增加了一个黑色祖先: 要么N的父亲变成黑色，要么它是黑色而S被增加为一个黑色祖父。所以，通过N的路径都增加了一个黑色节点。</p>\n<p>此时，如果一个路径不通过N，则有两种可能性:</p>\n<ul>\n<li>它通过N的新兄弟。那么它以前和现在都必定通过S和N的父亲，而它们只是交换了颜色。所以路径保持了同样数目的黑色节点。</li>\n<li>它通过N的新叔父，S的右儿子。那么它以前通过S、S的父亲和S的右儿子，但是现在只通过S，它被假定为它以前的父亲的颜色，和S的右儿子，它被从红色改变为黑色。合成效果是这个路径通过了同样数目的黑色节点。</li>\n</ul>\n<p>在任何情况下，在这些路径上的黑色节点数目都没有改变。所以我们恢复了性质4。在示意图中的白色节点可以是红色或黑色，但是在变换前后都必须指定相同的颜色。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c0ea423eef5e175e0ba92e43ad17270d.png\"><img class=\"aligncenter wp-image-111699 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c0ea423eef5e175e0ba92e43ad17270d.png\" alt=\"Red-black_tree_insert_case_5\" width=\"299\" height=\"143\"></a></p>\n<p><strong>红黑树实现源码：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d22af5990783211\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define BLACK 1\r\n#define RED 0\r\n\r\nusing namespace std;\r\n\r\nclass bst {\r\nprivate:\r\n\r\n    struct Node {\r\n        int value;\r\n        bool color;\r\n        Node *leftTree, *rightTree, *parent;\r\n\r\n        Node() {\r\n            color = RED;\r\n            leftTree = NULL;\r\n            rightTree = NULL;\r\n            parent = NULL;\r\n            value = 0;\r\n        }\r\n\r\n        Node* grandparent() {\r\n            if (parent == NULL) {\r\n                return NULL;\r\n            }\r\n            return parent-&gt;parent;\r\n        }\r\n\r\n        Node* uncle() {\r\n            if (grandparent() == NULL) {\r\n                return NULL;\r\n            }\r\n            if (parent == grandparent()-&gt;rightTree)\r\n                return grandparent()-&gt;leftTree;\r\n            else\r\n                return grandparent()-&gt;rightTree;\r\n        }\r\n\r\n        Node* sibling() {\r\n            if (parent-&gt;leftTree == this)\r\n                return parent-&gt;rightTree;\r\n            else\r\n                return parent-&gt;leftTree;\r\n        }\r\n    };\r\n\r\n    void rotate_right(Node *p) {\r\n        Node *gp = p-&gt;grandparent();\r\n        Node *fa = p-&gt;parent;\r\n        Node *y = p-&gt;rightTree;\r\n\r\n        fa-&gt;leftTree = y;\r\n\r\n        if (y != NIL)\r\n            y-&gt;parent = fa;\r\n        p-&gt;rightTree = fa;\r\n        fa-&gt;parent = p;\r\n\r\n        if (root == fa)\r\n            root = p;\r\n        p-&gt;parent = gp;\r\n\r\n        if (gp != NULL) {\r\n            if (gp-&gt;leftTree == fa)\r\n                gp-&gt;leftTree = p;\r\n            else\r\n                gp-&gt;rightTree = p;\r\n        }\r\n\r\n    }\r\n\r\n    void rotate_left(Node *p) {\r\n        if (p-&gt;parent == NULL) {\r\n            root = p;\r\n            return;\r\n        }\r\n        Node *gp = p-&gt;grandparent();\r\n        Node *fa = p-&gt;parent;\r\n        Node *y = p-&gt;leftTree;\r\n\r\n        fa-&gt;rightTree = y;\r\n\r\n        if (y != NIL)\r\n            y-&gt;parent = fa;\r\n        p-&gt;leftTree = fa;\r\n        fa-&gt;parent = p;\r\n\r\n        if (root == fa)\r\n            root = p;\r\n        p-&gt;parent = gp;\r\n\r\n        if (gp != NULL) {\r\n            if (gp-&gt;leftTree == fa)\r\n                gp-&gt;leftTree = p;\r\n            else\r\n                gp-&gt;rightTree = p;\r\n        }\r\n    }\r\n\r\n    void inorder(Node *p) {\r\n        if (p == NIL)\r\n            return;\r\n\r\n        if (p-&gt;leftTree)\r\n            inorder(p-&gt;leftTree);\r\n\r\n        cout &lt;&lt; p-&gt;value &lt;&lt; \" \";\r\n                \r\n        if (p-&gt;rightTree)\r\n            inorder(p-&gt;rightTree);\r\n    }\r\n\r\n    string outputColor(bool color) {\r\n        return color ? \"BLACK\" : \"RED\";\r\n    }\r\n\r\n    Node* getSmallestChild(Node *p) {\r\n        if (p-&gt;leftTree == NIL)\r\n            return p;\r\n        return getSmallestChild(p-&gt;leftTree);\r\n    }\r\n\r\n    bool delete_child(Node *p, int data) {\r\n        if (p-&gt;value &gt; data) {\r\n            if (p-&gt;leftTree == NIL) {\r\n                return false;\r\n            }\r\n            return delete_child(p-&gt;leftTree, data);\r\n        } else if (p-&gt;value &lt; data) {\r\n            if (p-&gt;rightTree == NIL) {\r\n                return false;\r\n            }\r\n            return delete_child(p-&gt;rightTree, data);\r\n        } else if (p-&gt;value == data) {\r\n            if (p-&gt;rightTree == NIL) {\r\n                delete_one_child(p);\r\n                return true;\r\n            }\r\n            Node *smallest = getSmallestChild(p-&gt;rightTree);\r\n            swap(p-&gt;value, smallest-&gt;value);\r\n            delete_one_child(smallest);\r\n\r\n            return true;\r\n        }\r\n    }\r\n\r\n    void delete_one_child(Node *p) {\r\n        Node *child = p-&gt;leftTree == NIL ? p-&gt;rightTree : p-&gt;leftTree;\r\n        if (p-&gt;parent == NULL &amp;&amp; p-&gt;leftTree == NIL &amp;&amp; p-&gt;rightTree == NIL) {\r\n            p = NULL;\r\n            root = p;\r\n            return;\r\n        }\r\n        \r\n        if (p-&gt;parent == NULL) {\r\n            delete  p;\r\n            child-&gt;parent = NULL;\r\n            root = child;\r\n            root-&gt;color = BLACK;\r\n            return;\r\n        }\r\n        \r\n        if (p-&gt;parent-&gt;leftTree == p) {\r\n            p-&gt;parent-&gt;leftTree = child;\r\n        } else {\r\n            p-&gt;parent-&gt;rightTree = child;\r\n        }\r\n        child-&gt;parent = p-&gt;parent;\r\n\r\n        if (p-&gt;color == BLACK) {\r\n            if (child-&gt;color == RED) {\r\n                child-&gt;color = BLACK;\r\n            } else\r\n                delete_case(child);\r\n        }\r\n\r\n        delete p;\r\n    }\r\n\r\n    void delete_case(Node *p) {\r\n        if (p-&gt;parent == NULL) {\r\n            p-&gt;color = BLACK;\r\n            return;\r\n        }\r\n        if (p-&gt;sibling()-&gt;color == RED) {\r\n            p-&gt;parent-&gt;color = RED;\r\n            p-&gt;sibling()-&gt;color = BLACK;\r\n            if (p == p-&gt;parent-&gt;leftTree)\r\n                rotate_left(p-&gt;sibling());\r\n            else\r\n                rotate_right(p-&gt;sibling());\r\n        }\r\n        if (p-&gt;parent-&gt;color == BLACK &amp;&amp; p-&gt;sibling()-&gt;color == BLACK\r\n                &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == BLACK &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == BLACK) {\r\n            p-&gt;sibling()-&gt;color = RED;\r\n            delete_case(p-&gt;parent);\r\n        } else if (p-&gt;parent-&gt;color == RED &amp;&amp; p-&gt;sibling()-&gt;color == BLACK\r\n                &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == BLACK &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == BLACK) {\r\n            p-&gt;sibling()-&gt;color = RED;\r\n            p-&gt;parent-&gt;color = BLACK;\r\n        } else {\r\n            if (p-&gt;sibling()-&gt;color == BLACK) {\r\n                if (p == p-&gt;parent-&gt;leftTree &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == RED\r\n                        &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == BLACK) {\r\n                    p-&gt;sibling()-&gt;color = RED;\r\n                    p-&gt;sibling()-&gt;leftTree-&gt;color = BLACK;\r\n                    rotate_right(p-&gt;sibling()-&gt;leftTree);\r\n                } else if (p == p-&gt;parent-&gt;rightTree &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == BLACK\r\n                        &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == RED) {\r\n                    p-&gt;sibling()-&gt;color = RED;\r\n                    p-&gt;sibling()-&gt;rightTree-&gt;color = BLACK;\r\n                    rotate_left(p-&gt;sibling()-&gt;rightTree);\r\n                }\r\n            }\r\n            p-&gt;sibling()-&gt;color = p-&gt;parent-&gt;color;\r\n            p-&gt;parent-&gt;color = BLACK;\r\n            if (p == p-&gt;parent-&gt;leftTree) {\r\n                p-&gt;sibling()-&gt;rightTree-&gt;color = BLACK;\r\n                rotate_left(p-&gt;sibling());\r\n            } else {\r\n                p-&gt;sibling()-&gt;leftTree-&gt;color = BLACK;\r\n                rotate_right(p-&gt;sibling());\r\n            }\r\n        }\r\n    }\r\n\r\n    void insert(Node *p, int data) {\r\n        if (p-&gt;value &gt;= data) {\r\n            if (p-&gt;leftTree != NIL)\r\n                insert(p-&gt;leftTree, data);\r\n            else {\r\n                Node *tmp = new Node();\r\n                tmp-&gt;value = data;\r\n                tmp-&gt;leftTree = tmp-&gt;rightTree = NIL;\r\n                tmp-&gt;parent = p;\r\n                p-&gt;leftTree = tmp;\r\n                insert_case(tmp);\r\n            }\r\n        } else {\r\n            if (p-&gt;rightTree != NIL)\r\n                insert(p-&gt;rightTree, data);\r\n            else {\r\n                Node *tmp = new Node();\r\n                tmp-&gt;value = data;\r\n                tmp-&gt;leftTree = tmp-&gt;rightTree = NIL;\r\n                tmp-&gt;parent = p;\r\n                p-&gt;rightTree = tmp;\r\n                insert_case(tmp);\r\n            }\r\n        }\r\n    }\r\n\r\n    void insert_case(Node *p) {\r\n        if (p-&gt;parent == NULL) {\r\n            root = p;\r\n            p-&gt;color = BLACK;\r\n            return;\r\n        }\r\n        if (p-&gt;parent-&gt;color == RED) {\r\n            if (p-&gt;uncle()-&gt;color == RED) {\r\n                p-&gt;parent-&gt;color = p-&gt;uncle()-&gt;color = BLACK;\r\n                p-&gt;grandparent()-&gt;color = RED;\r\n                insert_case(p-&gt;grandparent());\r\n            } else {\r\n                if (p-&gt;parent-&gt;rightTree == p &amp;&amp; p-&gt;grandparent()-&gt;leftTree == p-&gt;parent) {\r\n                    rotate_left(p);\r\n                    rotate_right(p);\r\n                    p-&gt;color = BLACK;\r\n                    p-&gt;leftTree-&gt;color = p-&gt;rightTree-&gt;color = RED;\r\n                } else if (p-&gt;parent-&gt;leftTree == p &amp;&amp; p-&gt;grandparent()-&gt;rightTree == p-&gt;parent) {\r\n                    rotate_right(p);\r\n                    rotate_left(p);\r\n                    p-&gt;color = BLACK;\r\n                    p-&gt;leftTree-&gt;color = p-&gt;rightTree-&gt;color = RED;\r\n                } else if (p-&gt;parent-&gt;leftTree == p &amp;&amp; p-&gt;grandparent()-&gt;leftTree == p-&gt;parent) {\r\n                    p-&gt;parent-&gt;color = BLACK;\r\n                    p-&gt;grandparent()-&gt;color = RED;\r\n                    rotate_right(p-&gt;parent);\r\n                } else if (p-&gt;parent-&gt;rightTree == p &amp;&amp; p-&gt;grandparent()-&gt;rightTree == p-&gt;parent) {\r\n                    p-&gt;parent-&gt;color = BLACK;\r\n                    p-&gt;grandparent()-&gt;color = RED;\r\n                    rotate_left(p-&gt;parent);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    void DeleteTree(Node *p) {\r\n        if (!p || p == NIL) {\r\n            return;\r\n        }\r\n        DeleteTree(p-&gt;leftTree);\r\n        DeleteTree(p-&gt;rightTree);\r\n        delete p;\r\n    }\r\npublic:\r\n\r\n    bst() {\r\n        NIL = new Node();\r\n        NIL-&gt;color = BLACK;\r\n        root = NULL;\r\n    }\r\n\r\n    ~bst() {\r\n        if (root)\r\n            DeleteTree(root);\r\n        delete NIL;\r\n    }\r\n\r\n    void inorder() {\r\n        if (root == NULL)\r\n            return;\r\n        inorder(root);\r\n        cout &lt;&lt; endl;\r\n    }\r\n\r\n    void insert(int x) {\r\n        if (root == NULL) {\r\n            root = new Node();\r\n            root-&gt;color = BLACK;\r\n            root-&gt;leftTree = root-&gt;rightTree = NIL;\r\n            root-&gt;value = x;\r\n        } else {\r\n            insert(root, x);\r\n        }\r\n    }\r\n\r\n    bool delete_value(int data) {\r\n        return delete_child(root, data);\r\n    }\r\nprivate:\r\n    Node *root, *NIL;\r\n};</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-294\">294</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-295\">295</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-296\">296</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-297\">297</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-298\">298</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-299\">299</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-300\">300</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-301\">301</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-302\">302</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-303\">303</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-304\">304</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-305\">305</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-306\">306</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-307\">307</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-308\">308</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-309\">309</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-310\">310</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-311\">311</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-312\">312</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-313\">313</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-314\">314</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-315\">315</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-316\">316</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-317\">317</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-318\">318</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-319\">319</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-320\">320</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-321\">321</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-322\">322</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-323\">323</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-324\">324</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-325\">325</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-326\">326</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-327\">327</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-328\">328</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-329\">329</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-330\">330</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-331\">331</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d22af5990783211-332\">332</div><div class=\"crayon-num\" data-line=\"crayon-5966007d22af5990783211-333\">333</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-1\"><span class=\"crayon-p\">#define BLACK 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-2\"><span class=\"crayon-p\">#define RED 0</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-4\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bst</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-7\"><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-8\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-24\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-28\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uncle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-38\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-43\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-46\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">fa</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-58\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-60\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-62\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-64\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-66\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-67\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-71\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-74\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">fa</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-80\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-82\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-84\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-87\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-88\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-89\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-91\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-93\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-94\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-95\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-96\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-101\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-102\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-103\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-104\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-105\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-106\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-107\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-108\"><span class=\"crayon-h\">                </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-110\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-112\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-113\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">outputColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-114\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BLACK\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"RED\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-115\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-116\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSmallestChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-119\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-120\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSmallestChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-121\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-122\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-125\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-126\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-127\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-128\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-131\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-132\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-133\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-134\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-135\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-136\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">delete_one_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-137\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-138\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-139\"><span class=\"crayon-h\">            </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">smallest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSmallestChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-140\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">smallest</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-141\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">delete_one_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">smallest</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-142\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-143\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-145\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-146\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-147\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_one_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">NIL</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-149\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-150\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-151\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-152\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-153\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-154\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-155\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">delete</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-157\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-158\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-159\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-160\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-162\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-163\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-164\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-165\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-166\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-167\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-168\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-169\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-170\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-171\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-172\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-173\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-174\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">delete_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-175\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-176\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-177\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-178\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-179\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-180\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-181\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-184\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-185\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-186\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-188\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-189\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-190\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-191\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-193\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-194\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-195\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">delete_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-197\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-198\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-201\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-203\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-204\"><span class=\"crayon-h\">                        </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-205\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-206\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-207\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-208\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-209\"><span class=\"crayon-h\">                        </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-210\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-211\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-212\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-213\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-214\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-215\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-216\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-217\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-218\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-219\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-220\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-221\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-222\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-223\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-224\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-225\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-226\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-227\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-228\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-230\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-232\"><span class=\"crayon-h\">                </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-233\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-234\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-235\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-236\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-237\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-238\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-239\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-240\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-241\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-242\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-243\"><span class=\"crayon-h\">                </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-244\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-245\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-246\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-247\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-248\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-249\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-250\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-251\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-252\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-253\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-254\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-255\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-256\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-258\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-260\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">uncle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-261\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">uncle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-262\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-263\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-264\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-265\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-266\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-267\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-268\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-269\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-270\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-271\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-272\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-273\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-274\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-275\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-276\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-277\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-278\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-279\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-280\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-281\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-282\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-283\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-284\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-286\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-287\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-288\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-289\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-290\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-291\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-292\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-293\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-294\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-295\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-296\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-297\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-298\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">bst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-299\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-300\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-301\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-302\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-303\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-304\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">bst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-305\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-306\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-307\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">delete </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-308\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-309\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-310\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-311\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-312\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-313\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-314\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-315\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-316\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-317\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-318\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-319\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-320\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-321\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-322\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-323\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-324\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-325\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-326\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-327\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-328\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-329\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-330\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-331\"><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d22af5990783211-332\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d22af5990783211-333\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0605 seconds] -->\r\n<p></p>\n<h1 class=\"First\">4. B树</h1>\n<p>B树也是一种用于查找的平衡树，但是它不是二叉树。</p>\n<p><strong>B树的定义：</strong>B树（<span class=\"LangWithName\"><span lang=\"en\" xml:lang=\"en\">B-tree）是一种树状数据结构，能够用来存储排序后的数据。这种数据结构能够让查找数据、循序存取、插入数据及删除的动作，都在对数时间内完成。B树，概括来说是一个一般化的二叉查找树，可以拥有多于2个子节点。与自平衡二叉查找树不同，B-树为系统最优化大块数据的读和写操作。B-tree算法减少定位记录时所经历的中间过程，从而加快存取速度。这种数据结构常被应用在数据库和文件系统的实作上。</span></span></p>\n<p>在B树中查找给定关键字的方法是，首先把根结点取来，在根结点所包含的关键字K1,…,Kn查找给定的关键字（可用顺序查找或二分查找法），若找到等于给定值的关键字，则查找成功；否则，一定可以确定要查找的关键字在Ki与Ki+1之间，Pi为指向子树根节点的指针，此时取指针Pi所指的结点继续查找，直至找到，或指针Pi为空时查找失败。</p>\n<p>B树作为一种多路搜索树（并不是二叉的）：</p>\n<p>1) 定义任意非叶子结点最多只有M个儿子；且M&gt;2；</p>\n<p>2) 根结点的儿子数为[2, M]；</p>\n<p>3) 除根结点以外的非叶子结点的儿子数为[M/2, M]；</p>\n<p>4) 每个结点存放至少M/2-1（取上整）和至多M-1个关键字；（至少2个关键字）</p>\n<p>5) 非叶子结点的关键字个数=指向儿子的指针个数-1；</p>\n<p>6) 非叶子结点的关键字：K[1], K[2], …, K[M-1]；且K[i] &lt; K[i+1]；</p>\n<p>7) 非叶子结点的指针：P[1], P[2], …, P[M]；其中P[1]指向关键字小于K[1]的子树，P[M]指向关键字大于K[M-1]的子树，其它P[i]指向关键字属于(K[i-1], K[i])的子树；</p>\n<p>8) 所有叶子结点位于同一层；</p>\n<p>如下图为一个M=3的B树示例：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0178191b698ab75a98fa1d0bb03cc51f.jpg\"><img class=\"aligncenter wp-image-111700 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0178191b698ab75a98fa1d0bb03cc51f.jpg\" alt=\"4\" width=\"624\" height=\"268\"></a></p>\n<p>B树创建的示意图：</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fh5p12mz57g20qm06d4qq.gif\" width=\"958\" height=\"229\"></p>\n<h1 class=\"First\">5. B+树</h1>\n<p>B+树是B树的变体，也是一种多路搜索树：</p>\n<p>1) 其定义基本与B-树相同，除了：</p>\n<p>2) 非叶子结点的子树指针与关键字个数相同；</p>\n<p>3) 非叶子结点的子树指针P[i]，指向关键字值属于[K[i], K[i+1])的子树（B-树是开区间）；</p>\n<p>4) 为所有叶子结点增加一个链指针；</p>\n<p>5) 所有关键字都在叶子结点出现；</p>\n<p>下图为M=3的B+树的示意图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0972ef809f286cc29cd2d94687b2ef2d.jpg\"><img class=\"aligncenter wp-image-111701 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0972ef809f286cc29cd2d94687b2ef2d.jpg\" alt=\"4\" width=\"569\" height=\"345\"></a></p>\n<p>B+树的搜索与B树也基本相同，区别是B+树只有达到叶子结点才命中（B树可以在非叶子结点命中），其性能也等价于在关键字全集做一次二分查找；</p>\n<p><strong>B+的性质：</strong></p>\n<p>1.所有关键字都出现在叶子结点的链表中（稠密索引），且链表中的关键字恰好是有序的；</p>\n<p>2.不可能在非叶子结点命中；</p>\n<p>3.非叶子结点相当于是叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层；</p>\n<p>4.更适合文件索引系统。</p>\n<p>下面为一个B+树创建的示意图：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fh5p2ef94jg20rz05i7wi.gif\" width=\"1007\" height=\"198\"></p>\n<h1 class=\"First\">6. B*树</h1>\n<p>B*树是B+树的变体，在B+树的非根和非叶子结点再增加指向兄弟的指针，将结点的最低利用率从1/2提高到2/3。</p>\n<p>B*树如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb5835f421e029240105ccb8e80279ee.jpg\"><img class=\"aligncenter wp-image-111702 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb5835f421e029240105ccb8e80279ee.jpg\" alt=\"4\" width=\"569\" height=\"345\"></a></p>\n<p>B*树定义了非叶子结点关键字个数至少为(2/3)*M，即块的最低使用率为2/3（代替B+树的1/2）；</p>\n<p>B+树的分裂：当一个结点满时，分配一个新的结点，并将原结点中1/2的数据复制到新结点，最后在父结点中增加新结点的指针；B+树的分裂只影响原结点和父结点，而不会影响兄弟结点，所以它不需要指向兄弟的指针；</p>\n<p>B*树的分裂：当一个结点满时，如果它的下一个兄弟结点未满，那么将一部分数据移到兄弟结点中，再在原结点插入关键字，最后修改父结点中兄弟结点的关键字（因为兄弟结点的关键字范围改变了）；如果兄弟也满了，则在原结点与兄弟结点之间增加新结点，并各复制1/3的数据到新结点，最后在父结点增加新结点的指针；</p>\n<p>所以，B*树分配新结点的概率比B+树要低，空间使用率更高。</p>\n<h1 class=\"First\">7. Trie树</h1>\n<p>Tire树称为字典树，又称单词查找树，Trie树，是一种树形结构，是一种哈希树的变种。典型应用是用于统计，排序和保存大量的字符串（但不仅限于字符串），所以经常被搜索引擎系统用于文本词频统计。<strong>它的优点是：利用字符串的公共前缀来减少查询时间，最大限度地减少无谓的字符串比较，查询效率比哈希树高。</strong></p>\n<div class=\"para\"><strong>Tire树的三个基本性质：</strong></div>\n<div class=\"para\">1) 根节点不包含字符，除根节点外每一个节点都只包含一个字符；</div>\n<div class=\"para\">2) 从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串；</div>\n<div class=\"para\">3) 每个节点的所有子节点包含的字符都不相同。</div>\n<p><strong>Tire树的应用：</strong></p>\n<p>1) <span class=\"headline-content\">串的快速检索</span></p>\n<p class=\"para\">给出N个单词组成的熟词表，以及一篇全用小写英文书写的文章，请你按最早出现的顺序写出所有不在熟词表中的生词。在这道题中，我们可以用数组枚举，用哈希，用字典树，先把熟词建一棵树，然后读入文章进行比较，这种方法效率是比较高的。</p>\n<p class=\"para\"><span class=\"headline-content\">2) “串”排序</span></p>\n<p class=\"para\">给定N个互不相同的仅由一个单词构成的英文名，让你将他们按字典序从小到大输出。用字典树进行排序，采用数组的方式创建字典树，这棵树的每个结点的所有儿子很显然地按照其字母大小排序。对这棵树进行先序遍历即可。</p>\n<p class=\"para\"><span class=\"headline-content\">3) 最长公共前缀</span></p>\n<p class=\"para\">对所有串建立字典树，对于两个串的最长公共前缀的长度即他们所在的结点的公共祖先个数，于是，问题就转化为求公共祖先的问题。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111680\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111680votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111680\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('Redis 源码学习之事件驱动', '2017-07-12', 'http://blog.jobbole.com/111425/', '0e15cd9faed6520743e695ffd3f07ef6', 'http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png', 'full/c766feed221138f7946130756cddfc7e86e388b4.jpg', '0', '0', '1', 'IT技术,Redis,数据库', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://beautyboss.farbox.com/post/redis/redisyuan-ma-xue-xi-zhi-shi-jian-qu-dong\">天凉好个秋</a>   </div><p><code>Redis</code>基于多路复用技术实现了一套简单的事件驱动库，代码在<code>ae.h</code>、<code>ae.c</code>以及<code>ae_epoll.c</code>、<code>ae_evport.c</code>和<code>ae_kqueue.c</code>、<code>ae_select.c</code>这几个文件中。其中<code>ae</code>表示的是<code>antirez eventloop</code>的意思。</p>\n<p><code>Redis</code>里面包含两种事件类型:<code>FileEvent</code>和<code>TimeEvent</code>。</p>\n<p><code>Redis</code>采用<code>IO</code>多路复用技术，所有的事件都是在一个线程中进行处理。<code>Redis</code>的事件驱动模型可以以以下为代码进行表示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e2e739585234\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint main(int argc,char **argv) \r\n{\r\n    while(true) {\r\n        // 等待事件到来:wait4Event();\r\n        // 处理事件:processEvent()\r\n    }\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e2e739585234-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e2e739585234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e2e739585234-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e2e739585234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e2e739585234-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e2e739585234-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e2e739585234-7\">7</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e2e739585234-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e2e739585234-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e2e739585234-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e2e739585234-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 等待事件到来:wait4Event();</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e2e739585234-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 处理事件:processEvent()</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e2e739585234-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e2e739585234-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在一个死循环中等待事件的到来，然后对事件进行处理，以此往复。这就是一个最经典的网络编程模型。</p>\n<h3>1.基本数据结构</h3>\n<p><strong>aeEventLoop</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e38586404452\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* State of an event based program */\r\ntypedef struct aeEventLoop {\r\n    int maxfd;   /* highest file descriptor currently registered */\r\n    int setsize; /* max number of file descriptors tracked */\r\n    long long timeEventNextId;\r\n    time_t lastTime;     /* Used to detect system clock skew */\r\n    aeFileEvent *events; /* Registered events */\r\n    aeFiredEvent *fired; /* Fired events */\r\n    aeTimeEvent *timeEventHead;\r\n    int stop;\r\n    void *apidata; /* This is used for polling API specific data */\r\n    aeBeforeSleepProc *beforesleep;\r\n} aeEventLoop;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e38586404452-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e38586404452-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e38586404452-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e38586404452-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e38586404452-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e38586404452-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e38586404452-13\">13</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-1\"><span class=\"crayon-c\">/* State of an event based program */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e38586404452-2\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeEventLoop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxfd</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">/* highest file descriptor currently registered */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e38586404452-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* max number of file descriptors tracked */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeEventNextId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e38586404452-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">time_t </span><span class=\"crayon-v\">lastTime</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">/* Used to detect system clock skew */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeFileEvent *</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* Registered events */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e38586404452-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeFiredEvent *</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* Fired events */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeTimeEvent *</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e38586404452-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stop</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">apidata</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* This is used for polling API specific data */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e38586404452-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeBeforeSleepProc *</span><span class=\"crayon-v\">beforesleep</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e38586404452-13\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aeEventLoop</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><code>aeEventLoop</code>是<code>Redis</code>中事件驱动模型的核心，封装了整个事件循环，其中每个字段解释如下：</p>\n<ul>\n<li><code>maxfd</code>:已经接受的最大的文件描述符。</li>\n<li><code>setsize</code>:当前循环中所能容纳的文件描述符的数量。</li>\n<li><code>timeEventNextId</code>:下一个时间事件的<code>ID</code>.</li>\n<li><code>lastTime</code>:上一次被访问的时间，用来检测系统时钟是否被修改。</li>\n<li><code>events</code>:指针，指向保存所有注册的事件的数组首地址。</li>\n<li><code>fired</code>:指针，保存所有已经买被触发的事件的数组首地址。</li>\n<li><code>timeEventHead</code>:<code>Redis</code>用一个链表来存储所有的时间事件，<code>timeEventHead</code>是指向这个链表的首节点指针。</li>\n<li><code>stop</code>:停止整个事件循环。</li>\n<li><code>apiData</code>:指针，指向<code>epoll</code>结构。</li>\n<li><code>beforeSleep</code>:函数指针。每次实现循环的时候，在阻塞直到时间到来之前，会先调用这个函数。</li>\n</ul>\n<p><strong>aeFileEvent和aeTimeEvent</strong></p>\n<p>这两个结构分别表示文件事件和时间事件，定义如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e3d805385733\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct aeFileEvent {\r\n    int mask; /* one of AE_(READABLE|WRITABLE) */\r\n    aeFileProc *rfileProc; // 函数指针，写事件处理\r\n    aeFileProc *wfileProc; // 函数指针，读事件处理\r\n    void *clientData; // 具体的数据\r\n} aeFileEvent;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e3d805385733-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e3d805385733-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e3d805385733-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e3d805385733-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e3d805385733-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e3d805385733-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e3d805385733-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeFileEvent</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e3d805385733-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* one of AE_(READABLE|WRITABLE) */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e3d805385733-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeFileProc *</span><span class=\"crayon-v\">rfileProc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 函数指针，写事件处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e3d805385733-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeFileProc *</span><span class=\"crayon-v\">wfileProc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 函数指针，读事件处理</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e3d805385733-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 具体的数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e3d805385733-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aeFileEvent</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>其中<code>mask</code>表示文件事件类型掩码，可以是<code>AE_READABLE</code>表示是可读事件，<code>AE_WRITABLE</code>为可写事件。<code>aeFileProc</code>是函数指针。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e40970171678\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* Time event structure */\r\ntypedef struct aeTimeEvent {\r\n    long long id; // 事件ID\r\n    long when_sec; // 事件触发的时间:s\r\n    long when_ms; // 事件触发的时间:ms\r\n    aeTimeProc *timeProc; // 函数指针\r\n    aeEventFinalizerProc *finalizerProc; // 函数指针:在对应的aeTieEvent节点被删除前调用，可以理解为aeTimeEvent的析构函数\r\n    void *clientData; // 指针，指向具体的数据 \r\n    struct aeTimeEvent *next; // 指向下一个时间事件指针\r\n} aeTimeEvent;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e40970171678-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e40970171678-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e40970171678-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e40970171678-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e40970171678-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e40970171678-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e40970171678-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e40970171678-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e40970171678-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e40970171678-10\">10</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e40970171678-1\"><span class=\"crayon-c\">/* Time event structure */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e40970171678-2\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeTimeEvent</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e40970171678-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 事件ID</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e40970171678-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 事件触发的时间:s</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e40970171678-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">when_ms</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 事件触发的时间:ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e40970171678-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeTimeProc *</span><span class=\"crayon-v\">timeProc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 函数指针</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e40970171678-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeEventFinalizerProc *</span><span class=\"crayon-v\">finalizerProc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 函数指针:在对应的aeTieEvent节点被删除前调用，可以理解为aeTimeEvent的析构函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e40970171678-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 指针，指向具体的数据 </span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e40970171678-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">aeTimeEvent *</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 指向下一个时间事件指针</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e40970171678-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aeTimeEvent</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><strong>aeFiredEvent</strong></p>\n<p><code>aeFiredEvent</code>结构表示一个已经被触发的事件，结果如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e44544123329\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* A fired event */\r\ntypedef struct aeFiredEvent {\r\n    int fd; // 事件被触发的文件描述符\r\n    int mask; // 被触发事件的掩码，表示被触发事件的类型\r\n} aeFiredEvent;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e44544123329-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e44544123329-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e44544123329-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e44544123329-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e44544123329-5\">5</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e44544123329-1\"><span class=\"crayon-c\">/* A fired event */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e44544123329-2\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeFiredEvent</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e44544123329-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 事件被触发的文件描述符</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e44544123329-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 被触发事件的掩码，表示被触发事件的类型</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e44544123329-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aeFiredEvent</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><code>fd</code>表示事件发生在哪个文件描述符上面，<code>mask</code>用来表示具体事件的类型。</p>\n<p><strong>aeApiState</strong></p>\n<p><code>Redis</code>底层采用<code>IO</code>多路复用技术实现高并发，具体实现可以采用<code>kqueue</code>、<code>select</code>、<code>epoll</code>等技术。对于<code>Linux</code>来说，<code>epoll</code>的性能要优于<code>select</code>，所以以<code>epoll</code>为例来进行分析。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e47465468639\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct aeApiState {\r\n    int epfd;\r\n    struct epoll_event *events;\r\n} aeApiState;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e47465468639-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e47465468639-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e47465468639-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e47465468639-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e47465468639-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeApiState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e47465468639-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epfd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e47465468639-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">epoll_event *</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e47465468639-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aeApiState</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><code>aeApiState</code>封装了跟<code>epoll</code>相关的数据，<code>epfd</code>保存<code>epoll_create()</code>返回的文件描述符。</p>\n<h3>具体实现细节</h3>\n<p><strong>事件循环启动:<code>aeMain()</code></strong></p>\n<p>事件驱动的启动代码位于<code>ae.c</code>的<code>aeMain()</code>函数中，代码如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e4a305738072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid aeMain(aeEventLoop *eventLoop) {\r\n    eventLoop-&gt;stop = 0;\r\n    while (!eventLoop-&gt;stop) {\r\n        if (eventLoop-&gt;beforesleep != NULL)\r\n            eventLoop-&gt;beforesleep(eventLoop);\r\n        aeProcessEvents(eventLoop, AE_ALL_EVENTS);\r\n    }\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4a305738072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4a305738072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4a305738072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4a305738072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4a305738072-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4a305738072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4a305738072-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4a305738072-8\">8</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e4a305738072-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeMain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4a305738072-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4a305738072-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4a305738072-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">beforesleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4a305738072-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">beforesleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4a305738072-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">aeProcessEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_ALL_EVENTS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4a305738072-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4a305738072-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>从<code>aeMain()</code>方法中可以看到，整个事件驱动是在一个<code>while()</code>循环中不停地执行<code>aeProcessEvents()</code>方法，在这个方法中执行从客户端发送过来的请求。</p>\n<p><strong>初始化:<code>aeCreateEventLoop()</code></strong></p>\n<p><code>aeEventLoop</code>的初始化是在<code>aeCreateEventLoop()</code>方法中进行的，这个方法是在<code>server.c</code>中的<code>initServer()</code>中调用的。实现如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e4e968718261\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\naeEventLoop *aeCreateEventLoop(int setsize) {\r\n    aeEventLoop *eventLoop;\r\n    int i;\r\n    if ((eventLoop = zmalloc(sizeof(*eventLoop))) == NULL) goto err;\r\n    eventLoop-&gt;events = zmalloc(sizeof(aeFileEvent)*setsize);\r\n    eventLoop-&gt;fired = zmalloc(sizeof(aeFiredEvent)*setsize);\r\n    if (eventLoop-&gt;events == NULL || eventLoop-&gt;fired == NULL) goto err;\r\n    eventLoop-&gt;setsize = setsize;\r\n    eventLoop-&gt;lastTime = time(NULL);\r\n    eventLoop-&gt;timeEventHead = NULL;\r\n    eventLoop-&gt;timeEventNextId = 0;\r\n    eventLoop-&gt;stop = 0;\r\n    eventLoop-&gt;maxfd = -1;\r\n    eventLoop-&gt;beforesleep = NULL;\r\n    // 调用aeApiCreate()初始化epoll相关的数据\r\n    if (aeApiCreate(eventLoop) == -1) goto err;\r\n    /* Events with mask == AE_NONE are not set. So let\'s initialize the\r\n     * vector with it. */\r\n    for (i = 0; i &lt; setsize; i++)\r\n        /**\r\n         * 把每个刚新建的aeFileEvent.mask设置为AE_NONE\r\n         * 这点是必须的\r\n         */\r\n        eventLoop-&gt;events[i].mask = AE_NONE;\r\n    return eventLoop;\r\n\r\nerr:\r\n    if (eventLoop) {\r\n        zfree(eventLoop-&gt;events);\r\n        zfree(eventLoop-&gt;fired);\r\n        zfree(eventLoop);\r\n    }\r\n    return NULL;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e4e968718261-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e4e968718261-34\">34</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-1\"><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-e\">aeCreateEventLoop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zmalloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zmalloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">aeFileEvent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zmalloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">aeFiredEvent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">setsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lastTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventNextId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">maxfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">beforesleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 调用aeApiCreate()初始化epoll相关的数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">aeApiCreate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">goto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Events with mask == AE_NONE are not set. So let\'s initialize the</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-18\"><span class=\"crayon-c\">     * vector with it. */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-21\"><span class=\"crayon-c\">         * 把每个刚新建的aeFileEvent.mask设置为AE_NONE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-22\"><span class=\"crayon-c\">         * 这点是必须的</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-23\"><span class=\"crayon-c\">         */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_NONE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-26\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-27\"><span class=\"crayon-v\">err</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e4e968718261-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e4e968718261-34\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>在这个方法中主要就是给<code>aeEventLoop</code>对象分配内存然后并进行初始化。其中关键的地方有：</p>\n<p>1、调用<code>aeApiCreate()</code>初始化<code>epoll</code>相关的数据。<code>aeApiCreate()</code>实现如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e52984048875\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic int aeApiCreate(aeEventLoop *eventLoop) {\r\n    // 1.分配内存\r\n    aeApiState *state = zmalloc(sizeof(aeApiState));\r\n    if (!state) return -1;\r\n    // 1.分配events内存，epoll_event的大小为setsize\r\n    state-&gt;events = zmalloc(sizeof(struct epoll_event)*eventLoop-&gt;setsize);\r\n    if (!state-&gt;events) {\r\n        zfree(state);\r\n        return -1;\r\n    }\r\n    // 2.调用epoll_create()生成epoll文件描述符，并保存在epfd这个域中\r\n    state-&gt;epfd = epoll_create(1024); /* 1024 is just a hint for the kernel */\r\n    if (state-&gt;epfd == -1) {\r\n        zfree(state-&gt;events);\r\n        zfree(state);\r\n        return -1;\r\n    }\r\n    // 把apidata指针指向第一步中分配的内存地址\r\n    eventLoop-&gt;apidata = state;\r\n    return 0;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e52984048875-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e52984048875-21\">21</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeApiCreate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 1.分配内存</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeApiState *</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zmalloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">aeApiState</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 1.分配events内存，epoll_event的大小为setsize</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zmalloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epoll_event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 2.调用epoll_create()生成epoll文件描述符，并保存在epfd这个域中</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">epfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">epoll_create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 1024 is just a hint for the kernel */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">epfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 把apidata指针指向第一步中分配的内存地址</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">apidata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e52984048875-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e52984048875-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>在<code>aeApiCreate()</code>方法中主要完成以下三件事：<br>\n1. 分配<code>aeApiState</code>结构需要的内存。<br>\n2. 调用<code>epoll_create()</code>方法生成<code>epoll</code>的文件描述符，并保存在<code>aeApiState.epfd</code>字段中。<br>\n3. 把第一步分配的<code>aeApiState</code>的内存地址保存在<code>EventLoop-&gt;apidata</code>字段中。</p>\n<p>2、初始化<code>events</code>中的<code>mask</code>字段为为<code>AE_NONE</code>。</p>\n<p><strong>生成<code>fileEvent</code>:<code>aeCreateFileEvent()</code></strong></p>\n<p><code>Redis</code>使用<code>aeCreateFileEvent()</code>来生成<code>fileEvent</code>，代码如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e56327513134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint aeCreateFileEvent(aeEventLoop *eventLoop, int fd, int mask,\r\n        aeFileProc *proc, void *clientData)\r\n{\r\n    // 1. 检查新增的fd是否超过所能容纳最大值\r\n    if (fd &gt;= eventLoop-&gt;setsize) {\r\n        errno = ERANGE;\r\n        return AE_ERR;\r\n    }\r\n    aeFileEvent *fe = &amp;eventLoop-&gt;events[fd];\r\n\r\n    // 2. 调用aeApiAddEvent()方法把对应的fd以mask模式添加到epoll监听器中\r\n    if (aeApiAddEvent(eventLoop, fd, mask) == -1)\r\n        return AE_ERR;\r\n    // 3. 设置相应的字段值\r\n    fe-&gt;mask |= mask;\r\n    if (mask &amp; AE_READABLE) fe-&gt;rfileProc = proc;\r\n    if (mask &amp; AE_WRITABLE) fe-&gt;wfileProc = proc;\r\n    fe-&gt;clientData = clientData;\r\n    if (fd &gt; eventLoop-&gt;maxfd)\r\n        // 如果有需要则修改maxfd字段的值\r\n        eventLoop-&gt;maxfd = fd;\r\n    return AE_OK;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e56327513134-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e56327513134-23\">23</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeCreateFileEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">aeFileProc *</span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 1. 检查新增的fd是否超过所能容纳最大值</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">errno</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ERANGE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_ERR</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeFileEvent *</span><span class=\"crayon-v\">fe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-10\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 2. 调用aeApiAddEvent()方法把对应的fd以mask模式添加到epoll监听器中</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">aeApiAddEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_ERR</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 3. 设置相应的字段值</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_READABLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rfileProc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_WRITABLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">wfileProc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">maxfd</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果有需要则修改maxfd字段的值</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">maxfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e56327513134-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e56327513134-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p><code>aeCreateFileEvent()</code>方法主要做了一下三件事:</p>\n<ol>\n<li>检查新增的fd是否超过所能容纳最大值。</li>\n<li>调用aeApiAddEvent()方法把对应的fd以mask模式添加到epoll监听器中。</li>\n</ol>\n<p>设置相应的字段值。其中最关键的步骤是第二步，<code>aeApiAddEvent()</code>方法如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e5a975271367\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic int aeApiAddEvent(aeEventLoop *eventLoop, int fd, int mask) {\r\naeApiState *state = eventLoop-&gt;apidata;\r\nstruct epoll_event ee = {0}; /* avoid valgrind warning */\r\n/* If the fd was already monitored for some event, we need a MOD\r\n * operation. Otherwise we need an ADD operation. */\r\nint op = eventLoop-&gt;events[fd].mask == AE_NONE ?\r\n        EPOLL_CTL_ADD : EPOLL_CTL_MOD;\r\n\r\nee.events = 0;\r\nmask |= eventLoop-&gt;events[fd].mask; /* Merge old events */\r\nif (mask &amp; AE_READABLE) ee.events |= EPOLLIN;\r\nif (mask &amp; AE_WRITABLE) ee.events |= EPOLLOUT;\r\nee.data.fd = fd;\r\nif (epoll_ctl(state-&gt;epfd,op,fd,&amp;ee) == -1) return -1;\r\nreturn 0;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5a975271367-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5a975271367-16\">16</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeApiAddEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-2\"><span class=\"crayon-e \">aeApiState *</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">apidata</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-3\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">epoll_event </span><span class=\"crayon-v\">ee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* avoid valgrind warning */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-4\"><span class=\"crayon-c\">/* If the fd was already monitored for some event, we need a MOD</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-5\"><span class=\"crayon-c\"> * operation. Otherwise we need an ADD operation. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE</span><span class=\"crayon-sy\">_</span>NONE<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">EPOLL_CTL_ADD</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLL_CTL_MOD</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-8\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-9\"><span class=\"crayon-v\">ee</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-10\"><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* Merge old events */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-11\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_READABLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ee</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLLIN</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-12\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_WRITABLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ee</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLLOUT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-13\"><span class=\"crayon-v\">ee</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">epoll_ctl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">epfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">ee</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5a975271367-15\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5a975271367-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>生成<code>timeEvent</code>:<code>aeCreateTimeEvent()</code></p>\n<p><code>aeCreateTimeEvent()</code>方法主要是用来生成<code>timeEvent</code>节点，其实现比较简单，代码如下所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e5d023761241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlong long aeCreateTimeEvent(aeEventLoop *eventLoop, long long milliseconds,\r\n        aeTimeProc *proc, void *clientData,\r\n        aeEventFinalizerProc *finalizerProc)\r\n{\r\n    // 1. 获取id\r\n    long long id = eventLoop-&gt;timeEventNextId++;\r\n    aeTimeEvent *te;\r\n\r\n    // 2. 分配内存\r\n    te = zmalloc(sizeof(*te));\r\n    if (te == NULL) return AE_ERR;\r\n    // 3. 设置aeTimeEvent的各个字段的值\r\n    te-&gt;id = id;\r\n    aeAddMillisecondsToNow(milliseconds,&amp;te-&gt;when_sec,&amp;te-&gt;when_ms);\r\n    te-&gt;timeProc = proc;\r\n    te-&gt;finalizerProc = finalizerProc;\r\n    te-&gt;clientData = clientData;\r\n    // timeEventHead总是指向最新添加的timeEvent节点\r\n    te-&gt;next = eventLoop-&gt;timeEventHead;\r\n    eventLoop-&gt;timeEventHead = te;\r\n    return id;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e5d023761241-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e5d023761241-22\">22</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-1\"><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeCreateTimeEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">milliseconds</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">aeTimeProc *</span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">aeEventFinalizerProc *</span><span class=\"crayon-v\">finalizerProc</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 1. 获取id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventNextId</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeTimeEvent *</span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-8\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 2. 分配内存</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zmalloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_ERR</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 3. 设置aeTimeEvent的各个字段的值</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">aeAddMillisecondsToNow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">milliseconds</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeProc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">finalizerProc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">finalizerProc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// timeEventHead总是指向最新添加的timeEvent节点</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e5d023761241-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e5d023761241-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p><strong>处理<code>timeEevnt</code>:<code>processTimeEvents()</code></strong></p>\n<p><code>Redis</code>在<code>processTimeEvents()</code>方法中来处理所有的<code>timeEvent</code>，实现如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e61224122893\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic int processTimeEvents(aeEventLoop *eventLoop) {\r\n    int processed = 0;\r\n    aeTimeEvent *te, *prev;\r\n    long long maxId;\r\n    time_t now = time(NULL);\r\n    /**\r\n     * 如果系统时间被调整到将来某段时间然后又被设置回正确的时间,\r\n     * 这种情况下链表中的timeEvent有可能会被随机的延迟执行,因\r\n     * 此在这个情况下把所有的timeEvent的触发时间设置为0表示及执行\r\n     */\r\n    if (now &lt; eventLoop-&gt;lastTime) {\r\n        te = eventLoop-&gt;timeEventHead;\r\n        while(te) {\r\n            te-&gt;when_sec = 0;\r\n            te = te-&gt;next;\r\n        }\r\n    }\r\n    eventLoop-&gt;lastTime = now; // 设置上次运行时间为now\r\n\r\n    prev = NULL;\r\n    te = eventLoop-&gt;timeEventHead;\r\n    maxId = eventLoop-&gt;timeEventNextId-1;\r\n    while(te) {\r\n        long now_sec, now_ms;\r\n        long long id;\r\n        /**\r\n         * 删除已经被标志位 删除 的时间事件\r\n         */\r\n        if (te-&gt;id == AE_DELETED_EVENT_ID) {\r\n            aeTimeEvent *next = te-&gt;next;\r\n            if (prev == NULL)\r\n                eventLoop-&gt;timeEventHead = te-&gt;next;\r\n            else\r\n                prev-&gt;next = te-&gt;next;\r\n            if (te-&gt;finalizerProc)\r\n                // 在时间事件节点被删除前调用finlizerProce()方法\r\n                te-&gt;finalizerProc(eventLoop, te-&gt;clientData);\r\n            zfree(te);\r\n            te = next;\r\n            continue;\r\n        }\r\n        if (te-&gt;id &gt; maxId) {\r\n            /**\r\n             * te-&gt;id &gt; maxId 表示当前te指向的timeEvent为当前循环中新添加的,\r\n             * 对于新添加的节点在本次循环中不作处理。\r\n             * PS:为什么会出现这种情况呢？有可能是在timeProc()里面会注册新的timeEvent节点?\r\n             * 对于当前的Redis版本中不会出现te-&gt;id &gt; maxId这种情况\r\n             */\r\n            te = te-&gt;next;\r\n            continue;\r\n        }\r\n        aeGetTime(&amp;now_sec, &amp;now_ms);\r\n        if (now_sec &gt; te-&gt;when_sec ||\r\n            (now_sec == te-&gt;when_sec &amp;&amp; now_ms &gt;= te-&gt;when_ms))\r\n        {\r\n            // 如果当前时间已经超过了对应的timeEvent节点设置的触发时间，\r\n            // 则调用timeProc()方法执行对应的任务\r\n            int retval;\r\n\r\n            id = te-&gt;id;\r\n            retval = te-&gt;timeProc(eventLoop, id, te-&gt;clientData);\r\n            processed++;\r\n            if (retval != AE_NOMORE) {\r\n                // 要执行多次，则计算下次执行时间\r\n                aeAddMillisecondsToNow(retval,&amp;te-&gt;when_sec,&amp;te-&gt;when_ms);\r\n            } else {\r\n                // 如果只需要执行一次，则把id设置为-1，再下次循环中删除\r\n                te-&gt;id = AE_DELETED_EVENT_ID;\r\n            }\r\n        }\r\n        prev = te;\r\n        te = te-&gt;next;\r\n    }\r\n    return processed;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e61224122893-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e61224122893-75\">75</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">processTimeEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">processed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeTimeEvent *</span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">time_t </span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-7\"><span class=\"crayon-c\">     * 如果系统时间被调整到将来某段时间然后又被设置回正确的时间,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-8\"><span class=\"crayon-c\">     * 这种情况下链表中的timeEvent有可能会被随机的延迟执行,因</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-9\"><span class=\"crayon-c\">     * 此在这个情况下把所有的timeEvent的触发时间设置为0表示及执行</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-10\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lastTime</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lastTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 设置上次运行时间为now</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">maxId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventNextId</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_ms</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-27\"><span class=\"crayon-c\">         * 删除已经被标志位 删除 的时间事件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-28\"><span class=\"crayon-c\">         */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_DELETED_EVENT_ID</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-e \">aeTimeEvent *</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">timeEventHead</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">prev</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">finalizerProc</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 在时间事件节点被删除前调用finlizerProce()方法</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">finalizerProc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">zfree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-44\"><span class=\"crayon-c\">             * te-&gt;id &gt; maxId 表示当前te指向的timeEvent为当前循环中新添加的,</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-45\"><span class=\"crayon-c\">             * 对于新添加的节点在本次循环中不作处理。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-46\"><span class=\"crayon-c\">             * PS:为什么会出现这种情况呢？有可能是在timeProc()里面会注册新的timeEvent节点?</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-47\"><span class=\"crayon-c\">             * 对于当前的Redis版本中不会出现te-&gt;id &gt; maxId这种情况</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-48\"><span class=\"crayon-c\">             */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">aeGetTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">now_ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_ms</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果当前时间已经超过了对应的timeEvent节点设置的触发时间，</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 则调用timeProc()方法执行对应的任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-59\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-60\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-61\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">timeProc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-62\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">processed</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-63\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_NOMORE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-64\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 要执行多次，则计算下次执行时间</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">aeAddMillisecondsToNow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-66\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-67\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 如果只需要执行一次，则把id设置为-1，再下次循环中删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-68\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_DELETED_EVENT_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-69\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">te</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">te</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e61224122893-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">processed</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e61224122893-75\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0098 seconds] -->\r\n<p>在这个方法中会</p>\n<ol>\n<li>判断系统时间有没有调整过，如果调整过，则会把<code>timeEvent</code>链表中的所有的<code>timeEvent</code>的触发时间设置为0，表示立即执行。</li>\n<li>对<code>timeEvent</code>链表进行遍历，对于每个<code>timeEvent</code>节点，如果有：\n<ol>\n<li>如果已经被标记为删除(<code>AE_DELETED_EVENT_ID</code>)，则立即释放对应节点内存，遍历下个节点。</li>\n<li>如果<code>id</code>大于<code>maxId</code>,则表示当前节点为本次循环中新增节点，咋本次循环中不错处理，继续下个节点。</li>\n<li>如果当前节点的触发时间大于当前时间，则调用对应节点的<code>timeProc()</code>方法执行任务。根据<code>timeProc()</code>方法的返回，又分为两种情况:\n<ol>\n<li>返回为<code>AE_NOMORE</code>，表示当前<code>timeEvent</code>节点属于一次性事件，标记该节点<code>ID</code>为<code>AE_DELETED_EVENT_ID</code>,表示删除节点，该节点将会在下一轮的循环中被删除。</li>\n<li>返回不是<code>AE_NOMORE</code>，表示当前<code>timeEvent</code>节点属于周期性事件，需要多次执行，调用<code>aeAddMillisecondsToNow()</code>方法设置下次被执行时间。</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<p><strong>处理所有事件:<code>aeProcessEvents()</code></strong></p>\n<p><code>Redis</code>中所有的事件，包括<code>timeEvent</code>和<code>fileEvent</code>都是在<code>aeProcessEvents()</code>方法中进行处理的，刚方法实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e67816650872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* Process every pending time event, then every pending file event\r\n * (that may be registered by time event callbacks just processed).\r\n * Without special flags the function sleeps until some file event\r\n * fires, or when the next time event occurs (if any).\r\n *\r\n * If flags is 0, the function does nothing and returns.\r\n * if flags has AE_ALL_EVENTS set, all the kind of events are processed.\r\n * if flags has AE_FILE_EVENTS set, file events are processed.\r\n * if flags has AE_TIME_EVENTS set, time events are processed.\r\n * if flags has AE_DONT_WAIT set the function returns ASAP until all\r\n * the events that\'s possible to process without to wait are processed.\r\n *\r\n * The function returns the number of events processed. */\r\nint aeProcessEvents(aeEventLoop *eventLoop, int flags)\r\n{\r\n    int processed = 0, numevents;\r\n    /**\r\n     * 既没有时间事件也没有文件事件，则直接返回\r\n     */\r\n    if (!(flags &amp; AE_TIME_EVENTS) &amp;&amp; !(flags &amp; AE_FILE_EVENTS)) return 0;\r\n    /**\r\n     * -1 == eventloop-&gt;maxfd 表示还么有任何aeFileEvent被添加到epoll    \r\n     * 事件循环中进行监听\r\n     */\r\n    if (eventLoop-&gt;maxfd != -1 ||\r\n        ((flags &amp; AE_TIME_EVENTS) &amp;&amp; !(flags &amp; AE_DONT_WAIT))) {\r\n        int j;\r\n        aeTimeEvent *shortest = NULL;\r\n        struct timeval tv, *tvp;\r\n\r\n        /**\r\n         * 如果有aeFileEvent需要处理，就先要从所有待处理的\r\n         * aeTimeEvent事件中找到最近的将要被执行的aeTimeEvent节点\r\n         * 并结算该节点触发时间\r\n         */\r\n        if (flags &amp; AE_TIME_EVENTS &amp;&amp; !(flags &amp; AE_DONT_WAIT))\r\n            shortest = aeSearchNearestTimer(eventLoop);\r\n        if (shortest) {\r\n            long now_sec, now_ms;\r\n\r\n            aeGetTime(&amp;now_sec, &amp;now_ms);\r\n            tvp = &amp;tv;\r\n\r\n            /* How many milliseconds we need to wait for the next\r\n             * time event to fire? */\r\n            // 计算epoll_wait()需要等待的时间\r\n            long long ms =\r\n                (shortest-&gt;when_sec - now_sec)*1000 +\r\n                shortest-&gt;when_ms - now_ms;\r\n\r\n            if (ms &gt; 0) {\r\n                tvp-&gt;tv_sec = ms/1000;\r\n                tvp-&gt;tv_usec = (ms % 1000)*1000;\r\n            } else {\r\n                tvp-&gt;tv_sec = 0;\r\n                tvp-&gt;tv_usec = 0;\r\n            }\r\n        } else {\r\n            // 如果flags设置了AE_DONT_WAIT,则设置epoll_wait()等待时间为0，\r\n            // 即立刻从epoll中返回\r\n            if (flags &amp; AE_DONT_WAIT) {\r\n                tv.tv_sec = tv.tv_usec = 0;\r\n                tvp = &amp;tv;\r\n            } else {\r\n                /* Otherwise we can block */\r\n                tvp = NULL; /* wait forever */\r\n            }\r\n        }\r\n\r\n        // 调用aeApiPoll()进行阻塞等待事件的到来，等待时间为tvp\r\n        numevents = aeApiPoll(eventLoop, tvp);\r\n        for (j = 0; j &lt; numevents; j++) {\r\n            aeFileEvent *fe = &amp;eventLoop-&gt;events[eventLoop-&gt;fired[j].fd];\r\n            int mask = eventLoop-&gt;fired[j].mask;\r\n            int fd = eventLoop-&gt;fired[j].fd;\r\n            int rfired = 0;\r\n            /* note the fe-&gt;mask &amp; mask &amp; ... code: maybe an already processed\r\n             * event removed an element that fired and we still didn\'t\r\n             * processed, so we check if the event is still valid. */\r\n            // fe-&gt;mask &amp;&amp; mask 的目的是确保对应事件时候还有效\r\n            if (fe-&gt;mask &amp; mask &amp; AE_READABLE) {\r\n                rfired = 1;\r\n                fe-&gt;rfileProc(eventLoop,fd,fe-&gt;clientData,mask);\r\n            }\r\n            if (fe-&gt;mask &amp; mask &amp; AE_WRITABLE) {\r\n                if (!rfired || fe-&gt;wfileProc != fe-&gt;rfileProc)\r\n                    fe-&gt;wfileProc(eventLoop,fd,fe-&gt;clientData,mask);\r\n            }\r\n            processed++;\r\n        }\r\n    }\r\n    /* Check time events */\r\n    if (flags &amp; AE_TIME_EVENTS)\r\n        // 处理aeTimeEvent\r\n        processed += processTimeEvents(eventLoop);\r\n\r\n    return processed; /* return the number of processed file/time events */\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e67816650872-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e67816650872-98\">98</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-1\"><span class=\"crayon-c\">/* Process every pending time event, then every pending file event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-2\"><span class=\"crayon-c\"> * (that may be registered by time event callbacks just processed).</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-3\"><span class=\"crayon-c\"> * Without special flags the function sleeps until some file event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-4\"><span class=\"crayon-c\"> * fires, or when the next time event occurs (if any).</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-5\"><span class=\"crayon-c\"> *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-6\"><span class=\"crayon-c\"> * If flags is 0, the function does nothing and returns.</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-7\"><span class=\"crayon-c\"> * if flags has AE_ALL_EVENTS set, all the kind of events are processed.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-8\"><span class=\"crayon-c\"> * if flags has AE_FILE_EVENTS set, file events are processed.</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-9\"><span class=\"crayon-c\"> * if flags has AE_TIME_EVENTS set, time events are processed.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-10\"><span class=\"crayon-c\"> * if flags has AE_DONT_WAIT set the function returns ASAP until all</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-11\"><span class=\"crayon-c\"> * the events that\'s possible to process without to wait are processed.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-12\"><span class=\"crayon-c\"> *</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-13\"><span class=\"crayon-c\"> * The function returns the number of events processed. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-14\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeProcessEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">processed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-18\"><span class=\"crayon-c\">     * 既没有时间事件也没有文件事件，则直接返回</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-19\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_TIME_EVENTS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_FILE_EVENTS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-22\"><span class=\"crayon-c\">     * -1 == eventloop-&gt;maxfd 表示还么有任何aeFileEvent被添加到epoll    </span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-23\"><span class=\"crayon-c\">     * 事件循环中进行监听</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">maxfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_TIME_EVENTS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_DONT_WAIT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">aeTimeEvent *</span><span class=\"crayon-v\">shortest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeval </span><span class=\"crayon-v\">tv</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tvp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-30\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-32\"><span class=\"crayon-c\">         * 如果有aeFileEvent需要处理，就先要从所有待处理的</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-33\"><span class=\"crayon-c\">         * aeTimeEvent事件中找到最近的将要被执行的aeTimeEvent节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-34\"><span class=\"crayon-c\">         * 并结算该节点触发时间</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-35\"><span class=\"crayon-c\">         */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_TIME_EVENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_DONT_WAIT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">shortest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeSearchNearestTimer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">shortest</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_ms</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-40\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">aeGetTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">now_ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tv</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/* How many milliseconds we need to wait for the next</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-45\"><span class=\"crayon-c\">             * time event to fire? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 计算epoll_wait()需要等待的时间</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ms</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-48\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">shortest</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_sec</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-49\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">shortest</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">when_ms</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now_ms</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-50\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ms</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">tv_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ms</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-53\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">tv_usec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ms</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">tv_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-56\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">tv_usec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果flags设置了AE_DONT_WAIT,则设置epoll_wait()等待时间为0，</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-60\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 即立刻从epoll中返回</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-61\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_DONT_WAIT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-62\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tv_sec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tv_usec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-63\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tv</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-64\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/* Otherwise we can block */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-66\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* wait forever */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-67\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 调用aeApiPoll()进行阻塞等待事件的到来，等待时间为tvp</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeApiPoll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-73\"><span class=\"crayon-h\">            </span><span class=\"crayon-e \">aeFileEvent *</span><span class=\"crayon-v\">fe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-74\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-76\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rfired</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-77\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/* note the fe-&gt;mask &amp; mask &amp; ... code: maybe an already processed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-78\"><span class=\"crayon-c\">             * event removed an element that fired and we still didn\'t</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-79\"><span class=\"crayon-c\">             * processed, so we check if the event is still valid. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-80\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// fe-&gt;mask &amp;&amp; mask 的目的是确保对应事件时候还有效</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-81\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_READABLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-82\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">rfired</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-83\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">rfileProc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-84\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-85\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_WRITABLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-86\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">rfired</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">wfileProc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rfileProc</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-87\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wfileProc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">fe</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">clientData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-88\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-89\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">processed</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Check time events */</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_TIME_EVENTS</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 处理aeTimeEvent</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">processed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">processTimeEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-96\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e67816650872-97\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">processed</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* return the number of processed file/time events */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e67816650872-98\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0126 seconds] -->\r\n<p>该方法的入参<code>flag</code>表示要处理哪些事件，可以取以下几个值 ：</p>\n<ul>\n<li><code>AE_ALL_EVENTS</code>:<code>timeEvent</code>和<code>fileEvent</code>都会处理。</li>\n<li><code>AE_FILE_EVENTS</code>:只处理<code>fileEvent</code>。</li>\n<li><code>AE_TIME_EVENTS</code>:只处理<code>timeEvent</code>。</li>\n<li><code>AE_DONT_WAIT</code>:要么立马返回，要么处理完那些不需要等待的事件之后再立马返回。</li>\n</ul>\n<p><code>aeProcessEvents()</code>方法会做下面几件事:</p>\n<ol>\n<li>判断传入的<code>flag</code>的值，如果既不包含<code>AE_TIME_EVENTS</code>也不包含<code>AE_FILE_EVENTS</code>则直接返回。</li>\n<li>计算如果有<code>aeFileEvent</code>事件需要进行处理，则先计算<code>epoll_wait()</code>方法需要阻塞等待的时间，计算方式如下:\n<ol>\n<li>先从<code>aeTimeEvent</code>事件链表中找到最近的需要被触发的<code>aeTimeEvent</code>节点并计算需要被触发的时间，该被触发时间则为<code>epoll_wait()</code>需要等待的时间。</li>\n<li>如果没有找到最近的<code>aeTimeEvent</code>节点，表示没有<code>aeTimeEvent</code>节点被加入链表，则判断传入的<code>flags</code>是否包含<code>AE_DONT_WAIT</code>选项，则设置<code>epoll_wait()</code>需要等待时间为0，表示立即返回。</li>\n<li>如果没有设置<code>AE_DONT_WAIT</code>,则设置需要等待时间为<code>NULL</code>,表示<code>epoll_wait()</code>一直阻塞等待知道有<code>fileEvent</code>事件到来。</li>\n</ol>\n</li>\n<li>调用<code>aeApiPoll()</code>方法阻塞等待事件的到来，阻塞时间为第二步中计算的时间。<code>aeApiPoll()</code>实现如下：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bff2e6e023222767\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic int aeApiPoll(aeEventLoop *eventLoop, struct timeval *tvp) {\r\n    aeApiState *state = eventLoop-&gt;apidata;\r\n    int retval, numevents = 0;\r\n\r\n    // 1. 根据传入的tvp计算需要等待时间，然后调用epoll_wait()进行阻塞等待\r\n    retval = epoll_wait(state-&gt;epfd,state-&gt;events,eventLoop-&gt;setsize,\r\n            tvp ? (tvp-&gt;tv_sec*1000 + tvp-&gt;tv_usec/1000) : -1);\r\n    // 有事件到来\r\n    if (retval &gt; 0) {\r\n        int j;\r\n\r\n        numevents = retval;\r\n        for (j = 0; j &lt; numevents; j++) {\r\n            int mask = 0;\r\n            struct epoll_event *e = state-&gt;events+j;\r\n\r\n            // 2. 计算到来的event的类型\r\n            if (e-&gt;events &amp; EPOLLIN) mask |= AE_READABLE;\r\n            if (e-&gt;events &amp; EPOLLOUT) mask |= AE_WRITABLE;\r\n            if (e-&gt;events &amp; EPOLLERR) mask |= AE_WRITABLE;\r\n            if (e-&gt;events &amp; EPOLLHUP) mask |= AE_WRITABLE;\r\n\r\n            // 3. 把有事件发生的fd以及对应的mask类型拷贝到eventloop-&gt;fired数组中\r\n            eventLoop-&gt;fired[j].fd = e-&gt;data.fd;\r\n            eventLoop-&gt;fired[j].mask = mask;\r\n        }\r\n    }\r\n    return numevents;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bff2e6e023222767-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-596564bff2e6e023222767-29\">29</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aeApiPoll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">aeEventLoop *</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">timeval *</span><span class=\"crayon-v\">tvp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">aeApiState *</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">apidata</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-4\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 1. 根据传入的tvp计算需要等待时间，然后调用epoll_wait()进行阻塞等待</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">epoll_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">epfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">setsize</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">tvp</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tvp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e \">tv_sec*</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tvp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">tv_usec</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 有事件到来</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">epoll_event *</span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-16\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 2. 计算到来的event的类型</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLLIN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_READABLE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLLOUT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_WRITABLE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLLERR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_WRITABLE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EPOLLHUP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AE_WRITABLE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-22\"> </div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 3. 把有事件发生的fd以及对应的mask类型拷贝到eventloop-&gt;fired数组中</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eventLoop</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">fired</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bff2e6e023222767-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numevents</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596564bff2e6e023222767-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n<br>\n<code>aeApiPoll()</code>会做下面几件事:\n<ol>\n<li>根据传入的<code>tvp</code>计算需要阻塞的时间，然后调用<code>epoll_wait()</code>进行阻塞等待。</li>\n<li>有事件到来之后先计算对应事件的类型。</li>\n<li>把事件发生的<code>fd</code>以及对应的类型<code>mask</code>拷贝到<code>fired</code>数组中。</li>\n</ol>\n</li>\n<li>从<code>aeApiPoll()</code>方法返回之后，所有事件已经就绪了的<code>fd</code>以及对应事件的类型<code>mask</code>已经保存在<code>eventLoop-&gt;fired[]</code>数组中。依次遍历<code>fired</code>数组，根据<code>mask</code>类型，执行对应的<code>frileProc()</code>或者<code>wfileProce()</code>方法。</li>\n<li>如果传入的<code>flags</code>中有<code>AE_TIME_EVENTS</code>,则调用<code>processTimeEvents()</code>执行所有已经到时间了的<code>timeEvent</code>。</li>\n</ol>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111425\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111425votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111425\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('如何最有效的编写SQL', '2017-07-12', 'http://blog.jobbole.com/111807/', '206d408271cde72276773274eb31dfde', 'http://jbcdn2.b0.upaiyun.com/2016/01/970c5be7812066919173f6ec5ab052ce.png', 'full/0e89c4879b2842f9c58098e98ad64d0a9d218103.jpg', '0', '0', '1', 'IT技术,SQL,数据库', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/the-most-effective-way-to-write-effective-sql-chan\">Emrah Mete</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32540\">ITeye-黑色巧克力</a>   </div><p><em>译者注：解决数据库级（SQL）工作上的问题，应该采用的是SET方法（整体的）而不是过程式的方法。下面来看看作者为什么这么说。</em></p>\n<p>编写有效的SQL查询是企业软件世界中最大的难题之一。</p>\n<p>每个公司在数据库开发项目中所面临的最根本的问题，在于开发环境中实现的性能不能在生产环境中实现。一般来说，存在性能损失是因为生产环境中的数据量要大得多。</p>\n<p>这些问题（运行缓慢的数据库操作）可能有各种各样的原因。本文将解释如何在编写查询时进行思考，如何思考是最基本的问题，也是解决此类问题的起点。</p>\n<p>观察发现SQL开发人员常使用过程方法编写查询。事实上，这是很自然的，因为用程序方法解决问题是最方便的人类逻辑解决方案。另一个方面，几乎所有的SQL开发人员都在同时编写Java、c#或其他编程语言的代码。Java、C#等可以用来训练开发人员以一种程序化的方式来培养他们的思维方式，因为当使用这些语言开发应用程序时，会使用很多类似的东西，比如IF .. THEN .. ELSE，FOR .. LOOP，WHILE .. DO， CASE .. WHEN。当然，在这种情况下，当将业务规则应用到一组数据时，意味着每个记录都是单独处理的(逐行处理)。这个过程方法在Java、c#等语言中使用。虽然使用语言开发软件是一种正确的方法，但在编写数据库级(SQL)的查询时，却不会产生同样的效果。</p>\n<p>下面用两种不同的方法来解决同一个示例问题，并将结果进行比较。看看CUSTOMERS表中对应的每个客户在SALES表中有多少条记录。</p>\n<p>过程式方法如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661c075231e794237570\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\nSELECT \r\n      c.cust_id,\r\n       (SELECT COUNT (*)\r\n          FROM sh.sales s\r\n         WHERE s.cust_id = c.cust_id)\r\n          sa_count\r\n  FROM SH.CUSTOMERS c;\r\nPlan hash value: 881374884\r\nStatistics\r\n----------------------------------------------------------\r\n          0  recursive calls\r\n          0  db block gets\r\n    2454756  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     925474  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59661c075231e794237570-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c075231e794237570-22\">22</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-3\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-4\"><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">sa_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-8\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-9\"><span class=\"crayon-e\">Plan </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">881374884</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-10\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-11\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-13\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2454756</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-15\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-17\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">925474</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-18\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-20\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c075231e794237570-21\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c075231e794237570-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5c59d421762074b3cc17f430ca7ce714.png\"></div>\n<p>现在，采用基于SET的方法来编写查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661c0752329890862787\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\nSELECT \r\n        c.cust_id, COUNT (s.cust_id) jh_count\r\n    FROM SH.CUSTOMERS c, sh.sales s\r\n   WHERE c.cust_id = s.cust_id(+)\r\nGROUP BY c.cust_id;\r\nPlan hash value: 716053480\r\nStatistics\r\n----------------------------------------------------------\r\n          1  recursive calls\r\n          0  db block gets\r\n        742  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     925474  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752329890862787-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752329890862787-20\">20</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jh_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cust_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-6\"><span class=\"crayon-e\">GROUP </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-7\"><span class=\"crayon-e\">Plan </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">716053480</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-8\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-10\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">742</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-13\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-14\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-15\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">925474</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-18\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752329890862787-19\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752329890862787-20\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c68cc95938e0f52a457d15867b33b3fc.png\"></div>\n<p>可以看到在两个查询的consistent gets数量之间的差异（当检查缓冲区缓存读到的块数据时）是巨大的。使用两种不同方法编写的查询在运行时导致不同时间。这种差别可以用性能来解释。</p>\n<p>在另一个例子中，常见的习惯是在SQL语句中调用PL/SQL函数。作为过程式工作的例子，也是一种解决问题的方法。还有其他一些影响在SQL内调用PL/SQL代码性能的不利因素，但在本文中，不会提到性能问题。</p>\n<p>下面编写查找客户表中每个客户的购买金额的代码。</p>\n<p>过程方法:</p>\n<p>在第一步中，创建一个PL/SQL函数来计算每个客户的总数，然后在代码和输出中调用这个函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661c0752335021945381\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE OR REPLACE FUNCTION get_grand_total (\r\n   p_cust_id_in IN SH.CUSTOMERS.CUST_ID%TYPE)\r\n   RETURN NUMBER\r\nIS\r\n   r_grand_total   NUMBER;\r\nBEGIN\r\n   SELECT SUM (amount_sold)\r\n     INTO r_grand_total\r\n     FROM sh.sales\r\n    WHERE cust_id = p_cust_id_in;\r\n   RETURN r_grand_total;\r\nEND;\r\nSET AUTOTRACE ON\r\nSELECT cust_id, \r\n            get_grand_total (cust_id) grand_total \r\nFROM sh.customers;\r\nStatistics\r\n----------------------------------------------------------\r\n      55503  recursive calls\r\n          0  db block gets\r\n    3066293  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     890447  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752335021945381-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752335021945381-29\">29</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">REPLACE </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_grand_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">p_cust_id_in </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CUSTOMERS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CUST_ID</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">TYPE</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NUMBER</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-4\"><span class=\"crayon-st\">IS</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">r_grand_total   </span><span class=\"crayon-v\">NUMBER</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-6\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-7\"><span class=\"crayon-e\">   </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">SUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amount_sold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">r_grand_total</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-9\"><span class=\"crayon-e\">     </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sales</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p_cust_id_in</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r_grand_total</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-12\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-13\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-14\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">get_grand_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grand_total </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-16\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">customers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-17\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-18\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55503</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-20\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3066293</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-22\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-23\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-24\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">890447</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-26\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-27\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752335021945381-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752335021945381-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b2618277a22d514ec13ef9a857ab3ec9.png\"></div>\n<p>现在，采用基于SET的方法来编写查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661c0752339050059285\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\n  SELECT c.cust_id, SUM (amount_sold)\r\n    FROM SH.CUSTOMERS c, sh.sales s\r\n   WHERE c.cust_id = s.cust_id(+)\r\nGROUP BY c.cust_id;\r\nStatistics\r\n----------------------------------------------------------\r\n          1  recursive calls\r\n          0  db block gets\r\n       1841  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     890452  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59661c0752339050059285-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c0752339050059285-18\">18</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amount_sold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cust_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-5\"><span class=\"crayon-e\">GROUP </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-6\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-7\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-8\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-10\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">1841</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-13\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">890452</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-15\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59661c0752339050059285-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c0752339050059285-18\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c419b66138cea074ab015cdd55726c10.png\"></div>\n<p>在本例中，通过查看consistent GETS和递归调用输出，我们可以看到相同的情况。</p>\n<p>我们的查询也是生成更高效的数据库操作的第一步，它考虑的是批处理，而不是逐行思考。在进行数据库操作时，批处理的方法会让你在一天结束时消耗更少的资源，从而提高工作效率。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111807\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111807votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111807\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('累到想删库，程序员职业倦怠的真实现状', '2017-07-12', 'http://blog.jobbole.com/111762/', '22720e0ebb8efa08e36bb42b57357be2', 'https://static1.squarespace.com/static/533ad9bde4b098d084a846b1/t/534f6e1ce4b09b70f38ee6c1/1432265542589/DSCF3147.jpg?format=500w', 'full/5e8775a4506c4ad37e2e965d436efb7888507510.jpg', '1', '3', '3', '职场,,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.kennethreitz.org/essays/the-reality-of-developer-burnout\">kennethreitz</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：Kenneth Reitz 是一个知名的程序员，特别是在 Python 圈，他编写了 Requests / Records / Maya 等著名 Python 库，出过书《The Hitchhiker’s Guide to Python》。他在从 2001 年起就职于 Heroku，同时还是 Python 软件基金会董事会成员。对了，他以前还是个大胖子，2016 年后来减肥成功。他喜欢街拍，并且还是一个电子音乐制作人。</p>\n<p><img class=\"aligncenter\" src=\"https://static1.squarespace.com/static/533ad9bde4b098d084a846b1/t/534f6e1ce4b09b70f38ee6c1/1432265542589/DSCF3147.jpg?format=500w\" width=\"500\" height=\"333\"></p>\n<p>很不幸，倦怠在软件开发中是一个非常真实的现象，尤其是创立并维护一个具有大量用户的开源项目。就这个话题，我深有体会。所以我来分析我的个人经验。</p>\n<p>即使软件编程是你在这世上最喜欢的活动之一，每个整天写代码的人都会经历这样的事情，突然感觉“我想做别的事情，而不是坐在这写代码”。</p>\n<blockquote><p>你突然意识到，你已把冰激凌当成三餐，持续吃了好几年。你已厌倦了冰淇淋，不想再看到它。但偶尔吃冰淇淋的人不明白这一点，他们会想：你怎么会不想要冰淇淋了呢？—— Gary Bernhardt</p></blockquote>\n<p>我对软件开发的倦怠情况有一些个人经验，还有几个如何正视、防范和简单应对的小窍门。</p>\n<h3>目标的必然衰败</h3>\n<p>在 2011 年，我为自己设定了一些开源社区的目标后，我很努力地为此工作，有着好运相伴，我取得了成功（特别是 Requests 项目）。随着项目的人气不断攀升，我对继续创建新项目的动力下降了。同时，为了满足成功项目带来的大量用户群所提出的要求，我的负担越来越重，而维护项目的压力也在不断增加。</p>\n<p>这是我想要的，是吗？</p>\n<blockquote><p>倦怠十分狡猾，它悄然而至。它慢慢地折磨你，直到你认为这种感觉已经成为了新常态，这时你再也无法轻易跳出自己挖的坑了。—— Zach Holman</p></blockquote>\n<h3>410 GONE 网络失踪</h3>\n<p>我记得曾经有一次，我躺在沙发上，也就是我现在坐的地方，一边解决新出现的慢性偏头痛 (NDPH)，一边回顾我的生活。就像看推文一样，我不断地刷新并思考过当时软件世界中的一些政治问题，我发现自己对这些事情非常紧张，这本身就是一个问题。不仅如此，而且我过于在意我在推特上关注的人提出的公开观点，</p>\n<p>一旦我认识到这一点，我立刻意识到这是一个很严重的问题，必须立即停止它。我的第一个想法是提出所谓的“410 错误”情况。当然，我没有这样做，但是我很重视这个问题。</p>\n<blockquote><p>410 GONE 是 Mark Pilgrim 的一个沸沸扬扬的举动，他作为 Python 的开发者以及一个普通人，因为一些未知的原因，选择将自己从开发者社区隔离。我认为这可能是因为他感受到了来自开源“领导者”地位的压力，想要保持自己的身份认同。他突然从互联网上删除了所有的公共代码，这样所有的用户只能重新定向，访问其他非官方镜像。</p>\n<p>伯乐在线补注：Mark Pilgrim 是《Dive into Python | 深入 Python》的作者。他不仅删代码，并且他的社交账号 GitHub、Google+、Reddit、Twitter，也全部清空了。</p></blockquote>\n<p>在我看来，这是倦怠周期的缩影以及最坏的情况。我差一点就从 GitHub 上删除所有的项目，从 SpeakerDeck 上删除所有演讲的幻灯片，搞掉我自己的网站，然后在平静的生活中继续前进。</p>\n<p>但最后我没有这样做，为什么？因为这些是世界上对我最重要的事情。为什么我要破坏那些我努力创造、引以为傲的东西？</p>\n<h3>“只发布”模式</h3>\n<p>所以，我决定找到问题的根源，并解决它们。我意识到，我的世界已经挤入太多人，没有委派足够的人手，并且需要他人的帮助来维持我的项目。我不想失去我在社区中珍视的位置，它能够影响这个我极其重视的世界。</p>\n<p>所以，我选择取消关注推特上的所有人。我停止关注科技趋势，也不再阅读 Hacker News。我进入了“只发布”模式。</p>\n<p>这是一个重大的举措，就和我见过的很多其他开发者一样（一般比较隐晦，并不明确），这是一个从开源软件开发中，缓解压力的好方法。远离喧嚣，善待自己。</p>\n<p>今天，我在社交媒体上关注了一些人，人数不多，但足以让我处于一个相对较忙的状态，而过去很长一段时间我都过于忙碌了。这一切很容易就能实现。</p>\n<h3>委派</h3>\n<p>当成千上万的活跃用户使用你的软件，或即使只有你的同事时，你很容易感到懈怠，因为你是项目的唯一联系人。所以，我已经学会以新的方式委托并加强合作。</p>\n<p>针对 Requests 项目，我有两个合作维护者，他们帮忙处理收到的问题（issues），并解决诸如安全更新的事情。这大大降低了项目施加在我身上的压力，也帮助他们成为了 Python 社区的活跃分子。</p>\n<h3>我今天的平衡生活</h3>\n<p>所有的这些都是许多年前的事了，如今我的生活已经取得了一个良好的平衡。我在个人的兴趣爱好，如音乐制作、摄影上花费了大量的空闲时间（我甚至今年要出一张专辑）。我今年出版了一本书，另一个人花了大量的时间与精力参与其中，这本书的出版离不开他/她的鼎力相助。</p>\n<p><span style=\"color: #ff0000;\">有着写代码以外的爱好，实在是太重要了。</span></p>\n<p>我没有和往常那样，将编程作为一项娱乐消遣的工作，但我将再一次重新出发。我不觉得现在缺少了什么，但我的夜生活已经不同往昔，不再 100% 被代码完全占据了。</p>\n<p>开源的本质就是合作/协作。如果你发现自己倦怠了，累了，也许你需要找到一种与他人协作的新方式，来帮助你做最好的事情。你会发现，其他人可以通过做他们擅长的事，来帮助你做自己擅长的事。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111762\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111762votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111762\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('C++17 相比于 C++14 的所有重大变化', '2017-07-12', 'http://blog.jobbole.com/111801/', '28306cda6bcd694e383903e031f1cdfe', 'http://jbcdn2.b0.upaiyun.com/2016/05/2b6a906c5f04bf387ccf049e4a20b855.png', 'full/b7ccda3a3b2f793882325f528f2211d69c7b4f95.jpg', '0', '0', '1', '开发,C++', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0636r1.html\">open-std</a>   译文出处：<a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/27551890\">d41d8c</a>   </div><h2>摘要</h2>\n<p>本文档列举了自C++14发布以来，到C++17 DIS（N4660）发布为止，应用于C++工作草案（working draft）的所有重大变化。重大变化（major changes）是以专门的文件（paper）的形式加入的。不是每个文件都单独在此提及，没有单独提及的文件在下面简要列出。CWG或LWG问题清单（issue list）中的问题解决方案（issue resolution）通常不包括在重大变化之内，但是包含问题解决方案的文件也会简要列出。</p>\n<h2>目录</h2>\n<ol>\n<li>删除或弃用的特性</li>\n<li>具有全局影响的新的核心语言特性</li>\n<li>具有局部影响的新的核心语言特性</li>\n<li>新的库特性</li>\n<li>对现有特性的修改</li>\n<li>杂项</li>\n<li>未列入的文件</li>\n<li>展示C++17的代码片段合集</li>\n</ol>\n<h2>删除或弃用的特性</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4086\" target=\"_blank\" rel=\"nofollow noreferrer\">N4086<i class=\"icon-external\"></i></a><br>\n概要：删除trigraph<br>\n注释：字符序列 ??! 不再表示 | 。实现（implementation）可以把类似trigraph的功能作为输入编码的一环。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0001r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0001R1<i class=\"icon-external\"></i></a><br>\n概要：删除register<br>\n注释：register仍然是保留字，但是不再具有任何语义。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0002r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0002R1<i class=\"icon-external\"></i></a><br>\n概要：删除bool类型的++运算<br>\n注释：前自增和后自增运算符不再接受bool类型的操作数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0003r5\" target=\"_blank\" rel=\"nofollow noreferrer\">P0003R5<i class=\"icon-external\"></i></a><br>\n概要：删除throw(A, B, C)<br>\n注释：形如throw(A, B, C)的动态异常规范（dynamic exception specification）不再是合法的。throw()保留，成为noexcept(true)的同义词。注意throw()的语义变化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0386r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0386R2<i class=\"icon-external\"></i></a><br>\n概要：弃用static constexpr成员的重复声明<br>\n注释： 对于struct X { static constexpr int n = 10; };，int X::n;不再是定义，而是多余的重复声明，这种重复声明已被弃用。成员X::n是隐含的inline变量（见下文）。</p>\n<p>———-</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4190\" target=\"_blank\" rel=\"nofollow noreferrer\">N4190<i class=\"icon-external\"></i></a><br>\n概要：删除auto_ptr、random_shuffle、&lt;functional&gt;中的过时部分<br>\n注释：在C++11已经被弃用并被更好的组件取代的功能将不再包含于C++17中。它们的名字仍然是保留的，实现可以选择继续提供。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0004r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0004R1<i class=\"icon-external\"></i></a><br>\n概要：删除被弃用的iostream成员<br>\n注释：同上</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0302r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0302R1<i class=\"icon-external\"></i></a><br>\n概要：删除std::function的内存分配器（allocator）支持<br>\n注释：多态函数包装器function不再具有接受内存分配器的构造函数。内存分配器支持对具有类型擦除（type-erase）功能的可复制类型来说很困难，可能无法有效实现。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0063r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0063R3<i class=\"icon-external\"></i></a>（见下文）<br>\n概要：弃用一些C库（C library）头文件（header）<br>\n注释：“C库”（C library，这个术语指的是C++标准库的一部分， 而不是C标准库的一部分）中的以下头文件被弃用：&lt;ccomplex&gt;、&lt;cstdalign&gt;、&lt;cstdbool&gt;、&lt;ctgmath&gt;。注意&lt;ciso646&gt;头文件没有被弃用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0174r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0174R2<i class=\"icon-external\"></i></a><br>\n概要：弃用标准库中的陈旧部分<br>\n注释：以下组件被弃用：allocator&lt;void&gt;、raw_storage_iterator、get_temporary_buffer、is_literal_type、std::iterator。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0618r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0618R0<i class=\"icon-external\"></i></a><br>\n概要：弃用&lt;codecvt&gt;<br>\n注释：整个&lt;codecvt&gt;头文件（注意codecvt类并不在这个头文件中）被弃用。wstring_convert和wbuffer_convert也被弃用。这些功能难以正确使用，甚至有怀疑它们的规范是否正确。用户应该使用专用的文本处理库。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0371r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0371R1<i class=\"icon-external\"></i></a><br>\n概要：暂时弃用memory_order_consume<br>\n注释： 当前的“consume”内存序的语义被发现是不够的，需要重新定义。这项工作希望能在C++的下一版中完成。在进行这项工作的时间里，建议用户不要使用“consume”内存序，而是使用“acquire”内存序，以免将来遇到问题。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0521r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0521R0<i class=\"icon-external\"></i></a><br>\n概要：弃用shared_ptr::unique<br>\n注释：该成员函数暗示了没有实际提供的行为。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0604r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0604R0<i class=\"icon-external\"></i></a><br>\n概要：弃用result_of<br>\n注释：请改用新的trait：invoke_result。</p>\n<h2>具有全局影响的新的核心语言特性</h2>\n<p>这些是在不需要你知情或同意的情况下，你可能遇到的特性。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0012r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0012R1<i class=\"icon-external\"></i></a><br>\n概要：异常规范（exception specification）作为类型系统的一部分<br>\n注释：函数的异常规范现在是函数类型的一部分：void f() noexcept(true); 和 void f() noexcept(false); 是具有不同类型的函数。函数指针可以按符合常理的方式转换。（但是这两个函数 f 不能构成重载。）这个变化加强了类型系统。例如，API可以通过类型系统要求回调函数不抛出异常。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0135r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0135R1<i class=\"icon-external\"></i></a><br>\n概要：保证的复制消除（guaranteed copy elision）<br>\n注释：prvalue和glvalue的含义已被修改，prvalue不再代表对象（object），而仅仅代表“初始化”（“initialization”）。返回prvalue的函数不再会复制对象（强制复制消除“mandatory copy elision”），并且有了新的从prvalue到glvalue的转换，叫做<i>temporary materialization conversion</i>。这个变化意味着复制消除是保证了的，而且甚至可以应用于不可移动或复制的类型。这允许你定义返回这种（不可移动或复制的）类型的函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0035r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0035R4<i class=\"icon-external\"></i></a><br>\n概要：过度对齐类型（over-aligned types——即alignment超过std::max_align_t的类型）的动态内存分配<br>\n注释：动态内存分配（operator new）现在可以支持过度对齐的类型，这个运算符的一个新的重载接受对齐要求（alignment）参数。仍然是由实现决定支持哪些对齐。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0145r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0145R3<i class=\"icon-external\"></i></a><br>\n概要：更严格的表达式求值顺序<br>\n注释：对某些子表达式的求值顺序的规定更多了。这个变化的一个重要方面是函数的各个实参现在以不确定（indeterminate）的顺序的求值（也就是说没有交错 interleaving），而以前只是未指定的（unspecified）。注意重载运算符的求值顺序和调用方式有关：如果按照运算符的形式调用，就和相应的内置运算符的顺序相同；如果按照函数调用的形式调用，就和一般的函数调用相同（也就是不确定的 indeterminate）。</p>\n<h2>具有局部影响的新的核心语言特性</h2>\n<p>这些是如果你要使用，你就需要知道的特性。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4267\" target=\"_blank\" rel=\"nofollow noreferrer\">N4267<i class=\"icon-external\"></i></a><br>\n概要：u8字符字面量<br>\n注释：具有u8前缀的字符字面量产生一个在UTF-8中占有一个编码单元（code unit）的合法Unicode代码点（code point）对应的字符，换句话说，就是产生一个ASCII值。例如：u8’x’。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0245r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0245R1<i class=\"icon-external\"></i></a><br>\n概要：十六进制浮点数字面量<br>\n注释：具有十六进制底数和十进制指数的浮点数字面量： 0xC.68p+2, 0x1.P-126。C语言自从C99开始就支持这种语法， printf的%a可以输出这种形式的浮点数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4295\" target=\"_blank\" rel=\"nofollow noreferrer\">N4295<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0036r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0036R0<i class=\"icon-external\"></i></a><br>\n概要：fold表达式<br>\n注释：用于迭代地将二元运算符应用于参数包（parameter pack）的元素的便利语法：template &lt;typename …Args&gt; auto f(Args …args) { return <b>(0 + … + args)</b>; }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0127r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0127R2<i class=\"icon-external\"></i></a><br>\n概要：template &lt;auto&gt;<br>\n注释：模板的非类型形参可以用占位符类型auto声明。例如：<br>\n• template &lt;<b>auto</b> X&gt; struct constant { static constexpr auto value = X; };<br>\n• Delegate&lt;&amp;MyClass::some_function&gt;<br>\n（←_←第二个例子的完整版本见下文）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0091r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0091R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0512r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0512R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0433r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0433R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0620r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0620R0<i class=\"icon-external\"></i></a><br>\n概要：类模板参数推导<br>\n注释：类模板的模板参数现在可以从构造函数推导。例如 pair p(1, ‘x’); 定义 p 为 pair&lt;int, char&gt; 类型的变量（这不是HTML错误，模板实参是故意省略的）。显式的推导指引（deduction guide）是隐式推导的补充，显式的推导指引允许作者定制推导如何发生，或者禁止推导。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0292r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0292R2<i class=\"icon-external\"></i></a><br>\n概要：Constexpr if<br>\n注释：新的 if <b>constexpr</b> (<i>condition</i>) 语句根据常量表达式（constant expression）的值选择执行哪个分支。在模板的实例中，只有在条件（condition）具有合适的值的时候，对应的分支才会实例化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0305r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0305R1<i class=\"icon-external\"></i></a><br>\n概要：带初始化的选择语句<br>\n注释：选择语句 if 和 switch 有了一个新的、可选的初始化部分：if (auto it = m.find(key); it != m.end()) return it-&gt;second;</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0170r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0170R1<i class=\"icon-external\"></i></a><br>\n概要：Constexpr lambda<br>\n注释：lambda表达式现在可以是常量表达式了：auto add = [](int a, int b) <b>constexpr</b> { return a + b; }; int arr[add(1, 2)];</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0018r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0018R3<i class=\"icon-external\"></i></a><br>\n概要：lambda捕获*this<br>\n注释：以前：[self = *this]{ self.f(); } 现在：[<b>*this</b>]{ f(); }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0386r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0386R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0607r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0607R0<i class=\"icon-external\"></i></a><br>\n概要：inline变量<br>\n注释：在头文件中：<b>inline</b> int n = 10; 所有定义都指代同一个实体。static constexpr 成员变量隐含地成为 inline 变量。（标准库中的常量，不论是已有的还是新增的，都已使用inline。）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0217r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0217R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0615r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0615R0<i class=\"icon-external\"></i></a><br>\n概要：结构化绑定<br>\n注释：<b>auto [it, ins]</b> = m.try_emplace(key, a1, a2, a3);<br>\n可以分解数组、所有成员都是public的类、像pair、tuple和array一样遵循get&lt;N&gt;协议的自定义类型。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0061r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0061R1<i class=\"icon-external\"></i></a><br>\n概要：__has_include<br>\n注释：检查能否包含特定头文件的预处理运算符。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0188r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0188R1 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0189r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0189R1 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0212r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0212R1<i class=\"icon-external\"></i></a><br>\n概要：属性（attribute）[[fallthrough]]、[[nodiscard]]、[[maybe_unused]]（分别对应三个文件）<br>\n注释：一套新的标准化属性。属性没有必要的语义，但是鼓励实现发出或抑制适当的诊断（警告）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0137r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0137R1<i class=\"icon-external\"></i></a><br>\n概要：launder<br>\n注释：语言支持工具（“优化屏障optimisation barrier”），允许库重新使用存储（storage），并通过旧指针访问该存储（以前是不允许的）。（这是实现者的专家工具，预期不会在“正常”代码中出现）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0298r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0298R3<i class=\"icon-external\"></i></a><br>\n概要：字节类型<br>\n注释：新的类型byte在&lt;cstddef&gt;中定义（不在&lt;stddef.h&gt;，并且只定义在命名空间std中），它和unsigned char具有相同的布局，和现有的字符类型一样允许别名（aliasing），并且定义了按位操作。</p>\n<h2>新的库特性</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0226r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0226R1<i class=\"icon-external\"></i></a><br>\n概要：数学特殊函数（mathematical special functions）<br>\n注释：前国际标准ISO/IEC 29124:2010（数学特殊函数）的内容现在是C++的一部分。 这些函数只添加到&lt;cmath&gt; ，而没有添加到&lt;math.h&gt; ，并且只定义在命名空间std中。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0218r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0218R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0219r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0219R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0317r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0317R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0392r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0392R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0430r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0430R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0492r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0492R2<i class=\"icon-external\"></i></a><br>\n概要：文件系统<br>\n注释：文件系统技术规范（Filesystems Technical Specification）的内容现在是C++的一部分。 文件系统库允许以可移植的方式与目录和类似目录的结构进行交互（列出文件目录的内容，移动文件等）。 它主要以POSIX为模型，但它足够灵活，可以在各种系统上实现。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0024r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0024R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0336r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0336R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0394r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0394R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0452r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0452R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0467r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0467R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0502r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0502R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0518r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0518R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0523r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0523R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0574r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0574R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0623r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0623R0<i class=\"icon-external\"></i></a><br>\n概要：并行<br>\n注释：并行技术规范（Parallelism Technical Specification）的内容现在是C++的一部分。它为很多算法（algorithm）增加了重载，这些新的重载额外接受一个<i>执行策略</i>（<i>execution policy</i>）参数。它也加入了新的算法（见下文）。 支持三种执行策略，分别提供顺序（sequential），并行（ parallel）和向量化（vectorized）的执行。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0024r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0024R2<i class=\"icon-external\"></i></a><br>\n概要：新算法<br>\n注释：并行技术规范为标准库添加了几种新算法。加入它们的动机是它们可以有效地并行执行，但也提供了通常的（不接受execution policy参数的）简单形式：for_each_n、reduce、transform_reduce、exclusive_scan、inclusive_scan、transform_exclusive_scan、transform_inclusive_scan。请注意， reduce看起来与现有的accumulate相似，但reduce不保证任何特定的操作顺序。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0254r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0254R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0403r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0403R1<i class=\"icon-external\"></i></a><br>\n概要：新类型：string_view（以及basic_string_view）<br>\n注释：新的string_view类是API接口的推荐类型，如果API需要读取字符串的内容，但是不需要取得字符串的所有权或者修改字符串。它可以从char指针构造，但是其他的字符串类型应该自己提供到string_view的隐式转换。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a><br>\n概要：新类型：any<br>\n注释：类型any对可复制（copyable）的对象进行类型擦除（type-erase）。基本上可以用any做以下三件事：1. 把T类型的值放入其中。2. 复制它。 3. 检查它是否包含一个U类型的值，并且取出这个值，取出操作只有在U就是T的时候才会成功。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0088r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0088R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0393r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0393R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0510r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0510R0<i class=\"icon-external\"></i></a><br>\n概要：新的类模板：variant<br>\n注释：variant是一个可辨识联合（disjoint union / discriminated union）。variant&lt;A, B, C&gt; 类型的值在任何时间都包含一个类型为A、B或C之一的值。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0307r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0307R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a><br>\n概要：新的类模板：optional<br>\n注释：一个可选的值。一个optional&lt;T&gt;表示一个T值，或者表示没有值（由类型nullopt_t标记）。在某些方面，可以认为它等同于variant&lt;nullopt_t, T&gt;，但是它具有专门的接口。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：新算法：sample<br>\n注释：从一个范围（range）里均匀选取最多n个元素作为样本。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4169\" target=\"_blank\" rel=\"nofollow noreferrer\">N4169<i class=\"icon-external\"></i></a><br>\n概要：invoke<br>\n注释：以统一形式调用Callable实体（包括函数、函数对象和成员指针）的工具。这允许用户编写的库可以使用与标准的魔法（magic）<i>INVOKE</i>规则相同的行为。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0077r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0077R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0604r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0604R0<i class=\"icon-external\"></i></a><br>\n概要：is_invocable, is_invocable_r, invoke_result<br>\n注释：用于推断可调用性和调用结果的trait。（←_←看名字就知道应该和std::invoke配合使用。C++11的result_of也应该和invoke配合使用来着，如果只支持函数和函数对象应该直接用decltype，可惜名字取得不好，造成不少误用）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0067r5\" target=\"_blank\" rel=\"nofollow noreferrer\">P0067R5<i class=\"icon-external\"></i></a><br>\n概要：基本字符串转换<br>\n注释：函数to_chars和from_chars分别生成和解析数字的字符串表示。这些旨在形成用于替换printf和iostream格式化操作的高效、低级（low-level）的基础。它们遵循惯用的C++算法风格。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3911\" target=\"_blank\" rel=\"nofollow noreferrer\">N3911<i class=\"icon-external\"></i></a><br>\n概要：类型别名模板void_t<br>\n注释：template &lt;class…&gt; using void_t = void; 在元编程中惊人地有用，简化了SFINAE的使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4389\" target=\"_blank\" rel=\"nofollow noreferrer\">N4389<i class=\"icon-external\"></i></a><br>\n概要：类型别名模板bool_constant<br>\n注释：template &lt;bool B&gt; using bool_constant = integral_constant&lt;bool, B&gt;</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0013r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0013R1<i class=\"icon-external\"></i></a><br>\n概要：逻辑操作元函数<br>\n注释：用于元编程的变长元函数conjunction、disjunction和negation。这些trait在元编程的意义上是短路（short-circuit）的：不影响结果的模板不会被实例化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0185r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0185R1<i class=\"icon-external\"></i></a><br>\n概要：用于SFINAE友好（SFINAE-friendly）swap的traits<br>\n注释：新的trait is_swappable、is_nothrow_swappable、is_swappable_with、is_nothrow_swappable_with。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/lwg2911\" target=\"_blank\" rel=\"nofollow noreferrer\">LWG 2911<i class=\"icon-external\"></i></a><br>\n概要：Trait is_aggregate<br>\n注释：检查类型是否是聚合类（aggregate）。例如，可以用于判断泛型类型（←_←就是作为模板参数的类型）是应该用列表初始化（list-initialization）还是应该用非列表初始化（non-list-initialization）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0258r2%2520%253Cview-source%3Ahttp%3A//wg21.link/p0258r2%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0258R2<i class=\"icon-external\"></i></a><br>\n概要：Trait has_unique_object_representations<br>\n注释：这个trait可以用来判断特定的基于值的操作（例如比较和求hash值）是否可以用基于对象表示（object representation）的操作（例如memcmp）代替。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0007r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0007r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0007R1<i class=\"icon-external\"></i></a><br>\n概要：as_const<br>\n注释：给定lvalue x，std::as_const(x)返回相应的带const限定符的lvalue。std::as_const不能接受rvalue。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4280%2520%253Cview-source%3Ahttp%3A//wg21.link/n4280%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">N4280<i class=\"icon-external\"></i></a><br>\n概要：非成员函数size、data、empty<br>\n注释：新增的函数补充了现有的非成员函数begin、end等等。通过这些函数，可以用统一的方式访问标准容器和C风格数组。注意，和begin/end不同，这些新的函数不是定制点（customisation point），仅为方便起见提供。（←_←不知道原文作者为什么强调 the new functions are <i>not</i> customisation points，记得customization point是Ranges里的术语，而且在Ranges里这些非成员函数确实是customization point object）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0025r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0025r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0025R0<i class=\"icon-external\"></i></a><br>\n概要：clamp<br>\n注释：clamp(x, low, high)在x处于区间[low, high]内时返回x，否则返回最接近的边界（小于low就返回low，大于high就返回high）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0295r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0295r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0295R0<i class=\"icon-external\"></i></a><br>\n概要：gcd和lcm<br>\n注释：数论中的函数，计算两个整数的最大公约数和最小公倍数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4508%2520%253Cview-source%3Ahttp%3A//wg21.link/n4508%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">N4508<i class=\"icon-external\"></i></a><br>\n概要：shared_mutex类<br>\n注释：读-写互斥体，能够以共享或独占模式锁定。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0154r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0154r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0154R1<i class=\"icon-external\"></i></a><br>\n概要：干扰尺寸（interference sizes）<br>\n注释：两个新的实现定义常量hardware_constructive_interference_size、hardware_destructive_interference_size允许平台记录其高速缓存行大小（cache line size），以便用户避免虚假共享（破坏性干扰）并提高局部性（建设性干扰）。定义了两个单独的常量，以支持异构体系结构（heterogeneous architecture）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：元组（tuple）apply<br>\n注释：调用一个callable，参数从给定的元组中提取。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0209r2%2520%253Cview-source%3Ahttp%3A//wg21.link/p0209r2%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0209R2<i class=\"icon-external\"></i></a><br>\n概要：从元组构造<br>\n注释：新的函数模板make_from_tuple，功能是用给定元组的成员初始化T类型的值。它有点像刚提到的apply，但是它用于构造函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0005r4%2520%253Cview-source%3Ahttp%3A//wg21.link/p0005r4%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0005R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0358r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0358r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0358R1<i class=\"icon-external\"></i></a><br>\n概要：通用否定函数对象not_fn<br>\n注释：一个调用包装器（call wrapper），对它包装的callable取否定。它适用于具有任意数量参数的callable。它取代了旧的not1和not2包装器。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：memory resource<br>\n注释：一套新的组件，包括用于动态选择内存提供者的<i>memory resource</i>基类，以及三个具体实现（synchronized_pool_resource、unsynchronized_pool_resource、monotonic_buffer_resource）。有关用例参见下一条。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0337r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0337r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0337R0<i class=\"icon-external\"></i></a><br>\n概要：多态的内存分配器<br>\n注释：使用memory resource的内存分配器，memory resource可以在运行时改变，不是分配器类型的一部分。为方便使用，还提供了类型别名，如std::pmr::vector&lt;T&gt; = std::vector&lt;T, polymorphic_allocator&lt;T&gt;&gt;。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0253r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0253r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0253R1<i class=\"icon-external\"></i></a><br>\n概要：搜索器函数对象<br>\n注释：使用Boyer-Moore和Boyer-Moore-Horspool算法、用于搜索子字符串的函数对象，和一个使用这些函数对象的algorithm。</p>\n<h2>对现有特性的修改</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3928\" target=\"_blank\" rel=\"nofollow noreferrer\">N3928<i class=\"icon-external\"></i></a><br>\n概要：只接受一个参数的static_assert<br>\n注释：static_assert声明不再需要第二个参数：static_assert(N &gt; 0);</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4230\" target=\"_blank\" rel=\"nofollow noreferrer\">N4230<i class=\"icon-external\"></i></a><br>\n概要：嵌套命名空间声明<br>\n注释：namespace <b>foo::bar</b> { /* … */ }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4051\" target=\"_blank\" rel=\"nofollow noreferrer\">N4051<i class=\"icon-external\"></i></a><br>\n概要：允许用typename声明模板的模板参数（template template parameters）<br>\n注释：template &lt;template &lt;typename&gt; <b>typename</b> Tmpl&gt; struct X; 以前，模板的模板参数的声明只能用关键字class。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0184r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0184R0<i class=\"icon-external\"></i></a><br>\n概要：基于范围的for循环（range-based for）接受不同的begin/end类型<br>\n注释：for (<i>decl</i> : <i>expr</i>) 的规则受到重写，从以前的auto __begin = <i>begin-expr</i>, __end = <i>end-expr</i>;改成现在使用的 auto __begin = <i>begin-expr</i>; auto __end = <i>end-expr</i>;。这使得基于范围的for循环为新的Ranges（工作正在进行中）做好准备。</p>\n<p>文件： <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0195r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0195R2<i class=\"icon-external\"></i></a><br>\n概要：<i>using-declaration</i> 中的包扩展（pack expansion）<br>\n注释：template &lt;typename …Args&gt; struct X : Args… { <b>using Args::f…;</b> };</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0138r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0138R2<i class=\"icon-external\"></i></a><br>\n概要：固定枚举（fixed enum）值的构造<br>\n注释：类型为固定枚举 E 的变量可以用 E e { 5 }; 的形式定义，不再需要更啰嗦的 E e { E(5) };。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3922\" target=\"_blank\" rel=\"nofollow noreferrer\">N3922<i class=\"icon-external\"></i></a><br>\n概要：从花括号列表中推导auto的新规则<br>\n注释：以前，auto a{1, 2, 3}, b{1}; 是允许的，两个变量的类型都是 initializer_list&lt;int&gt;。现在 auto a{1, 2, 3}; 是错误的（ill-formed）， auto b{1}; 声明一个 int。注意，auto a = {1, 2, 3}, b = {1}; 保持不变，推导出 initializer_list&lt;int&gt; 。此改变预期作为缺陷解决方案（defect resolution）（在C++11和C++14模式下也会使用新规则）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4259\" target=\"_blank\" rel=\"nofollow noreferrer\">N4259<i class=\"icon-external\"></i></a><br>\n概要：uncaught_exceptions()<br>\n注释：函数uncaught_exception被弃用，新函数uncaught_exceptions返回计数而不是布尔值。以前的功能实际上是不能用的，<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4152\" target=\"_blank\" rel=\"nofollow noreferrer\">N4152<i class=\"icon-external\"></i></a>解释了细节。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4266\" target=\"_blank\" rel=\"nofollow noreferrer\">N4266<i class=\"icon-external\"></i></a><br>\n概要：命名空间（namespace）和枚举成员（enumerators）的属性（attributes）<br>\n注释：命名空间和枚举成员现在可以用属性标记。例如，这允许标记命名空间和枚举成员为弃用的（deprecated）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0028r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0028R4<i class=\"icon-external\"></i></a><br>\n概要：属性命名空间（attribute namespace）不需要重复指定<br>\n注释：当重复使用某一个属性命名空间时，这简化了命名空间限定。</p>\n<p>———-</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4279\" target=\"_blank\" rel=\"nofollow noreferrer\">N4279<i class=\"icon-external\"></i></a><br>\n概要：改进了std::map和std::unordered_map的插入<br>\n注释：m.try_emplace(key, arg1, arg2, arg3) 在m中已经含有key的时候没有任何效果，否则插入一个从参数构造的新元素。这个接口（interface）保证即使实参绑定到右值引用（rvalue reference），如果没有发生插入，实参将不会被移动（not moved from）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0084r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0084R2<i class=\"icon-external\"></i></a><br>\n概要：emplace的返回类型<br>\n注释：顺序容器（sequence container）的过去返回void的emplace、emplace_front、emplace_back成员函数模板，现在返回刚刚插入的元素的引用。（关联容器不受影响，因为它们的插入函数一直都返回相关元素的迭代器。）</p>\n<p>文件： <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0083r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0083R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0508r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0508R0<i class=\"icon-external\"></i></a><br>\n概要：set和map的拼接（splice）<br>\n注释：一个叫做<i>节点句柄</i>（<i>node handle</i>）的新机制加入了标准容器库。这个新机制允许在不同的map/set对象之间移植元素，而不会触及容器中的对象。此外，这个机制使得对提取（extract）出的键值进行可变访问成为可能。（←_←可以不使用mutable就修改set的元素和map的key了，当然在修改之前必须先提取出来，修改之后再插入回去，以保证set和map的内部结构不受破坏）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0272r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0272R1<i class=\"icon-external\"></i></a><br>\n概要：非const的string::data<br>\n注释：现在有了一个非const的basic_string::data重载，返回一个可变的（mutable）指针。此外，C++17允许向空终止符（null terminator）写入，只要写入的值是零。这使得字符串类更便于和C风格接口一起使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0156r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0156R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0156r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0156R2<i class=\"icon-external\"></i></a><br>\n概要：变长（variadic）版的lock_guard，名叫scoped_lock<br>\n注释：增加了变长的类模板scoped_lock&lt;Args…&gt;。它可以同时给多个可锁的对象（lockable object）加锁（使用和std::lock相同的算法），并且在析构函数中释放锁。一开始建议直接修改lock_guard，使它成为变长模板，但是发现这会造成ABI不兼容，所以现在我们有了新的类模板scoped_lock，它严格优于旧的lock_guard，所以不要使用lock_guard了。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0006r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0006R0<i class=\"icon-external\"></i></a><br>\n概要：变量模板trait<br>\n注释：对于每一个只包含一个静态成员常量的trait foo ，有了一个对应的变量模板foo_v&lt;Args…&gt;。foo_v&lt;Args…&gt;等价于foo&lt;Args…&gt;::value。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0152r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0152R1<i class=\"icon-external\"></i></a><br>\n概要：atomic::is_always_lock_free<br>\n注释：一个新的静态成员常量is_always_lock_free记录了给定原子类型（atomic type）的操作是否总是无锁（lock-free）的。现有的非静态成员函数可能对同一原子类型的不同值给出不同的答案。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0414r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0414R2<i class=\"icon-external\"></i></a><br>\n概要：数组的shared_ptr<br>\n注释：类模板shared_ptr现在可以支持C风格数组，只需传入T[]或T[N]作为模板参数。接受原始指针（raw pointer）的构造函数将会设置（install）合适的数组内存释放器（array deleter）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0163r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0163R0<i class=\"icon-external\"></i></a><br>\n概要：shared_ptr::weak_type<br>\n注释：shared_ptr&lt;T&gt;现在有了一个成员类型weak_type，它是weak_ptr&lt;T&gt;的别名。这使得泛型代码不需要解构shard_ptr的类型就可以知道对应的weak_ptr类型。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0030r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0030R1<i class=\"icon-external\"></i></a><br>\n概要：三维的斜边长（hypotenuse）<br>\n注释：三维斜边长hypot(x, y, z) （可以用来计算三维空间中两个点的距离）作为额外的重载加入 &lt;cmath&gt; （但没有加入&lt;math.h&gt;，并且只定义在命名空间std中）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0040r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0040R3<i class=\"icon-external\"></i></a><br>\n概要：更多用于未初始化内存的算法<br>\n注释：增加在未初始化的内存中构造对象和销毁对象的算法。包括分别进行默认初始化（default-initialization）和值初始化（value-initialization）的版本。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4510\" target=\"_blank\" rel=\"nofollow noreferrer\">N4510<i class=\"icon-external\"></i></a><br>\n概要：内存分配器对不完整类型（incomplete type）的支持<br>\n注释：这项改变放宽了内存分配器对它的值类型（value type）的要求，使得值类型可以是不完整类型。例如，这允许递归的结构，如：struct X { std::vector&lt;X&gt; data; };</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0092r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0092R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0505r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0505R0<i class=\"icon-external\"></i></a><br>\n概要：对&lt;chrono&gt;的改变<br>\n注释：为时间点（time point）增加了向上取整（floor）、向下取整（ceiling）、除法（division）和四舍六入五成双取整（rounding）。（←_←我们中出了一个除法。根据P0092R1来看，原文似有问题，增加的应该是绝对值abs而不是除法。）大多数成员函数成为constexpr函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0426r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0426R1<i class=\"icon-external\"></i></a><br>\n概要：char_traits的constexpr支持<br>\n注释：对于标准要求的所有的char_traits特化（也就是std::char_traits&lt;char&gt;、std::char_traits&lt;wchar_t&gt;、std::char_traits&lt;char16_t&gt;、std::char_traits&lt;char32_t&gt;这四个类），成员函数length、compare、find和assign现在都是constexpr成员函数了。这使得string view可以在常量表达式中更广泛地使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4387\" target=\"_blank\" rel=\"nofollow noreferrer\">N4387<i class=\"icon-external\"></i></a><br>\n概要：改善pair和tuple<br>\n注释：这个变化使得pair和tuple的构造函数变为“带条件的explicit”构造函数。只有在有某个元素的对应构造函数是explicit的时候，pair和tuple的构造函数才是explicit的。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0435r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0435R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0548r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0548R1<i class=\"icon-external\"></i></a><br>\n概要：对common_type的改变<br>\n注释：因为如果不改一下common_type，就不能称为新标准了……</p>\n<h2>杂项</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0063r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0063R3<i class=\"icon-external\"></i></a><br>\n概要：C++引用C11<br>\n注释：C++标准现在正式地（normatively）引用C11 (ISO/IEC 9899:2011) 为“C标准”（“The C Standard”）了。这不仅是应对ISO的要求（ISO要求对其他国际标准的引用必须引用最新发布的版本，而不是某个历史版本），也使得我们可以使用aligned_alloc，它对于改进动态内存管理（dynamic memory management）非常有用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0180r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0180R2<i class=\"icon-external\"></i></a><br>\n概要：保留的（reserved）命名空间<br>\n注释：所有形如 std<i>N</i> （其中 <i>N</i> 是一串数字）的命名空间现在被保留了。（用户不能使用了。）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0175r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0175R1<i class=\"icon-external\"></i></a><br>\n概要：C库总览（synopsis）<br>\n注释：一个纯粹非技术性（editorial）的变化：标准库的“C库”部分的所有头文件的内容现在在C++标准文档中以完整的总览（synopsis）的形式展现（也就是完整列出每个标准头文件包含的完整声明），而不再是像以前一样只列出名字。这使得与C语言中的语义不同的地方（例如增加的重载，针对language linkage的重载）更容易理解。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4262\" target=\"_blank\" rel=\"nofollow noreferrer\">N4262 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0134r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0134R0 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0391r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0391R0 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4284\" target=\"_blank\" rel=\"nofollow noreferrer\">N4284<i class=\"icon-external\"></i></a><br>\n概要：术语“forwarding reference”、“default member initializer”、“templated entity”、“contiguous iterator”（分别对应四个文件）<br>\n注释：这些变化没有正式的（normative）影响，但是它们为迄今为止只从语言规则中<i>出现</i>的概念建立了官方术语。精确和众所周知的术语简化了关于C++的讨论，也简化了规范。</p>\n<h2>未列入的文件</h2>\n<p>以下文件在委员会会议（committee meeting）上被接受，但是它们的内容过于专门，不能称为单独的特性：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4258\" target=\"_blank\" rel=\"nofollow noreferrer\">N4258<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4268\" target=\"_blank\" rel=\"nofollow noreferrer\">N4268<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4277\" target=\"_blank\" rel=\"nofollow noreferrer\">N4277<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4285\" target=\"_blank\" rel=\"nofollow noreferrer\">N4285<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0017r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0017R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0031r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0031R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0074r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0074R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0270r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0270R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0283r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0283R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0296r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0296R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0503r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0503R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0509r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0509R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0516r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0516R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0517r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0517R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0558r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0558R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0599r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0599R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0612r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0612R0<i class=\"icon-external\"></i></a>。</p>\n<p>以下文件包含被接受为缺陷报告（defect report）的问题（issue）。处理CWG问题的文件有 <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4192\" target=\"_blank\" rel=\"nofollow noreferrer\">N4192<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4457\" target=\"_blank\" rel=\"nofollow noreferrer\">N4457<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0164r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0164R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0167r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0167R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0263r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0263R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0384r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0384R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0398r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0398R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0490r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0490R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0507r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0507R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0519r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0519R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0520r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0520R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0522r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0522R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0575r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0575R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0576r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0576R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0613r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0613R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0622r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0622R0<i class=\"icon-external\"></i></a>。处理LWG问题的文件有 <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4245\" target=\"_blank\" rel=\"nofollow noreferrer\">N4245<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4366\" target=\"_blank\" rel=\"nofollow noreferrer\">N4366<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4383\" target=\"_blank\" rel=\"nofollow noreferrer\">N4383<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4525\" target=\"_blank\" rel=\"nofollow noreferrer\">N4525<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0304r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0304R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0397r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0397R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0610r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0610R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0625r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0625R0<i class=\"icon-external\"></i></a>。每份文件中只有部分问题被选出，具体细节见会议记录（meeting minutes）。以下单独的文件解决特定的问题：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4089\" target=\"_blank\" rel=\"nofollow noreferrer\">N4089<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4261\" target=\"_blank\" rel=\"nofollow noreferrer\">N4261<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0033r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0033R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0136r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0136R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0250r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0250R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0418r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0418R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0513r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0513R0<i class=\"icon-external\"></i></a>。历年来解决的问题（accepted issue）的完整列表公布在<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html\" target=\"_blank\" rel=\"nofollow noreferrer\">CWG issues list<i class=\"icon-external\"></i></a>和<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html\" target=\"_blank\" rel=\"nofollow noreferrer\">LWG issues list<i class=\"icon-external\"></i></a>，二者会经常更新。</p>\n<h2>展示C++17的代码片段合集</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661e6d22115543854562\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstd::unordered_map&lt;std::string, std::unique_ptr&lt;Foo&gt;&gt; items;\r\nstd::vector&lt;std::unique_ptr&lt;Foo&gt;&gt; standby;\r\n\r\n// 如果没有\'id\'元素，则把\'foo\'作为\'id\'元素插入。\r\n// 否则把\'foo\'保存起来以备之后使用，将其放入standby中。\r\n\r\n// C++17以前\r\n\r\nvoid f(std::string id, std::unique_ptr&lt;Foo&gt; foo) {\r\n  auto it = items.find(id);\r\n  if (it == items.end()) {\r\n    auto p = items.emplace(std::move(id), std::move(foo));\r\n    p.first-&gt;second-&gt;launch();\r\n  } else {\r\n    standby.push_back(std::move(foo));\r\n    standby.back()-&gt;wait_for_notification();\r\n  }\r\n\r\n  // 注意：\r\n  // * 变量\'id\'不能再次使用（moved-from）；或者……\r\n  // * ……需要使用\'const string&amp; id\'作为参数，并强制复制。\r\n  // * 做了两次map查找。有序的map可以使用lower_bound + hint，但无序的map（unordered map）用不了。\r\n  // * （不能无条件调用emplace，因为它可能导致*foo被析构。）\r\n}\r\n\r\n// 使用C++17\r\n\r\nvoid f(std::string_view id, std::unique_ptr&lt;Foo&gt; foo) {\r\n  if (auto [pos, inserted] = items.try_emplace(id, std::move(foo)); inserted) {\r\n    pos-&gt;second-&gt;launch();\r\n  } else {\r\n    standby.emplace_back(std::move(foo))-&gt;wait_for_notification();\r\n  }\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22115543854562-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22115543854562-34\">34</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-1\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unordered_map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-2\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-4\"><span class=\"crayon-c\">// 如果没有\'id\'元素，则把\'foo\'作为\'id\'元素插入。</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-5\"><span class=\"crayon-c\">// 否则把\'foo\'保存起来以备之后使用，将其放入standby中。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-6\"> </div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-7\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-8\"> </div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-9\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">auto </span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emplace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">first</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">second</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">launch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wait_for_notification</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-18\"> </div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 注意：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * 变量\'id\'不能再次使用（moved-from）；或者……</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * ……需要使用\'const string&amp; id\'作为参数，并强制复制。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * 做了两次map查找。有序的map可以使用lower_bound + hint，但无序的map（unordered map）用不了。</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * （不能无条件调用emplace，因为它可能导致*foo被析构。）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-24\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-26\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-28\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">string_view </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-29\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inserted</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">try_emplace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inserted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">second</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">launch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-31\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emplace_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wait_for_notification</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22115543854562-33\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22115543854562-34\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p>下面的代码片段展示了template &lt;auto&gt;的用法，例子中的类模板将一个非成员函数转发给绑定了类实例的成员函数，并且成员函数是这个类模板的<i>类型</i>的一部分。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661e6d22126510221191\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// C++17以前\r\n\r\ntemplate &lt;typename T, int (T::* MF)(int, int)&gt; // 两个参数：一个类型参数，一个非类型参数\r\nstruct Delegate { /* ... */ };\r\n\r\nint n = Delegate&lt;MyComplexClass, &amp;MyComplexClass::an_imporant_function&gt;(&amp;obj)(10, 20);\r\n\r\n// 使用C++17\r\n\r\ntemplate &lt;auto&gt; struct Delegate;                  // 一个（非类型）参数\r\ntemplate &lt;typename T, int (T::* MF)(int, int)&gt;\r\nstruct Delegate&lt;MF&gt;  { /* ... */ };              // 实现方法和以前相同，但现在使用偏特化（partial specialization）\r\n\r\nint n = Delegate&lt;&amp;MyComplexClass::an_imporant_function&gt;(&amp;obj)(10, 20);</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d22126510221191-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d22126510221191-14\">14</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-1\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-2\"> </div><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-3\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 两个参数：一个类型参数，一个非类型参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-4\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delegate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ... */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">an_imporant_function</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-8\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-10\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">auto</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                  </span><span class=\"crayon-c\">// 一个（非类型）参数</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-11\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-12\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">MF</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ... */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\">// 实现方法和以前相同，但现在使用偏特化（partial specialization）</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d22126510221191-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d22126510221191-14\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">an_imporant_function</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>下面的代码片段展示fold表达式在泛型代码中的用法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661e6d2212b408750665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 对于参数包f中的所有元素，调用f(n)。\r\ntemplate &lt;typename ...F&gt;\r\nvoid ApplyAll(int n, const F&amp;... f) {\r\n   (f(n), ...); // 一元fold (over the comma operator)\r\n}\r\n\r\n// 对于参数包f中的所有元素，计算f(a, b)，返回和。\r\ntemplate &lt;typename ...F&gt;\r\nint ApplyAndSum(int a, int b, const F&amp;... f) {\r\n   return (f(a, b) + ... + 0); // 二元fold\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212b408750665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212b408750665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212b408750665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212b408750665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212b408750665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212b408750665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212b408750665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212b408750665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212b408750665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212b408750665-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212b408750665-11\">11</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661e6d2212b408750665-1\"><span class=\"crayon-c\">// 对于参数包f中的所有元素，调用f(n)。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212b408750665-2\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d2212b408750665-3\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplyAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212b408750665-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 一元fold (over the comma operator)</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d2212b408750665-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212b408750665-6\"> </div><div class=\"crayon-line\" id=\"crayon-59661e6d2212b408750665-7\"><span class=\"crayon-c\">// 对于参数包f中的所有元素，计算f(a, b)，返回和。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212b408750665-8\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d2212b408750665-9\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplyAndSum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212b408750665-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 二元fold</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d2212b408750665-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>下面的代码片段展示shared_ptr对数组的支持。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661e6d2212f708532504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// C++17以前\r\nstd::shared_ptr&lt;char&gt; p(new char[N], std::default_delete&lt;char[]&gt;()); // 如果不提供删除器（deleter）就错了\r\n\r\n// 使用C++17\r\nstd::shared_ptr&lt;char[]&gt; p(new char[N]); // 删除器自动使用“delete[]”</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212f708532504-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212f708532504-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212f708532504-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661e6d2212f708532504-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661e6d2212f708532504-5\">5</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661e6d2212f708532504-1\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212f708532504-2\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">shared_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">default_delete</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 如果不提供删除器（deleter）就错了</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d2212f708532504-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661e6d2212f708532504-4\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-59661e6d2212f708532504-5\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">shared_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 删除器自动使用“delete[]”</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111801\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111801votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111801\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('让程序员跨界做设计，脑洞开的万万想不到', '2017-07-12', 'http://blog.jobbole.com/111518/', '28c734bfc805d9104aada552c0c94048', 'http://jbcdn2.b0.upaiyun.com/2017/04/7a91ae8776d0953ac776284a7d92e861.jpg', 'full/e4ef10899dd499cd91f9102bff717ea3d2311bfc.jpg', '7', '1', '4', '趣文小说,,趣文', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/85952/th-worst-volume-control-design-contest\">开源中国社区/王练</a>   </div><p>如果程序员来做设计，世界会变成什么样子？</p>\n<p>著名社交新闻网站 Reddit 最近举办了一个“最糟糕音量键设计大赛”，起因是一个程序员在 Reddit 晒出了自己设计的一款“不同寻常”的音量控制键，并号召大家加入到设计当中来。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fgqlqodsdlg20d407s40w.gif\" width=\"472\" height=\"280\"></p>\n<p>程序员们分别按照自己的想法，重新设计了电脑的音量大小按键，比如这样的：</p>\n<blockquote><p>我也不知道音量大小是多少，全都是凭运气来调整的，想要改音量的时候就 roll 一下</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqoib21g20dy06z76y.gif\" width=\"502\" height=\"251\"></p>\n<blockquote><p>快把音量调到50！等等，等等，我再晃一下，刚刚晃过了…</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgqlqpgt5fg20ir06wqv5.gif\" width=\"675\" height=\"248\"></p>\n<p>愤怒的小鸟？</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqpwtikg20dw06y41h.gif\" width=\"500\" height=\"250\"></p>\n<p>单身几十年的手速终于排上用场了</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fgqlqqzjgeg20fm0dg7wh.gif\" width=\"562\" height=\"484\"></p>\n<p>学渣的末日</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqra6u8g20dm02yglm.gif\" width=\"490\" height=\"106\"></p>\n<p>论“鼠标手”是怎么炼成的</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgqlqrtsxyg20ie0aemzf.gif\" width=\"662\" height=\"374\"></p>\n<p>给我一天时间，我能画个蒙娜丽莎出来</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fgqlqs8ecsg20go0ctdqu.gif\" width=\"600\" height=\"461\"></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111518\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111518votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111518\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('如何做到“恰好一次”地传递数十亿条消息', '2017-07-12', 'http://blog.jobbole.com/111809/', '2b13e3e5df22fd0e812a87b4e135b363', 'http://dl2.iteye.com/upload/attachment/0125/9374/0805a15e-51e6-3eb3-b3dc-4a687849ed1c.png', 'full/857f271a3adaff2d5c4056118f165d5851466b8a.jpg', '0', '0', '1', '其他,kafka,分布式', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://segment.com/blog/exactly-once-delivery/\">Amir Abu Shareb</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32533\">ITeye-雁惊寒</a>   </div><p><em>译者注：在分布式领域中存在着三种类型的消息投递语义，分别是：最多一次（at-most-once）、至少一次（at-least-once）和恰好一次（exactly-once）。本文作者介绍了一个利用Kafka和RocksDB来构建的“恰好一次”消息去重系统的实现原理。以下是译文。</em></p>\n<p>对任何一个数据流水线的唯一要求就是不能丢失数据。数据通常可以被延迟或重新排序，但不能丢失。</p>\n<p>为了满足这一要求，大多数的分布式系统都能够保证“<a href=\"http://www.cloudcomputingpatterns.org/at_least_once_delivery/\" target=\"_blank\">至少一次</a>”的投递消息技术。实现“至少一次”的投递技术通常就是：“重试、重试、再重试”。在你收到消费者的确认消息之前，你永远不要认为消息已经投递过去。</p>\n<p>但“至少一次”的投递并不是用户想要的。用户希望消息被投递一次，并且仅有一次。</p>\n<p>然而，<a href=\"http://bravenewgeek.com/you-cannot-have-exactly-once-delivery/\" target=\"_blank\">实现“恰好一次”的投递需要完美的设计</a>。每种投递失败的情况都必须认真考虑，并设计到架构中去，因此它不能在事后“挂到”现有的实现上去。即使这样，“只有一次”的投递消息几乎是不可能的。</p>\n<p>在过去的三个月里，我们构建了一个全新的去重系统，以便在面对各种故障时能让系统尽可能实现“恰好一次”的投递。</p>\n<p>新系统能够跟踪旧系统100倍的消息数量，并且可靠性也得到了提高，而付出的代价却只有一点点。下面我们就开始介绍这个新系统。</p>\n<p><strong>问题所在</strong></p>\n<p>Segment内部的大部分系统都是通过重试、消息重新投递、锁定和<a href=\"https://en.wikipedia.org/wiki/Two-phase_commit_protocol\" target=\"_blank\">两阶段提交</a>来优雅地处理故障。但是，有一个特例，那就是将数据直接发送到公共API的客户端程序。</p>\n<p>客户端（特别是移动客户端）经常会发生网络问题，有时候发送了数据，却没有收到API的响应。</p>\n<p>想象一下，某天你乘坐公共汽车，在iPhone上使用HotelTonight软件预订房间。该应用程序将数据上传到了Segment的服务器上，但汽车突然进入了隧道并失去了网络连接。你发送的某些数据在服务器上已经被处理，但客户端却无法收到服务器的响应消息。</p>\n<p>在这种情况下，即使服务器在技术上已经收到了这些确切的消息，但客户端也会进行重试并将相同的消息重新发送给Segment的API。</p>\n<p>从我们服务器的统计数据来看，在四个星期的窗口时间内，大约有0.6％的消息似乎是我们已经收到过的重复消息。</p>\n<p>这个错误率听起来可能并不是很高。但是，对于一个能创造数十亿美元效益的电子商务应用程序来说，0.6％的出入可能意味着盈利和数百万美元损失之间的差别。</p>\n<p><strong>对消息进行去重</strong></p>\n<p>现在，我们认识到问题的症结了，我们必须删除发送到API的重复消息。但是，该怎么做呢？</p>\n<p>最简单的思路就是使用针对任何类型的去重系统的高级API。在Python中，我们可以将其表示为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965ec922e2b3503921211\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef dedupe(stream):  \r\n  for message in stream:  \r\n    if has_seen(message.id):   \r\n      discard(message)  \r\n    else:  \r\n      publish_and_commit(message)</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2b3503921211-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2b3503921211-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2b3503921211-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2b3503921211-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2b3503921211-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2b3503921211-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965ec922e2b3503921211-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">dedupe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2b3503921211-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2b3503921211-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has_seen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2b3503921211-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">discard</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2b3503921211-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2b3503921211-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">publish_and_commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>对于数据流中的每个消息，首先要把他的id（假设是唯一的）作为主键，检查是否曾经见过这个特定的消息。如果以前见过这个消息，则丢弃它。如果没有，则是新的，我们应重新发布这个消息并以原子的方式提交消息。</p>\n<p>为了避免存储所有的消息，我们会设置“去重窗口”这个参数，这个参数定义了在消息过期之前key存储的时长。只要消息落在窗口时间之外，我们就认为它已过期失效。我们要保证在窗口时间内某个给定ID的消息只发送一次。</p>\n<p>这个行为很容易描述，但有两个方面需要特别注意：读/写性能和正确性。</p>\n<p>我们希望系统能够低延迟和低成本的对通过流水线的数十亿个事件进行去重。更重要的是，我们要确保所有的事件都能够被持久化，以便可以从崩溃中恢复出来，并且不会输出重复的消息。</p>\n<p><strong>架构</strong></p>\n<p>为了实现这一点，我们创建了一个“两阶段”架构，它读入Kafka的数据，并且在四个星期的时间窗口内对接收到的所有事件进行去重。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9374/0805a15e-51e6-3eb3-b3dc-4a687849ed1c.png\" width=\"649\" height=\"363\"></div>\n<div style=\"text-align: center\">去重系统的高级架构图</div>\n<div style=\"text-align: center\"></div>\n<p><strong>Kafka的拓扑结构</strong></p>\n<p>要了解其工作原理，首先看一下<a href=\"https://kafka.apache.org/\" target=\"_blank\">Kafka</a>的流拓扑结构。所有传入消息的API调用都将作为单独的消息进行分离，并读入到Kafka输入主题（input topic）中。</p>\n<p>首先，每个传入的消息都有一个由客户端生成的具有唯一性的messageId标记。在大多数情况下，这是一个UUIDv4（我们考虑切换到<a href=\"https://segment.com/blog/a-brief-history-of-the-uuid/\" target=\"_blank\">ksuids</a>）。 如果客户端不提供messageId，我们会在API层自动分配一个。</p>\n<p>我们不使用矢量时钟或序列号，因为我们希望能降低客户端的复杂性。使用UUID可以让任何人轻松地将数据发送到我们的API上来，因为几乎所有的主要语言都支持它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965ec922e2bf937081928\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{  \r\n  \"messageId\": \"ajs-65707fcf61352427e8f1666f0e7f6090\",  \r\n  \"anonymousId\": \"e7bd0e18-57e9-4ef4-928a-4ccc0b189d18\",  \r\n  \"timestamp\": \"2017-06-26T14:38:23.264Z\",  \r\n  \"type\": \"page\"  \r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2bf937081928-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2bf937081928-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2bf937081928-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2bf937081928-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2bf937081928-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2bf937081928-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965ec922e2bf937081928-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2bf937081928-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"messageId\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ajs-65707fcf61352427e8f1666f0e7f6090\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2bf937081928-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"anonymousId\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"e7bd0e18-57e9-4ef4-928a-4ccc0b189d18\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2bf937081928-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2017-06-26T14:38:23.264Z\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2bf937081928-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"page\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2bf937081928-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>为了能够将消息持久化，并能够重新发送，一个个的消息被保存到Kafka中。消息以messageId进行分区，这样就可以保证具有相同messageId的消息能够始终由同一个消费者处理。</p>\n<p>这对于数据处理来说是一件很重要的事情。我们可以通过路由到正确的分区来查找键值，而不是在整个中央数据库的数百亿条消息中查找，这种方法极大地缩小了查找范围。</p>\n<p>去重“worker”（worker：工人。译者注，这里表示的是某个进程。为防止引起歧义，下文将直接使用worker）是一个Go程序，它的功能是从Kafka输入分区中读入数据，检查消息是否有重复，如果是新的消息，则发送到Kafka输出主题中。</p>\n<p>根据我们的经验，worker和Kafka拓扑结构都非常容易掌握。我们无需使用一组遇到故障时需要切换到副本的庞大的<a href=\"https://memcached.org/\" target=\"_blank\">Memcached</a>实例。相反，我们只需使用零协同的嵌入式<a href=\"http://rocksdb.org/\" target=\"_blank\">RocksDB</a>数据库，并以非常低的成本来获得持久化存储。</p>\n<p><strong>RocksDB的worker进程</strong></p>\n<p>每一个worker都会在本地EBS硬盘上存放了一个RocksDB数据库。 RocksDB是由<a href=\"https://www.facebook.com/notes/facebook-engineering/under-the-hood-building-and-open-sourcing-rocksdb/10151822347683920/\" target=\"_blank\">Facebook开发的嵌入式键值存储系统</a>，它的性能非常高。</p>\n<p>每当从输入主题中过来的消息被消费时，消费者通过查询RocksDB来确定我们之前是否见过该事件的messageId。</p>\n<p>如果RocksDB中不存在该消息，我们就将其添加到RocksDB中，然后将消息发布到Kafka输出主题。</p>\n<p>如果消息已存在于RocksDB，则worker不会将其发布到输出主题，而是更新输入分区的偏移，确认已处理过该消息。</p>\n<p><strong>性能</strong></p>\n<p>为了让我们的数据库获得高性能，我们必须对过来的每个事件满足三种查询模式：</p>\n<ul>\n<li>检测随机key的存在性，这可能不存在于我们的数据库中，但会在key空间中的任何地方找到。</li>\n<li>高速写入新的key</li>\n<li>老化那些超出了“去重窗口”的旧的key</li>\n</ul>\n<p>实际上，我们必须不断地检索整个数据库，追加新的key，老化旧的key。在理想情况下，这些发生在同一数据模型中。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9376/72903fab-cccf-3cad-865c-1ff55f16cc47.png\" width=\"650\" height=\"346\"></div>\n<div style=\"text-align: center\">我们的数据库必须满足三种独立的查询模式</div>\n<div style=\"text-align: center\"></div>\n<p>一般来说，这些性能大部分取决于我们数据库的性能，所以应该了解一下RocksDB的内部机制来提高它的性能。</p>\n<p>RocksDB是一个<a href=\"https://en.wikipedia.org/wiki/Log-structured_merge-tree\" target=\"_blank\">日志结构合并树（log-structured-merge-tree， 简称LSM）</a>数据库，这意味着它会不断地将新的key附加到磁盘上的预写日志（write-ahead-log）中，并把排序过的key存放在内存中作为memtable的一部分。</p>\n<div style=\"text-align: center\"><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9378/c8ba4f20-2a19-3d7d-9757-35a21939ad9b.png\" width=\"650\" height=\"316\"><br>\nkey存放在内存中作为memtable的一部分</div>\n<div></div>\n<div>写入key是一个非常快速的过程。新的消息以追加的方式直接保存到磁盘上，并且数据条目在内存中进行排序，以提供快速的搜索和批量写入。</div>\n<div>每当写入到memtable的条目达到一定数量时，这些条目就会被作为SSTable（排序的字符串表）持久化到磁盘上。由于字符串已经在内存中排过序了，所以可以将它们直接写入磁盘。</div>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9380/51764a44-a86b-3b2b-a51f-e3d76fb99e0d.png\" width=\"650\" height=\"442\"></div>\n<div style=\"text-align: center\">当前的memtable零级写入磁盘</div>\n<div style=\"text-align: center\"></div>\n<p>以下是在我们的生产日志中写入的示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965ec922e2c5939859879\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[JOB 40] Syncing log #655020  \r\n[default] [JOB 40] Flushing memtable with next log file: 655022  \r\n[default] [JOB 40] Level-0 flush table #655023: started  \r\n[default] [JOB 40] Level-0 flush table #655023: 15153564 bytes OK  \r\n[JOB 40] Try to delete WAL files size 12238598, prev total WAL file size 24346413, number of live WAL files 3.</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2c5939859879-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2c5939859879-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2c5939859879-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2c5939859879-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2c5939859879-5\">5</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965ec922e2c5939859879-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Syncing </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655020  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2c5939859879-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flushing </span><span class=\"crayon-e\">memtable </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">next </span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">655022</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2c5939859879-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Level</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flush </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655023: started  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2c5939859879-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Level</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flush </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655023: 15153564 bytes OK  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2c5939859879-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Try</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-e\">files </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12238598</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">prev </span><span class=\"crayon-e\">total </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24346413</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">live </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-i\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>每个SSTable是不可变的，一旦创建，永远不会改变。这是什么写入新的键这么快的原因。无需更新文件，无需写入扩展。相反，在带外压缩阶段，同一级别的多个SSTable可以合并成一个新的文件。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9382/50bf7dc4-1153-30fb-b263-d3d887451cec.png\" width=\"650\" height=\"422\"></div>\n<p> </p>\n<p>当在同一级别的SSTables压缩时，它们的key会合并在一起，然后将新的文件升级到下一个更高的级别。</p>\n<p>看一下我们生产的日志，可以看到这些压缩作业的示例。在这种情况下，作业41正在压缩4个0级文件，并将它们合并为单个较大的1级文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965ec922e2ca384028403\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/data/dedupe.db$ head -1000 LOG | grep \"JOB 41\"  \r\n[JOB 41] Compacting 4@0 + 4&lt;a href=\"http://www.jobbole.com/members/yaowei729\"&gt;@1&lt;/a&gt; files to L1, score 1.00  \r\n[default] [JOB 41] Generated table #655024: 1550991 keys, 69310820 bytes  \r\n[default] [JOB 41] Generated table #655025: 1556181 keys, 69315779 bytes  \r\n[default] [JOB 41] Generated table #655026: 797409 keys, 35651472 bytes  \r\n[default] [JOB 41] Generated table #655027: 1612608 keys, 69391908 bytes  \r\n[default] [JOB 41] Generated table #655028: 462217 keys, 19957191 bytes  \r\n[default] [JOB 41] Compacted 4@0 + 4&lt;a href=\"http://www.jobbole.com/members/yaowei729\"&gt;@1&lt;/a&gt; files to L1 =&gt; 263627170 bytes</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2ca384028403-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2ca384028403-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2ca384028403-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2ca384028403-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2ca384028403-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2ca384028403-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2ca384028403-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2ca384028403-8\">8</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965ec922e2ca384028403-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dedupe</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOG</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"JOB 41\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2ca384028403-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Compacting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/yaowei729\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.00</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2ca384028403-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655024: 1550991 keys, 69310820 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2ca384028403-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655025: 1556181 keys, 69315779 bytes  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2ca384028403-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655026: 797409 keys, 35651472 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2ca384028403-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655027: 1612608 keys, 69391908 bytes  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2ca384028403-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655028: 462217 keys, 19957191 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2ca384028403-8\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Compacted</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/yaowei729\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">263627170</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>压缩完成后，新合并的SSTables将成为最终的数据库记录集，旧的SSTables将被取消链接。</p>\n<p>如果我们登录到生产实例，我们可以看到正在更新的预写日志以及正在写入、读取和合并的单个SSTable。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9384/58c26daf-e386-397d-a70d-e0b929f02bb5.jpg\" width=\"650\" height=\"425\"></div>\n<div style=\"text-align: center\">日志和最近占用I/O的SSTable</div>\n<div style=\"text-align: center\"></div>\n<p>下面生产的SSTable统计数据中，可以看到一共有四个“级别”的文件，并且一个级别比一个级别的文件大。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9386/be0b7a4d-2501-3a32-8767-29ebfffb90ae.png\" width=\"650\" height=\"243\"></div>\n<p>RocksDB保存了索引和存储在SSTable的特定SSTables的<a href=\"https://en.wikipedia.org/wiki/Bloom_filter\" target=\"_blank\">布隆过滤器</a>，并将这些加载到内存中。通过查询这些过滤器和索引可以找到特定的key，然后将完整的SSTable作为LRU基础的一部分加载到内存中。</p>\n<p>在绝大多数情况下，我们就可以看到新的消息了，这使得我们的去重系统成为教科书中的布隆过滤器案例。</p>\n<p>布隆过滤器会告诉我们某个键“可能在集合中”，或者“绝对在集合中”。要做到这一点，布隆过滤器保存了已经见过的任何元素的多种哈希函数的设置位。如果设置了散列函数的所有位，则过滤器将返回消息“可能在集合中”。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9388/865a6b99-4181-3dc8-8400-5c9afab2d7b5.png\" width=\"650\" height=\"225\"></div>\n<p> </p>\n<p>我们的集合包含{x，y，z}，在布隆过滤器中查询w，则布隆过滤器会返回“不在集合中”，因为其中有一位没有设置。</p>\n<p>如果返回“可能在集合中”，则RocksDB可以从SSTables中查询到原始数据，以确定该项是否在该集合中实际存在。但在大多数情况下，我们不需查询任何SSTables，因为过滤器将返回“绝对不在集合”的响应。</p>\n<p>在我们查询RocksDB时，我们会为所有要查询的相关的messageId发出一个MultiGet。基于性能考虑，我们会批量地发布出去，以避免太多的并发锁定操作。它还允许我们批量处理来自Kafka的数据，这是为了实现顺序写入，而不是随机写入。</p>\n<p>以上回答了为什么读/写工作负载性能这么好的问题，但仍然存在如何老化数据这个问题。</p>\n<p><strong>删除：按大小来限制，而不是按时间来限制</strong></p>\n<p>在我们的去重过程中，我们必须要确定是否要将我们的系统限制在严格的“去重窗口”内，或者是通过磁盘上的总数据库大小来限制。</p>\n<p>为了避免系统突然崩溃导致去重系统接收到所有客户端的消息，我们决定按照大小来限制接收到消息数量，而不是按照设定的时间窗口来限制。这允许我们为每个RocksDB实例设置最大的大小，以能够处理突然的负载增加。但是其副作用是可能会将去重窗口降低到24小时以下。</p>\n<p>我们会定期在RocksDB中老化旧的key，使其不会增长到无限大小。为此，我们根据序列号保留key的第二个索引，以便我们可以先删除最早接收到的key。</p>\n<p>我们使用每个插入的key的序列号来删除对象，而不是使用RocksDB TTL（这需要在打开数据库的时候设置一个固定的TTL值）来删除。</p>\n<p>因为序列号是第二索引，所以我们可以快速地查询，并将其标记为已删除。下面是根据序列号进行删除的示例代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965ec922e2d1107427287\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunc (d *DB) delete(n int) error {  \r\n        // open a connection to RocksDB  \r\n        ro := rocksdb.NewDefaultReadOptions()  \r\n        defer ro.Destroy()  \r\n  \r\n        // find our offset to seek through for writing deletes  \r\n        hint, err := d.GetBytes(ro, []byte(\"seek_hint\"))  \r\n        if err != nil {  \r\n                return err  \r\n        }  \r\n  \r\n        it := d.NewIteratorCF(ro, d.seq)  \r\n        defer it.Close()  \r\n  \r\n        // seek to the first key, this is a small  \r\n        // optimization to ensure we don\'t use `.SeekToFirst()`  \r\n        // since it has to skip through a lot of tombstones.  \r\n        if len(hint) &gt; 0 {  \r\n                it.Seek(hint)  \r\n        } else {  \r\n                it.SeekToFirst()  \r\n        }  \r\n  \r\n        seqs := make([][]byte, 0, n)  \r\n        keys := make([][]byte, 0, n)  \r\n  \r\n        // look through our sequence numbers, counting up  \r\n        // append any data keys that we find to our set to be  \r\n        // deleted  \r\n        for it.Valid() &amp;&amp; len(seqs) &lt; n {  \r\n                k, v := it.Key(), it.Value()  \r\n                key := make([]byte, len(k.Data()))  \r\n                val := make([]byte, len(v.Data()))  \r\n  \r\n                copy(key, k.Data())  \r\n                copy(val, v.Data())  \r\n                seqs = append(seqs, key)  \r\n                keys = append(keys, val)  \r\n  \r\n                it.Next()  \r\n                k.Free()  \r\n                v.Free()  \r\n        }  \r\n  \r\n        wb := rocksdb.NewWriteBatch()  \r\n        wo := rocksdb.NewDefaultWriteOptions()  \r\n        defer wb.Destroy()  \r\n        defer wo.Destroy()  \r\n  \r\n        // preserve next sequence to be deleted.  \r\n        // this is an optimization so we can use `.Seek()`  \r\n        // instead of letting `.SeekToFirst()` skip through lots of tombstones.  \r\n        if len(seqs) &gt; 0 {  \r\n                hint, err := strconv.ParseUint(string(seqs[len(seqs)-1]), 10, 64)  \r\n                if err != nil {  \r\n                        return err  \r\n                }  \r\n  \r\n                buf := []byte(strconv.FormatUint(hint+1, 10))  \r\n                wb.Put([]byte(\"seek_hint\"), buf)  \r\n        }  \r\n  \r\n        // we not only purge the keys, but the sequence numbers as well  \r\n        for i := range seqs {  \r\n                wb.DeleteCF(d.seq, seqs[i])  \r\n                wb.Delete(keys[i])  \r\n        }  \r\n  \r\n        // finally, we persist the deletions to our database  \r\n        err = d.Write(wo, wb)  \r\n        if err != nil {  \r\n                return err  \r\n        }  \r\n  \r\n        return it.Err()  \r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5965ec922e2d1107427287-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965ec922e2d1107427287-76\">76</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-1\"><span class=\"crayon-e\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">d *</span><span class=\"crayon-v\">DB</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// open a connection to RocksDB  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ro</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewDefaultReadOptions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-5\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// find our offset to seek through for writing deletes  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GetBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"seek_hint\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-11\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewIteratorCF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-14\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// seek to the first key, this is a small  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// optimization to ensure we don\'t use `.SeekToFirst()`  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// since it has to skip through a lot of tombstones.  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-21\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SeekToFirst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-23\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-26\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// look through our sequence numbers, counting up  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// append any data keys that we find to our set to be  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// deleted  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-34\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-39\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-42\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-44\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWriteBatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewDefaultWriteOptions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">wo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-49\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// preserve next sequence to be deleted.  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// this is an optimization so we can use `.Seek()`  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// instead of letting `.SeekToFirst()` skip through lots of tombstones.  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-54\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-56\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-57\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-58\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-59\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormatUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-60\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"seek_hint\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-62\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// we not only purge the keys, but the sequence numbers as well  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DeleteCF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-66\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-68\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// finally, we persist the deletions to our database  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-72\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-74\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5965ec922e2d1107427287-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965ec922e2d1107427287-76\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0122 seconds] -->\r\n<p>为了保证写入速度，RocksDB不会立即返回并删除一个键（记住，这些SSTable是不可变的！）。相反，RocksDB将添加一个“墓碑”，等到压缩时再进行删除。因此，我们可以通过顺序写入来快速地老化，避免因为删除旧项而破坏内存数据。</p>\n<p><strong>确保正确性</strong></p>\n<p>我们已经讨论了如何确保数十亿条消息投递的速度、规模和低成本的搜索。最后一个部分将讲述各种故障情况下我们如何确保数据的正确性。</p>\n<p><strong>EBS快照和附件</strong></p>\n<p>为了确保RocksDB实例不会因为错误的代码推送或潜在的EBS停机而损坏，我们会定期保存每个硬盘驱动器的快照。虽然EBS已经在底层进行了复制，但是这一步可以防止数据库受到某些底层机制的破坏。</p>\n<p>如果我们想要启用一个新实例，则可以先暂停消费者，将相关联的EBS驱动器分开，然后重新附加到新的实例上去。只要我们保证分区ID相同，重新分配磁盘是一个轻松的过程，而且也能保证数据的正确性。</p>\n<p>如果worker发生崩溃，我们依靠RocksDB内置的预写日志来确保不会丢失消息。消息不会从输入主题提交，除非RocksDB已经将消息持久化在日志中。</p>\n<p><strong>读取输出主题</strong></p>\n<p>你可能会注意到，本文直到这里都没有提到“原子”步骤，以使我们能够确保只投递一次消息。我们的worker有可能在任何时候崩溃，不如：写入RocksDB时、发布到输出主题时，或确认输入消息时。</p>\n<p>我们需要一个原子的“提交”点，并覆盖所有这些独立系统的事务。对于输入的数据，需要某个“事实来源”：输出主题。</p>\n<p>如果去重worker因为某些原因发生崩溃，或者遇到Kafka的某个错误，则系统在重新启动时，会首先查阅这个“事实来源”，输出主题，来判断事件是否已经发布出去。</p>\n<p>如果在输出主题中找到消息，而不是RocksDB（反之亦然），则去重worker将进行必要的修复工作以保持数据库和RocksDB之间的同步。实际上，我们使用输出主题作为我们的预写入日志和最终的事实来源，让RocksDB进行检查和校验。</p>\n<p><strong>在生产环境中</strong></p>\n<p>我们的去重系统已经在生产运行了3个月，对其运行的结果我们感到非常满意。我们有以下这些数据：</p>\n<ul>\n<li>在RocksDB中，有1.5TB的key存储在磁盘上</li>\n<li>在老化旧的key之前，有一个四个星期的去重窗口</li>\n<li>RocksDB实例中存储了大约600亿个key</li>\n<li>通过去重系统的消息达到2000亿条</li>\n</ul>\n<p>该系统快速、高效、容错性强，也非常容易理解。</p>\n<p>特别是我们的v2版本系统相比旧的去重系统有很多优点。</p>\n<p>以前我们将所有的key存储在Memcached中，并使用Memcached的原子CAS（check-and-set）操作来设置key。 Memcached起到了提交点和“原子”地发布key的作用。</p>\n<p>虽然这个功能很好，但它需要有大量的内存来支撑所有的key。此外，我们必须能够接受偶尔的Memcached故障，或者将用于高速内存故障切换的支出加倍。</p>\n<p>Kafka/RocksDB的组合相比旧系统有如下几个优势：</p>\n<p><strong>数据存储在磁盘上</strong>：在内存中保存所有的key或完整的索引，其代价是非常昂贵的。通过将更多的数据转移到磁盘，并利用多种不同级别的文件和索引，能够大幅削减成本。对于故障切换，我们能够使用冷备（EBS），而不用运行其他的热备实例。</p>\n<p><strong>分区</strong>：为了缩小key的搜索范围，避免在内存中加载太多的索引，我们需要保证某个消息能够路由到正确的worker。在Kafka中对上游进行分区可以对这些消息进行路由，从而更有效地缓存和查询。</p>\n<p><strong>显式地进行老化处理</strong>：在使用Memcached的时候，我们在每个key上设置一个TTL来标记是否超时，然后依靠Memcached进程来对超时的key进行处理。这使得我们在面对大量数据时，可能会耗尽内存，并且在丢弃大量超时消息时，Memcached的CPU使用率会飙升。而通过让客户端来处理key的删除，使得我们可以通过缩短去重窗口来优雅地处理。</p>\n<p><strong>将Kafka作为事实来源</strong>：为了真正地避免对多个提交点进行消息去重，我们必须使用所有下游消费者都常见的事实来源。使用Kafka作为“事实来源”是最合适的。在大多数失败的情况下（除了Kafka失败之外），消息要么会被写入Kafka，要么不会。使用Kafka可以确保按顺序投递消息，并在多台计算机之间进行磁盘复制，而不需要在内存中保留大量的数据。</p>\n<p><strong>批量读写</strong>：通过Kafka和RocksDB的批量I/O调用，我们可以通过利用顺序读写来获得更好的性能。与之前在Memcached中使用的随机访问不同，我们能够依靠磁盘的性能来达到更高的吞吐量，并只在内存中保留索引。</p>\n<p>总的来说，我们对自己构建的去重系统非常满意。使用Kafka和RocksDB作为流媒体应用的原语开始变得越来越普遍。我们很高兴能继续在这些原语之上构建新的分布式应用程序。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111809\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111809votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111809\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('Linus Torvalds 说 Linux 仍然惊讶和激励着他', '2017-07-12', 'http://blog.jobbole.com/111571/', '2e6de1dd2090382bf77a14e74b18bde3', 'http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png', 'full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg', '0', '1', '1', 'IT技术,Linus Torvalds', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/blog/event/lc3-china/20176/6/linus-torvalds-explains-how-linux-still-surprises-and-motivates-him\">Linux 基金会</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8638-1.html\">Linux中国</a>   </div><p>周一，Linus Torvalds 首次来到中国参加<a class=\"ext\" href=\"https://www.lfasiallc.com/linuxcon-containercon-cloudopen-china\" target=\"_blank\" rel=\"external nofollow\">在北京召开的 LinuxCon + ContainerCon + CloudOpen</a>。在近 2000 名观众面前，Linus Torvalds 和 VMware 开源负责人 Dirk Hohndel 进行了进行了一次“炉边聊天”，谈及是什么在惊讶和激励着他，以及有志的开源开发者们该如何上手。下面是他们谈话中的一些亮点。</p>\n<h3 id=\"toc_1\">Linux 开发中有什么令人惊讶的事情?</h3>\n<blockquote><p>“我觉得有趣的是我认为已经稳定的代码仍然在不断的得到改进，有些东西我们已经很多年没有碰了，然后有人来改进了它们，或者在我以为根本就不会有人用的东西上提交了 Bug 报告。我们有了新的硬件，开发了新的功能，但是 25 年后，我们仍然有老的、非常基础的东西，并且人们依然在关心和改善着它们。”</p></blockquote>\n<h3 id=\"toc_2\">什么在激励着他</h3>\n<blockquote><p>“我真的很喜欢我正在做的事情。我喜欢醒来时有一个在技术上有趣而富有挑战性并且不太紧张的工作，因此我可以长时间的为此工作；或者做一些我感觉我正在做一个真正有影响的事情，做一些不仅仅是对我来说有意义的事情。</p>\n<p>“我偶尔在工作中休息一下，例如我在 Git 上工作两到三周的时候就开始休息了。但是每次休息的时间比较长我都会感到无聊厌倦。当我出去潜水一周，就想着要回来，我从没有感觉我需要一个更长的假期。”</p></blockquote>\n<p>（LCTT 译注：此处“在 Git 上工作” 是指 Linus 在 Git 版本仓库里面开发 Linux 内核，而非开发 Git 软件——事实上，Linus 在早期开发完 Git 的原型之后，主要的 Git 开发已经有别人接手了，虽然他被称之为 Git 之父。而“潜水”是真的指潜水运动，Linus 喜好玩潜水运动。）</p>\n<h3 id=\"toc_3\">Linux 的未来领导力</h3>\n<blockquote><p>“我们的工作进程不会只是 25 年，我们仍然有非常强大的维护团队。我们常常抱怨我们没有足够的维护者 – 这是真的，我们只有数十名顶级维护者做日常合并的工作，这对于一个开源项目来说是一个非常强大的团队。而且随着这些顶级维护者慢慢变老变胖，我们不断有新人进来。一个新人成长为一个顶级维护者需要几年的时间，因此我不觉得我们应该为 Linux 的下一个 20 年担心。”</p></blockquote>\n<h3 id=\"toc_4\">Linux 会被替代吗？</h3>\n<blockquote><p>“或许会有一些新的项目将来会并且表明他们比我们做的更好，但是我不担心这个。有很多非常成功的 Linux 的分支（fork），人们不会把它们看作是分支是因为他们很和谐。如果有人想要改变一切并且让内核变得更好，我的感觉是，干吧，证明你自己。我可能觉得那是一个坏主意，但是你可以证明我是错的。”</p></blockquote>\n<p>（LCTT 译注：此处所说的分支，应该是指类似 Android、AGL 等 Linux 分支并没有分裂 Linux 生态，而是彼此补充。）</p>\n<h3 id=\"toc_5\">对 Git 的想法</h3>\n<blockquote><p>“我对 Git 的广泛传播感到非常的惊讶。显然我非常高兴，它验证了我对分布式开发的看法。然而那时，已经有如此之多的源码版本控制工具，很难再去推出一个新的版本控制系统。我预计它主要限于内核开发 – 因为它是针对我们所做的。”</p>\n<p>“在刚开始的三到四年里，关于 Git 的抱怨是它如此的与众不同，难以使用。大约五年前，事情发生了改变。有足够多的项目和开发者开始使用 Git ，它变得不再与众不同；人们习惯于使用 Git 。他们开始利用这种开发模式，使用 Git 的安全感，意味着任何东西都不会损坏或者丢失。”</p>\n<p>“在某些方面，Git 比 Linux 更为人所知。Linux 常常被隐藏起来，例如安卓手机就运行在 Linux 之上，但是你并不知道。但是使用 Git 时，你确切地知道你在使用 Git 。”</p></blockquote>\n<h3 id=\"toc_6\">分支 Linux</h3>\n<blockquote><p>“当我坐下来开始写 Git ，一个首要的原则就是你应该能 fork 并且在此基础上做你自己的事情。如果你有友好的 fork（能证明我错了，并且能够改进内核），在这种情况下，人们可以回来说我们实际上改进了内核，这没有什么不好的感觉。我会采纳你的改进并且将其合并进来。这就是为什么你应该鼓励 fork 。你也想让良好的回馈变得很简单。”</p></blockquote>\n<h3 id=\"toc_7\">开源开发者应该如何开始</h3>\n<blockquote><p>“于我而言，我总是自我激励，知道自己想要做什么，我从来没有被告知要去做什么。我不确定我的例子是否适合人们效仿。如果你是一个新手程序员，你可以从成千上万的开源项目中找到你所感兴趣的，你可以长期关注这个项目，去了解它的代码，以至于你可以在某个部分的代码上可以成为专家，不需要是整个项目。没有人是整个内核的专家，但是你可以很好地了解其中的一个领域。”</p>\n<p>“如果你能成为社区的一份子，能提交补丁，那将不仅仅是编程，而是有开源社会方面的意义。你作为一个程序员提升了你自己并且和外界联系了起来。你基本上可以向外展示 – 我做了这些改进，我有能力在我的社区或者工作上走得更远。你不得不花费一定的时间来学习一个项目，但是你将有一个巨大的上升空间 – 不仅仅是从职业方面，而且在你的生活中有一个惊人的项目。”</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111571\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111571votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111571\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('LevelDB 实现分析', '2017-07-12', 'http://blog.jobbole.com/111792/', '345014f87e74ee252ce7be279d54c7b4', 'https://gw.alicdn.com/tfs/TB1R1S4SXXXXXaRXpXXXXXXXXXX-900-500.jpg', 'full/80cecbf79a5f06eb7460152bae80cab5d6f499f7.jpg', '0', '1', '1', 'IT技术,LevelDB,数据库', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://taobaofed.org/blog/2017/07/04/leveldb-analysis/\">胡帅</a>   </div><p><img class=\"aligncenter\" src=\"https://gw.alicdn.com/tfs/TB1R1S4SXXXXXaRXpXXXXXXXXXX-900-500.jpg\" alt=\"LevelDB 实现分析\"></p>\n<h3 id=\"LevelDB-介绍\">LevelDB 介绍</h3>\n<p>LevelDB 是由 Google 开发的 key-value 非关系型数据库存储系统，是基于 LSM(Log-Structured-Merge Tree) 的典型实现，LSM 的原理是：当读写数据库时，首先纪录读写操作到 Op log 文件中，然后再操作内存数据库，当达到 checkpoint 时，则写入磁盘，同时删除相应的 Op log 文件，后续重新生成新的内存文件和 Op log 文件。</p>\n<p>LevelDB 内部采用了内存缓存机制，也就是在写数据库时，首先会存储在内存中，内存的存储结构采用了 skip list 结构，待达到 checkpoint 时，才进行落盘操作，保证了数据库的高效运转。</p>\n<h3 id=\"LevelDB-总体架构\">LevelDB 总体架构</h3>\n<p><img class=\"aligncenter\" src=\"https://gw.alicdn.com/tfs/TB1AMqNSXXXXXczXFXXXXXXXXXX-851-479.png\" alt=\"resources structure\"></p>\n<p>如上图所示，整个 LevelDB 由以下几部分组成：</p>\n<ol>\n<li>Write(k,v)，对外的接口</li>\n<li>Op log，操作日志记录文件</li>\n<li>memtable，数据库存储的内存结构</li>\n<li>Immutable memtable，待落盘的数据库内存数据</li>\n<li>sstable，落盘后的磁盘存储结构</li>\n<li>manifest，LevelDB 元信息清单，包括数据库的配置信息和中间使用的文件列表</li>\n<li>current，当前正在使用的文件清单</li>\n</ol>\n<p>整体结构清晰紧凑，非常容易理解。</p>\n<h3 id=\"对外接口\">对外接口</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9cf898795681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDB() { };\r\nvirtual ~DB();\r\nstatic Status Open(const Options&amp; options,\r\n                   const std::string&amp; name,\r\n                   DB** dbptr);\r\nvirtual Status Put(const WriteOptions&amp; options,\r\n                   const Slice&amp; key,\r\n                   const Slice&amp; value) = 0;\r\nvirtual Status Delete(const WriteOptions&amp; options, const Slice&amp; key) = 0;\r\nvirtual Status Write(const WriteOptions&amp; options, WriteBatch* updates) = 0;\r\nvirtual Status Get(const ReadOptions&amp; options,\r\n                   const Slice&amp; key, std::string* value) = 0;\r\nvirtual Iterator* NewIterator(const ReadOptions&amp; options) = 0;\r\nvirtual const Snapshot* GetSnapshot() = 0;\r\nvirtual void ReleaseSnapshot(const Snapshot* snapshot) = 0;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9cf898795681-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9cf898795681-15\">15</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-1\"><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-2\"><span class=\"crayon-v\">virtual</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-3\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Options</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-4\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-5\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e \">DB*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-6\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-7\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-8\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-9\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-10\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">WriteBatch*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">updates</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-11\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-12\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-13\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e \">Iterator*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewIterator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9cf898795681-14\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9cf898795681-15\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ReleaseSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snapshot</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>整体接口分为：</p>\n<p>数据库创建和删除</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9da879680210\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDB() { };\r\nvirtual ~DB();</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9da879680210-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9da879680210-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9da879680210-1\"><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9da879680210-2\"><span class=\"crayon-v\">virtual</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>数据库打开</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9de696899970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic Status Open(const Options&amp; options,\r\n                   const std::string&amp; name,\r\n                   DB** dbptr);</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9de696899970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9de696899970-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9de696899970-3\">3</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9de696899970-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Options</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9de696899970-2\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9de696899970-3\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e \">DB*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>数据库读写删除操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9e4187258771\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual Status Put(const WriteOptions&amp; options,\r\n                   const Slice&amp; key,\r\n                   const Slice&amp; value) = 0;\r\nvirtual Status Delete(const WriteOptions&amp; options, const Slice&amp; key) = 0;\r\nvirtual Status Get(const ReadOptions&amp; options,\r\n                   const Slice&amp; key, std::string* value) = 0;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9e4187258771-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9e4187258771-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9e4187258771-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9e4187258771-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661d369b9e4187258771-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9e4187258771-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9e4187258771-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9e4187258771-2\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9e4187258771-3\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9e4187258771-4\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59661d369b9e4187258771-5\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9e4187258771-6\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>数据库批处理操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9e8119013197\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual Status Write(const WriteOptions&amp; options, WriteBatch* updates) = 0;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9e8119013197-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9e8119013197-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">WriteBatch*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">updates</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>数据库遍历操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9eb420647396\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual Iterator* NewIterator(const ReadOptions&amp; options) = 0;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9eb420647396-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9eb420647396-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e \">Iterator*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewIterator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>获取快照操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59661d369b9ef177449295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual const Snapshot* GetSnapshot() = 0;\r\nvirtual void ReleaseSnapshot(const Snapshot* snapshot) = 0;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661d369b9ef177449295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661d369b9ef177449295-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661d369b9ef177449295-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661d369b9ef177449295-2\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ReleaseSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snapshot</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h4 id=\"Op-log结构分析\">Op log结构分析</h4>\n<p>LevelDB 使用的 Op log 日志采用了文件记录的方式，且文件使用了 mmap 方式操作，以提高效率。</p>\n<p>Op log 存储切分为 32KB 大小的数据块，每个 32KB 数据块存储着 Op log，每 个Op log 格式如下：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1IRGFSXXXXXbsXVXXXXXXXXXX-405-79.png\" alt=\"resources structure\"></p>\n<p>其中：</p>\n<ol>\n<li>CRC32 为 crc 校验码，保证数据的完整性</li>\n<li>Length，为 Op log 的数据长度</li>\n<li>Log Type，Op log 的类型，之所以会有类型，是由于 32KB 可能存不下一条 Op log，Op log 有可能跨数据块，类型分为：\n<ul>\n<li>FULL：代表 Data 包含了所有的数据</li>\n<li>FIRST：代表该 Data 是 Op log 的开始数据</li>\n<li>MIDDLE：代表该 Data 是 Op log 的中间数据</li>\n<li>LAST: 代表该 Data 是 Op log 的结束数据</li>\n</ul>\n</li>\n<li>Data，为 Op log 的实际数据</li>\n</ol>\n<h4 id=\"memtable-结构分析\">memtable 结构分析</h4>\n<p>memtable 是 LevelDB 数据库的内存存储结构，采用了 skip list 结构存储，如下图所示：</p>\n<blockquote><p>skip list 是一种可以代替平衡树的存储结构，它采用概率的方式来保证平衡，而平衡树则是采用严格的旋转树结构来保证平衡，复杂度会高一些。<br>\n对于 skip list，会有 n 层链表，其中 0 层保存所有的值，越往上层，保存的值越少。每当插入一个值时，会通过概率计算该值需要插入的最高层级 k，然后从 0~k-1 层，分别插入该值。</p></blockquote>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1aoiISXXXXXX4XVXXXXXXXXXX-941-359.png\" alt=\"resources structure\"></p>\n<p>其中每个表项的存储结构如下：</p>\n<p>key_size | key_value | sequence_num&amp;type | value_size | value</p>\n<p>其中：</p>\n<p>sequence_num：表示操作的序列号，每一个数据项都会带有一个序列号，用以表示数据的新旧程度。</p>\n<p>type：表示数据的类型，分为：</p>\n<ul>\n<li>kTypeValue：表明数据有效</li>\n<li>kTypeDeletion：表明数据已经失效，在数据进行 delete 操作时会打上该标识</li>\n</ul>\n<h4 id=\"sstable-结构分析\">sstable 结构分析</h4>\n<p>sstable 作为落盘的存储结构，每个 sstable 最大 2MB，从宏观来看，它属于分层的结构，即：</p>\n<ul>\n<li>level 0：最多存储 4 个 sstable</li>\n<li>level 1：存储不超过 10MB 大小的 sstable</li>\n<li>level 2：存储不超过 100MB 大小的 sstable</li>\n</ul>\n<p>level 3 及之后：存储大小不超过上一级大小的 10 倍</p>\n<p>之所以这样分层，是为了提高查找效率，也是 LevelDB 名称的由来。当每一层超过限制时，会进行 compaction 操作，合并到上一层，递归进行。</p>\n<p>从微观的角度看，每个 sstable 文件结构入下图所示：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1n.yuSXXXXXacaXXXXXXXXXXX-345-228.png\" alt=\"resources structure\"></p>\n<p>其中：</p>\n<ul>\n<li>Data Block 存储具体的 k-v 数据</li>\n<li>Meta Block 存储索引过滤信息，用于快速定位 key 是否存在于 Data Block 中</li>\n<li>Meta Index Block 存储 Meta Block 的偏移位置及大小</li>\n<li>Index Block 存储 Data Block 的偏移位置及大小</li>\n<li>Footer 则存储 Meta Index Block 和 Index Block 的偏移位置及大小，相当于二级索引，Footer 的结构如下：<br>\n<img src=\"https://gw.alicdn.com/tfs/TB1C9DXSXXXXXcyXXXXXXXXXXXX-197-140.png\" alt=\"resources structure\"></li>\n</ul>\n<p>另外 Data Block 及 Meta Block 的存储格式是统一的，都是如下格式：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1X9qPSXXXXXbwXFXXXXXXXXXX-435-67.png\" alt=\"resources structure\"></p>\n<p>其中 type 表示是否是压缩存储，目前 LevelDB 支持 key 值的 snappy 压缩或者不压缩。</p>\n<p>而上图中的 Block data 的格式则为：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB11UGqSXXXXXaEaXXXXXXXXXXX-819-359.png\" alt=\"resources structure\"></p>\n<p>上图有几点要说明：</p>\n<ol>\n<li>对于 Block data 中的第一项总是不压缩存储的，不压缩存储的项称为 restarts，会被记录在上图的最尾部，同时每隔 k 个值（k 值可定制），都会存储一个不压缩的项，这些都称为 restarts，都会被记录在最尾部。</li>\n<li>每个 restarts 表项会作为索引项存储。</li>\n<li>除了 restarts 表项以外，其它的表项则基于该 restarts 项，计算跟他相同部分和不同部分，上图中的 shared_bytes 和 unshared_bytes 记录了相同部分长度和不同部分的长度，key_delta 则记录了不同的部分的值，value_length 和 value 则记录了 value 部分的值。</li>\n<li>压不压缩是可选的，默认会进行 snappy 压缩。</li>\n</ol>\n<p>对于 Meta Block 来说，它保存了用于快速定位 key 是否在 Data Block 中的信息，具体方法是：</p>\n<ol>\n<li>采用了 bloom filter 的过滤机制，bloom filter 是一种 hash 机制，它对每一个 key，会计算 k 个 hash 值，然后在 k 个 bit 位记录为 1。当查找时，相应计算出 k 个 hash 值，然后比对 k 个 bit 位是否为 1，只要有一个不为 1，则不存在。</li>\n<li>对于每一个 Data Block，所有的 key 值会传入进行 bloom filter 的 hash 计算，每个 key 存储 k 个 bit 位值。</li>\n</ol>\n<h4 id=\"版本管理\">版本管理</h4>\n<p>对于 LevelDB 来说，它采用了简单的 sequence num 机制来管理，具体为：</p>\n<ol>\n<li>对于 Op log 文件，每一个 Op log 文件名中会包含一个唯一的 sequence num，每创建一个新的 Op log 文件，sequence num 则加 1，sequence num 越大，则表示文件越新，同时最新的 sequence num 会记录下来。</li>\n<li>对于每个 key-value 对，也会对应一个 sequence num，对于同一个 key，如果后续更新值时，sequence num 也会相应更新，这样就可以根据 sequence num 的大小，找到最新的 key-value 对</li>\n</ol>\n<h4 id=\"新增特性\">新增特性</h4>\n<ol>\n<li>支持模糊查询该功能支持 key 以模糊规则匹配的方式进行数据库查询，支持＊和？两种模糊规则查询。</li>\n<li>支持 JSON 格式数据存储该功能支持 k-v 中，v以json格式传入，后续可以通过关键字，查询json里面的数据。</li>\n</ol>\n<h4 id=\"结束语\">结束语</h4>\n<p>LevelDB 短小精悍，代码运行效率高效，且通俗易懂，是一个非常不错的 k-v 存储系统。</p>\n<p>注：图片来源于网络</p>\n<blockquote><p>题图：<a href=\"https://unsplash.com/photos/9wwF-VmSOrY\" target=\"_blank\" rel=\"external\">https://unsplash.com/photos/9wwF-VmSOrY</a> By @eberhard grossgasteiger</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111792\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111792votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111792\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('为何不用担心大公司偷你的绝世创业点子', '2017-07-12', 'http://blog.jobbole.com/111721/', '38cc12ee297c4f23c14ac3da6f7a65ce', 'http://wx1.sinaimg.cn/mw690/63918611gy1fhc6vu9yuej20oq0e4772.jpg', 'full/80ab850be768ae7a65c51623fb321921ff892d2c.jpg', '0', '1', '1', '创业,创业', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/TJQ\">佟大冬</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://timhampson.quora.com/Startups-Why-Google-Facebook-Apple-SalesForce-probably-wont-steal-your-lunch-money\">Tim Hampson</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：并非所有人都认为你的创业idea是值得做的。且大公司并非拥有无限人力财力，再加上内部各山头的政治斗争，中层干部只求升职加薪安安稳稳，底层年轻员工空有理想但说话没分量。</p>\n<p style=\"text-align: center\"><strong>为何不用担心 GG/FB/苹果等大公司偷你的绝世创业点子<img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fhc6vu9yuej20oq0e4772.jpg\" width=\"690\" height=\"394\"></strong></p>\n<p>创业公司经常被问到这样一个问题——为什么大公司不实现你的创业 idea，从而把你踢除这个市场？</p>\n<p>因为相比于典型创业公司的资源，大公司拥有数十亿美元的资金和成千上万个工程师，所以这个问题听起来似乎非常合理。</p>\n<p>其实比起创业公司，大公司的优势实际比你想象的要少。为什么？这个问题的原因值得列出来。</p>\n<h3>1.创新是件全凭运气的事儿</h3>\n<p>只有当你的点子（idea）开始盈利了，别人才会发现你的 idea 到底有多好，在此之前没人真的了解。然而到那个时候，你也将顺利地成为下一代执牛耳者。风投不会投资公司，他们投资市场和人（尤其是 CEO）。因为他们明白，在一个热门市场，他们尝试投资一位出类拔萃的人，他有望成为市场领导者，而且很有可能（50% ~ 80% 的可能性）带来回报，这些回报足以让有限的合伙人安心。如果这个市场足够热门，即使失败了，你也不会失去一切。失败被遗忘，历史被重写，只有其中 1-2 个带来回报的大项目被人们记住，以强调投资人有远见。而 20-30 个失败投资就这样被遗忘了（在大多数人看来，这些失败投资中，有些可能还是很成功的）。</p>\n<p>创业是一项投资组合业务，而且在这项业务中，大部分风投公司的投资规模在 1~5 亿美元之间。你不能在 2004 年左右，只是简单地将 1000 万美元投资给 Facebook，虽然这也不那么容易。你应该采取广泛的组合投资，而这需要大量的资金。因此，即使市场领导人试着实施他们自己的创新项目时也犹豫不决。</p>\n<p>这种投资组合模式也需要优胜劣汰机制，这一点风投们可以轻松做到，因为他们所要做的只是在资金用完时停止续投。对一个大公司而言，要解散一个表现不佳的研发团队无论从心理上还是实际行动上都困难得多。Google 因为终止项目非常果决，所以经常被做为反例。但实际上 Google 在 Google+ 上展示了它比任何风投都多的耐心。大公司对待新项目就像哺乳动物对待自己的孩子，风投则像鱼，虽然冷血（无双关），但它更有效。</p>\n<p>大公司无意和一个 500 万美元的创业公司竞争，他们竞争的是一个数十亿美元的生态系统，这就是为什么创业公司总能克敌制胜。大公司不能像风投那样对项目进行组合投资。</p>\n<h3>2. 每个人都不愿亏损</h3>\n<p>没人想影响正常稳定的收入。创业公司没有什么收入，所以他们不用担心收入受影响。从稳定的、可预测的（即使是下降的）收入形势中走出来不容易。相比之下，一款最新的小工具能不能在市场投放，大公司不关心，他们更倾向于投资升级成熟的主线产品……</p>\n<p> </p>\n<h3>3. 大公司是受过程约束的</h3>\n<p>每个人都可以说不，没有人可以拍板。或者往好了说，整个公司都需要“买进”，“整个”可以是公司遍布全球的各个部门。中层管理者更关注于管理自己的养老金，这是他们固有的惰性。上层管理者往往对现实市场鞭长莫及，不能辨别后起之秀。而对于公司底层人员，别人说什么他们就做什么，要不然就离开公司自己去创业……</p>\n<h3>4. 大公司需要大项目</h3>\n<p>所有的大公司基本都成为了集团。如果你已经是市场的引领者了，那么唯一的发展方向就是进入另一个市场。如果你想每季度收入几十亿美元，那么只有大项目能够做到。当然，创业公司 100 % 的增长看起来很漂亮，而额外的 100 万美元收入，大公司收入四舍五入带来的错误就有这么多。</p>\n<p>大公司注重创新之处都是大量资本密集投注的地方（比如 Google 街景），这是创业公司难以匹敌的事情。</p>\n<p>这还会影响大公司的发展战略。从 90 年代初期开始，Oracle 公司就不再满足于做一家数据库公司，现在已转型为 IT 供应商，为企业提供全套服务，包括硬件、软件和服务。SalesForce 是 CRM 市场的占尽先机者，所以人们经常还会以为 SalesForce 仍然是一家 CRM 公司。事实上，SalesForce 如今已发展为一个 PaaS 公司，希望通过大数据等来扩展其业务。在云服务方面，SalesForce 像 Oracle 看齐。SalesForce 85% 的 IT 支出是用于企业客户的，Marc Benioff （SalesForce 创始人）根本不在乎小客户，更别说想赶上类似 SalesForce 的 CRM 创业公司。这就像 Oracle 根本不在乎 MongoDB 一样。</p>\n<h3>5. 非本公司原创（即不愿意用别人发明的东西）</h3>\n<p>在 1999 年，Google 主动提出仅以 1 百万美元出售给 Excite，但是被 Excite 嗤之以鼻，因为 Excite 仅靠自己可以很容易实现搜索引擎。有趣的是，虽说他们是正确的，但他们从未找到足够的时间去做。正如他们所说，遗留的是历史。</p>\n<p>作为一个手下数百名开发人员的大公司的产品经理，很难接受这个事实：他们可能已经错过了，几个极客在资源紧缺的条件下，成功完成的某个项目。所以他们通常不会（使用创业公司的 idea）。</p>\n<h3>6. 大公司并不大</h3>\n<p>大公司有很多部门，其中有些可能并不大。“<strong>但他们还是有大量资源</strong>”，没错，但是他们都有事情在做。而对于所需的实际技能，他们并没有。</p>\n<p>90 年代，我离开 IBM（当时已有 30 万名员工），加入了 Sybase（当时有 1500 名员工）。令我惊讶的是，后起之秀 Sybase（只做数据库）专注于数据库开发的员工数量是 IBM 的两倍，那时 IBM 还有除数据库之外的各种业务，甚至包括管理军用直升机的交付项目。之后，当我加入创业公司 Illustra（不到 80 名员工）时，我并不惊讶，而至今我们所拥有的 web 数据库专业知识，比 Informix、Oracle 和 Sybase 加起来都多。最后 Informix 付给了 Illustra 4 亿美元。</p>\n<h3>7. 时间就是金钱</h3>\n<p>究竟为什么 Facebook 不简单地复制 Instagram 的 24 人月的工作量，而是支付令人瞠目的 10 亿美元来收购呢？</p>\n<p>这不是对 13 名员工的人才收购。由于 Instragram 的 3000 万用户也都是 Facebook 的用户（那时有 8.45 亿用户），所以和市场份额也没关系。当然这更不是获得多少收入，因为 Instagram 没有钱，完全没有！</p>\n<p>原因是 Facebook 确信这是图片分享的未来，并且会使自家业务面临风险（因为简单来说，Facebook 实际上是和照片相关的应用）。对于以上列出的所有原因，他们明白至少需要 12 个月才能复制出来，到那时，占尽先机的大公司和初创企业之间的财富可能会有很大的逆转。购买而非构造意味着额外的收入，但是相当于并购公司现有的销售和营销渠道的水平，而不是创业公司的。这可以很容易地证明愚蠢的营收倍数，因为重点不是 Instagram 现在在做什么，而是 Facebook 会错过什么，你说是不是？当 Facebook 在 14 年第三季度几乎投了 30 亿美元时，却只为 Instagram 投了一个月的收入。鉴于现在 Instagram 对于 Facebook 价值主张的重要性，这看起来似乎赚到了。</p>\n<h2>专注于客户，而不是竞争</h2>\n<p>你不能指望一颗橡子就能长成一颗橡树。你首先需要准备一盘完整的幼苗，然后筛选剔除一些，最后专心培育其余的幼苗，期待至少有一颗苗子最后能长成橡树。这实际上正是 VC 模式的整个前提，这也是为什么大公司通常不会压制创业公司的原因，因为他们不知道哪个最终会超过他们，并且也不可能把那么多初创公司都扼杀。</p>\n<p>如同商业中所有的普遍规律一样，也有例外存在。总想着成为市场领导者一向不会有什么好结果，但应该明白以上这些规律。虽然总体规则很明确。几乎没有哪家初创公司会因为试图取代占尽先机者而面临风险，更大的风险是：<strong>你的产品在市场上是否有容身之处</strong>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111721\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111721votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111721\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/TJQ\">佟大冬</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/TJQ\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/5f8b3a74725397a8f5033c9ac0afeefb.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            live and learn.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/TJQ\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/tjq/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/TJQ/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：601591123\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('拯救 Java Code Style 强迫症', '2017-07-12', 'http://blog.jobbole.com/111468/', '3a898adcf998284e1075b145b18db2d5', 'http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-style.jpg', 'full/8df83dd8bc57ae7800dd00484fe81b189041997c.jpg', '0', '2', '1', '开发,java,编程风格', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>这篇文章缘起于上一个持续交付的咨询项目，当时正在指导客户团队的Java工程师做Code Review，发现一个很有意思的现象：有一位工程师对Code Style特别在意，所以在Code Review的大部分时间中都是该工程师在指出哪里哪里的格式不对，但是团队并没有找到改进方法，每次的结论都是“下次我注意一点。”我挺欣赏这位工程师对Code Style的认真态度，所以就萌生了“怎么拯救Code Style强迫症”的想法。</p>\n<h3>要点</h3>\n<ul>\n<li>Code Style不是个人喜好问题，它会影响工作效率，团队应将其当做工程实践予以重视。</li>\n<li>Code Style需要端到端的工具支持，尽早解决问题，避免技术债。</li>\n<li>以Checkstyle作为核心工具支撑Java项目的Code Style实施方案。</li>\n</ul>\n<h3>Code Style是一项工程实践</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-style.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/1-style.jpg\" alt=\"\" width=\"479\" height=\"310\"></a></p>\n<p>我是右侧风格的忠实拥趸，如果让我在工作的项目中看到左侧风格的代码，你猜猜我的反应是什么。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/2-gitblame.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/2-gitblame.jpg\" alt=\"\" width=\"400\" height=\"400\"></a></p>\n<p>嗯，可能我对代码风格确实有些强迫症，但事实上，Code Style并不仅仅是代码是否好看那么简单，如果没有按照惯例来编写代码，甚至会让阅读者产生疑惑。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bf409da502004248\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate Listener listener = new Listener() // So Listener looks like a class?  \r\n{}; // Oops, it is an interface</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bf409da502004248-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409da502004248-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bf409da502004248-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listener </span><span class=\"crayon-v\">listener</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// So Listener looks like a class?  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409da502004248-2\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Oops, it is an interface</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>如果代码可读性还不足以打动你，那么想象一下这个场景，你的同事说他修复了两个空指针问题，请你帮忙Code Review，你查看了这个文件的修订历史，乍看之下有许多改动，看来是个大动作。然而事实上，绝大部分改动是代码格式调整，只有两处改动与需要Review的问题相关。</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/3-happy-code-review.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/3-happy-code-review-1024x365.jpg\" alt=\"\" width=\"700\" height=\"250\"></a></p>\n<p style=\"text-align: center;\">(看来这位同事的IDE使用了不同的自动缩进设置，导致所有行都产生了缩进)</p>\n<p>之所以会产生以上这些影响工作效率的问题，是因为团队没有重视Code Style，没有把它当做一项工程实践，既没有对其达成一致，也没有正确地使用工具帮助实施。</p>\n<h3>那就按照工程实践的标准来实施Code Style</h3>\n<p>本文将重点介绍Java项目中Code Style的工具支持，但在此之前，你的团队需要一起做一些决定：</p>\n<p><strong>使用哪种Code Style？</strong></p>\n<p>每个人可能都有偏好的style，但在团队协作面前，需要一定的妥协。有些公司或组织有着统一的Code Style指导标准，萧规曹随是个不错的选择（但是要确保这类统一指导标准在制定时参考了开发人员的意见，是切实可行的），你的团队也可以自己裁剪，但至少要保证项目（Repository）级别上使用同一种Style。</p>\n<p><strong>如何处理不符合Code Style的提交？</strong></p>\n<p>大家往往懈怠于事后补救的方式，我的建议是不要让不符合约定的代码流入代码库。对于遗留项目，尤其是大型项目，可以选择一部分代码作为实施范围，集中修复Style问题后严格实施，切忌操之过急，最后团队疲惫不堪只得放弃。</p>\n<p>我们都知道人工监督检查的方式是不可持续和不可靠的，来看看有哪些工具可以提供帮助吧。</p>\n<h3>懒惰是第一生产力</h3>\n<p>工程实践不能没有自动化工具支持，在Java生态圈中，Code Style工具最出名的应该是Checkstyle了，它可以通过XML形式的<a href=\"https://martinfowler.com/books/dsl.html\">外部DSL</a>来定义Code Style的检查风格，比如你可以从这里找到<a href=\"https://github.com/checkstyle/checkstyle/blob/master/src/main/resources/google_checks.xml\">Google的Java Checkstyle配置文件</a>。这里我不会详细介绍Checkstyle本身，相反，我会更多地探讨如何工程化地使用Checkstyle，在交付代码的各个活动中，我们都可以用到Checkstyle，进行360°无死角的检查。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/4-lifecycle-overview.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/4-lifecycle-overview-1024x558.jpg\" alt=\"\" width=\"700\" height=\"381\"></a></p>\n<p style=\"text-align: center;\">（和Code Style相关的代码交付生命周期）</p>\n<h3>守住提交的质量关口</h3>\n<p>为了贯彻不让不符合约定的代码流入代码库的决定，可以优先在服务端设置Code Style的检查关卡。</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/5-lifecycle-ci.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/5-lifecycle-ci-1024x584.jpg\" alt=\"\" width=\"700\" height=\"399\"></a></p>\n<p style=\"text-align: center;\">（优先守住代码提交时的服务端检查，可以考虑使用CI服务器来实现）</p>\n<p><strong>从实现层面上说，有两种方式：</strong></p>\n<p>一是在SCM（Source Control Management，例如Git/SVN）服务端设置检查项，如果不达标则拒绝提交，但这种方式相对不容易实现，而且一般SCM服务端也不由开发团队管理，设置起来不灵活也不方便。</p>\n<p>二是利用<a href=\"https://www.thoughtworks.com/continuous-integration\">持续集成</a>服务器，开发团队的每一次提交都会触发一次构建，我们可以在构建脚本中加入Checkstyle检查，如果有不达标的代码则让构建失败，以便告诉提交者立即修复Style问题。我更推荐这个方案，因为相关的工具支持都很成熟，实现简单，而且构建过程可以在开发者的本地环境复制，以便在后续改进中将Checkstyle检查前移，提供更快的反馈。如果团队使用Maven/Gradle等构建工具，可以用插件的方式实现Checkstyle检查并嵌入到整个构建过程中。这样CI服务器只要调用构建脚本就行了。</p>\n<h3>在开发者本地验证Style</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/6-lifecycle-local.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/6-lifecycle-local-1024x559.jpg\" alt=\"\" width=\"700\" height=\"382\"></a></p>\n<p style=\"text-align: center;\">（在开发者本地实现验证，反馈关口前移）</p>\n<p>在实现了CI验证后，就可以着手实现开发者本地验证了，这样开发者就不用等到提交代码到服务端后才会获得反馈了。由于之前采用的是构建工具的插件方案，所以开发者在本地运行构建就能实现验证了。比如Gradle提供了Checkstyle插件支持，你可以在这里找到Gradle Checkstyle Plugin的详细配置文档，如果你使用Maven，则可以参考这里。现在只需要一条命令，开发者久能在本地验证Code style了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bf409f7087618236\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# build.gradle \r\n# omitted plugins \r\napply plugin: \'checkstyle\'  \r\ncheckstyle {     \r\n    configFile = file(\"config/checkstyle.xml\") //指定checkstyle配置文件     \r\n    toolVersion = \"7.4\" //指定checkstyle工具的版本，部分style规则有版本要求 \r\n}  \r\ncheckstyleTest.exclude \"**/ContractVerifierTest**\" // 忽略检查生成代码，这个锅我们不背  \r\n\r\n// 如果出现checkstyle warning也使构建失败，插件默认只支持checkstyle error失败 \r\n// Fail build on Checkstyle Warning Violation · Issue #881 \r\ntasks.withType(Checkstyle).each { checkstyleTask -&gt;     \r\n    checkstyleTask.doLast {         \r\n        reports.all { report -&gt;             \r\n            def outputFile = report.destination             \r\n            if (outputFile.exists() &amp;&amp; outputFile.text.contains(\"&lt;error \")) {    \r\n                throw new GradleException(\"There were checkstyle warnings! For more info check $outputFile\")             \r\n            }         \r\n        }     \r\n    }\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409f7087618236-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409f7087618236-21\">21</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-1\"><span class=\"crayon-p\"># build.gradle </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-2\"><span class=\"crayon-p\"># omitted plugins </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-3\"><span class=\"crayon-e\">apply </span><span class=\"crayon-v\">plugin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'checkstyle\'</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-4\"><span class=\"crayon-e\">checkstyle</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">configFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"config/checkstyle.xml\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//指定checkstyle配置文件     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">toolVersion</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"7.4\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//指定checkstyle工具的版本，部分style规则有版本要求 </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-8\"><span class=\"crayon-v\">checkstyleTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">exclude</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"**/ContractVerifierTest**\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 忽略检查生成代码，这个锅我们不背  </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-10\"><span class=\"crayon-c\">// 如果出现checkstyle warning也使构建失败，插件默认只支持checkstyle error失败 </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-11\"><span class=\"crayon-c\">// Fail build on Checkstyle Warning Violation · Issue #881 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-12\"><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">withType</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Checkstyle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">checkstyleTask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">checkstyleTask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">doLast</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">         </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">reports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">def </span><span class=\"crayon-v\">outputFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">destination             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-16\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">outputFile</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exists</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outputFile</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&lt;error \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GradleException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There were checkstyle warnings! For more info check $outputFile\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">         </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409f7087618236-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596564bf409f7087618236-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>现在只需要一条命令，每个开发者就能在本地验证Code Style了。你可以在<a href=\"https://docs.gradle.org/current/userguide/checkstyle_plugin.html\">这里</a>找到Gradle Checkstyle Plugin的详细配置文档，如果你使用Maven，则可以参考<a href=\"https://maven.apache.org/plugins/maven-checkstyle-plugin/\">这里</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bf409ff301577488\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n➜  court-booking-backend (master) ✗ ./gradlew check \r\nStarting a Gradle Daemon (subsequent builds will be faster) \r\n:compileJava \r\n:processResources UP-TO-DATE \r\n:classes \r\n:checkstyleMain [ant:checkstyle] \r\n    [WARN] /Users/twer/Workspace/restbucks/court-booking-backend/src/main/java/com/restbucks/courtbooking/http/CourtRestController.java:16: \r\n    \'method def\' child have incorrect indentation level 4, expected level should be 8. [Indentation] :checkstyleMain FAILED  \r\nFAILURE: Build failed with an exception.</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bf409ff301577488-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409ff301577488-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409ff301577488-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409ff301577488-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409ff301577488-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409ff301577488-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409ff301577488-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf409ff301577488-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bf409ff301577488-9\">9</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bf409ff301577488-1\">➜<span class=\"crayon-h\">  </span><span class=\"crayon-v\">court</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">booking</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">backend</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span>✗<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">gradlew </span><span class=\"crayon-e\">check </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409ff301577488-2\"><span class=\"crayon-i\">Starting</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gradle </span><span class=\"crayon-e\">Daemon</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">subsequent </span><span class=\"crayon-e\">builds </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">be </span><span class=\"crayon-v\">faster</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409ff301577488-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">compileJava</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409ff301577488-4\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">processResources </span><span class=\"crayon-v\">UP</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">TO</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DATE</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409ff301577488-5\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409ff301577488-6\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">checkstyleMain</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ant</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">checkstyle</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409ff301577488-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">WARN</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">twer</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Workspace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">restbucks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">court</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">booking</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backend</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">main</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">java</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">restbucks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">courtbooking</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CourtRestController</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">java</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf409ff301577488-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\'method def\'</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">have </span><span class=\"crayon-e\">incorrect </span><span class=\"crayon-e\">indentation </span><span class=\"crayon-i\">level</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">expected </span><span class=\"crayon-e\">level </span><span class=\"crayon-e\">should </span><span class=\"crayon-i\">be</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Indentation</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">checkstyleMain </span><span class=\"crayon-e\">FAILED  </span></div><div class=\"crayon-line\" id=\"crayon-596564bf409ff301577488-9\"><span class=\"crayon-v\">FAILURE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Build </span><span class=\"crayon-e\">failed </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">an </span><span class=\"crayon-v\">exception</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p></p>\n<h3>本地验证很不错，但我有时候会忘记执行</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/7-lifecycle-git-hook.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/7-lifecycle-git-hook-1024x559.jpg\" alt=\"\" width=\"700\" height=\"382\"></a></p>\n<p style=\"text-align: center;\">（让机器代劳琐事）</p>\n<p>有时候，开发者修改了代码后会忘记执行本地检查就提交代码了，最好能够在提交代码前自动执行检查。如果你使用Git的话，可能会想到Git commit hook，比如这是我常用的pre-commit hook</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bf40a04055366110\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\n# From gist at https://gist.github.com/chadmaughan/5889802\r\n\r\n# stash any unstaged changes\r\ngit stash -q --keep-index\r\n\r\n# run the tests with the gradle wrapper\r\n./gradlew clean build\r\n\r\n# store the last exit code in a variable\r\nRESULT=$?\r\n\r\n# unstash the unstashed changes\r\ngit stash pop -q\r\n\r\n# return the \'./gradlew build\' exit code\r\nexit $RESULT</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a04055366110-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a04055366110-17\">17</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-2\"><span class=\"crayon-p\"># From gist at https://gist.github.com/chadmaughan/5889802</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-4\"><span class=\"crayon-p\"># stash any unstaged changes</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-5\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">stash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-6\"> </div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-7\"><span class=\"crayon-p\"># run the tests with the gradle wrapper</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-8\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">gradlew </span><span class=\"crayon-e\">clean </span><span class=\"crayon-v\">build</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-10\"><span class=\"crayon-p\"># store the last exit code in a variable</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-11\"><span class=\"crayon-v\">RESULT</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-12\"> </div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-13\"><span class=\"crayon-p\"># unstash the unstashed changes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-14\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">stash </span><span class=\"crayon-v\">pop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a04055366110-16\"><span class=\"crayon-p\"># return the \'./gradlew build\' exit code</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a04055366110-17\"><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">RESULT</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>将该脚本拷贝到<code>.git/hooks/</code>下，在执行<code>git commit</code>的时候就会自动触发检查了，如果检查失败则提交失败。但问题是<code>.git</code>并不能提交到远程代码仓库，那么除了人工分发和拷贝外，有没有更好的方式在团队中共享这个机制呢？</p>\n<p>可以曲线救国！把pre-commit纳入版本控制(如下面的<code>config/pre-commit</code>)，再使用构建工具的扩展机制来自动完成拷贝工作，这样可以间接实现git hooks的团队间共享。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596564bf40a0a590784485\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# build.gradle\r\n\r\ntask installGitHooks(type: Copy) { //将pre-commit拷贝到指定位置\r\n    from new File(rootProject.rootDir, \'config/pre-commit\')\r\n    into {\r\n        new File(rootProject.rootDir, \'.git/hooks\')\r\n    }\r\n    fileMode 0755\r\n}\r\n\r\nbuild.dependsOn installGitHooks //设置执行build任务时会自动触发installGitHooks任务</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596564bf40a0a590784485-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a0a590784485-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a0a590784485-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a0a590784485-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a0a590784485-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a0a590784485-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a0a590784485-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a0a590784485-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a0a590784485-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596564bf40a0a590784485-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596564bf40a0a590784485-11\">11</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596564bf40a0a590784485-1\"><span class=\"crayon-p\"># build.gradle</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a0a590784485-2\"> </div><div class=\"crayon-line\" id=\"crayon-596564bf40a0a590784485-3\"><span class=\"crayon-e\">task </span><span class=\"crayon-e\">installGitHooks</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Copy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//将pre-commit拷贝到指定位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a0a590784485-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">from </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rootProject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rootDir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'config/pre-commit\'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a0a590784485-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a0a590784485-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rootProject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rootDir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'.git/hooks\'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a0a590784485-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a0a590784485-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">fileMode</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0755</span></div><div class=\"crayon-line\" id=\"crayon-596564bf40a0a590784485-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596564bf40a0a590784485-10\"> </div><div class=\"crayon-line\" id=\"crayon-596564bf40a0a590784485-11\"><span class=\"crayon-v\">build</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dependsOn </span><span class=\"crayon-v\">installGitHooks</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//设置执行build任务时会自动触发installGitHooks任务</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3>关闭包围圈，编辑时反馈</h3>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/8-lifecycle-edit-time.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/8-lifecycle-edit-time-1024x558.jpg\" alt=\"\" width=\"700\" height=\"381\"></a></p>\n<p style=\"text-align: center;\">(实时反馈)</p>\n<p>之前基于构建工具的方案都很好，但是对于开发者来说，最好能将反馈前移到编辑时，并且可视化。所幸的是，Checkstyle的生态系统非常成熟，各主流IDE都有插件支持，以Intellij Idea为例，可以使用<a href=\"https://github.com/jshiell/checkstyle-idea\">checkstyle-idea</a>插件，让团队成员手工设置插件，使用项目的checkstyle配置文件即可(我目前还没有找到自动化配置的方式，或许gradle idea插件可以？)</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/9-idea-checkstyle-settings.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/9-idea-checkstyle-settings-1024x258.jpg\" alt=\"\" width=\"700\" height=\"176\"></a></p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/10-idea-checkstyle-plugin.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/10-idea-checkstyle-plugin-1024x142.jpg\" alt=\"\" width=\"700\" height=\"97\"></a></p>\n<p style=\"text-align: center;\">(checkstyle-idea插件配置和效果)</p>\n<p>有了自动实时检查，最好还能将IDE的自动格式化与Checkstyle配置文件挂钩，否则自动格式化反倒给你添麻烦了。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/11-idea-format.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/11-idea-format-1024x485.jpg\" alt=\"\" width=\"700\" height=\"332\"></a></p>\n<p style=\"text-align: center;\">(为IDE导入checkstyle配置文件作为自动格式化的依据)</p>\n<p>如果你连自动格式化都懒得按，那可以试试<a href=\"https://github.com/dubreuia/intellij-plugin-save-actions\">Save Actions</a>插件，它可以在Intellij保存文件时自动执行代码格式化等动作。</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/12-save-actions.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/06/12-save-actions-1024x583.jpg\" alt=\"\" width=\"700\" height=\"399\"></a></p>\n<p style=\"text-align: center;\">(这个插件目前对部分文件有些问题，可以通过File path exclusion忽略)</p>\n<h3>总结</h3>\n<ol>\n<li>Code Style影响工作效率，团队应将其当做工程实践予以重视。</li>\n<li>Code Style不能靠人工监督和检查，应该提供端到端的工具支持\n<ul>\n<li>服务端检查（推荐集成到CI的构建步骤中）</li>\n<li>开发环境检查（使用各构建工具的Checkstyle插件）</li>\n<li>自动提交检查（git pre-commit hook与共享）</li>\n<li>IDE增强（checkstyle插件实时可视化反馈/自动的自动格式化！）</li>\n<li>以上的工具都要依据为同一份Checkstyle配置文件，并纳入版本控制</li>\n</ul>\n</li>\n</ol>\n<p>希望以上这些招数可以解救Java Code Style强迫症 ：）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111468\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111468votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111468\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n			<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 60</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('九年游戏开发经验谈', '2017-07-12', 'http://blog.jobbole.com/109943/', '4057d0a4af8aa2f6c9d6dd4716b2d87b', 'http://wx3.sinaimg.cn/mw690/63918611gy1fgn2pbhpw9j213r0mcwo9.jpg', 'full/37d4eb0422ad391a3cea574bc52cd9a2ec0614ca.jpg', '0', '2', '6', '职场,游戏,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>【导读】：程序员是一个充满了躁动与焦虑的职业，新人的不断涌入和频繁的跳槽正在不断消磨人们对这个行业的安全感。而我有幸认识了这样一位工程师，他从 08 年就加入育碧上海工作室从事他所热爱的游戏开发。这九年的时间里，他见证了游戏行业的蓬勃发展，开发技术的日新月异，而育碧也见证了他由青涩到成熟，在游戏开发行业中渐渐闯出自己的一番天地。</p>\n<blockquote><p>育碧是全球领先的游戏制作、发行及分销商，创建于1986年。在全球拥有30个工作室，10000名员工。育碧上海工作室是育碧亚太区的核心研发中心。自1996年成立以来，约400位顶尖人才正不断推出高品质3A级端游、页游和手游产品。同时上海工作室也承担着育碧亚太网络数据中心的重要角色。</p></blockquote>\n<p>除了育碧旗下全球畅销游戏作品《刺客信条》、《波斯王子》、《雷曼》、《孤岛惊魂》和《看门狗》，游戏发烧友们一定还知道《我还活着》、《细胞分裂系列》和《彩虹六号：围攻》等等。这些游戏从设计，制作，不断打磨完善，到最终呈现在玩家面前，都离不开游戏开发工程师们的努力，其中就包括曹檬恺。这些脍炙人口的游戏，就是由他和育碧全球各工作室的同事一起，将一行行代码转化为精美的画面，生动的人物，炫酷的操作和流畅的剧情。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fgn2pbhpw9j213r0mcwo9.jpg\" width=\"690\" height=\"388\"></p>\n<p>读书期间，曹檬恺就是热爱游戏的众多青年之一，在玩游戏的过程中，他逐渐对游戏开发产生了浓厚的兴趣。被《刺客信条》宣传视频深深震撼的他毅然决定加入育碧。九年时间里，不同的工作角色给了他与众不同的体验。兴趣和责任激励他不断开阔视野，充实自己的技术栈，由初出茅庐成长为技术负责人。</p>\n<p>当被问到有没有考虑过离开育碧的时候，他给了我一个否定答案。曹檬恺告诉我，跳槽并不是程序员的必由之路，选择一个适合自己的公司非常重要。在已过去的九年和未来的职业生涯中，能够和志同道合的人一起做自己热爱的事业，保持学习和成长的状态，体会游戏上线所带来的成就感，对于一名游戏开发工程师来说，是相当享受的一件事。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fgn2pfmwczj213r0mc480.jpg\" width=\"690\" height=\"388\"></p>\n<p>作为“过来人”，对想进入游戏开发领域的新人，或是处于工作迷茫期不知如何做选择的人，曹檬恺分享了自己的经验：</p>\n<h3>兴趣是最好的老师，勇敢追求自己喜欢的事业</h3>\n<p>要坚持做一件事，仅靠毅力还不够，还需要兴趣作为不断探索钻研的动力。在曹檬恺看来，相较于其他类型的软件开发，游戏开发有其独特的魅力。它是创意与技术的结合：在工作中，每天都能接触到最前沿的图形技术，并将其运用到游戏当中，制作出生动有趣的作品。从游戏玩家到参与设计制作游戏，是一个很大的跨越。当真正参与到游戏项目中的时候，能够体会到普通游戏玩家所体会不到的乐趣。尤其是在育碧这种多文化背景的环境下，能与不同职位，来自不同国家工作室的同事们交流，感受思维的碰撞。</p>\n<p>很多人期待加入这个行业，但因为种种原因望而却步，他们缺乏的是把“想”变成“做”的过程。曹檬恺希望更多喜欢游戏的年轻人，以及处于观望状态中的朋友能勇敢迈出这一步，加入到游戏开发的队伍中来。</p>\n<h3>不局限于短期利益，放眼长远发展</h3>\n<p>无论是游戏行业还是其他软件开发行业，进步都不是一两天的功夫。选择了这个职业就等于选择了终身学习。多思考，多积累，由此不断提升自己。相比于一些短期的利益，一个能让人不断成长的工作环境才是至关重要的。</p>\n<p>曹檬恺说，很多人在工作一段时间以后就会感觉遇到了瓶颈，没有了提升的空间，这对个人感受和未来发展都很不利。而他在育碧的九年时间里能一直保持成长的状态主要来源于以下几方面。</p>\n<p>首先，从刚进入工作岗位到成长为团队的负责人，这个过程本身就体现了作为一名程序员良性并且长远的职业发展路径。同时，他的工作角色一直在变化之中，经历了由开发工具维护、引擎维护、功能开发、游戏玩法设计实现等等。不同的角色让他有机会涉猎包括传统软件开发、动画、AI、图形等各种类型的技术，开拓了视野，对自己本身的定位有了更好的认识。其次，游戏项目当中离不开组内所有成员的协作分工，除了每天会和不同职位的人打交道，大型团队中的分工细化也能让开发人员在某一个领域深入钻研，这是选择大公司大团队的一个明显优势。另外，随着各个工作室之间合作的加强，有机会接触到像《刺客信条》《孤岛惊魂》这些最知名的游戏，其代码经过了十几二十年的沉淀，从中可以学到很多东西，磨炼个人技术水平。</p>\n<h3>紧跟潮流，了解行业技术前沿</h3>\n<p>一个尊重技术、紧跟潮流的公司对开发人员有着非常积极的影响。个人的成长与公司产品的成长密不可分。如今的游戏行业，一方面，社交主导的手游正在兴起，另一方面，更高精尖的图形技术和 AI 技术也在不断运用到游戏设计中来。例如游戏中一个非常不起眼的 NPC，从一点移动到另一点的简单过程，也会运用到寻路等算法。又例如在图形技术中，从最早的DX9.0到目前的DX12。这些新技术的运用使玩家获得更丰富的游戏体验。而产品的成功，自然需要开发人员不断吸收新技术，并与现有的产品完美结合。</p>\n<p>除此之外，个人也要多了解游戏行业发展趋势，不仅要学习新技术，还要发现游戏的新玩法新创意，多关注国内外的论坛，大牛的博客，专业的游戏测评网站等等。</p>\n<h3>责任就是动力</h3>\n<p>有些人会觉得参与项目责任越大压力越大，但曹檬恺却认为责任就是动力。在一个项目当中，每个人都有着举足轻重的作用。一款游戏并非从一开始就全部设计完成，只需要工程师按部就班地去实现。在设计师提出需求以后，还要在实现过程中不断打磨，以期带给玩家最棒的游戏体验。在打磨过程中迸发出的新想法，根据个人经验理解所做的技术优化都会为游戏增色不少。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgn2pju4doj213q0myqam.jpg\" width=\"690\" height=\"399\"></p>\n<p>在育碧上海工作室，能接触到大 IP，参与大型游戏开发项目更是难得的机会。在承担其中的部分工作的同时还需要管理团队，这会让自己感受到肩上的责任，努力把任务完成好。当你或是整个项目组为了一款游戏做了很多付出，看到它最终被推向市场，获得玩家的肯定时，这种巨大的成就感是其他事情所不能比拟的。大项目中的技术沉淀也值得每一个技术人员深入探讨研究，从中学习有用的经验。</p>\n<h3>劳逸结合，丰富生活</h3>\n<p>一个轻松愉快的工作氛围能使人全身心投入工作，也能追求工作与生活的平衡。好的项目团队就像一个家，大家的目标都是相同的，为了把游戏做好。工作中要平等交流互相学习，工作之余，同事间也能一起参加各种活动，成为朋友，一起游游泳、踢踢球。朋友多了，运动多了，保持身心愉悦工作自然会越做越好。</p>\n<p>现在很多公司会强调加班文化。曹檬恺坦言，自己也会加班，但不是为了赶工完成任务，而是根据自身情况选择最佳状态完成工作。有些人晚上工作效率会更高，白天的时间会用来完成一些个人的学习，公司给员工更多自由其实对双方都是颇有益处的。</p>\n<p>除了技术上的提升，公司里多一些其他职场相关的培训也很有意义，例如和顶级游戏工作室学习工作方式，针对英语和演讲方面的训练，对自己未来的职业发展非常有帮助。</p>\n<p>最后，曹檬恺用三个词语概括了在育碧的这九年：<strong>笃定、学习和动力</strong>。他对工作的选择、职业的发展规划、学习的方式都为年轻的工程师们提供了宝贵的借鉴意义。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fgn2pp75ryj213p0newq8.jpg\" width=\"690\" height=\"407\"></p>\n<p>在 IT 圈人员流动速度快、人心浮躁的大环境下，曹檬恺却对我说，他和同事们都非常享受现在的工作状态，希望继续留在育碧，专心于技术，做玩家喜爱的游戏。育碧上海工作室团队中不乏工作了十年，十五年甚至更长时间的老员工。他也期待更多热爱游戏热爱技术的人加入其中，为育碧注入新鲜的血液。不论你擅长是游戏逻辑编程，UI 编程还是手游，这里都会有你的一片天地。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"109943\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"109943votetotal\">6</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"109943\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 37</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('一步步实现 Redis 搜索引擎', '2017-07-12', 'http://blog.jobbole.com/111480/', '42369d324412b391499279a170e4ca36', 'http://jbcdn2.b0.upaiyun.com/2013/08/redis-logo.png', 'full/0a03ec3e1ce1b668b8db0234731fac4915b1064d.jpg', '1', '5', '1', 'IT技术,,Redis', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md\">jasonGeng88</a>   </div><div>\n<h2>场景</h2>\n</div>\n<p>大家如果是做后端开发的，想必都实现过列表查询的接口，当然有的查询条件很简单，一条 SQL 就搞定了，但有的查询条件极其复杂，再加上库表中设计的各种不合理，导致查询接口特别难写，然后加班什么的就不用说了（<em>不知各位有没有这种感受呢~</em>）。</p>\n<p>下面以一个例子开始，这是某购物网站的搜索条件，如果让你实现这样的一个搜索接口，你会如何实现？（<em>当然你说借助搜索引擎，像 Elasticsearch 之类的，你完全可以实现。但我这里想说的是，如果要你自己实现呢？</em>）</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_01.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_01.png\" alt=\"\"></a></p>\n<p>从上图中可以看出，搜索总共分为6大类，每大类中又分了各个子类。这中间，各大类条件之间是取的交集，各子类中有单选、多选、以及自定义的情况，最终输出符合条件的结果集。</p>\n<p>好了，既然需求很明确了，我们就开始来实现。</p>\n<h2><a id=\"user-content-实现1\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%AE%9E%E7%8E%B01\"></a>实现1</h2>\n<p>率先登场是小A同学，他是写 SQL 方面的“专家”。小A信心满满的说：“不就是一个查询接口吗？看着条件很多，但凭着我丰富的 SQL 经验，这点还是难不倒我的。”</p>\n<p>于是乎就写出了下面这段代码（这里以 MYSQL 为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965d16b683f7866671834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect ... from table_1\r\nleft join table_2\r\nleft join table_3\r\nleft join (select ... from table_x where ...) tmp_1\r\n...\r\nwhere ...\r\norder by ...\r\nlimit m,n</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965d16b683f7866671834-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b683f7866671834-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965d16b683f7866671834-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b683f7866671834-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965d16b683f7866671834-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b683f7866671834-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965d16b683f7866671834-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b683f7866671834-8\">8</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965d16b683f7866671834-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table_1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b683f7866671834-2\"><span class=\"crayon-e\">left </span><span class=\"crayon-e\">join </span><span class=\"crayon-e\">table_2</span></div><div class=\"crayon-line\" id=\"crayon-5965d16b683f7866671834-3\"><span class=\"crayon-e\">left </span><span class=\"crayon-e\">join </span><span class=\"crayon-e\">table_3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b683f7866671834-4\"><span class=\"crayon-e\">left </span><span class=\"crayon-e\">join</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table_x </span><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">_</span>1</div><div class=\"crayon-line\" id=\"crayon-5965d16b683f7866671834-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b683f7866671834-6\"><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5965d16b683f7866671834-7\"><span class=\"crayon-e\">order </span><span class=\"crayon-i\">by</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b683f7866671834-8\"><span class=\"crayon-i\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>代码在测试环境跑了一把，结果好像都匹配上了，于是准备上预发。这一上预发，问题就开始暴露出来。预发为了尽可能的逼真线上环境，所以数据量自然而然要比测试大的多。所以这么一个复杂的 SQL，它的执行效率可想而知。测试同学果断把小A的代码给打了回来。</p>\n<h2><a id=\"user-content-实现2\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%AE%9E%E7%8E%B02\"></a>实现2</h2>\n<p>总结了小A失败的教训，小B开始对SQL进行了优化，先是通过了<code>explain</code>关键字进行SQL性能分析，对该加索引的地方都加上了索引。同时将一条复杂SQL拆分成了多条SQL，计算结果在程序内存中进行计算。</p>\n<p>伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965d16b68402866564006\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$result_1 = query(\'select ... from table_1 where ...\');\r\n$result_2 = query(\'select ... from table_2 where ...\');\r\n$result_3 = query(\'select ... from table_3 where ...\');\r\n...\r\n\r\n$result = array_intersect($result_1, $result_2, $result_3, ...);</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965d16b68402866564006-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b68402866564006-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965d16b68402866564006-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b68402866564006-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965d16b68402866564006-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d16b68402866564006-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965d16b68402866564006-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\'select ... from table_1 where ...\'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b68402866564006-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\'select ... from table_2 where ...\'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965d16b68402866564006-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\'select ... from table_3 where ...\'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b68402866564006-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5965d16b68402866564006-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d16b68402866564006-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_intersect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这种方案从性能上明显比第一种要好很多，可是在功能验收的时候，产品经理还是觉得查询速度不够快。小B自己也知道，每次查询都会向数据库查询多次，而且有些历史原因，部分条件是做不到单表查询的，所以查询等待的时间是避免不了的。</p>\n<h2><a id=\"user-content-实现3\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%AE%9E%E7%8E%B03\"></a>实现3</h2>\n<p>小C从上面的方案中看到了优化的空间。他发现小B在思路上是没问题的，将复杂条件拆分，计算各个子维度的结果集，最后将所有的子结果集进行一个汇总合并，得到最终想要的结果。</p>\n<p>于是他突发奇想，能否事先将各个子维度的结果集给缓存起来，这要查询的时候直接去取想要的子集，而不用每次去查库计算。</p>\n<p>这里小C采用 <a href=\"https://redis.io/\">Redis</a> 来存储缓存数据，用它的主要原因是，它提供了多种数据结构，并且在 Redis 中进行集合的交并集操作是一件很容易的事情。</p>\n<p>具体方案，如图所示：</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_02.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_02.png\" alt=\"\"></a></p>\n<p>这里每个条件都事先将计算好的结果集ID存入对应的key中，选用的数据结构是集合（Set）。查询操作包括：</p>\n<ul>\n<li>子类单选：直接根据条件 key，获取对应结果集；</li>\n<li>子类多选：根据多个条件 Key，进行并集操作，获取对应结果集；</li>\n<li>最终结果：将获取的所有子类结果集进行交集操作，得到最终结果；</li>\n</ul>\n<p><em><strong>这其实就是所谓的<a href=\"https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95\">反向索引</a>。</strong></em></p>\n<p>这里会发现，漏了一个价格的条件。从需求中可知，价格条件是个区间，并且是无穷举的。所以上述的这种穷举条件的 Key-Value 方式是做不到的。这里我们采用 Redis 的另一种数据结构进行实现，有序集合（Sorted Set）：</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_03.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_03.png\" alt=\"\"></a></p>\n<p>将所有商品加入 Key 为价格的有序集合中，值为商品ID，每个值对应的分数为商品价格的数值。这样在 Redis 的有序集合中就可以通过<code>ZRANGEBYSCORE</code>命令，根据分数（价格）区间，获取相应结果集。</p>\n<p>至此，方案三的优化已全部结束，将数据的查询与计算通过缓存的手段，进行了分离。在每次查找时，只需要简单的查找 Redis 几次就能得出结果。查询速度上符合了验收的要求。</p>\n<h2><a id=\"user-content-扩展\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%89%A9%E5%B1%95\"></a>扩展</h2>\n<h3><a id=\"user-content-分页\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E5%88%86%E9%A1%B5\"></a>分页</h3>\n<p>这里你或许发现了一个严重的功能缺陷，列表查询怎么能没有分页。是的，我们马上来看 Redis 是如何实现分页的。</p>\n<p>分页主要涉及排序，这里简单起见，就以创建时间为例。</p>\n<p>如图所示：</p>\n<p><a href=\"https://github.com/jasonGeng88/blog/blob/master/201706/assets/redis_search_04.png\" target=\"_blank\"><img src=\"https://github.com/jasonGeng88/blog/raw/master/201706/assets/redis_search_04.png\" alt=\"\"></a></p>\n<p>图中蓝色部分是以创建时间为分值的商品有序集合，蓝色下方的结果集即为条件计算而得的结果，通过<code>ZINTERSTORE</code>命令，赋结果集权重为0，商品时间结果为1，取交集而得的结果集赋予创建时间分值的新有序集合。对新结果集的操作即能得到分页所需的各个数据：</p>\n<ul>\n<li>页面总数为：<code>ZCOUNT</code>命令</li>\n<li>当前页内容：<code>ZRANGE</code>命令</li>\n<li>若以倒序排列：<code>ZREVRANGE</code>命令</li>\n</ul>\n<h3><a id=\"user-content-数据更新\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0\"></a>数据更新</h3>\n<p>关于索引数据更新的问题，有两种方式来进行。一种是通过商品数据的修改，来即时触发更新操作，一种是通过定时脚本来进行批量更新。这里要注意的是，关于索引内容的更新，如果暴力的删除 Key，再重新设置 Key。因为 Redis 中两个操作不会是原子性进行的，所以中间可能存在空白间隙，建议采用仅移除集合中失效元素，添加新元素的方式进行。</p>\n<h3><a id=\"user-content-性能优化\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96\"></a>性能优化</h3>\n<p>Redis 是内存级操作，所以单次的查询会很快。但是如果我们的实现中会进行多次的 Redis 操作，Redis 的多次连接时间可能是不必要时间消耗。通过使用<code>MULTI</code>命令，开启一个事务，将 Redis 的多次操作放在一个事务中，最后通过<code>EXEC</code>来进行原子性执行（<em><strong>注意：这里所谓的事务，只是将多个操作在一次连接中执行，如果执行过程中遇到失败，是不会回滚的</strong></em>）。</p>\n<h2><a id=\"user-content-总结\" class=\"anchor\" href=\"https://github.com/jasonGeng88/blog/blob/master/201706/redis-search.md?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#%E6%80%BB%E7%BB%93\"></a>总结</h2>\n<p>这里只是一个采用 Redis 优化查询搜索的一个简单 Demo，和现有的开源搜索引擎相比，它更轻量，学习成本也相应低些。其次，它的一些思想与开源搜索引擎是类似的，如果再加上词语解析，也可以实现类似全文检索的功能。</p>\n<p>最后，未完，待续。。。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111480\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111480votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111480\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('我给你钱，你帮我改好不好？', '2017-07-12', 'http://blog.jobbole.com/108195/', '44d75eb058214ff58a5b9fe0dccb16bd', 'http://wx4.sinaimg.cn/mw690/7cc829d3gy1fgjcurlsj2j20ka0d8t9t.jpg', 'full/93c5357a5f9cfa4a19bfcde8644db2d5f7712cc6.jpg', '7', '5', '5', '职场,,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/4e4e41e1eecc\">乔兰伊雪</a>   </div><div>\n<h3>一、</h3>\n<p>七点左右，我下班回家的路上收到一条消息，是一个初入职场的同行发过来的。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fgjcurlsj2j20ka0d8t9t.jpg\" width=\"580\" height=\"378\"></p>\n<p>其实他也不算初入职场，去年他就毕业工作了，那个时候我在上家公司工作比较轻松，每天都会到论坛逛逛，时不时写一些小功能发到网上共享，也会帮别人解决一些问题。</p>\n<p>他看到了我的代码，就加了我，说是以后有问题就向我请教，后来就杳无音讯。直到前阵子联系我帮他写一个功能，我才知道他因为家里原因大半年没上班，最近才开始工作。</p>\n<p>他问我，有没有做过扫描二维码或者条形码的功能？</p>\n<p>我想了想，去年好像写过这个功能，就跟他说明天帮他找找这份代码。</p>\n<p>然后回家，吃了饭下楼散步，又收到他的消息。</p>\n<p>可是我现在就得实现这个功能啊？</p>\n<p><b>我有些无奈，你现在要实现这个功能，与我何干？这语气好像是你着急要这个功能，我就必须要帮你实现似的。</b></p>\n<p><b>小伙子，没有人有义务帮你做任何事情，何况还是素不相识的陌生人。</b></p>\n<p>谁让我这么心软呢，最后还是找到我去年写的那份代码的下载链接发给他，让他试试看能不能用。</p>\n<p>过了一会，他说，可以用，我从网上也下了一些demo，但是想把中间的正方形扫描框改成长方形的，却找来找去不知道怎么改。你有时间吗，我给你钱，你帮我改好不好？</p>\n<p>心里莫名升起一把火，代码都给你了，就是把正方形改成长方形都还要花钱让别人改，你是钱多得没处使么？</p>\n<p>我说我在外面，没法帮他改，我的代码注释都很清楚，让他自己找找改一下，又从网上找了一篇教程发给他，让他看着改。</p>\n<p>他的心情估计也很无奈，说，好吧，那我试试看。</p>\n<p>他找到了我设置扫描框的代码，截图给我看，却依然不知该怎么修改。</p>\n<p>我已经不知道该怎么跟他说了，只能跟他说你总得自己试着成长，不能一有问题就找别人帮你写。</p>\n<p>他说，好吧，我看看。</p>\n<p>第二天一早，我问他改好了么。他肯能在忙，直到下午才回复我说改好了，并对我表示感谢。</p>\n<p><b>这不就挺好么，不试一试又怎么知道自己不行呢？遇到事情不能过分的依赖别人，也不是所有的事情都可以用钱来解决，最好能自己解决的就自己解决，这样才能快速成长起来。</b></p>\n<h4>不是所有的路别人都可以帮你走 ，有些路是需要你独自前行的。</h4>\n<h3>二</h3>\n<p>我想，应该有很多这种初入职场的菜鸟，好不容易找到工作，自己却无法按时完成任务，而不得不四处求人帮忙，甚至花钱让别人帮他写以完成任务，保住饭碗。</p>\n<p>当然，刚入职时为了不耽误项目进度，这样做也不失为一种解决办法，但长期如此就是职业道德问题了，但愿这位小伙子能够靠自己能力胜任这份工作。</p>\n<p>我曾在某平台发过帖子咨询大家对于工作完不成，花钱买代码的行为的看法。</p>\n<p>有人表示不可思议，居然有人会这么做，也有一部分人表示自己身边就有这样的人，甚至自己就曾经被某大型软件公司一位工程师以低薪聘请，专职为那位工程师写代码，结果可想而知，被公司发现后，那位工程师被开除，他也失业了。</p>\n<p><b>想来这样长期靠买代码完成工作的人，大概下场都不会很好吧。</b><br>\n<img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fgjcur1snfj20go09d3yo.jpg\" width=\"580\" height=\"326\"></p>\n</div>\n<p><b>我并不是想说菜鸟有多么笨，多么不可教，也不是想要讽刺谁，我只是希望他们能变得更好。</b></p>\n<p>毕竟我也是从菜鸟过来的，我懂得在工作中无法实现某个功能时，身边又没有大神可问的的那种焦急无奈的心情。但是万事开头难，遇到问题总得自己先试着去解决，去百度，去论坛贴吧看别人的经验帖。</p>\n<p>要知道你遇到的问题百分之九十九的程序员都曾遇到过，还有百分之一是天才，在写代码之前就能预见到各种可能出现的问题，然后规避错误。但绝大多数人都还是普通人，通过自己的努力实现某个功能，解决某个问题，并且愿意无偿将自己的经验和代码分享出来，避免大家重复造轮子。</p>\n<p>关键在于你是否能从偌大的信息库中找到跟你想要实现的功能相似的帖子和代码，并总结他人经验，转化成自己的能力，一步步提升自己，摆脱菜鸟的标签。</p>\n<p>但如果一遇到问题，甚至是很简单的问题就花钱让别人帮你写，你的工作是保住了，那么你的能力呢，又何时才能有提升？难不成就一直花钱让别人帮你写，自己实现一些简单的功能，那么你的职业生涯又能维持多久呢？</p>\n<p>我在上家公司曾招过一名实习生，因不服气学长通过培训编程找到一份高薪工作就到处吹牛，觉得自己不比他差，凭着不服输的劲儿自学成才。大部分功能他都能独立实现，甚至有些知识点比我们这些老程序员都了解的透彻，平常工作根本不需要别人指点，即便遇到问题也能自己查资料解决，或者一点就通。</p>\n<p>同样是初入职场的新人，为什么差距这么大呢？</p>\n<p>也许有人说，这跟天赋、能力有关，可是笨鸟先飞啊，你如果觉得自己天赋不太好，那就要付出比别人更多的努力去弥补先天不足。</p>\n<p>也许又有人说了，你怎么知道别人没有付出努力？对，我确实不能说他没付出努力，他也是天天加班，平常完不成的工作六日补回来，但用功不在点子上也是徒劳。而且他每次找我从来都不是问我某个功能怎么实现，原理是什么，而是直接问我实现这个功能要多少钱，你帮我写好，我给你钱。</p>\n<p><b>当然，从我的层面上来说，这对我来说没什么坏处，反而能得一份外快，我又何乐而不为呢？可我觉得，长此以往不是帮他，而是害了他</b>。</p>\n<blockquote><p>3</p></blockquote>\n<p><b>一份工作，如果你努力了，付出了，仍然感到费力，还不如换一份，要相信天生我材必有用，总会有适合你那一份。</b></p>\n<p>并不是所有的人都适合编程，有些人天生就爱编程，编程就像流淌在他身体里的血液，是他的生命，他的一切，这种人可遇不可求。</p>\n<p>而大部分人只是把编程当作职业，一份养家糊口的工作，其中也不乏因为职业而爱上编程，将自己的时间都贡献在开发大业上，成为万人敬仰的大神。</p>\n<p>我并不属于他们中的一员，也不是大神，走上编程之路也并非我的本意，只是迫于生计寻找一份高薪工作而已。</p>\n<p>我的工作和生活完全分开，力求在工作时间内完成任务，并有余力提升自己不至于被淘汰。下班之后不谈工作，甚至不摸电脑，事实上我一直都没买电脑。</p>\n<p>可能有人觉得一个程序员居然没有电脑很不可思议，那我可能是个奇葩。也许我是属于程序员中不求上进的那种，只求完成本职工作，不愿为编程贡献自己的业余时间，但起码我有能力完成我的工作。</p>\n<p>但有一部分人，当初可能是被忽悠，也可能是看上程序员的高薪，入了坑，学得很吃力也很用功，走上工作岗位后依然不能胜任，为了这个饭碗苦苦挣扎，把自己弄的心力交瘁。</p>\n<p>既然这么辛苦，为什么不换一份工作？</p>\n<p>肯定会有人说我站着说话不腰疼，换工作哪有那么容易，现在工作这么不好找。可是即便你那么努力的坚持下去，又能坚持多久？</p>\n<p>公司迟早会发现你的能力不适合这份工作，你还是要面临重新找工作风险，那么你之前的坚持又有何意义？何不趁早转行，也许你就能找到适合自己的工作，在你的岗位上发光发热。</p>\n<p>在写这篇文章的时候，朋友跟我说这篇文章发出去肯定会有很多人对号入座，触犯了很多人的利益，会有很多人骂我，但这是一种不良的社会现象，总得有人敢于直言，只有戳到了痛处，才会有反思。</p>\n<p>不光是程序员，各行各业都会有不适合该行业的人在生死边缘挣扎，我还是希望每个人都能对自己负责，反思自己是否适合从事某份工作，如果不适合一定要及时悬崖勒马，换一个方向也许就海阔天空。</p>\n<h4>人生苦短，何必在没有希望的路上浪费精力？</h4>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"108195\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"108195votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"108195\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('开发团队到底好不好，这 12 个问题能检验出来吗？', '2017-07-12', 'http://blog.jobbole.com/111551/', '52f70501a29c2a68a1a8aced393190d5', 'http://ww4.sinaimg.cn/large/7cc829d3gw1f5o84olqc5j20zk0qodjo.jpg', 'full/8ac214b4204afd642c5f87970a0d16ad87660f96.jpg', '0', '6', '1', '开发,团队', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/alvendarthy\">alvendarthy</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://myers.io/2017/04/04/the-joel-test-for-2017/\">Dale Myers</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：「Joel 测试」是 Joel Spolsky 在 2000 年提出的 12 个问题，用来检验一个团队是否是好的开发团队。17 年过去了，Dale Myers 重新审视了这12个问题，并与时俱进地提出了修改建议。</p>\n<hr>\n<p>就在 2013 年，我参加了一个课程：“软件的架构、执行和管理”。其中主题之一，就是如何评价一个开发团队？这不是一个简单的问题，如果要得到一个完整的答案，最后一定需要一些必要的研究，一篇冗长的报告。还好，Joel Spolsky 提出了12 个非常简单的测试问题，相对无痛地解决这个问题，这些问题被称为“Joel 测试”。该测试不是非常严谨，也无意于此。但是它可以为你提供坚实基础，进一步了解其他细节。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654bb1c36b8393230233\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1. 是否使用源码控制？\r\n2. 能实现一键编译吗?\r\n3. 是否进行每日编译？\r\n4. 有无 bug 数据库？\r\n5. 在编码前是否解决bug？\r\n6. 是否有实时更新的计划表？\r\n7. 是否有文档？\r\n8. 开发人员有安静的开发环境吗?\r\n9. 是否使用市面上最好的工具？\r\n10. 是否有测试人员？\r\n11. 新员工面试时写代码吗？\r\n12. 是否进行走廊可用性测试？</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36b8393230233-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36b8393230233-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36b8393230233-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36b8393230233-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36b8393230233-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36b8393230233-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36b8393230233-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36b8393230233-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36b8393230233-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36b8393230233-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36b8393230233-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36b8393230233-12\">12</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654bb1c36b8393230233-1\"><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span>是否使用源码控制？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36b8393230233-2\"><span class=\"crayon-cn\">2.</span><span class=\"crayon-h\"> </span>能实现一键编译吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36b8393230233-3\"><span class=\"crayon-cn\">3.</span><span class=\"crayon-h\"> </span>是否进行每日编译？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36b8393230233-4\"><span class=\"crayon-cn\">4.</span><span class=\"crayon-h\"> </span>有无<span class=\"crayon-h\"> </span><span class=\"crayon-i\">bug</span><span class=\"crayon-h\"> </span>数据库？</div><div class=\"crayon-line\" id=\"crayon-59654bb1c36b8393230233-5\"><span class=\"crayon-cn\">5.</span><span class=\"crayon-h\"> </span>在编码前是否解决<span class=\"crayon-i\">bug</span>？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36b8393230233-6\"><span class=\"crayon-cn\">6.</span><span class=\"crayon-h\"> </span>是否有实时更新的计划表？</div><div class=\"crayon-line\" id=\"crayon-59654bb1c36b8393230233-7\"><span class=\"crayon-cn\">7.</span><span class=\"crayon-h\"> </span>是否有文档？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36b8393230233-8\"><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span>开发人员有安静的开发环境吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36b8393230233-9\"><span class=\"crayon-cn\">9.</span><span class=\"crayon-h\"> </span>是否使用市面上最好的工具？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36b8393230233-10\"><span class=\"crayon-cn\">10.</span><span class=\"crayon-h\"> </span>是否有测试人员？</div><div class=\"crayon-line\" id=\"crayon-59654bb1c36b8393230233-11\"><span class=\"crayon-cn\">11.</span><span class=\"crayon-h\"> </span>新员工面试时写代码吗？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36b8393230233-12\"><span class=\"crayon-cn\">12.</span><span class=\"crayon-h\"> </span>是否进行走廊可用性测试？</div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><strong>Joel 测试的优点在于：仅仅通过很小一组是非题，就可以得到需要的答案</strong>。你无需关注任何例外，或任何附加条件，只需要单纯的关注每个问题的答案是 yes 还是 no，就可以得到需要的结果： 12 分为优，11 分为良， 10 分及以下为差。这个优点并没有被我和我的几个同学忽视。我立刻将这个方法用到评估那些我面试实习的公司，以及后来毕业后第一份工作的公司。大多数雇主从来没有听说过这个测试，这倒不意外。真正令人意外的是，有多少公司没有通过该测试，而我曾认为这些公司非常棒！</p>\n<p><strong>我提问的不准确吗？他们真的理解我的意思吗？再或者我统计 12 个问题的时候算错了？</strong></p>\n<p>在面试时遇到 ”你还有什么想要问我们的吗？“ 这种问题时，Joel 测试是回答这个问题的大杀器，但是基本都没有及格的。当然，有可能刚好我面试的公司都很差劲，但是，尽管我是软件行业的新人，但是我有个感觉，事实绝非如此。我将该测试带入我的一些应用，发现我竟没有在任何地方考虑到这些问题。</p>\n<p><strong>那么我在 Joel 测试中出了什么问题呢？</strong></p>\n<p>每个开发人员都是不同的，他们对好坏都有着自己的标准，而且这个标准还会随着时间变化。Joel 测试试图规避这种偏差，用客观题替代了主观题。相信没有任何开发人员会反对，跟踪 bug 是个好想法，但是其他的问题呢？</p>\n<p>从 2000 年发布开始，Joel 测试已经有 17 个年头了。它比 OS X 的历史还要久。在同一时期，Windows 2000 还是当时技术最高水平，PlayStation 2 刚刚发布， 奔腾 III 处理器还在 1GHz 下嗡嗡地工作。 在计算机世界里，这确实是很久以前的事了。随着处理器计算能力（还有硬件的整体性能）每18个月翻番，我们的开发进程也一同提升了。Joel 测试的问题反映了当时软件开发的时代缩影。时至 2017 年，它们就未必非常恰当了。</p>\n<p>以第一个问题为例：</p>\n<blockquote><p>是否有源码控制？</p></blockquote>\n<p>如今最流行的版本控制系统——Git，在当时还没有出现。好吧，众所周知，Git 直到 2005 年才出现。也不要忘记，前任的版本控制系统之王——Subversion 也是到 2000 年才出现，比 Joel 测试首次发布晚了 2 个月。那时源码控制出现了，但是却不像今天这样普遍。这是不是意味着，今天还讨论源码控制这个问题显得多此一举呢？可能吧！我们应该修改这个问题与时俱进吗？也许吧！</p>\n<p>让我们一起来看看这些问题，然后看看如何与时俱进吧。</p>\n<h3 id=\"do-you-use-source-control\">1. 是否使用源码控制？</h3>\n<p>除了上面提到的，时至今日，这个问题似乎依然有意义。任何团队都需要源码控制，这是毋庸置疑的。如今的争议主要在是否使用集中式版本控制系统。一般的项目使用 Git 或者 Mercurial （举例来说）都可以。大型公司拥有超大型代码仓库，一般采用集中式版本控制系统。这个问题没有绝对答案。真正重要的是，有版本控制！既然这个问题已经是常识，我认为它就没必要继续存在了。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议： 删除</strong></span></p>\n<h3>2. 能实现一键编译吗?</h3>\n<p>Joel 的解释如下：</p>\n<blockquote><p>从最新的代码快照编译出交付版本，一共需要多少步？</p></blockquote>\n<p>其背后的原因，今天依然成立。好了，我认为这是我们对老问题的第一个挑战。我一直认为，编译交付版本，应当 0 步骤完成。持续集成已经广泛存在。使用它是非常明智的。创建一个交付版本的步骤应当这样：程序员们提交代码，当管理人员，或者其他负责人准备 release 时，他只需要点击 ”release“ 按钮即可，然后就成功了。所有开发人员只需要确保他们提交的代码无误，持续集成服务自动会完成其他工作。</p>\n<p>持续集成系统将软件开发产业向前推进了一大步。如果我们能更广泛的使用，充分发挥它的潜力，我们将受益良多。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：所有版本，都由持续集成服务器自动编译吗？</strong></span></p>\n<h3 id=\"do-you-make-daily-builds\">3. 是否进行每日编译？</h3>\n<p>这个问题紧随第 2 个。如果对团队有用的话，每日编译是可行的。我一直认为每日应当是最低限度了。在我眼里更好的实践是，确保主开发分支的每一次提交，都可以正常的完成编译。这算是一种“预览”版本，同时也意味着你能更快、更有效地发现自己的问题，因为一旦发生任何故障，非常容易确认其版本。</p>\n<p>该编译过程应当由持续集成系统自动完成。还有，你不止应当进行每日编译，而且应该使用它们。当然，如果你开发那些与你日常工作无关的软件时（定制或者专业软件），很难做到这一点。比如你在开发一款会计软件，或者火箭控制程序，显然你不可能使用这些产品。然而，我的建议是，每天至少花20分钟看看你的软件，试用一下，确保一切正常。假如你开发的软件每天都能用得到，那就更好了。它的作用与前面提到的 20 分钟试用一样，但在实际操作中，你可以进行远超 20 分钟的测试，使项目暴露在更加真实的场景下。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：是否执行每日编译，并使用这些版本？</strong></span></p>\n<h3>4. 有无 bug 数据库？</h3>\n<p>当然啦，你应该使用某种 bug 数据库。你听说过任何人认为没这个必要吗？如今发生变化的是，bug 跟踪有了更加丰富的特性。它们已经不再单单是一个数据库表的接口，而是拥有丰富功能的规划、管理程序，通常在任务和 bug 之间有显著区别（参考第 5 条）。</p>\n<p>如今，当你提交一个bug时，它有标题、描述、复现步骤、影响平台等等信息，一般都是如此。如今不同的是，管理将贯穿你的 bug 处理，bug 会被分派到若干迭代中，你需要利用看板规划任务，你的敏捷开发组长会就那些有困难的任务与你进行谈话。</p>\n<p>问题跟踪器也不仅仅是记录需要做的事。它包含谁执行了操作，对团队的影响，对产品的影响，以及其他上百个属性。那么，我认为你应该有某种软件来做这些事情，这都不重要，它就是你的某种问题跟踪器。因为各个团队的情况有所差异，这个问题也没有确切的答案。我所做的一点调整，只是为了用文字的一点不同，来反映我们现有的能力。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：你是否使用问题追踪器（issue tracker）？</strong></span></p>\n<h3 id=\"do-you-fix-bugs-before-writing-new-code\">5. 在编码前是否解决bug？</h3>\n<p>Joel 对这一点的重要性给出了非常好的论述，17 年后的今天，它依然成立。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：无</strong></span></p>\n<h3 id=\"do-you-have-an-up-to-date-schedule\">6. 是否有实时更新的计划表？</h3>\n<p>作为开发人员，你可能没那么关心计划表。如果你的团队没有在按时完成任务会怎样？不是你的问题吗？把这个问题留给管理人员吧！</p>\n<p>留个管理人员，也许有用，也许没用。如今，我们有各种敏捷开发理论，从开发人员，或者其他任何估时比较靠谱的人那里，得到的项目预估，是进行项目规划的关键要素。这帮助我们安排团队工作、谁来做这些工作，以及何时做这些工作。你可以掩耳盗铃，假装事事与你无关，但是最终，每一个人都需要对整个团队有一份责任。</p>\n<p>这一条今天还有效吗？必须的！当然了，我们已经不用瀑布流了。确保准时达到测试阶段，对我们已经没有太多意义了，但在敏捷开发（很多人深信，跟“现编现造”一个意思），特别是敏捷开发，计划表是最重要的，而且需要时刻保持更新。如今不同的是，计划表会根据新信息，保持更新。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：无</strong></span></p>\n<h3 id=\"do-you-have-a-spec\">7. 是否有文档？</h3>\n<p>计划表那一条完整的被保留下来，文档却未必同样走运。在瀑布流流行的时候，文档是你了解开发目标的关键。如果你无法有效调配资源，那么你的项目，注定会失败。</p>\n<p>回到 2001 年，当你创建一个程序时，无论是一台咖啡机，一台火箭，或者只是一个简单的 CRUD（Create、Retrieve、Update、Delete等） 界面，你都很清楚需要做什么，以及大约需要多少开销，逐步实现它。开发人员、测试人员、项目管理人员各司其职，大家全程根据文档展开工作，测试，交付，然后进入下一个项目。而今，在很多方面已经不是这样了。当然了，如果你还在开发上面提到的东西，情况就基本没什么变化。但是，如果你在开发 Twitter 客户端呢？或者文本编辑器呢？再或者邮件客户端？以前的老方法还依然有效吗？通常不是。</p>\n<p>只有当你可以从一开始就获得所有信息，并用来完成规划，文档才是有效的。当你的软件需要持续开发时，文档只在 MVP（Minimum Viable Product，最小可行产品）阶段比较重要，在此之后，它的用处就很小了。要让文档在今天依然保持重要性，就必须实时更新信息，并相应地适应当前进度和产品情况。</p>\n<p>这里所谓的信息，可以通过很多形式获得。可能只是简单的模拟用户如何使用APP，或者应该更进一步，如果可能的话，应当对新特性和设计进行 A/B 测试。</p>\n<p><strong><span style=\"color: #ff0000;\">更新建议：是否有关于产品功能和使用相关的最新信息？</span></strong></p>\n<h3 id=\"do-programmers-have-quiet-working-conditions\">8. 程序员有安静的开发环境吗?</h3>\n<p>当回想八九十年代的软件开发环境，一片小隔间的海洋就会进入脑海。如今，情形基本没变，唯独发生变化的是，隔断变得更小了，或者隔断在所谓的“开放式”办公室里，直接消失了。</p>\n<p>我个人而言，我并不喜欢开放式办公室。我喜欢自己的办公室，我就可以拥有单独的开发时间，完全看我的喜好，我可以打开音乐，让我步入状态。然而并不是所有人都同意我的观点。我知道很多人喜欢开放式办公，这样更加有效率，促进团队成员之间直接沟通，通常可以获得更快、更好的问题解决方案。</p>\n<p>这条规则对工作环境的要求，并不是什么特例。开放式办公室，通常比你自己的办公室更加嘈杂。每当有人问起关于开放式办公室的噪音问题时，我通常的解决方案就是带上耳机。通过消音技术，基本能解决绝大多数问题。这是我平常在开放办公室的办法。</p>\n<p>总之，安静的工作环境，无非就是独立办公室和开放办公室之间的取舍，这两个也没有孰优孰劣。</p>\n<p><img id=\"pic\" class=\"M_cur_zoom_out aligncenter\" src=\"http://ww4.sinaimg.cn/large/7cc829d3gw1f5o84olqc5j20zk0qodjo.jpg\"></p>\n<p style=\"text-align: center;\">（ 《<a href=\"http://blog.jobbole.com/101501/\" target=\"_blank\">国内程序员的办公桌是什么样的？</a>》文中黄钊的晒图 ）</p>\n<p><strong><span style=\"color: #ff0000;\">更新建议：删除</span></strong></p>\n<h3 id=\"do-you-use-the-best-tools-money-can-buy\">9. 是否使用市面上最好的工具？</h3>\n<p>这一条是最难取舍的，事实上我是写完本文其他部分以后，才回头写这一部分。</p>\n<p>我通常遇到的情况是这样的，公司无法负担市面最好的工具。也就是今天无法负担而已，不代表以后不行。我认为这一条规则的精神依然是成立的。公司应当有义务，尽可能保证开发人员的工作惬意、开心。愉快、宽松的程序员会生产更好的代码。</p>\n<p>有一点一定要切记，这并不意味着必须要用重金砸向这些问题，如果优秀的工具是免费的，那肯定还是要用免费的。</p>\n<p> </p>\n<p><img id=\"pic\" class=\"M_cur_zoom_in aligncenter\" src=\"http://ww1.sinaimg.cn/large/7cc829d3gw1f5mkf3ee8wj20zk0qon0z.jpg\" width=\"734\" height=\"551\"></p>\n<p style=\"text-align: center;\">（《<span data-rel=\"title\"><a class=\"archive-title\" title=\"国外程序员的办公桌是什么样的？\" href=\"http://blog.jobbole.com/103205/\" target=\"_blank\">国外程序员的办公桌是什么样的？</a>》，</span>网友「土豆」晒图）</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：无</strong></span></p>\n<h3 id=\"do-you-have-testers\">10. 是否有测试人员？</h3>\n<p>不同公司在测试方面是有区别的。几年前，就在我还是个实习生，到成为全职之间那段时间，微软复用工程师作为测试人员。我曾撰文说明，<a href=\"https://www.quora.com/Why-is-Microsoft-merging-its-SDE-and-SDET-positions-into-the-software-engineer-title\" target=\"_blank\">为什么我认为微软复用开发和测试人员</a>，很好的说明我作为实习生浪费了多少资源，还消除了曾鼓励我编写更好代码的安全网。现在这都在微软得到印证，我们还是看看 Joel 对此是怎么说的：</p>\n<blockquote><p>如果你的团队没有专业的测试人员，至少每 2~3 个开发人员一个测试人员，你要么会交付缺陷产品，要么你让时薪 $100 的开发人员，去做时薪 $30 测试人员的工作。</p></blockquote>\n<p>我和 Joel 观点的主要不同是，对于微软而言，开发人员和测试人员是一样的，开发人员的薪酬并不是测试人员的 3 倍。测试人员花费时间，遍历代码变更，确保提交的修改可用，而且没有引入新的问题，这些都与开发人员的时间一样有价值。当然，这也算安全网。</p>\n<p>拥有测试人员是很好的选择，但是 Joel 提出了更好的观点，那就是，你千万不要浪费测试人员的价值。</p>\n<p>开发人员需要对自己的代码负责。如果你不是特别确信自己的代码无 bug，就不应当提交。这意味着你需要进行人工测试、单元测试、集成测试等等。既然在未进行代码 review 之前，代码是不可提交的，那没有进行测试，又怎么可以提交呢？</p>\n<p>测试人员不需要遍历每一个变更，但是他们需要确保，产品作为一个整体依然是稳定的。他们应该能将他们的时间投入测试模型，这远比开发人员更加有价值。有测试人员并不是最关键的，有完整有效的测试计划才是。</p>\n<p><strong><span style=\"color: #ff0000;\">更新建议：是否有完整的测试计划。</span></strong></p>\n<h3 id=\"do-new-candidates-write-code-during-their-interview\">11. 新员工面试时写代码吗？</h3>\n<p>当你在很多类似 Hacker News，或者一些  Reddit 之类开发网站搜索关键字“面试”时，结果中的文章有多少对现在的面试流程是正面评价呢？非常少！每个人都很清楚，现在的面试系统很烂，我们需要更好的选择。在某人想出更好的之前，就当现在只有这么一个办法，虽然看起来不像什么好点子，我们就将就一下吧。</p>\n<p>目前有如下一些不同的面试方法：</p>\n<ol>\n<li>白板面试。</li>\n<li>做一个家庭作业式的小项目。</li>\n<li>到公司来，与我们一起工作 6 个月，作为试用期。</li>\n</ol>\n<p>有件事我们都有共识，开发人员应该编码。既然这是他们的工作，那你就应该在这方面测试他们。就不要用查找特定的语法错误这种问题来为难他们，也不要让他们选择你的团队的工作语言了，只要确保他们可以编码即可。</p>\n<p>就像我们前面看到的，这一条也是非常常识的问题，我觉得就没必要继续保留了。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：删除。</strong></span></p>\n<h3 id=\"do-you-do-hallway-usability-testing\">12. 是否进行走廊可用性测试？</h3>\n<p>这是一条鲜为人知的规则，我们看看 Joel 的定义：</p>\n<blockquote><p>走廊可用性测试是这样的，你在走廊里，随手请一位路人，帮忙测试你刚刚编写的代码。如果如此请了 5 个人帮忙，你就可以找到代码中 95% 影响可用性的问题。</p></blockquote>\n<p>现在，如果我说走廊可用性测试是个好东西，应该不会有太多人反对吧，但是对于灰色桌面背景上的灰色工具栏，上面还有灰色按钮的情况，这就未必了。电脑用户（如今这个定义非常宽泛）通常不是特别了解其工作原理。对于专业工具，你可能需要按钮提示信息、拖拽支持、键盘快捷方式等，这样就非常棒了。然而对于 Facebook，得让你的爷爷奶奶也能用才行。这需要清晰的设计：元素之间采用高对比度，在合理的位置进行交互，还要有适合的大小。</p>\n<p>在各种情况下，需要创建用户界面和用户体验，我所说的不仅仅是常规的 UI，而是类似“以合理的方式，控制文件保存操作”这样的事，这已经不是一个开发人员能做到的了，应该由专业人员来做。现在这是专业的 UI 和 UX 设计师应该掌握的一种专业技能。</p>\n<p><span style=\"color: #ff0000;\"><strong>更新建议：是否有专业的 UI 和 UX 设计师?</strong></span></p>\n<h2>现在我们看看「Joel 测试」变成什么样了：</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654bb1c36cb595775044\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1. 所有版本都是由一个持续集成服务自动完成的吗? \r\n2. 是否生成并使用每日版本? \r\n3. 是否有问题跟踪器?\r\n4. 写代码之前修正所有 bug 吗?\r\n5. 是否有实时更新的计划表?\r\n6. 是否实时更新产品功能和使用方法的文档?\r\n7. 是否使用市面上最好的工具？\r\n8. 是否有完整的测试计划？\r\n9. 是否有专业的 UI 和 UX 设计师？</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36cb595775044-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36cb595775044-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36cb595775044-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36cb595775044-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36cb595775044-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36cb595775044-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36cb595775044-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36cb595775044-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36cb595775044-9\">9</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654bb1c36cb595775044-1\"><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span>所有版本都是由一个持续集成服务自动完成的吗<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36cb595775044-2\"><span class=\"crayon-cn\">2.</span><span class=\"crayon-h\"> </span>是否生成并使用每日版本<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36cb595775044-3\"><span class=\"crayon-cn\">3.</span><span class=\"crayon-h\"> </span>是否有问题跟踪器<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36cb595775044-4\"><span class=\"crayon-cn\">4.</span><span class=\"crayon-h\"> </span>写代码之前修正所有<span class=\"crayon-h\"> </span><span class=\"crayon-i\">bug</span><span class=\"crayon-h\"> </span>吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36cb595775044-5\"><span class=\"crayon-cn\">5.</span><span class=\"crayon-h\"> </span>是否有实时更新的计划表<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36cb595775044-6\"><span class=\"crayon-cn\">6.</span><span class=\"crayon-h\"> </span>是否实时更新产品功能和使用方法的文档<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36cb595775044-7\"><span class=\"crayon-cn\">7.</span><span class=\"crayon-h\"> </span>是否使用市面上最好的工具？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36cb595775044-8\"><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span>是否有完整的测试计划？</div><div class=\"crayon-line\" id=\"crayon-59654bb1c36cb595775044-9\"><span class=\"crayon-cn\">9.</span><span class=\"crayon-h\"> </span>是否有专业的<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UI</span><span class=\"crayon-h\"> </span>和<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UX</span><span class=\"crayon-h\"> </span>设计师？</div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>我们砍掉了部分规则，修正了其他的。但是这还没完。这只是我们如何修改已有规则，使之与时俱进，但是我们还需要新增一些如今非常重要的规则。</p>\n<h2 id=\"new-rules\">新增的 3 个规则</h2>\n<h3 id=\"does-all-code-go-through-code-review\">所有代码都经过 review 了吗？</h3>\n<p>每个人都会犯错，无论你是刚刚毕业的新人，还是身经百战的编程老司机，你都会犯错。我们总是过于依赖编译器帮我们发现错误，这并不是编译器的正确使用方法。这就是我们需要“测试”的原因。但是测试也可能失效，我们不能 100% 依赖它。对你的代码擦亮眼睛，能让你发现平时未发现的东西。除此之外，这还能让你的代码与团队代码风格保持一致，编译器通常不具备这样的能力（代码检查这个主题，我们换个机会再谈）。一致性良好的代码，可以方便团队成员阅读、使用你的代码。</p>\n<h3 id=\"do-you-have-coding-standards\">是否有编码标准？</h3>\n<p>这条规则与上面一条相互依存。编写代码非常重要，但是最终你需要能重读你的代码。很遗憾，现实并不是这样。所以，我们应该尽可能让代码易于阅读。首要任务就是，保证代码库的一致性。通过制定一系列规范，在团队内贯彻，令代码易于阅读和理解。在代码库中搜索最常用的模块、类型等等，清晰定义期望的代码风格，帮助新进开发人员逐步跟上进度，这比在开发过程中一点点明确风格要好的多。也可以在持续集成系统中，增加自动代码检查工具，推进这些代码规范。</p>\n<h3 id=\"are-new-employees-given-training\">新员工是否有培训？</h3>\n<p>这看起来显而易见，但事实上却并不常见。很多新进开发人员，加入一家公司，就立刻被投入深水区。这个过程对开发人员和公司，都是浪费。有一些会试着游起来，但是绝大多数会沉没。当你加入一家公司后，你应当获得工作所需的一些必要信息。我并不是说你应该在一间会议室里待一周，学习 HR 课程、聆听 VP 的宣讲，这确非我的本意。实际上你应该获得你所工作系统的文档，并且，有一位团队成员，给你当一段时间导师，以帮助你尽快跟上进度。没错，这意味着这个开发人员可能在培训阶段的输出会有所减少，但是在此之后，你就获得了两个开发人员，任何会算数的人，都会看出来，这事一笔值当的投资。</p>\n<h2 id=\"conclusion\">结语</h2>\n<p>那么，我们看看我们 2017 版 “Joel 测试”是怎样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654bb1c36d2056785676\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1. 所有版本都是由一个持续集成服务器自动完成的吗? \r\n2. 是否生成并使用每日版本? \r\n3. 是否有问题跟踪器?\r\n4. 写代码之前修正所有 bug 吗?\r\n5. 是否有实时更新的计划表?\r\n6. 是否实时更新产品功能和使用方法的文档?\r\n7. 是否使用市面上最好的工具？\r\n8. 是否有完整的测试计划？\r\n9. 是否有专业的 UI 和 UX 设计师？\r\n10. 所有代码都进行 review 吗？\r\n11. 是否有代码规范？\r\n12. 新员工有培训吗？</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36d2056785676-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36d2056785676-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36d2056785676-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36d2056785676-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36d2056785676-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36d2056785676-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36d2056785676-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36d2056785676-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36d2056785676-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36d2056785676-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59654bb1c36d2056785676-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654bb1c36d2056785676-12\">12</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654bb1c36d2056785676-1\"><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span>所有版本都是由一个持续集成服务器自动完成的吗<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36d2056785676-2\"><span class=\"crayon-cn\">2.</span><span class=\"crayon-h\"> </span>是否生成并使用每日版本<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36d2056785676-3\"><span class=\"crayon-cn\">3.</span><span class=\"crayon-h\"> </span>是否有问题跟踪器<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36d2056785676-4\"><span class=\"crayon-cn\">4.</span><span class=\"crayon-h\"> </span>写代码之前修正所有<span class=\"crayon-h\"> </span><span class=\"crayon-i\">bug</span><span class=\"crayon-h\"> </span>吗<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36d2056785676-5\"><span class=\"crayon-cn\">5.</span><span class=\"crayon-h\"> </span>是否有实时更新的计划表<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36d2056785676-6\"><span class=\"crayon-cn\">6.</span><span class=\"crayon-h\"> </span>是否实时更新产品功能和使用方法的文档<span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-59654bb1c36d2056785676-7\"><span class=\"crayon-cn\">7.</span><span class=\"crayon-h\"> </span>是否使用市面上最好的工具？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36d2056785676-8\"><span class=\"crayon-cn\">8.</span><span class=\"crayon-h\"> </span>是否有完整的测试计划？</div><div class=\"crayon-line\" id=\"crayon-59654bb1c36d2056785676-9\"><span class=\"crayon-cn\">9.</span><span class=\"crayon-h\"> </span>是否有专业的<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UI</span><span class=\"crayon-h\"> </span>和<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UX</span><span class=\"crayon-h\"> </span>设计师？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36d2056785676-10\"><span class=\"crayon-cn\">10.</span><span class=\"crayon-h\"> </span>所有代码都进行<span class=\"crayon-h\"> </span><span class=\"crayon-i\">review</span><span class=\"crayon-h\"> </span>吗？</div><div class=\"crayon-line\" id=\"crayon-59654bb1c36d2056785676-11\"><span class=\"crayon-cn\">11.</span><span class=\"crayon-h\"> </span>是否有代码规范？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654bb1c36d2056785676-12\"><span class=\"crayon-cn\">12.</span><span class=\"crayon-h\"> </span>新员工有培训吗？</div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>好棒耶！让我们喜大普奔地照办起来吧。</p>\n<p>还是不要了！该测试不是万金油，只是个指导意见。它是一个指导系统，而非一套完整的评估系统。一个得到满分的企业，依然可能是一家不宜工作的地方。当然，如果一家公司连 10 分都拿不到，那这是家不靠谱的公司基本没跑。只要确保你的雇主能获得 11~12 这样的高分，然后根据自己的判断来。千万不要迷信！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111551\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111551votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111551\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/alvendarthy\">alvendarthy</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/alvendarthy\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个热爱生活的家伙！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/alvendarthy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/alvendarthy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/alvendarthy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a>        </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('带着问题学习分布式系统之数据分片', '2017-07-12', 'http://blog.jobbole.com/111716/', '7005be04c2edd13df9a087263d719892', 'http://jbcdn2.b0.upaiyun.com/2017/07/9c3ebd88533763a9cc48fc406d741a1a.png', 'full/4f98c9ecf55b5d6ac63cc8ecc27f2fa194e86ad0.jpg', '0', '3', '1', 'IT技术,分布式系统', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7076731.html\">xybaby</a>   </div><p>听过很多道理，却依然过不好这一生。</p>\n<p>看过很多关于学习的技巧、方法，却没应用到自己的学习中。</p>\n<p>随着年纪变大，记忆力越来越差，整块的时间也越来越少，于是，越来越希望能够更高效的学习。学习是一种习惯也是一种能力，这种能力在上学期间养成是最好的，毕竟那个时候绝大部分时间都在学习。但很遗憾，我没有养成适合自己的、好的学习习惯。工作之后，除了在日常工作中用到的知识技术，很难通过自学掌握新的知识（偏向于专业知识，即技术）。而互联网行业的分支、知识点又是如此之多，于是会出现这样的情况，遇到一个新的知识，觉得很厉害很感兴趣，看两天，但很快就忘记了。另外，对于一些比较庞杂的技术，又无从下手，也很难坚持下去。</p>\n<p>根本的问题在于学习不系统，没有把一个个的知识点连接起来，本来这些新的知识就很少在工作中实践，如果又是一个个的信息孤岛，很快就会被遗忘。另一个问题，没有良好的规划，今天看看这里，明天看看哪里，纠结于细枝末节，忘了从整体上把握。</p>\n<p>幸好，差不多半年前开始意识到了这个问题，开始看书，看别人的博客，开始思考如何充分利用好有限的时间。自己也实践了一些想法，比如写博客，坚持写博客。也有很多没做好，比如如何学习掌握一门新技术。关于这一点，其实看了许多文章，也有很多印象深刻，觉得很有道理；也有一些好书，比如《study more，learn less》。纸上得来终觉浅，绝知此事要躬行，别人的办法再好也需要亲身实践才知道是否对自己适用。</p>\n<p>需要学习的技术很多，要自学新知识也不是一件容易的事，选择一个自己比较感兴趣的会是一个比较好的开端，于是，打算学一学分布式系统。</p>\n<p><strong>带着问题，有目的的学习，先了解整体架构，在深入感兴趣的细节</strong>，这是我的计划。</p>\n<div>首先得有问题，如果每日重复相同的工作，也不主动去学习，很难发现新的问题。不怕自己无知，就怕不知道自己无知，只有不断的学习，才会发现更多未知的知识领域！</div>\n<h3>带着问题出发</h3>\n<p>分布式要解决什么问题呢？解决持久化数据太大，单个节点的硬盘无法存储的问题；解决运算量太大，单个节点的内存、CPU无法处理的问题。解决这些问题，有两种思路：scale up，scale out。前者就是提升单个节点的能力，更大的磁盘，更快的CPU，定制的软硬件，然而这意味着更高的价格，而且再怎么scaleup 也是有上限的。后者就是把存储、计算任务分担到普通的机器上，通过动态增加节点来应对数据量的增长，但缺点是多个节点的管理、任务的调度比较麻烦，这也是分布式系统研究和解决的问题。只有当数据量达到单机无法存储、处理的情况下才考虑分布式，不然都是自找麻烦。</p>\n<div>\n<div>状态的维护比计算要难很多，所谓状态就是需要持久化的数据。因此主要考虑分布式存储，况且即使是分布式计算，为了节省带宽需要尽量保证data locality，也是需要分布式存储。</div>\n<div></div>\n<div>现在有一堆数据，可能是结构化或者半结构化，需要将数据分片（segment、fragment、shard），形成一个个的数据子集，存储到一组物理节点上，物理节点之间通过网络通信。那么需要考虑两个问题：</div>\n<div></div>\n<blockquote>\n<div>第一：数据如何划分;</div>\n<div>第二：数据的可靠性、可用性问题</div>\n</blockquote>\n<h3>数据分片</h3>\n<p>数据分片是指将数据子集尽可能均衡的划分到各个物理节点上。那么会有哪些挑战呢？</p>\n<div>\n<p>（1）如果某个物理节点宕机，如何将该物理节点负责的数据尽快的转移到其他物理节点；</p>\n</div>\n<div>\n<p>（2）如果新增了物理节点，怎么从其他节点迁移数据到新节点；</p>\n</div>\n<p>（3）对于可修改的数据（即不是只能追加的数据），比如数据库数据，如果某节点数据量变大，怎么将部分数据迁移到其他负载较小的节点，及达到动态均衡的效果。</p>\n<div>（4）元数据的管理问题：当数据分布在各个节点，那么当用户使用的时候需要知道具体的数据在哪一个节点上。因此，系统需要维护<strong>数据的元数据：即每一个数据所在的位置、状态等信息</strong>。当用户需要具体的数据时，先查询元数据，然后再去具体的节点上查询。当数据在节点之间迁移的时候，也需要更新元数据。元数据的管理节点这里称之为meta server。元数据的管理也带来了新的挑战：</div>\n<div>（4.1）如何抽取数据的特征（特征是分片的依据，也是用户查询数据时的key），或者支持用户自定义数据特征；</div>\n<p>（4.2）如何保证meta server的高性能和高可用，是单点还是复制集</p>\n<div>（5）分片的粒度，即数据子集的大小，也是数据迁移的基本单位。粒度过粗，不利于数据均衡；粒度过细，管理、迁移成本又会比较大。</div>\n<h3>数据冗余</h3>\n<div>\n<p>前面提到，分布式系统中的节点都是普通的节点，因此有一定的概率会出现物理故障，比如断电、网络不可用，这些故障导致数据的暂时不可用；另外一些故障更严重，会导致数据的丢失，比如磁盘损坏。即使单个节点的故障是小概率，当集群中的节点数目很多是，故障就成为了一个大概率事件。因此，保证数据的高可用和可靠性是分布式系统必须解决的问题。</p>\n<p>为了避免单点故障，可行的办法就是数据冗余（复制集），即将同一份数据放在不同的物理节点，甚至是不同的数据中心。如果数据是一次写，多次读那很好办，随便从哪个副本读取都行。但对于很多分布式存储系统，比如数据库，数据是持续变化的，有读有写。那么复制集会带来什么样的挑战呢，需要如何权衡呢，假设有三个副本：</p>\n<p>（1）三个副本的地位，大家都是平等的还是有主（primary、master）有次（secondary、slave），如果是平等的，那么每个节点都可以接收写操作；如果不平等，可以一个节点负责所有的写操作，所有节点都提供读操作，</p>\n<p>（2）在平等的情况下，怎么保证写入操作不冲突，保证各个节点的数据是一致的，怎么保证能读取到最新的数据</p>\n<div>　　（3）不平等的情况下</div>\n<div>　　　　（3.1）写节点怎么将变更的数据同步到其他节点，同步还是异步；</div>\n<div>　　　　（3.2）非写节点能否提供读数据，如果能够允许，会不会读取到过时的数据。</div>\n<div>　　　　（3.3）主节点是怎么产生的，当主节点宕机的时候，怎么选择出新的主节点。是有统一的复制集管理中心（记录谁主谁次，各自的状态），还是复制集自己选举出一个主节点？</div>\n<p>（4）不管复制集内部的节点是平等的，还是有集中式节点的，只要有多个数据副本，就需要考虑数据的一致性可用性问题。按照CAP理论，只能同时满足一致性 可用性 分区容错性之间的二者，不同的分布式系统需要权衡。</p>\n</div>\n</div>\n<hr>\n<p>在前文中，提出了分布式系统（尤其是分布式存储系统）需要解决的两个最主要的问题，即数据分片和数据冗余，下面这个图片（<a href=\"http://book.mixu.net/distsys/intro.html\" target=\"_blank\">来源</a>）形象生动的解释了其概念和区别：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3ebd88533763a9cc48fc406d741a1a.png\" alt=\"\"></p>\n<p>其中数据即A、B属于数据分片，原始数据被拆分成两个正交子集分布在两个节点上。而数据集C属于数据冗余，同一份完整的数据在两个节点都有存储。当然，在实际的分布式系统中，数据分片和数据冗余一般都是共存的。</p>\n<p>本文主要讨论数据分片的三个问题：</p>\n<p>（1）如何做数据分片，即如何将数据映射到节点</p>\n<p>（2）数据分片的特征值，即按照数据中的哪一个属性（字段）来分片</p>\n<p>（3）数据分片的元数据的管理，如何保证元数据服务器的高性能、高可用，如果是一组服务器，如何保证强一致性</p>\n<p>所谓分布式系统，就是利用多个独立的计算机来解决单个节点（计算机）无法处理的存储、计算问题，这是非常典型的分而治之的思想。每个节点只负责原问题（即整个系统需要完成的任务）的一个子集，那么原问题如何拆分到多个节点？在分布式存储系统中，任务的拆分即数据分片。</p>\n<p>何为数据分片（segment，fragment， shard， partition），就是按照一定的规则，将数据集划分成相互独立、正交的数据子集，然后将数据子集分布到不同的节点上。注意，这里提到，数据分片需要按照一定的规则，不同的分布式应用有不同的规则，但都遵循同样的原则：按照最主要、最频繁使用的访问方式来分片。</p>\n<h1>三种数据分片方式</h1>\n<div>　　首先介绍三种分片方式：hash方式，一致性hash（consistent hash），按照数据范围（range based）。对于任何方式，都需要思考以下几个问题：</div>\n<div>\n<ol>\n<li>具体如何划分原始数据集？</li>\n<li>当原问题的规模变大的时候，能否通过增加节点来动态适应？</li>\n<li>当某个节点故障的时候，能否将该节点上的任务均衡的分摊到其他节点？</li>\n<li>对于可修改的数据（比如数据库数据），如果某节点数据量变大，能否以及如何将部分数据迁移到其他负载较小的节点，及达到动态均衡的效果？</li>\n<li>元数据的管理（即数据与物理节点的对应关系）规模？元数据更新的频率以及复杂度？</li>\n</ol>\n<p>为了后面分析不同的数据分片方式，假设有三个物理节点，编号为N0， N1， N2；有以下几条记录：</p>\n<p>R0: {id: 95, name: ‘aa’, tag:’older’}<br>\nR1: {id: 302, name: ‘bb’,}<br>\nR2: {id: 759, name: ‘aa’,}<br>\nR3: {id: 607, name: ‘dd’, age: 18}<br>\nR4: {id: 904, name: ‘ff’,}<br>\nR5: {id: 246, name: ‘gg’,}<br>\nR6: {id: 148, name: ‘ff’,}<br>\nR7: {id: 533, name: ‘kk’,}</p>\n</div>\n<h2>hash方式：</h2>\n<p>哈希表（散列表）是最为常见的数据结构，根据记录（或者对象）的关键值将记录映射到表中的一个槽（slot），便于快速访问。绝大多数编程语言都有对hash表的支持，如python中的dict， C++中的map，Java中的Hashtable， Lua中的table等等。在哈希表中，最为简单的散列函数是 mod N（N为表的大小）。即首先将关键值计算出hash值（这里是一个整型），通过对N取余，余数即在表中的位置。</p>\n<p>数据分片的hash方式也是这个思想，即按照数据的某一特征（key）来计算哈希值，并将哈希值与系统中的节点建立映射关系,从而将哈希值不同的数据分布到不同的节点上。</p>\n<p>我们选择id作为数据分片的key，那么各个节点负责的数据如下：</p>\n<div>　　<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/60b1cd0b902642fcd732d92d826bf1d7.png\" alt=\"\" width=\"735\" height=\"173\"></div>\n<p>由此可以看到，按照hash方式做数据分片，映射关系非常简单；需要管理的元数据也非常之少，只需要记录节点的数目以及hash方式就行了。</p>\n<div>　　但hash方式的缺点也非常明显：当加入或者删除一个节点的时候，大量的数据需要移动。比如在这里增加一个节点N3，因此hash方式变为了mod 4，数据的迁移如下：</div>\n<div>　　<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a070c20a578c8728f269a7c5f88a9bc1.png\" alt=\"\"></div>\n<p>在这种方式下，是不满足单调性（Monotonicity）的：如果已经有一些内容通过哈希分派到了相应的缓冲中，又有新的缓冲加入到系统中。哈希的结果应能够保证原有已分配的内容可以被映射到原有的或者新的缓冲中去，而不会被映射到旧的缓冲集合中的其他缓冲区。</p>\n<p>在工程中，为了减少迁移的数据量，节点的数目可以成倍增长，这样概率上来讲至多有50%的数据迁移。</p>\n<div>hash方式还有一个缺点，即很难解决数据不均衡的问题。有两种情况：原始数据的特征值分布不均匀，导致大量的数据集中到一个物理节点上；第二，对于可修改的记录数据，单条记录的数据变大。在这两种情况下，都会导致节点之间的负载不均衡，而且在hash方式下很难解决。</div>\n<h2>一致性hash</h2>\n<div><a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">一致性hash</a>是将数据按照特征值映射到一个首尾相接的hash环上，同时也将节点（按照IP地址或者机器名hash）映射到这个环上。对于数据，从数据在环上的位置开始，顺时针找到的第一个节点即为数据的存储节点。这里仍然以上述的数据为例，假设id的范围为［0， 1000］，N0， N1， N2在环上的位置分别是100， 400， 800，那么hash环示意图与数据的分布如下：</div>\n<div style=\"text-align: center;\"> 　　<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/265e3dc723d195313a689e01bc6c542e.png\" alt=\"\">　　<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bba07578f38434571328a37d984025c0.png\" alt=\"\"></div>\n<p>可以看到相比于上述的hash方式，一致性hash方式需要维护的元数据额外包含了节点在环上的位置，但这个数据量也是非常小的。</p>\n<p>一致性hash在增加或者删除节点的时候，受到影响的数据是比较有限的，比如这里增加一个节点N3，其在环上的位置为600，因此，原来N2负责的范围段（400， 800］现在由N2（400， 600] N3(600, 800]负责，因此只需要将记录R2(id:759), R3(id: 607) 从N2,迁移到N3:</p>\n<div>　　不难发现一致性hash方式在增删的时候只会影响到hash环上响应的节点，不会发生大规模的数据迁移。</div>\n<p>但是，一致性hash方式在增加节点的时候，只能分摊一个已存在节点的压力；同样，在其中一个节点挂掉的时候，该节点的压力也会被全部转移到下一个节点。我们希望的是“一方有难，八方支援”，因此需要在增删节点的时候，已存在的所有节点都能参与响应，达到新的均衡状态。</p>\n<p>因此，在实际工程中，一般会引入虚拟节点（virtual node）的概念。即不是将物理节点映射在hash换上，而是将虚拟节点映射到hash环上。虚拟节点的数目远大于物理节点，因此一个物理节点需要负责多个虚拟节点的真实存储。操作数据的时候，先通过hash环找到对应的虚拟节点，再通过虚拟节点与物理节点的映射关系找到对应的物理节点。</p>\n<p>引入虚拟节点后的一致性hash需要维护的元数据也会增加：第一，虚拟节点在hash环上的问题，且虚拟节点的数目又比较多；第二，虚拟节点与物理节点的映射关系。但带来的好处是明显的，当一个物理节点失效是，hash环上多个虚拟节点失效，对应的压力也就会发散到多个其余的虚拟节点，事实上也就是多个其余的物理节点。在增加物理节点的时候同样如此。</p>\n<p>工程中，<a href=\"http://cloudgroup.neu.edu.cn/papers/cloud%20data%20storage/dynamo-sosp-2007.pdf\" target=\"_blank\">Dynamo</a>、<a href=\"https://cassandra.apache.org/%20%20%20%20\" target=\"_blank\">Cassandra</a>都使用了一致性hash算法，且在比较高的版本中都使用了虚拟节点的概念。在这些系统中，需要考虑综合考虑数据分布方式和数据副本，当引入数据副本之后，一致性hash方式也需要做相应的调整， 可以参加cassandra的相关文档。</p>\n<h2>range based</h2>\n<p>简单来说，就是按照关键值划分成不同的区间，每个物理节点负责一个或者多个区间。其实这种方式跟一致性hash有点像，可以理解为物理节点在hash环上的位置是动态变化的。</p>\n<p>还是以上面的数据举例，三个节点的数据区间分别是N0(0, 200]， N1(200, 500]， N2(500, 1000]。那么数据分布如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/97744e5665ed8d8444a5642e0e887714.png\" alt=\"\"></p>\n<p>注意，区间的大小不是固定的，每个数据区间的数据量与区间的大小也是没有关系的。比如说，一部分数据非常集中，那么区间大小应该是比较小的，即以数据量的大小为片段标准。在实际工程中，一个节点往往负责多个区间，每个区间成为一个块（chunk、block），每个块有一个阈值，当达到这个阈值之后就会分裂成两个块。这样做的目的在于当有节点加入的时候，可以快速达到均衡的目的。</p>\n<p>不知道读者有没有发现，如果一个节点负责的数据只有一个区间，range based与没有虚拟节点概念的一致性hash很类似；如果一个节点负责多个区间，range based与有虚拟节点概念的一致性hash很类似。</p>\n<p>range based的元数据管理相对复杂一些，需要记录每个节点的数据区间范围，特别单个节点对于多个区间的情况。而且，在数据可修改的情况下，如果块进行分裂，那么元数据中的区间信息也需要同步修改。</p>\n<p>range based这种数据分片方式应用非常广泛，比如MongoDB, PostgreSQL， HDFS</p>\n<h2>小结：</h2>\n<p>在这里对三种分片方式（应该是四种，有没有virtual node的一致性hash算两种）进行简单总结，主要是针对提出的几个问题：</p>\n<table cellspacing=\"0\" cellpadding=\"2\">\n<colgroup></colgroup>\n<tbody>\n<tr>\n<td></td>\n<td>映射难度</td>\n<td>元数据</td>\n<td>节点增删</td>\n<td>数据动态均衡</td>\n</tr>\n<tr>\n<td>hash方式</td>\n<td>简单</td>\n<td>非常简单，几乎不用修改</td>\n<td>需要迁移的数据比较多</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td>consistent hash<br>\nwithout virtual node</td>\n<td>简单</td>\n<td>比较简单，取决于节点规模，几乎不用修改</td>\n<td>增删节点的时候只影响hash环上相邻节点，但不能使所有节点都参与数据迁移过程</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td>consistent hash<br>\nwith virtual node</td>\n<td>中等</td>\n<td>稍微复杂一些，主要取决于虚拟节点规模，很少修改</td>\n<td>需要迁移的数据比较少，且所有节点都能贡献部分数据</td>\n<td>若支持（修改虚拟节点与物理节点映射关系）</td>\n</tr>\n<tr>\n<td>range based</td>\n<td>较为复杂</td>\n<td>取决于每个块的大小，一般来说规模较大；且修改频率较高</td>\n<td>需要迁移的数据比较少，且所有节点都能贡献部分数据</td>\n<td>支持，且比较容易</td>\n</tr>\n</tbody>\n</table>\n<p>上面的数据动态均衡，值得是上述问题的第4点，即如果某节点数据量变大，能否以及如何将部分数据迁移到其他负载较小的节点</p>\n<h1>分片特征值的选择</h1>\n<p>上面的三种方式都提到了对数据的分片是基于关键值、特征值的。这个特征值在不同的系统中有不同的叫法，比如MongoDB中的<a href=\"https://docs.mongodb.com/manual/core/sharding-shard-key/\" target=\"_blank\">sharding key</a>， Oracle中的<a href=\"https://docs.oracle.com/cd/B28359_01/server.111/b32024/partition.htm\" target=\"_blank\">Partition Key</a>，不管怎么样，这个特征值的选择都是非常非常重要的。</p>\n<p>那么。怎么选择这个特征值呢？《<a href=\"http://book.mixu.net/distsys/intro.html\" target=\"_blank\">Distributed systems for fun and profi</a>t》给出了言简意赅的标准：</p>\n<blockquote><p>　　 based on what you think the primary access pattern will be</p></blockquote>\n<p>大概翻译为：基于最常用的访问模式。访问时包括对数据的增删改查的。比如上面的列子，我们选择“id”作为分片的依据，那么就是默认对的数据增删改查都是通过“id”字段来进行的。</p>\n<p>如果在应用中，大量的数据操作都是通过这个特征值进行，那么数据分片就能提供两个额外的好处：</p>\n<p>（1）提升性能和并发，操作被分发到不同的分片，相互独立</p>\n<p>（2）提升系统的可用性，即使部分分片不能用，其他分片不会受到影响</p>\n<p>如果大量操作并没有使用到特征值，那么就很麻烦了。比如在本文的例子中，如果用name去查询，而元数据记录的是如何根据按照id映射数据位置，那就尴尬了，需要到多有分片都去查一下，然后再做一个聚合！</p>\n<p>另外一个问题，如果以单个字段为特征值（如id），那么不管按照什么分布方式，在多条数据拥有相同的特征值（如id）的情况下，这些数据一定都会分布到同一个节点上。在这种情况下有两个问题，一是不能达到节点间数据的均衡，二是如果数据超过了单个节点的存储能力怎么办？关键在于，即使按照分布式系统解决问题的常规办法 — 增加节点 –也是于事无补的。</p>\n<p>在这个时候，单个字段做特征值就不行了，可能得再增加一个字段作为“联合特征值”，类似数据库中的联合索引。比如，数据是用户的操作日志，可以使用id和时间戳一起作为hash函数的输入，然后算出特征值；但在这种情况下，如果还想以id为查询关键字来查询，那就得遍历所有节点了。</p>\n<p>所以说没有最优的设计，只有最符合应用需求的设计。</p>\n<p>下面以MongoDB中的sharding key为例，解释特征值选择的重要性以及对数据操作的影响。如果有数据库操作基础，即使没有使用过MongoDB，阅读下面的内容应该也没有问题。</p>\n<h2>以MongoDB sharding key为例</h2>\n<p>关于MongoDB Sharded cluster，之前也写过一篇文章《<a href=\"http://www.cnblogs.com/xybaby/p/6832296.html\" target=\"_blank\">通过一步步创建sharded cluster来认识mongodb</a>》，做了简单介绍。在我的工作场景中，除了联合查询（join）和事务，MongoDB的使用和Mysql还是比较相似的，特别是基本的CRUD操作、数据库索引。MongoDb中，每一个分片成为一个shard，分片的特征值成为sharding key，每个数据称之为一个document。选择适合的字段作为shardingkey非常重要，why？</p>\n<p>前面也提到，如果使用非sharding key去访问数据，那么元数据服务器（或者元数据缓存服务器，后面会讲解这一部分）是没法知道对应的数据在哪一个shard上，那么该访问就得发送到所有的shard，得到所有shard的结果之后再做聚合，在mongoDB中，由mongos（缓存有元数据信息）做数据聚合。对于数据读取（R： read or retrieve），通过同一个字段获取到多个数据，是没有问题的，只是效率比较低而已。对于数据更新，如果只能更新一个数据，那么在哪一个shard上更新呢，似乎都不对，这个时候，MongoDB是拒绝的。对应到MongoDB（MongoDD3.0）的命令包括但不限于：</p>\n<ul>\n<li>　　findandmodify：这个命令只能更新一个document，因此查询部分必须包含sharding key</li>\n</ul>\n<blockquote><p>　　When using <code>findAndModify</code> in a sharded environment, the <code>query</code> must contain the shard key for all operations against the shard cluster for the <em>sharded</em> collections.</p></blockquote>\n<ul>\n<li>　　update：这个命令有一个参数multi，默认是false，即只能更新一个document，此时查询部分必须包含sharding key</li>\n</ul>\n<blockquote>\n<div>All <code>update()</code> operations for a sharded collection that specify the <code>multi: false</code> option must include theshard key <em>or</em> the <code>_id</code> field in the query specification.</div>\n</blockquote>\n<ul>\n<li> 　  remove：有一个参数JustOne，如果为True，只能删除一个document，也必须使用sharidng key</li>\n</ul>\n<p>另外，熟悉sql的同学都知道，在数据中索引中有unique index（唯一索引），即保证这个字段的值在table中是唯一的。mongoDB中，也可以建立unique index，但是在sharded cluster环境下，只能对sharding key创建unique index，道理也很简单，如果unique index不是sharidng key，那么插入的时候就得去所有shard上查看，而且还得加锁。</p>\n<p>接下来，讨论分片到shard上的数据不均的问题，如果一段时间内shardkey过于集中（比如按时间增长），那么数据只往一个shard写入，导致无法平衡集群压力。</p>\n<div>　　MongoDB中提供了”<a href=\"https://docs.mongodb.com/manual/core/ranged-sharding/\" target=\"_blank\">range partition</a>“和”<a href=\"https://docs.mongodb.com/manual/core/hashed-sharding/\" target=\"_blank\">hash partition</a>“，<strong>这个跟上面提到的分片方式 hash方式， ranged based不是一回事儿</strong>，而是指对sharding key处理。MongoDB一定是ranged base分片方式,<a href=\"https://docs.mongodb.com/manual/core/sharding-shard-key/\" target=\"_blank\">docuemnt</a>中如是说：</div>\n<blockquote>\n<div>MongoDB <a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-data-partition\">partitions</a> data in the collection using ranges of shard key values. Each range defines a non-overlapping range of shard key values and is associated with a <a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-chunk\">chunk</a>.</div>\n</blockquote>\n<p>那么什么是”range partition”和”hash partition”，官网的一张图很好说明了二者的区别：</p>\n<p style=\"text-align: center;\">　　<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4f75dba562d78dd3cf88e6a0420a83b6.png\" alt=\"\" width=\"496\" height=\"248\">            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/13aa93953848ef771a508070a6e68ee7.png\" alt=\"\" width=\"504\" height=\"252\"></p>\n<p>　　上图左是range partition，右是hash partition。range partition就是使用字段本身作为分片的边界，比如上图的x；而hash partition会将字段重新hash到一个更大、更离散的值域区间。</p>\n<p>hash partition的最大好处在于保证数据在各个节点上均匀分布（这里的均匀指的是在写入的时候就均匀，而不是通过MongoDB的balancing功能）。比如MongoDB中默认的_id是objectid，objectid是一个12个字节的BSON类型，前4个字节是机器的时间戳，那么如果在同一时间大量创建以ObjectId为_id的数据 会分配到同一个shard上，此时若将_id设置为hash index 和 hash sharding key，就不会有这个问题。</p>\n<p>当然，hash  partition相比range partition也有一个很大的缺点，就是范围查询的时候效率低！因此到底选用hash  partition还是range partition还得根据应用场景来具体讨论。</p>\n<p>最后得知道，sharding key一但选定，就无法修改（Immutable）。如果应用必须要修改sharidng key，那么只能将数据导出，新建数据库并创建新的sharding key，最后导入数据。</p>\n<h1>元数据服务器</h1>\n<p>在上面讨论的三种数据分片分式中，或多或少都会记录一些元数据：数据与节点的映射关系、节点状态等等。我们称记录元数据的服务器为元数据服务器（metaserver），不同的系统叫法不一样，比如master、configserver、namenode等。</p>\n<p>元数据服务器就像人类的大脑，一只手不能用了还没忍受，大脑不工作整个人就瘫痪了。因此，元数据服务器的<strong>高性能、高可用</strong>，要达到这两个目标，元数据服务器就得高<strong>可扩展</strong> — 以此应对元数据的增长。</p>\n<p>元数据的高可用要求元数据服务器不能成为故障单点（single point of failure），因此需要元数据服务器有多个备份，并且能够在故障的时候迅速切换。</p>\n<p>有多个备份，那么问题就来了，怎么保证多个备份的数据一致性？</p>\n<p>多个副本的一致性、可用性是CAP理论讨论的范畴，这里简单介绍两种方案。第一种是主从同步，首先选出主服务器，只有主服务器提供对外服务，主服务器将元数据的变革信息以日志的方式持久化到共享存储（例如nfs），然后从服务器从共享存储读取日志并应用，达到与主服务器一致的状态，如果主服务器被检测到故障（比如通过心跳），那么会重新选出新的主服务器。第二种方式，通过分布式一致性协议来达到多个副本件的一致，比如大名鼎鼎的Paxos协议，以及工程中使用较多的Paxos的特化版本 — Raft协议，协议可以实现所有备份均可以提供对外服务，并且保证强一致性。</p>\n<h2>HDFS元数据</h2>\n<p>HDFS中，元数据服务器被称之为namenode，在hdfs1.0之前，namenode还是单点，一旦namenode挂掉，整个系统就无法工作。在hdfs2.0，解决了namenode的单点问题。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8221eac439b32bd000638097d281c3bb.png\" alt=\"\"></p>\n<p>上图中NN即NameNode， DN即DataNode（即实际存储数据的节点）。从图中可以看到， 两台 NameNode 形成互备，一台处于 Active 状态，为主 NameNode，另外一台处于 Standby 状态，为备 NameNode，<strong>只有主 NameNode 才能对外提供读写服务</strong>。</p>\n<p>Active NN与standby NN之间的数据同步通过共享存储实现，共享存储系统保证了Namenode的高可用。为了保证元数据的强一致性，在进行准备切换的时候，新的Active NN必须要在确认元数据完全同步之后才能继续对外提供服务。</p>\n<p>另外，Namenode的状态监控以及准备切换都是Zookeeper集群负责，在网络分割（network partition）的情况下，有可能zookeeper认为原来的Active NN挂掉了，选举出新的ActiveNN，但实际上原来的Active NN还在继续提供服务。这就导致了“双主“或者脑裂（brain-split）现象。为了解决这个问题，提出了fencing机制，也就是想办法把旧的 Active NameNode 隔离起来，使它不能正常对外提供服务。具体参见<a href=\"https://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop-name-node/\" target=\"_blank\">这篇文章</a>。</p>\n<h2>MongoDB元数据</h2>\n<p>MongoDB中，元数据服务器被称为config server。在MongoDB3.2中，已经不再建议使用三个镜像(Mirrored)MongoDB实例作为config server，而是推荐使用复制集（replica set）作为config server，此举的目的是增强config server的一致性，而且config sever中mongod的数目也能从3个达到replica set的上线（50个节点），从而提高了可靠性。</p>\n<p>在MongoDB3.0及之前的版本中，元数据的读写按照下面的方式进行：</p>\n<blockquote><p>　　When writing to the three config servers, a <strong>coordinator</strong> dispatches the same write commands to the three config servers and collects the results. Differing results indicate an inconsistent writes to the config servers and may require manual intervention.</p></blockquote>\n<p>MongoDB的官方文档并没有详细解释这一过程，不过在<a href=\"https://dba.stackexchange.com/questions/91194/why-does-mongodb-require-three-config-servers\" target=\"_blank\">stackexchange</a>上，有人指出这个过程是两阶段提交。</p>\n<p>MongoDB3.2及之后的版本，使用了replica set config server，在《<a href=\"http://www.cnblogs.com/xybaby/p/6871764.html\" target=\"_blank\">CAP理论与MongoDB一致性、可用性的一些思考</a>》文章中，详细介绍了replica set的write concern、read concern和read references，这三个选项会影响到复制集的一致性、可靠性与读取性能。在config server中，使用了WriteConcern：Majority；ReadConcern：Majority；ReadReferences：nearest。</p>\n<h2>元数据的缓存：</h2>\n<p>即使元数据服务器可以由一组物理机器组成，也保证了副本集之间的一致性问题。但是如果每次对数据的请求都经过元数据服务器的话，元数据服务器的压力也是非常大的。很多应用场景，元数据的变化并不是很频繁，因此可以在访问节点上做缓存，这样应用可以直接利用缓存数据进行数据读写，减轻元数据服务器压力。</p>\n<p>在这个环境下，缓存的元数据必须与元数据服务器上的元数据一致，缓存的元数据必须是准确的，未过时的。相反的例子是DNS之类的缓存，即使使用了过期的DNS缓存也不会有太大的问题。</p>\n<p>怎么达到缓存的强一致性呢？比较容易想到的办法是当metadata变化的时候立即通知所有的缓存服务器（mongos），但问题是通信有延时，不可靠。</p>\n<p>解决不一致的问题，一个比较常见的思路是版本号，比如网络通信，通信协议可能会发生变化，通信双方为了达成一致，那么可以使用版本号。在缓存一致性的问题上，也可以使用版本号，基本思路是请求的时候带上缓存的版本号，路由到具体节点之后比较实际数据的版本号，如果版本号不一致，那么表示缓存信息过旧，此时需要从元数据服务器重新拉取元数据并缓存。在MongoDB中，mongos缓存上就是使用的这种办法。</p>\n<p>另外一种解决办法，就是大名鼎鼎的lease机制 — “An Efficient Fault-Tolerant Mechanism for Distributed File Cache Consistency”，lease机制在分布式系统中使用非常广泛，不仅仅用于分布式缓存，在很多需要达成某种约定的地方都大显身手，在《分布式系统原理介绍》中，对lease机制有较为详细的描述，下面对lease机制进行简单介绍。</p>\n<h2>Lease机制：</h2>\n<p>既然，Lease机制提出的时候是为了解决分布式存储系统中缓存一致性的问题，那么首先来看看Lease机制是怎么保证缓存的强一致性的。<strong>注意</strong>，为了方便后文描述，在本小节中，我们称元数据服务器为服务器，缓存服务器为客户端。</p>\n<p><strong>要点</strong>：</p>\n<ul>\n<li>　　服务器向所有客户端发送缓存数据的同时，颁发一个lease，lease包含一个有限期（即过期时间）</li>\n<li>　　lease的含义是：在这个有效期内，服务器保证元数据不会发生变化</li>\n<li>　　因此客户端在这个有效期内可以放心大胆的使用缓存的元数据，如果超过了有效期，就不能使用数据了，就得去服务器请求。</li>\n<li>　　如果外部请求修改服务器上的元数据（元数据的修改一定在服务器上进行），那么服务器会阻塞修改请求，直到所有已颁发的lease过期，然后修改元数据，并将新的元数据和新的lease发送到客户端</li>\n<li>　　如果元数据没有发生变化，那么服务器也需要在之前已颁发的lease到期之间，重新给客户端颁发新的lease（只有lease，没有数据）</li>\n</ul>\n<p>在Lease论文的标题中，提到了“Fault-Tolerant”，那么lease是怎么做到容错的呢。关键在于，只要服务器一旦发出数据和lease，不关心客户端是否收到数据，只要等待lease过期，就可以修改元数据；另外，lease的有效期通过过期时间（一个时间戳）来标识，因此即使从服务器到客户端的消息延时到达、或者重复发送都是没有关系的。</p>\n<p>不难发现，容错的前提是服务器与客户端的时间要一致。如果服务器的时间比客户端的时间慢，那么客户端收到lease之后很快就过期了，lease机制就发挥不了作用；如果服务器的时间比客户端的时间快，那么就比较危险，因为客户端会在服务器已经开始更新元数据的时候继续使用缓存，工程中，通常将服务器的过期时间设置得比客户端的略大，来解决这个问题。为了保持时间的一致，最好的办法是使用NTP（Network Time Protocol）来保证时钟同步。</p>\n<p>Lease机制的本质是颁发者授予的在某一有效期内的承诺，承诺的范围是非常广泛的：比如上面提到的cache；比如做权限控制，例如当需要做并发控制时，同一时刻只给某一个节点颁发lease，只有持有lease的节点才可以修改数据；比如身份验证，例如在primary-secondary架构中，给节点颁发lease，只有持有lease的节点才具有primary身份；比如节点的状态监测，例如在primary-secondary架构中监测primary是否正常，这个后文再详细介绍。</p>\n<p>工程中，lease机制也有大量的应用：GFS中使用Lease确定Chuck的Primary副本, Lease由Master节点颁发给primary副本，持有Lease的副本成为primary副本。chubby通过paxos协议实现去中心化的选择primary节点，然后Secondary节点向primary节点发送lease，该lease的含义是：“承诺在lease时间内，不选举其他节点成为primary节点”。chubby中，primary节点也会向每个client节点颁发lease。该lease的含义是用来判断client的死活状态，一个client节点只有只有合法的lease，才能与chubby中的primary进行读写操作。</p>\n<h1>总结</h1>\n<p>本文主要介绍分布式系统中的分片相关问题，包括三种分布方式：hash、一致性hash、range based，以及各自的优缺点。分片都是按照一定的特征值来进行，特征值应该从应用的使用场景来选取，并结合MongoDB展示了特征值（mongodb中的sharding key）对数据操作的影响。分片信息（即元数据）需要专门的服务器存储，元数据服务器是分布式存储系统的核心，因此需要提到其可用性和可靠性，为了减轻元数据服务器的压力，分布式系统中，会在其他节点缓存元数据，缓存的元数据由带来了一致性的挑战，由此引入了Lease机制。</p>\n<h1>references</h1>\n<ul>\n<li>刘杰的《分布式系统原理介绍》</li>\n<li><a href=\"http://book.mixu.net/distsys/\" target=\"_blank\">Distributed systems for fun and profit  </a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">Wiki：Consistent_hashing</a></li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop-name-node/\" target=\"_blank\">Hadoop NameNode 高可用 (High Availability) 实现解析</a></li>\n<li><a href=\"http://www.cnblogs.com/xybaby/p/6871764.html\" target=\"_blank\">CAP理论与MongoDB一致性、可用性的一些思考</a></li>\n<li><a href=\"http://web.eecs.umich.edu/~mosharaf/Readings/Leases.pdf\" target=\"_blank\">Leases: An Efficient Fault-Tolerant Mechanism for Distributed File Cache Consistency</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111716\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111716votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111716\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('实例详解贝叶斯推理的原理', '2017-07-12', 'http://blog.jobbole.com/111399/', '823bb661f6166a2a99761141fa9d7c86', 'http://wx4.sinaimg.cn/mw690/6941baebly1fgiqen6xoij20dz09943b.jpg', 'full/25baaf1aee981547da4ca064aa19b977ec266622.jpg', '6', '2', '2', 'IT技术,,数学,贝叶斯', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qiaofeng\">乔永琪</a> 翻译，<a href=\"http://www.jobbole.com/members/tangyouhua\">唐尤华</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.kdnuggets.com/2016/11/how-bayesian-inference-works.html\">Brandon Rohrer</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>注：Brandon Rohrer 的原<a href=\"https://youtu.be/5NMxiOGL39M\">视频 </a>+ <a href=\"https://docs.google.com/presentation/d/1325yenZP_VdHoVj-tU0AnbQUxFwb8Fl1VdyAAUxEzfg/edit?usp=sharing\">原PPT</a>。（需梯子）</p>\n<p>贝叶斯推理是一种精确的数据预测方式。在数据没有期望的那么多，但却想毫无遗漏地，全面地获取预测信息时非常有用。</p>\n<p>提及贝叶斯推理时，人们时常会带着一种敬仰的心情。其实并非想象中那么富有魔力，或是神秘。尽管贝叶斯推理背后的数学越来越缜密和复杂，但其背后概念还是非常容易理解。简言之，贝叶斯推理有助于大家得到更有力的结论，将其置于已知的答案中。</p>\n<p>贝叶斯推理理念源自托马斯贝叶斯。三百年前，他是一位从不循规蹈矩的教会长老院牧师。贝叶斯写过两本书，一本关于神学，一本关于概率。他的工作就包括今天著名的贝叶斯定理雏形，自此以后应用于推理问题，以及有根据猜测（educated guessing）术语中。贝叶斯理念如此流行，得益于一位名叫理查·布莱斯牧师的大力推崇。此人意识到这份定理的重要性后，将其优化完善并发表。因此，此定理变得更加准确。也因此，历史上将贝叶斯定理称之为 Bayes-Price法则。</p>\n<p>译者注：educated guessing 基于(或根据)经验(或专业知识、手头资料、事实等)所作的估计(或预测、猜测、意见等)</p>\n<h3>影院中的贝叶斯推理</h3>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqen6xoij20dz09943b.jpg\"></p>\n<p>试想一下，你前往影院观影，前面观影的小伙伴门票掉了，此时你想引起他们的注意。此图是他们的背影图。你无法分辨他们的性别，仅仅知道他们留了长头发。那你是说，女士打扰一下，还是说，先生打扰一下。考虑到你对男人和女人发型的认知，或许你会认为这位是位女士。（本例很简单，只存在两种发长和性别）</p>\n<p>现在将上面的情形稍加变化，此人正在排队准备进入男士休息室。依靠这个额外的信息，或许你会认为这位是位男士。此例采用常识和背景知识即可完成判断，无需思考。而贝叶斯推理是此方式的数学实现形式，得益于此，我们可以做出更加精确的预测。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqelzhcfj20qo0f0aid.jpg\"></p>\n<p>我们为电影院遇到的困境加上数字。首先假定影院中男女各占一半，100个人中，50个男人，50个女人。女人中，一半为长发，余下的25人为短发。而男人中，48位为短发，两位为长发。存在25个长发女人和2位长发男人，由此推断，门票持有者为女士的可能性很大。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqel8q49j20qo0f0112.jpg\"></p>\n<p>100个在男士休息室外排队，其中98名男士，2位女士为陪同。长发女人和短发女人依旧对半分，但此处仅仅各占一种。而男士长发和短发的比例依旧保持不变，按照98位男士算，此刻短发男士有94人，长发为4人。考虑到有一位长发女士和四位长发男士，此刻最有可能的是持票者为男士。这是贝叶斯推理原理的具体案例。事先知晓一个重要的信息线索，门票持有者在男士休息室外排队，可以帮助我们做出更好的预测。</p>\n<p>为了清晰地阐述贝叶斯推理，需要花些时间清晰地定义我们的理念。不幸的是，这需要用到数学知识。除非不得已，我尽量避免此过程太过深奥，紧随我查看更多的小节，必定会从中受益。为了大家能够建立一个基础，我们需要快速地提及四个概念：概率、条件概率、联合概率以及边际概率。</p>\n<h3>概率</h3>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqekghoyj20qo0f0js1.jpg\"></p>\n<p>一件事发生的概率，等于该事件发生的数目除以所有事件发生的数目。观影者为一个女士的概率为50位女士除以100位观影者，即0.5 或50%。换作男士亦如此。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqejzd9nj20qo0f00tf.jpg\"></p>\n<p>而在男士休息室排列此种情形下，女士概率降至0.02，男士的概率为0.98。</p>\n<h3>条件概率</h3>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqejg0fhj20qo0f0t9g.jpg\"></p>\n<p>条件概率回答了这样的问题，倘若我知道此人是位女士，其为长发的概率是多少？条件概率的计算方式和直接得到的概率一样，但它们更像所有例子中满足某个特定条件的子集。本例中，此人为女士，拥有长发的人士的条件概率，P(long hair | woman)为拥有长发的女士数目，除以女士的总数，其结果为0.5。无论我们是否考虑男士休息室外排队，或整个影院。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqeiwvvgj20qo0f0js1.jpg\"></p>\n<p>同样的道理，此人为男士，拥有长发的条件概率，P(long hair | man)为0.4，不管其是否在队列中。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqeiees3j20cu09iwkd.jpg\"></p>\n<p>很重要的一点，条件概率P(A | B)并不等同于P(B | A)。比如P(cute | puppy)不同于P(puppy | cute)。倘若我抱着的是小狗，可爱的概率是很高的。倘若我抱着一个可爱的东西，成为小狗的概率中等偏下。它有可能是小猫、小兔子、刺猬，甚至一个小人。</p>\n<h3>联合概率</h3>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqehgnuvj20qo0f0jrx.jpg\"></p>\n<p>联合概率适合回答这样的问题，此人为一个短发女人的概率为多少？找出答案需要两步。首先，我们先看概率是女人的概率，P(woman)。接着，我们给出头发短人士的概率，考虑到此人为女士，P(short hair | woman)。通过乘法，进行联合，给出联合概率，P(woman with short hair) = P(woman) * P(short hair | woman)。利用此方法，我们便可计算出我们已知的概率，所有观影中P(woman with long hair)为0.25，而在男士休息室队列中的P(woman with long hair)为0.1。不同是因为两个案例中的P(woman)不同。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqegyts7j20qo0f0q3n.jpg\"></p>\n<p>相似的，观影者中P(man with long hair) 为0.02，而在男士休息室队列中概率为0.04。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqeg3kcvj209v0bhgru.jpg\"></p>\n<p>和条件概率不同，联合概率和顺序无关，P(A and B)等同于P(B and A)。比如，同时拥有牛奶和油炸圈饼的概率，等同于拥有油炸圈饼和牛奶的概率。</p>\n<h3>边际概率</h3>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqef7izlj20qo0f0wf2.jpg\"></p>\n<p>我们最后一个基础之旅为边际概率。特别适合回答这样的问题，拥有长发人士的概率？为计算出结果，我们须累加此事发生的所有概率——即男士留长发的概率加女士留长发的概率。加上这两个概率，即给出所有观影者P(long hair)的值0.27，而男休息室队列中的P(long hair)为0.05。</p>\n<h3>贝叶斯定理</h3>\n<p>现在到了我们真正关心的部分。我们想回答这样的问题，倘若我们知道拥有长发的人士，那他们是位女士或男士的概率为？这是一个条件概率，P(man | long hair)，为我们已知晓的P(long hair | man)逆方式。因为条件概率不可逆，因此，我们对这个新条件概率知之甚少。</p>\n<p>幸运的是托马斯观察到一些很酷炫的知识可以帮到我们。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvuu70uj20hk03caa8.jpg\"></p>\n<p>根据联合概率计算规则，我们给出方程P(man with long hair)和P(long hair and man)。因为联合概率可逆，因此这两个方程等价。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvtttirj20jk06c750.jpg\"></p>\n<p>借助一点代数知识，我们就能解出P(man | long hair)。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqvtcst3j20jm039jrm.jpg\"><br>\n表达式采用A和B，替换“man”和“long hair”，于是我们得到贝叶斯定理。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqvt0iq2j20gq05zjrh.jpg\"></p>\n<p>我们回到最初，借助贝叶斯定理，解决电影院门票困境。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqvsjn41j20qo0f074o.jpg\"></p>\n<p>首先，需要计算边际概率P(long hair)。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqvs4k73j20qo0f0dgf.jpg\"></p>\n<p>接着代入数据，计算出长发中是男士的概率。对于男士休息室队列中的观影者而言，P(man | long hair)微微0.8。这让我们更加确信一直觉，掉门票的可能是一男士。贝叶斯定理抓住了在此情形下的直觉。更重要的是，更重要的是吸纳了先验知识，男士休息室外队列中男士远多于女士。借用此先验知识，更新我们对一这情形的认识。</p>\n<h3>概率分布</h3>\n<p>诸如影院困境这样的例子，很好地解释了贝叶斯推理的由来，以及作用机制。然而，在数据科学应用领域，此推理常常用于数据解释。有了我们测出来的先验知识，借助小数据集便可得出更好的结论。在开始细说之前，请先允许我先介绍点别的。就是我们需要清楚一个概率分布。</p>\n<p>此处可以这样考虑概率，一壶咖啡正好装满一个杯子。倘若用一个杯子来装没有问题，那不止一个杯子呢，你需考虑如何将这些咖啡分这些杯子中。当然你可以按照自己的意愿，只要将所有咖啡放入某个杯子中。而在电影院，一个杯子或许代表女士或者男士。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvrk4xaj20qo0f0t90.jpg\"></p>\n<p>或者我们用四个杯子代表性别和发长的所有组合分布。这两个案例中，总咖啡数量累加起来为一杯。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqvr5m4wj20qo0f0dg6.jpg\"></p>\n<p>通常，我们将杯子挨个摆放，看其中的咖啡量就像一个柱状图。咖啡就像一种信仰，此概率分布用于显示我们相信某件事情的强烈程度。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqvqqv0wj20qo0f03yk.jpg\"></p>\n<p>假设我投了一块硬币，然后盖住它，你会认为正面和反面朝上的几率是一样的。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvqfjhzj20qo0f0wej.jpg\"></p>\n<p>假设我投了一个骰子，然后盖住它，你会认为六个面中的每一个面朝上的几率是一样的。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvq2e9mj20qo0f0t8x.jpg\"></p>\n<p>假设我买了一期强力球彩票，你会认为中奖的可能性微乎其微。投硬币、投骰子、强力球彩票的结果，都可以视为收集、测量数据的例子。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqvpb2i5j20qo0f0glw.jpg\"></p>\n<p>毫无意外，你也可以对其它数据持有某种看法。这里我们考虑美国成年人的身高，倘若我告诉你，我见过，并测量了某些人的身高，那你对他们身高的看法，或许如上图所示。此观点认为一个人的身高可能介于150和200cm之间，最有可能的是介于180和190cm之间。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqvox3z1j20qo0f0mxk.jpg\"></p>\n<p>此分布可以分成更多的方格，视作将有限的咖啡放入更多的杯子，以期获得一组更加细颗粒度的观点。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvo9x54j20qo0f0aah.jpg\"></p>\n<p>最终虚拟的杯子数量将非常大，以至于这样的比喻变得不恰当。这样，分布变得连续。运用的数学方法可能有点变化，但底层的理念还是很有用。此图表明了你对某一事物认知的概率分布。</p>\n<p>感谢你们这么有耐心！！有了对概率分布的介绍，我们便可采用贝叶斯定理进行数据解析了。为了说明这个，我以我家小狗称重为例。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqvnqnv2j20e90d914x.jpg\"></p>\n<h3>兽医领域的贝叶斯推理</h3>\n<p>它叫雅各宾当政，每次我们去兽医诊所，它在秤上总是各种晃动，因此很难读取一个准确的数据。得到一个准确的体重数据很重要，这是因为，倘若它的体重有所上升，那么我们就得减少其食物的摄入量。它喜欢食物胜过它自己，所以说风险蛮大的。</p>\n<p>最近一次，在它丧失耐心前，我们测了三次：13.9镑,17.5镑以及14.1镑。这是针对其所做的标准统计分析。计算这一组数字的均值，标准偏差，标准差，便可得到小狗当政的准确体重分布。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvkrzfmj20qo0f0t98.jpg\"></p>\n<p>分布展示了我们认为的小狗体重，这是一个均值15.2镑，标准差1.2镑的正态分布。真实得测量如白线所示。不幸的是，这个曲线并非理想的宽度。尽管这个峰值为15.2镑，但概率分布显示，在13镑很容易就到达一个低值，在17镑到达一个高值。太过宽泛以致无法做出一个确信的决策。面对如此情形，通常的策略是返回并收集更多的数据，但在一些案例中此法操作性不强，或成本高昂。本例中，小狗当政的（Reign ）耐心已经耗尽，这是我们仅有的测量数据。</p>\n<p>此时我们需要贝叶斯定理，帮助我们处理小规模数据集。在使用定理前，我们有必要重新回顾一下这个方程，查看每个术语。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqvkacmhg20jq0b340y.gif\"></p>\n<p>我们用“w” (weight)和 “m” (measurements)替换“A” and “B” ，以便更清晰地表示我们如何用此定理。四个术语分别代表此过程的不同部分。</p>\n<p>先验概率，P(w)，表示已有的事物认知。本例中，表示未称量时，我们认为的当政体重w。</p>\n<p>似然值，P(m | w)，表示针对某个具体体重w所测的值m。又叫似然数据。</p>\n<p>后验概率，P(w | m)，表示称量后，当政为某个体重w的概率。当然这是我们最感兴趣的。</p>\n<p>译者注：后验概率，通常情况下，等于似然值乘以先验值。是我们对于世界的内在认知。</p>\n<p>概率数据，P(m)，表示某个数据点被测到的概率。本例中，我们假定它为一个常量，且测量本身没有偏向。</p>\n<p>对于完美的不可知论者来说，也不是什么特别糟糕的事情，而且无需对结果做出什么假设。例如本例中，即便假定当Reign的体重为13镑、或1镑，或1000000 镑，让数据说话。我们先假定一个均一的先验概率，即对所有值而言，概率分布就一常量值。贝叶斯定理便可简化为P(w | m) = P(m | w)。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fgiqviwr9lg20jq0b3482.gif\"></p>\n<p>此刻，借助Reign的每个可能体重，我们计算出三个测量的似然值。比如，倘若当政的体重为1000镑，极端的测量值是不太可能的。然而，倘若当政的体重为14镑或16镑。我们可以遍历所有，利用Reign的每一个假设体重值，计算出测量的似然值。这便是P(m | w)。得益于这个均一的先验概率，它等同于后验概率分布 P(w | m)。</p>\n<p>这并非偶然。通过均值、标准偏差、标准差得来的，很像答案。实际上，它们是一样的，采用一个均一的先验概率给出传统的统计估测结果。峰值所在的曲线位置，均值，15.2镑也叫体重的极大似然估计（MLE）。</p>\n<p>即使采用了贝叶斯定理，但依旧离有用的估计很远。为此，我们需要非均一先验概率。先验分布表示未测量情形下对某事物的认知。均一的先验概率认为每个可能的结果都是均等的，通常都很罕见。在测量时，对某些量已有些认识。年龄总是大于零，温度总是大于-276摄氏度。成年人身高罕有超过8英尺的。某些时候，我们拥有额外的领域知识，一些值很有可能出现在其它值中。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqvg3k1cj20qo0f03yy.jpg\"></p>\n<p>在Reign的案例中，我确实拥有其它的信息。我知道上次它在兽医诊所称到的体重是14.2镑。我还知道它并不是特别显胖或显瘦，即便我的胳膊对重量不是特别敏感。有鉴于此，它大概重14.2镑，相差一两镑上下。为此，我选用峰值为14.2镑。标准偏差为0.5镑的正态分布。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fgiqvfhe8pg20qo0f07aq.gif\"></p>\n<p>先验概率已经就绪，我们重复计算后验概率。为此，我们考虑某一概率，此时Reign体重为某一特定值，比如17镑。接着，17镑这一似然值乘以测量值为17这一条件概率。接着，对于其它可能的体重，我们重复这一过程。先验概率的作用是降低某些概率，扩大另一些概率。本例中，在区间13-15镑增加更多的测量值，以外的区间则减少更多的测量值。这与均一先验概率不同，给出一个恰当的概率，当政的真实体重为17镑。借助非均匀的先验概率，17镑掉入分布式的尾部。乘以此概率值使得体重为17镑的似然值变低。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fgiqvd2rrkj20qo0f0dgo.jpg\"></p>\n<p>通过计算当政每一个可能的体重概率，我们得到一个新的后验概率。后验概率分布的峰值也叫最大后验概率（MAP），本例为14.1镑。这和均一先验概率有明显的不同。此峰值更窄，有助于我们做出一个更可信的估测。现在来看，小狗当政的体重变化不大，它的体型依旧如前。</p>\n<p>通过吸收已有的测量认知，我们可以做出一个更加准确的估测，其可信度高于其他方法。这有助于我们更好地使用小量数据集。先验概率赋予17.5镑的测量值是一个比较低的概率。这几乎等同于反对此偏离正常值的测量值。不同于直觉和常识的异常检测方式，贝叶斯定理有助于我们采用数学的方式进行异常检测。</p>\n<p>另外，假定术语P(m)是均一的，但恰巧我们知道称量存在某种程度的偏好，这将反映在P(m)中。若称量仅输出某些数字，或返回读数2.0，占整个时间的百分之10，或第三次尝试产生一个随机测量值，均需要手动修改P(m)以反映这一现象，以便后验概率更加准确。</p>\n<h3>规避贝叶斯陷阱</h3>\n<p>探究Reign的真实体重体现了贝叶斯的优势。但这也存在某些陷阱。通过一些假设我们改进了估测，而测量某些事物的目的就是为了了解它。倘若我们假定对某一答案有所了解，我们可能会删改此数据。马克·吐温对强先验的危害做了简明地阐述，“将你陷入困境的不是你所不知道的，而是你知道的那些看似正确的东西。”</p>\n<p>假如采取强先验假设，当Reign的体重在13与15镑之间，再假如其真实体重为12.5镑，我们将无法探测到。先验认知认为此结果的概率为零，不论做多少次测量，低于13镑的测量值都认为无效。</p>\n<p>幸运的是，有一种两面下注的办法，可以规避这种盲目地删除。针对对于每一个结果至少赋予一个小的概率，倘若借助物理领域的一些奇思妙想，当政确实能称到1000镑，那我们收集的测量值也能反映在后验概率中。这也是正态分布作为先验概率的原因之一。此分布集中了我们对一小撮结果的大多数认识，不管怎么延展，其尾部再长都不会为零。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fgiqvbjmplj20870a3tck.jpg\"></p>\n<p>在此，红桃皇后是一个很好的榜样：</p>\n<blockquote><p>爱丽丝笑道：“试了也没用，没人会相信那些不存在的事情。”</p>\n<p>“我敢说你没有太多的练习”，女王回应道，“我年轻的时候，一天中的一个半小时都在闭上眼睛，深呼吸。为何，那是因为有时在早饭前，我已经意识到存在六种不可能了。”来自刘易斯·卡罗尔的《爱丽丝漫游奇境》</p></blockquote>\n<p>更正：感谢那些指出错别字和其它错误的热心人士。Justin Fortier 和 Irina Max，我欠你们一杯自选饮料。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/0e7f3ed833bce2ad9a7586304992d287.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/a64465daeaf26033e2afcd40659beab2.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111399\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111399votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111399\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qiaofeng\">乔永琪</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/qiaofeng\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/12/c3d69df6568c8c8861768301d9607a81.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            （新浪微博：@甜菜碱）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qiaofeng\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qiaofeng/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qiaofeng/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 20</a>        </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('实现前后端分离的心得', '2017-07-12', 'http://blog.jobbole.com/111624/', '83036acfe38763334b3abfe88bc409c1', 'http://jbcdn2.b0.upaiyun.com/2017/07/67e8579ee2214313c2b2984471596e35.png', 'full/cb6856e79b5025e46c895464e60a86e2f6c4e811.jpg', '0', '5', '1', 'IT技术,前端,后端', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/chenjg/p/6992062.htm\">陈陈jg</a>   </div><div id=\"cnblogs_post_body\">\n<h1 id=\"实现前后端分离的心得\">实现前后端分离的心得</h1>\n<p>对目前的web来说，前后端分离已经变得越来越流行了，越来越多的企业/网站都开始往这个方向靠拢。那么，为什么要选择前后端分离呢？前后端分离对实际开发有什么好处呢?</p>\n<h2 id=\"为什么选择前后端分离\"><strong>为什么选择前后端分离</strong></h2>\n<ul>\n<li><strong>在以前传统的网站开发中，前端一般扮演的只是切图的工作，只是简单地将UI设计师提供的原型图实现成静态的HTML页面，而具体的页面交互逻辑，比如与后台的数据交互工作等，可能都是由后台的开发人员来实现的，或者是前端是紧紧的耦合后台。比如，以前淘宝的Web基本上都是基于MVC框架webx，架构决定了前端只能依赖后端。所以他们的开发模式依然是，前端写好静态demo，后端翻译成VM模版，这种模式的问题就不说了，被吐槽了很久。</strong></li>\n<li><strong>而且更有可能后台人员直接兼顾前端的工作，一边实现API接口，一边开发页面，两者互相切换着做，而且根据不同的url动态拼接页面，这也导致后台的开发压力大大增加。前后端工作分配不均。不仅仅开发效率慢，而且代码难以维护。而前后端分离的话，则可以很好的解决前后端分工不均的问题，将更多的交互逻辑分配给前端来处理，而后端则可以专注于其本职工作，比如提供API接口，进行权限控制以及进行运算工作。而前端开发人员则可以利用nodejs来搭建自己的本地服务器，直接在本地开发，然后通过一些插件来将api请求转发到后台，这样就可以完全模拟线上的场景，并且与后台解耦。前端可以独立完成与用户交互的整一个过程，两者都可以同时开工，不互相依赖，开发效率更快，而且分工比较均衡。</strong></li>\n</ul>\n<h2 id=\"如何做到前后端分离\"><strong>如何做到前后端分离</strong></h2>\n<p>(以下的内容都是基于我们的电影购票网站来讨论的)<br>\n前端的技术框架是: vue全家桶+nodejs+express(实现的是单页面(SPA)应用)<br>\n首先，先分清楚前后端的工作</p>\n<ul>\n<li>前端的工作：实现整一个前端页面以及交互逻辑，以及利用ajax与nodejs服务器（中间层)交互</li>\n<li>后端的工作：提供API接口，利用redis来管理session,与数据库交互</li>\n</ul>\n<p>我们项目的整一个架构如下:</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/67e8579ee2214313c2b2984471596e35.png\" alt=\"这里写图片描述\"></p>\n<p><strong>接下来进入正题，如何实现前后端分离</strong></p>\n<ol>\n<li>一般来说，要实现前后端分离，前端就需要开启一个本地的服务器来运行自己的前端代码，以此来模拟真实的线上环境，并且，也是为了更好的开发。因为你在实际开发中，你不可能要求每一个前端都去搭建一个java(php)环境，并且在java环境下开发，这对于前端来说，学习成本太高了。但如果本地没有开启服务器的话，不仅无法模拟线上的环境，而且还面临到了跨域的问题，因为你如果写静态的html页面，直接在文件目录下打开的话，你是无法发出ajax请求的(浏览器跨域的限制),因此，你需要在本地运行一个服务器，可是又不想搭建陌生而庞大的java环境，怎么办法呢？nodejs正好解决了这个问题。在我们项目中，我们利用nodejs的express框架来开启一个本地的服务器，然后利用nodejs的一个http-proxy-middleware插件将客户端发往nodejs的请求转发给真正的服务器，让nodejs作为一个中间层。这样，前端就可以无忧无虑的开发了</li>\n<li>由于前后端分离后，前端和后台同时开发时，就可能遇到前端已经开发好一个页面了，可是却等待后台API接口的情况。比如说A是负责前端，B是负责后台，A可能用了一周做好了基本的结构，并且需要API接口联调后，才能继续开发，而此时B却还没有实现好所需要的接口，这种情况，怎么办呢？在我们这个项目里，我们是通过了mock来提供一些假数据，我们先规定好了API接口，设计出了一套API文档，然后我们就可以通过API文档，利用mock(<a>http://mockjs.com)来返回一些假数据，这样就可以模拟发送API到接受响应的整一个过程，因此前端也不需要依赖于后端开发了，可以独立开发，等到后台的API全部设计完之后，就可以比较快速的联调</a>。</li>\n</ol>\n<h2 id=\"为什么要引入nodejs作为中间层\"><strong>为什么要引入nodejs作为中间层</strong></h2>\n<p>前面的我发的项目结构图中，已经表明，在这个项目里，我们将nodejs作为中间层，那么，为什么我们要特地引入nodejs呢？直接用java做不就行了吗？</p>\n<ul>\n<li>我觉得引入nodejs主要是为了分层开发，职责划分，nodejs作为前端服务器，由前端开发人员负责，前端开发人员不需要知道java后台是如何实现的，也不需要知道API接口是如何实现的，我们只需要关心我们前端的开发工作，并且管理好nodejs前端服务器，而后台开发人员也不需要考虑如何前端是如何部署的，他只需要做好自己擅长的部分，提供好API接口就可以；</li>\n<li>nodejs本身有着独特的异步、非阻塞I/O的特点，这也就意味着他特别适合I/O密集型操作，在处理并发量比较大的请求上能力比较强，因此，利用它来充当前端服务器，向客户端提供静态文件以及响应客户端的请求，我觉得这是一个很不错的选择。</li>\n</ul>\n<h2 id=\"前端服务器如何部署\"><strong>前端服务器如何部署</strong></h2>\n<p><strong>nodejs前端服务器的职责</strong></p>\n<ol>\n<li>作为静态文件服务器，当用户访问网站的时候，将index.html以及其引入的js、css、fonts以及图片返回给用户</li>\n<li>负责将客户端发来的ajax请求转发给后台服务器</li>\n</ol>\n<p><strong>其实前端服务器的部署工作是算比较简单的，具体有以下两个点:</strong></p>\n<ol>\n<li>将开发完的前端代码，利用webpack打包成静态压缩文件</li>\n<li>在服务器上，利用pm2负载均衡器来执行以下的代码来开启服务器:</li>\n</ol>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e6da864d4af726f47beb4100fbf5bbff.png\"></p>\n<p>评论区有人提到有一个不错的文章，我看了下觉得写得确实很详细，大家也可能看一下:<a href=\"https://segmentfault.com/a/1190000009329474?_ea=2038402\">https://segmentfault.com/a/1190000009329474?_ea=2038402</a> (感觉这就是业务与专业的区别哈哈)<br>\n(PS:其实也有一个做法，就是用nginx来做反向代理，负责转发请求，根据客户端访问的url把这个请求转发到不同的服务，比如访问/api/*的请求，就转发到后台服务，访问其它的请求，就转发到nodejs服务)<br>\n以上，就是我对于前后端分离的一些看法，以及一些实践，如果大家有什么好的想法，欢迎交流。</p>\n<p>本次项目代码的地址为:<a href=\"https://github.com/chenjigeng/filmshopping\">https://github.com/chenjigeng/filmshopping</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111624\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111624votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111624\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('能当主力，能入虚拟机，还能随时打包带走，Linux 就是这么强大', '2017-07-12', 'http://blog.jobbole.com/111672/', '851c8144fffb89af1d9613091b149fa9', 'http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg', 'full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg', '0', '3', '1', 'IT技术,Linux', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/\">zasdfgbnm</a>   </div><p>这里介绍一下自己管理自己的Linux桌面的一点经验吧，我觉得还是有不少可取之处的。先来说一下大多数人管理Linux桌面的方法有哪些不方便的地方吧：</p>\n<ul>\n<li>买新电脑了，又得在新电脑上安装Linux，安装各种软件，各种库，各种开发环境，配置各种服务，真麻烦。</li>\n<li>最近一直在用电脑A，干了好多事情安装了好多软件，也配置了不少开发环境跟各种服务，然而处于某种原因，我又要开始使用好久没用过的电脑B了，难道我要把在A上的做的各种配置在B上再重新做一遍？</li>\n<li>在Windows下做着PPT呢，发现需要调出自己之前的程序，然后根据若干组输入跑几个结果画张图好插到PPT里，然而这个程序是在Linux下写的，编译等的过程也严重依赖自己用的Linux环境，重启进Linux拿到结果再回Windows太不方便，想在Windows下配置好环境把自己的程序跑通更不容易。</li>\n<li>要对系统安装某个软件，或者进行一些比较危险的更新操作（要知道Archlinux滚动更新滚挂了太正常了），担心把系统搞挂了，系统备份又实在太麻烦，要真挂了，系统恢复起来更麻烦。</li>\n<li>我一直用Archlinux做主力，然而最近做的某件事情要用某个软件，这个软件官方只给了Ubuntu上的安装方式，Archlinux里面没有相应的包，在Archlinux上手动安装也太不方便。装个Ubuntu，然后暂时用几天Ubuntu吧，也是够折腾的。更何况有时候只是想用一小下而已，怎样才能最小化自己在折腾上浪费的时间呢？</li>\n<li>有的软件官方软件仓库里面没有，而<code>make install</code>的话则会在系统中安装上不被包管理器所管理的文件，将来卸载也不方便，我还是更希望所有的文件都在一个包管理器中管理的。</li>\n<li>听说新版本内核引入了某个牛逼的东西？我就想快速测试一下玩玩，我电脑还有计算在跑着呢，我可不想重启，那就只能用虚拟机尝试了。而且，一定要快速，我可不想为此特地装一个虚拟机。</li>\n</ul>\n<p>上述的这些不方便之处是可以通过自己管理系统时的一些技巧来克服的，本文目的就是来介绍一下这些技巧。通过这些技巧，我们实现的功能是：一台机器上，可以同时安装Windows跟若干Linux系统，Windows下可以通过虚拟机来运行位于本地磁盘的这些Linux系统，而这些Linux系统下也可以通过容器或者虚拟机的方式互相运行。并且这些系统可以非常方便地备份跟删除，也可以随时创建以及运行快照。并且这些Linux系统可以随时打包带走，只需要经过很少的修改，就能直接在U盘或者其他机器上运行。如果要换电脑，或者新装一台电脑，也不需要重新安装系统，只需要把已有的系统同步到新电脑就行。这也正是这篇文章标题的意思。</p>\n<p>为了行文的方便，我们假定读者有一台全新的机器，硬盘还没分区，也还没装任何系统。如果已经什么都装好了，而只是想迁移到我这种管理方式的话，我相信读者能够判断这个安装教程中哪些步骤是需要做的哪些步骤是不需要做的。 另外需要注意的是这不是一个手把手的一步一步的教程，中间有一些显然的步骤我就略去不写了，所以希望读者不要照着文章里的的命令不加思考地一条一条粘贴运行，而是要搞明白这些命令的目的是什么，然后根据你自己的情况来做相应的修改。</p>\n<h3 id=\"分区与子卷\">分区与子卷</h3>\n<p>具体怎么分区我就不说了，随便找个livecd启动进去，然后找到你自己最喜欢的分区程序，按照你的喜好把区分了就好。注意别忘了EFI分区。我这里需要说的是，分区的时候，不论有多少个发行版要安装，总共只给Linux划分两个分区：一个是swap，另一个则是一个大的btrfs分区。那个btrfs分区里面装着所有的文件，包括用户的个人数据，以及所有发行版的rootfs。这两个分区在格式化的时候，一定要给他们取Label，这么做的好处接下来我们很快就会看到。我的习惯是，swap分区的Label我就叫他“swap”，而那个btrfs分区我则叫他“linux”。创建好分区以后，如果格式化工作是在图形的分区管理程序下完成的，那么指定Label是个非常简单的工作，右键属性里面就有。如果是使用命令行工具格式化分区的，则可以使用<code>-L label</code>选项来指定label，比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a78819967749\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkswap -L swap /dev/sdb4\r\nmkfs.btrfs -L linux /dev/nvme0n1p4</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a78819967749-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2a78819967749-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a78819967749-1\"><span class=\"crayon-v\">mkswap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">L</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">swap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sdb4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2a78819967749-2\"><span class=\"crayon-v\">mkfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">L</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">linux</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nvme0n1p4</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>那个大的btrfs分区上的不同内容是通过btrfs的子卷来管理的，具体来讲就是为自己想安装的每个不同的Linux系统来创建一个单独的子卷。 比如说我电脑上同时安装了Archlinux、Ubuntu、Kali、Debian四个系统，那么的btrfs分区里面就有四个子卷：archlinux、ubuntu、kali、debian。 子卷的创建可以通过<code>btrfs subvolume create &lt;name&gt;</code>命令完成，比如说要创建我这五个子卷，需要做的事情就是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a82210006510\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmount /dev/disk/by-label/linux /mnt\r\ncd /mnt\r\nbtrfs subvolume create archlinux\r\nbtrfs subvolume create ubuntu\r\nbtrfs subvolume create kali\r\nbtrfs subvolume create debian</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a82210006510-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2a82210006510-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a82210006510-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2a82210006510-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a82210006510-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2a82210006510-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a82210006510-1\"><span class=\"crayon-v\">mount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">disk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">linux</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">mnt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2a82210006510-2\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">mnt</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2a82210006510-3\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">create </span><span class=\"crayon-e\">archlinux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2a82210006510-4\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">create </span><span class=\"crayon-e\">ubuntu</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2a82210006510-5\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">create </span><span class=\"crayon-e\">kali</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2a82210006510-6\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">debian</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如果你只想装一个发行版，比如archlinux，那么只需要archlinux子卷就够了。另外，如果你想把用户数据单独放在一个子卷里，也是完全可以的，不过这里不推荐多个Linux系统共享同一个家目录，因为不同系统上安装的软件不同，同样的软件版本也不相同，即使版本相同，不同发行版也可能应用了不同的patch，这就导致在一个系统上用户家目录里面产生的配置文件，在另一个系统里无法兼容，产生奇怪的行为。</p>\n<h3 id=\"系统安装\">系统安装</h3>\n<p>创建好分区与子卷，下一步就是安装操作系统了。这里分两种情况来讲：第一种情况是你想要全新安装一个Linux操作系统；第二种情况则是你已经有了某个可用的操作系统了，而只是想把这个操作系统迁移到文章所说的管理方式上。</p>\n<h4 id=\"全新安装\">全新安装</h4>\n<p>如果想要全新安装一个操作系统，安装方式上，作者只推荐纯手工安装，而不是用官方给的安装光盘不断点着“下一步”来进行安装。这么做是为了防止官方安装程序做一些我们不想让他做的事情，比如说自动安装grub。对于Archlinux跟Gentoo来讲，唯一的安装方法就是纯手工安装，所以只要按照官方的教程来就好了。对于deb系的系统，可以使用debootstrap程序。对于其他的发行版，可能会找不到手工安装的教程，这时候可以新建一个虚拟机，在虚拟机中使用官方的安装程序不断点击“下一步”来完成安装，然后按照下一节即将介绍的现有系统迁移教程把系统从虚拟机中迁移到现实机器上；除此之外，读者还可以找到发行版官方提供的安装程序的源代码阅读一下，看明白这些安装程序都在干啥，就知道怎么手工安装了，安装程序的代码还是相对简单的，有时间的读者不妨尝试一下。下面来具体说一下安装过程，这里只介绍Archlinux跟deb系。如果有多个Linux系统需要安装，建议先安装并完全配置好其中一个，让这个系统处于可用并且方便使用的状态，然后再在这个可用的系统中安装其他系统。这里我们假设读者已经完成了分区，创建了对应的子卷，并且把那个btrfs分区挂载在了<code>/mnt</code>上。</p>\n<h5 id=\"Archlinux的手动安装\">Archlinux的手动安装</h5>\n<p>Archlinux的手动安装主要还是看<a href=\"https://wiki.archlinux.org/index.php/Installation_guide\" target=\"_blank\" rel=\"external\">官方教程</a>。分区的时候注意按照上文介绍的方法。非常关键的<code>pacstrap</code>那一步注意使用如下命令安装到子卷里，而不是整个btrfs分区中:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a88717369966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacstrap -d /mnt/archlinux base</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a88717369966-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a88717369966-1\"><span class=\"crayon-v\">pacstrap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">archlinux </span><span class=\"crayon-v\">base</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>至于fstab，就不要使用教程中的方法来生成了，我们的管理方式比较非常规，还是自己写fstab比较好。bootloader也要按照本文下文说的方式来安装跟配置。至于其他的设置键盘、设置网络、设置时区等操作，照着教程来就行。</p>\n<h5 id=\"deb系的手动安装\">deb系的手动安装</h5>\n<p>deb系的系统网上找到的教程都是使用发行版自带的安装程序的教程，并没有像Archlinux那么详细的手动安装教程。因为我们想要手动安装，所以我们就不参照网上的deb系的安装教程了。但是我们还是有教程可以参照的，那就是Archlinux的wiki里面<a href=\"https://wiki.archlinux.org/index.php/Systemd-nspawn#Create_a_Debian_or_Ubuntu_environment\" target=\"_blank\" rel=\"external\">关于systemd-nspawn的教程</a>，这个教程里面有一节介绍如何使用debootstrap安装Debian或者Ubuntu。具体安装过程请参照上述教程，其中关键命令如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a8c630266766\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndebootstrap --arch amd64 zesty /mnt/ubuntu http://archive.ubuntu.com/ubuntu/</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a8c630266766-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a8c630266766-1\"><span class=\"crayon-v\">debootstrap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">arch </span><span class=\"crayon-e\">amd64 </span><span class=\"crayon-v\">zesty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ubuntu </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//archive.ubuntu.com/ubuntu/</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>值得一提的是，我们安装deb系的发行版并不一定要使用deb系的livecd，任何能够安装debootstrap程序的livecd都是可以的。比如说我们完全可以使用Archlinux的livecd来启动，然后安装debootstrap并通过debootstrap来安装Ubuntu。</p>\n<p>注意的是，debootstrap并不会像官方安装程序那样安装一个完整齐全开袋即食的操作系统，而只是安装最基本的软件包，读者需要根据自己的情况单独安装桌面环境等的软件包。同时fstab跟bootloader也要根据本文的方法自己配置。</p>\n<h4 id=\"现有系统迁移\">现有系统迁移</h4>\n<p>Linux系统的迁移其实非常简单，无非就是把rootfs的文件全都拷贝到目的地即可。不过这个过程虽然看似简单，但是还是有一些需要注意的东西的。比如说对于符号链接，如果处理不当，则会不小心把符号链接搞成实体文件，这就不好了。再比如说，文件的权限等元数据的问题，如果处理不当，可能会导致拷贝过程中元数据的丢失。这两种问题，都有可能会导致系统不能正常运行。还有一个需要注意的地方就是，正常运行的操作系统里，会有/proc、/dev等目录，这些目录都是单独的虚拟文件系统，是不需要拷贝的，也是无法拷贝的。</p>\n<p>我们现在假设用户想要把位于A的Ubuntu系统迁移到目标子卷<code>/mnt/ubuntu</code>去。其中，A可能位于虚拟机中，可能位于另一台电脑上，也可能位于本地磁盘。对系统进行迁移，大方向上来讲，需要做的有两步：</p>\n<ol>\n<li>挂载相应分区，设置ssh，保证我们能够访问到A。</li>\n<li>使用<code>rsync</code>或者<code>btrfs send</code>命令来把数据从A发送到目标子卷中去。</li>\n</ol>\n<p>第一步具体怎么做就不说了，分三种情况简单几句话概括一下怎么做：</p>\n<ul>\n<li>如果只是一个分区的话，mount就可以了</li>\n<li>如果是另一台机器，把那台机器配置好ssh，保证root用户可以用ssh访问</li>\n<li>如果是虚拟机，有两种选择，一种是想办法挂载虚拟机的磁盘镜像，然后像情况1那样处理；另一种则是配置好网络跟ssh，像情况2那样处理。具体采取哪种措施请读者根据自己的情况来自行决定。</li>\n</ul>\n<p>第二步我们来分别介绍<code>rsync</code>跟<code>btrfs send</code>两种方法。</p>\n<p><code>rsync</code>的方法<a href=\"https://wiki.archlinux.org/index.php/full_system_backup_with_rsync\" target=\"_blank\" rel=\"external\">这里有教程</a>可以参照。我们现在假设A的ip地址为<code>192.168.88.3</code>。则只需执行如下命令即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a90616010466\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrsync -aAXv --exclude={\"/dev/*\",\"/proc/*\",\"/sys/*\",\"/tmp/*\",\"/run/*\",\"/mnt/*\",\"/media/*\",\"/lost+found\"} root@192.168.88.3:/ /mnt/ubuntu</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a90616010466-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a90616010466-1\"><span class=\"crayon-v\">rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAXv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">exclude</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"/dev/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/proc/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/sys/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/tmp/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/run/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/mnt/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/media/*\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"/lost+found\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">192.168.88.3</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>这里提醒读者注意自己系统上是否还有其他不想要同步的文件，记得一并排除掉。</p>\n<p><code>btrfs send</code>只在A的rootfs也是btrfs的情况下才能使用。<a href=\"https://btrfs.wiki.kernel.org/index.php/Incremental_Backup\" target=\"_blank\" rel=\"external\">这个方法的教程参见这里</a>。首先需要做的是在A机器上给rootfs创建一个只读快照（注意下面命令是在A机器上执行的）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a94628424803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbtrfs subvolume snapshot -r / /ubuntu</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a94628424803-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a94628424803-1\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-v\">snapshot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>注意上面命令中快照的名字要和目标子卷的名字相同，这样可以省去将来改名的麻烦。然后就可以使用<code>btrfs send</code>命令来把快照/ubuntu中的内容发送到目的地了，在这之前我们需要暂时删除我们分区的时候创建的ubuntu子卷，这个子卷会在接收过程中自动重新创建：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a97670643397\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbtrfs subvolume delete /mnt/ubuntu\r\nssh root@192.168.88.3 btrfs send /ubuntu | btrfs receive /mnt</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a97670643397-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2a97670643397-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a97670643397-1\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-v\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2a97670643397-2\"><span class=\"crayon-e\">ssh </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">192.168.88.3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">btrfs </span><span class=\"crayon-v\">send</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">btrfs </span><span class=\"crayon-v\">receive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnt</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>最后在A机器上把刚刚创建的快照删除就可以了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2a9b457172835\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbtrfs subvolume delete /ubuntu</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2a9b457172835-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2a9b457172835-1\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-v\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"bootloader与fstab\">bootloader与fstab</h3>\n<p>系统装好了，我们的fstab还没设置，启动管理器也还没安装配置。下面来讲讲怎么配置这两样东西。我们之前说过一定要给分区取一个Label，玄机在这里。如何在虚拟机中直接运行本地磁盘上安装的Linux，以及如何能把一个系统直接进行打包带走而不需要更改太多配置，关键也在这里。</p>\n<h4 id=\"fstab\">fstab</h4>\n<p>先来说说fstab，fstab总共有五列，分别为fs、mountpoint、type、opts跟dump/pass。这五列分别为什么意思、以及fstab该怎么填，网上一查便知，在此不再赘述。这里只说我们需要做的跟常规不一样的地方。</p>\n<p>第一个要注意的事情是，大家在填写fstab的时候，通常喜欢在fs那一列填写类似<code>/dev/sda4</code>或者<code>UUID=d5acc217-d524-4a2d-a937-bad945a047b2</code>，而在这里这样是不行的，这里我们填写的是形如<code>/dev/disk/by-label/linux</code>这样的东西。也就是说，我们的fstab里面是通过分区的Label来找分区的。这么做的原因是，我们希望我们的rootfs不光能在这台机器上启动，还希望它能在虚拟机的环境中，或者当我们把rootfs打包带走同步到别的机器上的时候，也能正常启动。在这台机器上rootfs所在的分区叫做<code>/dev/sda4</code>，在别的机器上或者虚拟机里就不一定还叫<code>/dev/sda4</code>了。但是我们只要遵守自己的命名规则，所有机器上的这些分区我们都取相同的Label，那么我们的fstab就是放之四海而皆准的，不需要为不同的环境而更改。</p>\n<p>第二个需要注意的问题是，不要填写rootfs的条目。这种做法跟通常发行版或者其他用户的默认做法是非常不相同的。为了理解这一点，先来说说Linux系统的启动过程。通常情况下，Linux启动的时候，首先由bootloader把内核装载到内存，并向内核传递参数告诉内核rootfs的位置。接下来内核就会根据传递的参数，以只读方式挂载rootfs，并执行rootfs中的init程序。init程序会调用相应的初始化程序执行各种初始化操作。其中一项初始化操作就是根据fstab的配置，来重新以读写方式挂载rootfs，并且挂载fstab里面配置的其他各个分区到指定位置。明白了Linux启动的过程，我们就知道，fstab里面的rootfs那一行其实不是必须的。删掉了rootfs那一行，我们只需要通过修改bootloader传递给内核的参数，就可以告诉内核直接以读写而不是只读的方式挂载rootfs。</p>\n<p>那么，我们在写fstab的时候不写rootfs那一项有啥好处呢？好处就是，我们不仅希望我们的系统能在裸机上用，还希望我们的系统能在虚拟机上用。在下文设置qemu虚拟机的时候，我们会以virtfs的方式把我们的子卷传递给虚拟机，这个时候rootfs就已经不再是<code>/dev/disk/by-label/linux</code>了，如果我们把rootfs的挂载方式硬编码到fstab里面，那么会导致init程序的失败，进而无法启动。</p>\n<p>另外有一点值得一提的小技巧是，很多时候我们还有别的一些个分区想要自动挂载。问题在于，这些分区在虚拟机环境中，并不一定是存在的，这就会导致启动的时候由于无法挂载而启动失败。其实系统的设计者早就考虑到这个问题了。如果你不希望fstab中的某些条目自动挂载，在选项里面增加<code>noauto</code>即可。如果你希望一些条目自动挂载，但是这些条目不是那么重要，即使挂载失败也不希望这些条目导致启动失败，可以在选项中增加<code>nofail</code>。这两个选项真的是给我们的系统管理工作提供了非常大的方便。比如说我们可能会在fstab中增加<code>/dev/disk/by-label/swap</code>的条目，以便开机自动将这个分区设置为交换分区供系统使用。然而后面我们会看到，我们设置虚拟机的时候，这个分区在虚拟机环境下，并不一定是可用的。这种情况下，我们希望系统在找不到这个分区的时候直接忽略错误不用swap便是，而不是报错拒绝启动。</p>\n<p>说了这么多，直接贴一个fstab的例子好了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2aa0013564763\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntmpfs                  		/tmp	tmpfs	defaults		0 0\r\n/dev/disk/by-label/swap		none	swap	defaults,nofail		0 0</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa0013564763-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aa0013564763-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2aa0013564763-1\"><span class=\"crayon-v\">tmpfs</span><span class=\"crayon-h\">                  		</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tmp	</span><span class=\"crayon-e\">tmpfs	</span><span class=\"crayon-i\">defaults</span><span class=\"crayon-h\">		</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aa0013564763-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">disk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">swap		</span><span class=\"crayon-e\">none	</span><span class=\"crayon-e\">swap	</span><span class=\"crayon-v\">defaults</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">nofail</span><span class=\"crayon-h\">		</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h4 id=\"bootloader\">bootloader</h4>\n<p>再来说说启动管理器，这里作者推荐的启动管理器是refind，<a href=\"http://www.rodsbooks.com/refind/installing.html\" target=\"_blank\" rel=\"external\">安装教程官网有</a>，在此不赘述。这里只讲一下启动项怎么写。先贴示例代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2aa4611322257\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmenuentry archlinux {\r\n	icon EFI/refind/icons/os_arch.png\r\n	volume linux\r\n	loader archlinux/boot/vmlinuz-linux\r\n	options \"root=/dev/disk/by-label/linux rootflags=subvol=archlinux rw\"\r\n	initrd archlinux/boot/initramfs-linux.img\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa4611322257-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aa4611322257-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa4611322257-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aa4611322257-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa4611322257-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aa4611322257-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa4611322257-7\">7</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2aa4611322257-1\"><span class=\"crayon-e\">menuentry</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">archlinux</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aa4611322257-2\"><span class=\"crayon-h\">	</span><span class=\"crayon-e\">icon </span><span class=\"crayon-v\">EFI</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">refind</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">os_arch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aa4611322257-3\"><span class=\"crayon-e\">	</span><span class=\"crayon-e\">volume </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aa4611322257-4\"><span class=\"crayon-e\">	</span><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vmlinuz</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aa4611322257-5\"><span class=\"crayon-e\">	</span><span class=\"crayon-i\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"root=/dev/disk/by-label/linux rootflags=subvol=archlinux rw\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aa4611322257-6\"><span class=\"crayon-h\">	</span><span class=\"crayon-e\">initrd </span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initramfs</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">img</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aa4611322257-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>其中第三行的volume用来指定内核存放的分区，此分区可以通过多种方式来指定，比如通过分区的GUID，但是对我们来说最重要的是可以通过文件系统的Label来指定。我们的rootfs分区Label是”linux”，所以这一行写作<code>volume linux</code>。</p>\n<p>接下来就是指定内核位置、内核参数跟initramfs的位置了。其中loader用来指定内核位置，options用来指定内核参数，initrd则用来指定initramfs的位置。示例中的是Archlinux系统，内核是archlinux子卷中的<code>boot/vmlinuz-linux</code>文件，所以写作<code>loader archlinux/boot/vmlinuz-linux</code>。类似，initrd那一行则写作<code>initrd archlinux/boot/initramfs-linux.img</code>。至于内核参数，<code>root=/dev/disk/by-label/linux</code>告诉内核我们的rootfs所在的分区，<code>rootflags=subvol=archlinux</code>告诉内核挂载名为archlinux的子卷，<code>rw</code>则告诉内核以读写方式挂载。对于Ubuntu系统，这三行应该写作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2aa8497016051\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloader ubuntu/vmlinuz\r\noptions \"root=/dev/disk/by-label/linux rootflags=subvol=ubuntu rw\"\r\ninitrd ubuntu/initrd.img</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa8497016051-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aa8497016051-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aa8497016051-3\">3</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2aa8497016051-1\"><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">vmlinuz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aa8497016051-2\"><span class=\"crayon-i\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"root=/dev/disk/by-label/linux rootflags=subvol=ubuntu rw\"</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aa8497016051-3\"><span class=\"crayon-e\">initrd </span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initrd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">img</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>细心的读者可能已经发现，我们的refind的配置文件中在指定分区的时候用的全是他们的Label，这就保证了这个配置文件的普适性，换台电脑，只要你用同样的管理方式，同样的命名习惯，配置文件里面的东西动都不用动，直接拷贝过去就行。</p>\n<h3 id=\"系统的备份与恢复以及快照的应用\">系统的备份与恢复以及快照的应用</h3>\n<p>由于使用了btrfs的动态卷，所以备份恢复工作做起来非常简单。备份系统只需要创建快照即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2aab288661274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd /mnt\r\nbtrfs subvolume snapshot archlinux backup</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aab288661274-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aab288661274-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2aab288661274-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">mnt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aab288661274-2\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">snapshot </span><span class=\"crayon-e\">archlinux </span><span class=\"crayon-v\">backup</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>至于恢复，其实我们根本不需要恢复，直接把快照作为rootfs用就行。我们只需要去refind的配置文件里面，把相应的启动项改改即可。比如说对于Archlinux而言，只需要改成：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2aaf568171566\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmenuentry archlinux {\r\n	icon EFI/refind/icons/os_arch.png\r\n	volume linux\r\n	loader backup/boot/vmlinuz-linux\r\n	options \"root=/dev/disk/by-label/linux rootflags=subvol=backup rw\"\r\n	initrd backup/boot/initramfs-linux.img\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aaf568171566-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aaf568171566-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aaf568171566-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aaf568171566-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aaf568171566-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2aaf568171566-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2aaf568171566-7\">7</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2aaf568171566-1\"><span class=\"crayon-e\">menuentry</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">archlinux</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aaf568171566-2\"><span class=\"crayon-h\">	</span><span class=\"crayon-e\">icon </span><span class=\"crayon-v\">EFI</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">refind</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">os_arch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aaf568171566-3\"><span class=\"crayon-e\">	</span><span class=\"crayon-e\">volume </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aaf568171566-4\"><span class=\"crayon-e\">	</span><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vmlinuz</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aaf568171566-5\"><span class=\"crayon-e\">	</span><span class=\"crayon-i\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"root=/dev/disk/by-label/linux rootflags=subvol=backup rw\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2aaf568171566-6\"><span class=\"crayon-h\">	</span><span class=\"crayon-e\">initrd </span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initramfs</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">img</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2aaf568171566-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>如果有强迫症，觉得rootfs名字不叫archlinux很不爽，那其实改名也很简单:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ab2523934294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd /mnt\r\nbtrfs subvolume delete archlinux\r\nbtrfs subvolume snapshot backup archlinux</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ab2523934294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2ab2523934294-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ab2523934294-3\">3</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ab2523934294-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">mnt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2ab2523934294-2\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">archlinux</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2ab2523934294-3\"><span class=\"crayon-e\">btrfs </span><span class=\"crayon-e\">subvolume </span><span class=\"crayon-e\">snapshot </span><span class=\"crayon-e\">backup </span><span class=\"crayon-v\">archlinux</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>其实，btrfs的快照功能不仅可以用来备份与恢复系统，还有很多非常灵活的运用的。比如说我想在系统里面安装一个巨大而又混乱的软件，这个软件我只想用几天干一件事情，干完这件事情我就不想用了。问题是，这个软件在官方的软件仓库并没有，要安装，我只能使用软件提供的安装程序来安装，然而软件并没有提供卸载程序，或者卸载程序卸载的很不彻底，会在系统残留垃圾。我想用这软件，然而又不想脏了我的系统，这该怎么办？很简单：创建一个快照，新增加一条以快照为rootfs的启动项，要用软件了就启动到快照中去，用完这个软件以后把快照删除即可。再比如说，我想要搞个虚拟机跟实体机一起来测试某个东西（比如说测试某些网络协议、测试某些集群管理软件等），这个时候我根本没必要重新用安装光盘去装一个虚拟机，只需要创建一个快照，然后把快照作为虚拟机的rootfs启动即可，具体方法下文会介绍，在此不多说。当然，快照的应用还远远不止我说的这些，更多好玩的应用还待读者自己探索。</p>\n<h3 id=\"Windows下访问Linux\">Windows下访问Linux</h3>\n<p>从文章的刚开头我们就说，有时候我们是有在Windows下运行本地安装的Linux的需求的。这个需求可以通过VirtualBox来满足，只需要在VirtualBox中使用本地磁盘来作虚拟磁盘即可。说起来简单，但是实现起来还是需要折腾一下子的。</p>\n<p>首先我们需要新建一个虚拟机，具体过程不多说，一路“下一步”就行了，唯一需要注意的是，在创建虚拟磁盘的那一步，选择“不添加虚拟硬盘”：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/virt_hdd.png\" rel=\"group\"><img class=\"aligncenter\" title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/virt_hdd.png\" alt=\"virt_hdd.png\"></a></p>\n<p>这里我的虚拟机取名为“Linux”。创建完虚拟机了以后，就需要把本地磁盘设置为虚拟磁盘了。VirtualBox只能通过命令来做这件事情，<a href=\"http://www.serverwatch.com/server-tutorials/using-a-physical-hard-drive-with-a-virtualbox-vm.html\" target=\"_blank\" rel=\"external\">教程可以在这里找到</a>。首先要做的是寻找我们安装Linux的磁盘的编号，这个可以在系统自带的磁盘管理程序中找到，在我的机器上这个磁盘编号为2：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/dskmgr.png\" rel=\"group\"><img class=\"aligncenter\" title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/dskmgr.png\" alt=\"dskmgr.png\"></a><br>\n知道了磁盘的编号，就可以创建虚拟盘了。这里我们使用的命令如下，注意使用管理员身份运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ab7038251170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nVBoxManage internalcommands createrawvmdk -filename \"C:\\Users\\gaoxiang\\VirtualBox VMs\\Linux\\localdisk.vmdk\" -rawdisk \\\\.\\PhysicalDrive2</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ab7038251170-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ab7038251170-1\"><span class=\"crayon-e\">VBoxManage </span><span class=\"crayon-e\">internalcommands </span><span class=\"crayon-v\">createrawvmdk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"C:\\Users\\gaoxiang\\VirtualBox VMs\\Linux\\localdisk.vmdk\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">rawdisk</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">PhysicalDrive2</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>有了虚拟磁盘了，就可以将虚拟磁盘添加到虚拟机中去了：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/newdisk.png\" rel=\"group\"><img class=\"aligncenter\" title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/newdisk.png\" alt=\"newdisk.png\"></a></p>\n<p>虚拟磁盘设置好了，最后一步就是设置EFI了。由于我们之前在分区的时候给文件系统都赋予了Label，并且在refind设置的时候也是用的Label来指定分区，所以同一套refind的配置在虚拟机上也能用。因此我们不需要单独给虚拟机安装bootloader，而是直接用我们之前安装在物理磁盘上的EFI分区中的refind就行。VitualBox默认是不开启EFI的，我们需要在虚拟机的系统设置里面手动勾选EFI：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/efi.png\" rel=\"group\"><img class=\"aligncenter\" title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/efi.png\" alt=\"efi.png\"></a><br>\n为了要让VirtualBox自动启动refind，还要对EFI的分区做一些简单的设置，<a href=\"https://wiki.archlinux.org/index.php/VirtualBox#Installation_in_EFI_mode\" target=\"_blank\" rel=\"external\">设置的教程参考这里</a>。设置的时候一定要注意，这些设置一定要是通用的，即同一份文件既能在物理机上正常工作也能在虚拟机上正常工作，不要改完了设置以后虚拟机上能跑了物理机却挂了，这就不好玩了。VirtualBox的EFI在启动的时候会优先选择<code>/EFI/BOOT/BOOTX64.EFI</code>，如果找不到的话，才会启动EFI分区根目录下的<code>startup.nsh</code>中指定的bootloader。知道了这一点，为了实现自动启动refind，首先需要检查一下<code>/EFI/BOOT/BOOTX64.EFI</code>这个文件是否存在，若存在，备份并删除之：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2abc754376661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd EFI/BOOT\r\nmv bootx64.efi bootx64-backup.efi</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2abc754376661-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2abc754376661-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2abc754376661-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">EFI</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">BOOT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2abc754376661-2\"><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">bootx64</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">efi </span><span class=\"crayon-v\">bootx64</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">backup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">efi</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>然后就是在EFI分区根目录下新建一个<code>startup.nsh</code>了，这个文件只需要一行，内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2abf701076369\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\\EFI\\refind\\refind_x64.efi</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2abf701076369-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2abf701076369-1\"><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">EFI</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">refind</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">refind_x64</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">efi</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>一切设置完毕，运行虚拟机，就能看到我们熟悉的refind界面了：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/refind.png\" rel=\"group\"><img class=\"aligncenter\" title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/refind.png\" alt=\"refind.png\"></a><br>\n打开其中的Ubuntu系统，测试一切正常就大功告成了：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/ubuntu.png\" rel=\"group\"><img class=\"aligncenter\" title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/ubuntu.png\" alt=\"ubuntu.png\"></a></p>\n<p>当然，要在虚拟机中使用，还有一些细节性的工作要处理，比如安装VirtualBox的guest需要的相应的内核模块等等，这些在此不谈，读者使用过程中如果发现少啥了，自己装上便是。</p>\n<h3 id=\"Linux下不同发行版的互相访问\">Linux下不同发行版的互相访问</h3>\n<p>我们已经成功地在Windows下运行Linux了，下一步就是想办法在一个Linux系统下访问其他Linux了。由于这些系统都是Linux，而且都在同一个文件系统里面，所以如果只是想要访问一下里面的文件的话，挂载了用就行了。但是很多时候我们还是有需要来运行其他系统里面安装的程序，或者对那个系统进行管理的。应对这种需求有两种解决方案：容器跟虚拟机。</p>\n<p>可能很多读者并不了解这两者的区别，这里简单介绍一下。粗略来讲，虚拟机是通过软件的方式虚拟出一套硬件环境来，并在这套硬件环境中启动内核，然后内核会进行一个完整的开机过程，包括进行相应的初始化，加载init程序等。相比之下，容器则要轻量很多。容器并不会虚拟出自己的硬件环境，也不会额外加载一个内核。容器所做的，就是在现有内核上，运用namespace来创建出一套独立的进程PID、挂载点、网络接口、用户ID等等，由于不同namespace中的这些个ID之类的标识符都是独立的，所以不同namespace中的进程是互相之间看不到对方的，虚拟出来的环境乍看上去就跟在单独运行的一个系统一样，同样有PID为1的init进程，有自己一套独立的rootfs，等等。虚拟机的优点是更不容易被突破，安全性更好，可以使用自己的内核，但是效率也更低。容器的优点是轻便效率高，但是安全性就要稍差一些，也没法使用定制内核。</p>\n<h4 id=\"容器\">容器</h4>\n<p>Linux下大家最熟悉的容器就是chroot了，但是作者并不喜欢chroot，主要原因有两点：</p>\n<ul>\n<li>/proc、 /dev等东西不会自动挂载，每次手动挂载挂的心好累</li>\n<li>没有一个相对完整的开机过程，好多我希望自动启动的服务并不会运行起来</li>\n</ul>\n<p>基于上面的原因，作者在这里推荐的容器是systemd-nspawn。关于systemd-nspawn的介绍跟使用教程，<a href=\"https://wiki.archlinux.org/index.php/Systemd-nspawn\" target=\"_blank\" rel=\"external\">推荐看这里</a>。systemd-nspawn的使用非常简单，假设你的linux分区已经mount到了/mnt上去了，那么你只需要下面步骤就能启动一个systemd-nspawn容器（以Debian为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ac5700521677\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd /mnt/debian\r\nsystemd-nspawn -b</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ac5700521677-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2ac5700521677-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ac5700521677-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">debian</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2ac5700521677-2\"><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">nspawn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后就能看到刷刷刷的开机界面了，真的是非常的方便快捷。这里还有一点小技巧是，如果嫌每次开容器都要把linux分区挂载到/mnt上太麻烦，可以在<code>/var/lib/machines</code>里面为每个系统新建一个目录，然后在fstab里面设置一下自动把相应的子卷挂载进去：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ac8733863351\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/dev/disk/by-label/linux        /var/lib/machines/kali          btrfs           defaults,nofail,noatime,discard,subvol=kali            0 0\r\n/dev/disk/by-label/linux        /var/lib/machines/debian        btrfs           defaults,nofail,noatime,discard,subvol=debian          0 0\r\n/dev/disk/by-label/linux        /var/lib/machines/ubuntu        btrfs           defaults,nofail,noatime,discard,subvol=ubuntu          0 0</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ac8733863351-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2ac8733863351-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ac8733863351-3\">3</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ac8733863351-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">disk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">linux</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">machines</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kali          </span><span class=\"crayon-e\">btrfs           </span><span class=\"crayon-v\">defaults</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nofail</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">noatime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">discard</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">subvol</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">kali</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2ac8733863351-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">disk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">linux</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">machines</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">debian        </span><span class=\"crayon-e\">btrfs           </span><span class=\"crayon-v\">defaults</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nofail</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">noatime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">discard</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">subvol</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">debian</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2ac8733863351-3\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">disk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">linux</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">machines</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ubuntu        </span><span class=\"crayon-e\">btrfs           </span><span class=\"crayon-v\">defaults</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nofail</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">noatime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">discard</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">subvol</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">ubuntu</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>这么做的好处是，根目录位于<code>/var/lib/machines</code>的系统，在启动systemd-nspawn的时候可以直接使用<code>-M</code>选项来指定系统，而不需要进入相应目录。比如如果想启动Ubuntu系统：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2acc166774123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsystemd-nspawn -b -M ubuntu</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2acc166774123-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2acc166774123-1\"><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">nspawn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">M</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ubuntu</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h4 id=\"虚拟机\">虚拟机</h4>\n<p>如果只是想运行一下其他系统里面的程序，那么容器完全就够用了，但是有的时候我们还是需要玩玩不同的内核的，这就必须得用虚拟机了。通常情况下，大家用虚拟机，都是新建一个磁盘镜像，然后插入安装光盘，然后把光盘安装到镜像上。这么做的坏处，一个是访问镜像中的文件不方便，另一个是，我们在本地已经有安装过若干系统了，不去充分利用一下这些而去再重新往镜像里面安装那实在是舍近求远。那我们就来找一个把子卷当成虚拟机rootfs的方法。困难在于，虚拟机是个很独立的东西，是无法直接访问宿主机的文件系统的。然而幸运的是，Linux的内核虚拟化方案KVM提供了一个把本地文件系统传递给虚拟机的解决方案，用到的东西叫做VirtFS，<a href=\"http://wiki.qemu.org/Documentation/9psetup\" target=\"_blank\" rel=\"external\">相关的文档见这里</a>。</p>\n<p>好消息是，VirtFS是可以作为rootfs的。但是要能正常挂载VirtFS，内核必须要有相应的驱动才行。这里有两种方法可以做到这一点。如果你是自己编译内核的话，那么建议直接将相应的驱动编译进内核而不是模块。根据官网的指示，涉及到的内核配置如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ad0469063427\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCONFIG_NET_9P=y\r\nCONFIG_NET_9P_VIRTIO=y\r\nCONFIG_9P_FS=y\r\nCONFIG_9P_FS_POSIX_ACL=y</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ad0469063427-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2ad0469063427-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ad0469063427-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2ad0469063427-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ad0469063427-1\"><span class=\"crayon-v\">CONFIG_NET_9P</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2ad0469063427-2\"><span class=\"crayon-v\">CONFIG_NET_9P_VIRTIO</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2ad0469063427-3\"><span class=\"crayon-v\">CONFIG_9P_FS</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2ad0469063427-4\"><span class=\"crayon-v\">CONFIG_9P_FS_POSIX_ACL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>如果使用的是发行版提供的内核的话，那么可以修改initramfs的相关设置保证9p、9pnet、9pnet_virtio三个modules能被安装到initramfs里面去。这里以Ubuntu做guest为例，具体做法是修改Ubuntu系统中的<code>/etc/initramfs-tools/modules</code>文件，增加下面三行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ad3287198594\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n9p\r\n9pnet\r\n9pnet_virtio</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ad3287198594-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965501fa2ad3287198594-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ad3287198594-3\">3</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ad3287198594-1\"><span class=\"crayon-cn\">9p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965501fa2ad3287198594-2\"><span class=\"crayon-cn\">9pnet</span></div><div class=\"crayon-line\" id=\"crayon-5965501fa2ad3287198594-3\"><span class=\"crayon-cn\">9pnet_virtio</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>然后重新生成initramfs即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ad6870718556\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nupdate-initramfs -u</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ad6870718556-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ad6870718556-1\"><span class=\"crayon-v\">update</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">initramfs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>内核驱动设置好了，就可以启动qemu虚拟机了，这里假定Ubuntu的rootfs已经被mount到了<code>/var/lib/machines/ubuntu</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965501fa2ad9150198418\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nqemu-system-x86_64 -enable-kvm -m 16G -kernel /var/lib/machines/ubuntu/vmlinuz -initrd /var/lib/machines/ubuntu/initrd.img -virtfs local,id=root9p,path=/var/lib/machines/ubuntu,security_model=passthrough,mount_tag=root9p -nographic -append \'root=root9p rw rootfstype=9p rootflags=trans=virtio console=ttyS0 init=/lib/systemd/systemd\'</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965501fa2ad9150198418-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965501fa2ad9150198418-1\"><span class=\"crayon-v\">qemu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">enable</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">kvm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16G</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">kernel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">machines</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vmlinuz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">initrd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">machines</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initrd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">img</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">virtfs </span><span class=\"crayon-v\">local</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">root9p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">machines</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">security_model</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">passthrough</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">mount_tag</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">root9p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">nographic</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">append</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'root=root9p rw rootfstype=9p rootflags=trans=virtio console=ttyS0 init=/lib/systemd/systemd\'</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>最后放一张成功的截图：<br>\n<a class=\"fancybox fancybox.image\" href=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/qemu-ubuntu.png\" rel=\"group\"><img title=\"\" src=\"https://zasdfgbnm.github.io/2017/06/29/%E8%83%BD%E5%BD%93%E4%B8%BB%E5%8A%9B%EF%BC%8C%E8%83%BD%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E8%BF%98%E8%83%BD%E9%9A%8F%E6%97%B6%E6%89%93%E5%8C%85%E5%B8%A6%E8%B5%B0%EF%BC%8CLinux%E5%B0%B1%E6%98%AF%E8%BF%99%E4%B9%88%E5%BC%BA%E5%A4%A7/qemu-ubuntu.png\" alt=\"qemu-ubuntu.png\"></a></p>\n<p>全剧终</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111672\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111672votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111672\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('C++ 中命名空间的 5 个常见用法', '2017-07-12', 'http://blog.jobbole.com/111472/', '870e31215fb1729110ca515f2094da90', 'http://jbcdn2.b0.upaiyun.com/2016/05/eca4be2ffe4b0cb57637c10c6a35a454.png', 'full/da35ad566039b9a47e7be77df46f799f2628ed32.jpg', '0', '0', '1', 'C/C++,C++', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://cppdepend.com/blog/?p=79\">CppDepend Team</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32479\">王江平</a>   </div><p>译者注：可能很多程序员对C++已经非常熟悉，但是对命名空间经常使用到的地方还不是很明白，这篇文章就针对命名空间这一块做了一个叙述。</p>\n<p>命名空间在1995年被引入到 c++ 标准中，通常是这样定义的:</p>\n<blockquote>\n<div>命名空间定义了新的作用域。它们提供了一种避免名称冲突的方法。</div>\n</blockquote>\n<p>c++ 中的命名空间通常用于避免命名冲突。尽管命名空间在最近的 c++ 代码中广泛使用，但大多数较旧代码都不使用此工具。</p>\n<p>基于对众多C++项目源码的探索与研究，总结出了在这些项目中使用命名空间的一些常见原因。</p>\n<p><strong>1-避免名称冲突</strong></p>\n<p>如前所述，这是在C++中使用命名空间最常见的原因，在这种情况下，它们的使用只是对编译器有效。无法为开发人员在代码可读性和维护性方面带来什么价值。</p>\n<p><strong>2-模块化应用程序</strong></p>\n<p>命名空间采取 “Namespace-by-feature ”的方法使代码模块化。”Namespace-by-feature” 通过命名空间来反映功能集。它将具有相互关联的项归类在同一个命名空间。这会形成具有高内聚低耦合（译者注：高内聚是指一个软件模块是由相关性很强的代码组成，只负责一项任务。耦合是一个软件结构内不同模块之间互连程度的度量）、模块性很强的命名空间。</p>\n<p>Boost是按功能分组的最佳示例， 它包含数以千计的命名空间， 每一个都用于对特定功能进行分组。</p>\n<p><strong>3-匿名命名空间</strong></p>\n<p>匿名的命名空间可避免产生全局静态变量。您创建的 “匿名” 命名空间只能在创建它的文件中访问。</p>\n<p><strong>4-解决枚举类型成员重名问题</strong></p>\n<p>如果在同一个作用域内定义了具有相同名称的枚举，C++中的“传统”枚举会在其作用域内导出枚举值，可能会导致名称冲突，</p>\n<p>在一个大型项目中，不能保证两个不同的枚举都不会以同名命名。这个问题在C++ 11中已经得以解决，它使用枚举类，隐式地对枚举名称中的枚举值进行定义。</p>\n<p>许多年前, 使用在命名空间内声明枚举的技巧解决这个问题, 而不是像这样声明枚举</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59656275f3adc164437504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n enum status{  \r\n   status_ok,  \r\n    status_error  \r\n};</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59656275f3adc164437504-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59656275f3adc164437504-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59656275f3adc164437504-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59656275f3adc164437504-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59656275f3adc164437504-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">enum</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59656275f3adc164437504-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">status_ok</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59656275f3adc164437504-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">_</span>error<span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59656275f3adc164437504-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>它在命名空间中声明:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59656275f3ae5782711271\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n namespace status{  \r\n   enum status{  \r\n     ok,\r\n      error  \r\n };  \r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59656275f3ae5782711271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59656275f3ae5782711271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59656275f3ae5782711271-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59656275f3ae5782711271-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59656275f3ae5782711271-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59656275f3ae5782711271-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59656275f3ae5782711271-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59656275f3ae5782711271-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">enum</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59656275f3ae5782711271-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">ok</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59656275f3ae5782711271-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">error</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59656275f3ae5782711271-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59656275f3ae5782711271-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>许多 c++ 项目使用此技巧，例如Unreal Engine（译者注：UNREAL ENGINE中文名称为“虚幻引擎” ，是目前世界最知名授权最广的顶尖游戏引擎，占有全球商用游戏引擎80%的市场份额）源代码就广泛使用此技术。</p>\n<p><strong>5-隐藏实现</strong></p>\n<p>对于在头文件中实现的模板库，开发者在调用时不需要用到特殊的数据类型，因为他们只专注于功能的实现，所以对于找到一种适合开发者调用库的方法是很有趣的。在c#中， “internal” 关键字做了这项工作， 但是在c++中，没有办法将公有数据类型完全对开发者进行隐藏。</p>\n<p>在模块中将定义和实现分离，是由Boost库开发者们创建的一个c++惯用语法，但这些定义必须按照规则放入到一个可供开发者调用sub-namespace（子命名空间）中。</p>\n<p>例如在 boost::math文档中， 它指定:</p>\n<div>引用</div>\n<blockquote>\n<div>不适用于应用程序的函数是在 boost::math::detail中。</div>\n</blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111472\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111472votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111472\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('2017 年最佳开源网络监控工具', '2017-07-12', 'http://blog.jobbole.com/111458/', '8f86159a04608f8daae91ab61b818f76', 'https://static.oschina.net/uploads/space/2017/0610/222601_ElXA_2894582.jpg', 'full/e397352deab3de2274f1bc8a890a2853cf7a627e.jpg', '0', '6', '1', '工具与资源,开源,网络监控', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.computerworlduk.com/galleries/open-source/best-open-source-network-management-tools-3644057/\">Christina Mercer</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/best-open-source-network-monitoring-tools-2017\">开源中国</a>   </div><p>对开源软件的需求持续增长，网络管理工具已经适应了这一浪潮。你不再需要为可能不是你所需的软件支付小额的费用，请留意下（大部分）免费的开源工具，用来监控、配置和映射你的联网设备。</p>\n<p>这里有 14 个开源网络监控工具来协助IT管理员完成工作。</p>\n<h3><strong>1. 开源网络监控工具： NetXMS</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/222601_ElXA_2894582.jpg\"></p>\n<p><a href=\"https://www.netxms.org/\" target=\"_blank\" rel=\"nofollow\">NetXMS</a> 提供了企业级开源网络管理和监控程序，它在Windows和Linux上有一个简单的用户界面。<br>\nNetXMS通过相对简单的安装过程为IT基础架构的所有层提供了分布式网络监控、自动化网络发现和详细报告。<br>\n此外，服务器设备和代理对于这样一个全面的产品来说是相当轻量级的。</p>\n<h3><strong>2. 开源网络监控工具: Pandora FMS</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225036_iqEA_2894582.jpg\"></p>\n<p>定位于企业级， <a href=\"https://pandorafms.com/monitoring-solutions/network-monitoring/\" target=\"_blank\" rel=\"nofollow\">Pandora FMS</a> 提供了一个时尚且整洁的用户体验，提供了易于阅读的快速洞察工具以及重要的网络统计信息，例如网络状态、已上报的告警、已部署的代理数量和其他最近执行任务的列表。</p>\n<p>Pandora FMS可以在无需外部访问的情况下执行网络诊断，这意味着用户可以更快地响应任何网络问题。事实上，FMS声称，在代理模式下的器监控系统响应速度约为10秒。</p>\n<h3><strong>3. 开源网络监控工具: Cacti</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225046_S2NE_2894582.jpg\"></p>\n<p>最初发布于2001年，<a href=\"http://www.cacti.net/\" target=\"_blank\" rel=\"nofollow\"> Cacti</a> 是一款开源的基于Web的网络监控和专为数据记录而设计的图形化工具。它可以用于实时显示网络数据，如CPU负载或带宽利用率。</p>\n<p>Cacti是RRDtool的前端应用程序，RRDtool是一种用于存储实时变化数据的开源数据库工具，其使用SNMP作为其默认收集算法，但如果你喜欢本地Perl的PHP脚本，那么你也可以使用它们。</p>\n<p>其最新版本0.8.8h于2016年5月发布，主要功能包括无限图形项目、图形自动填充支持、图形数据处理、自定义数据采集脚本、内置SNMP支持、图形模板、数据源模板、主机模板和基于用户的管理。</p>\n<h3><strong>4. 开源网络监控工具: GroundWork Monitor Core</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225056_4gdH_2894582.jpg\"></p>\n<p><a href=\"https://www.gwos.com/\" target=\"_blank\" rel=\"nofollow\">GroundWork Monitor Core</a> 是监控网络、应用和云计算使用情况的平台。开源版本包含最多可监控50个设备和基于社区的支持的许可证，该软件还有其对应的商业版本。</p>\n<p>在其网络管理功能方面，GroundWork提供网络和设备的自发现和维护、拓扑、报警控制、通过API/SNMP/IPMI的数据收集和对OpenDaylight SDN的支持等功能。</p>\n<p>GroundWork还提供了存储管理，支持大规模的企业级供应商，如NetApp和EMC，以及从磁盘、块或对象存储的数据收集和存储缓冲以及中断可视化。<br>\n由于GroundWork的一站式网络管理方法，这种套件可能更适合那些寻找成熟品牌的大型商业和企业，而不是以开发人员为重点的工具，如Big Brother或Big Sister。</p>\n<h3><strong>5. 开源网络监控工具：Hyperic</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225111_6poD_2894582.jpg\"></p>\n<p>VMware的<a href=\"http://www.vmware.com/products/vrealize-hyperic.html\" target=\"_blank\" rel=\"nofollow\">Hyperic</a>工具用于在物理、虚拟或云环境下监控Web应用程序及其性能。 它适用于应用程序服务器，web服务器，数据库，操作系统，虚拟机管理程序，消息传递服务和目录服务器。</p>\n<p>Hyperic提供基础架构和操作系统监控，详细的报告，应用程序和中间件监控，警报和修复工作流程以及通用可扩展的API。</p>\n<p>该网络监控工具提供了企业版本，可以提高网络警报功能，并且能更好地创建基准。</p>\n<h3><strong>6. 开源网络监控工具: Observium</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225121_LLdQ_2894582.jpg\"></p>\n<p>基于Linux的<a href=\"http://www.observium.org/\" target=\"_blank\" rel=\"nofollow\">Observium</a>是一个自动监测的网络监控工具。 据该网站介绍，“该工具是由一批经验丰富的专业网络工程师和系统管理员开发和维护的，Observium是一个由用户自己设计和构建的平台。”</p>\n<p>Observium提供社区版本和专业版，使用RRDTool进行缓冲存储和图形化功能，并具有易于使用的用户界面和报告功能。 但是，它没有报告导出功能，这可能对商务应用来讲会是一个问题。</p>\n<p>社区版本将为用户提供对所有支持设备或指标的完整自动监测功能，通过自动发现协议进行网络映射，自动识别数百种设备，并且每六个月发布一个新版本。</p>\n<p>而专业版用户将获得所有社区版本的功能并且还将获得实时软件更新和修复功能，基于规则的自动分组功能，网络阈值和状态警报系统以及流量统计系统。</p>\n<h3><strong>7. 开源网络监控工具: Zabbix</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225227_Aw2c_2894582.jpg\"></p>\n<p><a href=\"http://www.zabbix.com/\" target=\"_blank\" rel=\"nofollow\">Zabbix</a> 作为企业级的网络监控工具，通过从服务器，虚拟机和网络设备收集的数据提供实时监控，自动发现，映射和可扩展等功能。</p>\n<p>Zabbix的企业级监控软件为用户提供内置的Java应用服务器监控，硬件监控，VMware监控和CPU，内存，网络，磁盘空间性能监控。</p>\n<p>该企业级网络监控工具能够每分钟进行 3,000,000 次检查，具有更高的安全性和数据中心监控功能。</p>\n<h3><strong>8. 开源网络监控工具: Nagios</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225235_kIpK_2894582.jpg\"></p>\n<p><a href=\"https://www.nagios.org/\" target=\"_blank\" rel=\"nofollow\">Nagios</a> 是一款用于监控IT基础架构和查看当前状态、历史日志和基本报告的开源软件工具。 Nagios 用户可以监控系统指标，网络协议，应用程序，服务器，网络基础架构和接收故障警报。</p>\n<p>Nagios提供三种类型的网络管理工具，Nagios XL，Nagios日志服务器和Nagios网络分析器。其中 Nagios XL 最适合网络监控（尽管其他两种也提供网络监控服务）。</p>\n<p>Nagios XL提供企业级网络监控，为用户提供带宽报告，网络心跳监控，自定义URL，电子邮件报告和远程机器监控。 升级的企业版提供基于Web的服务器控制台访问，业务流程监控，记录审核和自动化删除功能。</p>\n<h3><strong>9. 开源网络监控工具: NetDisco</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225246_lLsB_2894582.jpg\"></p>\n<p><a href=\"https://metacpan.org/pod/App::Netdisco\" target=\"_blank\" rel=\"nofollow\">NetDisco</a>专为类 Unix 操作系统而设计，通过NSMP提供基于网络的自动发现网络设备的功能，从而生成网络拓扑图。它是专为中型到大型网络而设计的。</p>\n<p>该网络管理工具可用于定位设备，创建设备目录并报告IP地址和交换机端口使用情况。</p>\n<p>NetDisco用户可以通过MAC或IP在网络上定位机器，关闭交换机端口，或更改端口的VLAN或PoE状态，按照型号，供应商，软件和操作系统对网络硬件进行清点，并给你的网络创建一个详细的拓扑图。</p>\n<h3></h3>\n<h3><strong>10. 开源网络监控工具: OpenNMS</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225255_FOmY_2894582.jpg\"></p>\n<p><a href=\"https://www.opennms.org/en\" target=\"_blank\" rel=\"nofollow\">OpenNMS</a>是在1999年发布的，旨在为大型企业级用户提供事件管理，服务监控和性能测量。</p>\n<p>使企业用户受益的主要特点包括外部脚本、向通话系统工程师发送警报、扩展Java本机通知策略API、请求跟踪（RT）集成、高级警报、IPv4和IPv6网络可达性超过ICMP、测试状态和节点库存信息。</p>\n<p>企业服务或是“风格”网络提供预置事件，通知，数据收集，工作流和附加报告等功能。</p>\n<h3><strong>11. 开源网络监控工具：RANCID</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225304_sbWJ_2894582.jpg\"></p>\n<p><a href=\"http://www.shrubbery.net/rancid/\" target=\"_blank\" rel=\"nofollow\">RANCID</a> 听起来像一个消极的名字，除非你学会Really Awesome New Cisco的配置。这一点意味着它能监视路由器或其他设备的配置，并维护任何更改过的历史记录。RANCID 支持很多供应商设备，包括 Juniper路由，HP交换机，Redback的NAS 和 很多对Observium有扩展设备的支持。</p>\n<p>RANCID支持许多供应商的设备，包括Juniper路由器，HP交换机，Redback NAS和许多其他设备，以及对Observium的扩展支持。</p>\n<p>RANCID提供多种网络管理功能，包括登录到路由器表（router.db）中的每个设备，运行各种命令以获取将被保存的信息，将之前收集的信息中的任何变化发送到邮件列表，并提交这些更改到版本控制系统。</p>\n<h3></h3>\n<h3><strong>12. 开源网络监控工具: Xymon</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225312_W73h_2894582.jpg\"></p>\n<p>另一个需要提及的网络监控工具是Xymon（以前称为Hobbit）。 Xymon监控服务器，应用程序和网络，通过网页提供有关所有这些网络组件运行状况的信息。</p>\n<p>其网站上表示Xymon的开发受到Big Brother的启发，同Big Sister一样，它试图解决Big Brother BTF的缺点，如性能方面。 同时，Xymon更容易部署并且是免费的。</p>\n<h3><strong>13. 开源网络监控工具: Big Brother BTF</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225324_M2Lp_2894582.jpg\"> Big Brother创建于20世纪90年代中期，用于监控网络系统，后来被Quest Software收购，而其又被戴尔在2012年收购。</p>\n<p>许多其他网络监控工具都是模仿Big Brother的，所以它有一个大型的、详细的论坛和有帮助的开发人员社区，是初学者的好选择。</p>\n<p>除了可用于学生和非商业用途的开源版本之外，其还提供了名为Big Brother Professional Edition的商业版本。</p>\n<h3><strong>14. 开源网络监控工具: Big Sister</strong></h3>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0610/225337_KP2a_2894582.jpg\"></p>\n<p><a href=\"http://www.bigsister.ch/bigsister.html\" target=\"_blank\" rel=\"nofollow\">Big Sister</a>创始人托马斯·艾比（Thomas Aeby）表示，他对Big Brother的网络监控印象深刻，但希望提高其性能，减少坏事件发生时的警报数量，并进行其他改进。</p>\n<p>Big Sister提供网络监控，节点管理，doxygen过滤器和Web应用程序框架，作为Unix衍生产品和Microsoft Windows操作系统的一部分。</p>\n<p>Big Sister对监控网络系统的IT管理员有所帮助。当系统故障时，它会通知管理员，生成状态变化历史记录日志并显示各种系统性能数据。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111458\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111458votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111458\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('减轻服务器负载的建议和技巧', '2017-07-12', 'http://blog.jobbole.com/111725/', '9098565e7972c6d0a1a0f5f75c2f05cb', 'http://jbcdn2.b0.upaiyun.com/2017/06/48bf315aeeae9f3a7ce0b11b7c6ce31e.png', 'full/b115c033c502899f0a878f54b5a62805b0d233b4.jpg', '0', '1', '1', 'IT技术,服务器', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/haowang1989\">王浩</a> 翻译，<a href=\"http://www.jobbole.com/members/8zjl8\">周进林</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.lucidchart.com/techblog/2017/06/02/tips-tricks-for-reducing-server-load/\">lucidchart</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我们公司有个面向服务的架构。其中一个服务是字体服务，字体体系和 unicode 编码范围（unicode range）提供字体数据，为用户上传的字体验证权限。我们没想到这个字体服务会有很高的负载<sup>1</sup>（负载是指线程消耗和 CPU 等待的平均值）。但是去年我们注意到字体服务出人意料地出现高负载，尤其是晚上我们没什么流量的时候。幸运的是，我们发现了这一问题的根本原因，并大幅提升了字体服务的性能和系统整体的稳定性。以下内容是我们的优化过程。</p>\n<figure><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/48bf315aeeae9f3a7ce0b11b7c6ce31e.png\"><img class=\" wp-image-64903 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/48bf315aeeae9f3a7ce0b11b7c6ce31e.png\" alt=\"Figure 1: Server load before and after change. (Fix was released Dec 21.)\" width=\"661\" height=\"191\"></a><br>\n<figcaption style=\"text-align: center;\">图1：修改前后系统复制（12 月 21 日发布修复版本）</figcaption>\n</figure>\n<h3>用火焰图调试</h3>\n<p>我一个同事从 Netflix 公司的 Brendan Gregg 那里发现并部署了一个小巧的火焰图工具。这个工具可以把多个性能检测工具的数据结合起来，生成一张本地方法和 JVM 方法资源使用情况的图象。图里每一个矩形都代表一个栈帧，矩形的宽度代表资源的使用情况，如 CPU 时间，y 轴代表调用栈。你可以简单地通过找出比较宽的矩形来定位出问题所在。这个工具对于调试字体服务的性能是非常宝贵的。</p>\n<figure><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/092148cc9b6180af009d4a106022a936.png\"><img class=\"wp-image-64904 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/092148cc9b6180af009d4a106022a936.png\" alt=\"Figure 2: A flame graph from a font server during high load.\" width=\"556\" height=\"485\"></a><br>\n<figcaption style=\"text-align: center;\">图2：字体服务器高负载情况下的一张火焰图</figcaption>\n</figure>\n<p>我们收集了几张字体服务高负载状态下的火焰图。下面展示了其中一张，图里有一处 JVM 部分几乎到顶。我们很快注意到这些图的规律。绝大部分时间都是消耗在 libz.so（用于 gzip 压缩和解压）上，而 JVM 里的绝大部分时间都是消耗在 XML 转义和 UTF-8 编码上。</p>\n<figure><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/00be5bb53f79bfbbc30d7eebd570113a.png\"><img class=\"wp-image-64905 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/00be5bb53f79bfbbc30d7eebd570113a.png\" alt=\"Figure 3: A flame graph zoomed in to the JVM portion.\" width=\"555\" height=\"485\"></a><br>\n<figcaption style=\"text-align: center;\">图3：在 JVM 部分放大的火焰图</figcaption>\n</figure>\n<h3>为什么这么慢</h3>\n<p>首先，介绍一点关于我们字体服务如何工作的背景。我们将字体数据保存在 Amazon S3 容器中，每一种字体的每一 unicode 编码范围（unicode range）是一个独立的对象。其他服务会为字体体系、一系列 unicode 编码范围（unicode range）或者用户来请求字体数据。字体服务会下载用户请求的字体体系中特定 unicode 编码范围（unicode range）的数据，并返回包含这所有数据的 XML。</p>\n<p>这一功能非常简单，并没有什么明显密集计算的东西。然而，我们遇到了高负载。我们在火焰图的帮助下发现 libz、XML 转义和 UTF8 编码占用了 CPU 大量资源。但是为什么我们花了这么多时间在编码和压缩上呢？记得我刚才说的，晚上负载最高吗？我们的晚上（美国山区标准时）在亚洲是白天。每当晚上我们本地没什么流量的时候，大量其他地区的用户正在用亚洲语言的 unicode 编码范围（unicode range），比如中文、日语和韩语。事实上，相比起来这些类别的字体数据是非常庞大的。这些数据通过 gzip 解压、UTF-8 解码然后 XML 转义、UTF-8 编码最后 gzip 压缩。对于体积很小的基本拉丁文类别，这一过程没什么。然而，CJK 类别比基本拉丁文类别大了两个数量级（1MB 对比 60KB）。对于这些体积大的字体类别，这所有的转换都使得 CPU 吃不消。Gzip 压缩和解压相对很耗资源，XML 转义也没有那么快。</p>\n<h3>怎样加速</h3>\n<p>字体服务响应的内容本质上只是来自 S3 的原始数据。字体服务的确做了其他重要的工作，比如权限验证，查找字体关键字。但是没有理由必须让字体服务从 S3 转发字体数据。我们的解决方案非常简单粗暴，直接返回一系列包含字体数据的 S3 对象的链接，而不是通过字体服务下载然后重新编码字体数据。</p>\n<p>这一修改几乎将字体服务器的负载降为 0（见图1）。客户端服务器也察觉不到任何影响。尽管我们第一次尝试非常成功，但我也应该记住，我们部署的同时增加了功能发布控制，它可以让我们在 100% 启用前，先启用一定比例的请求来测试它能够正常工作。</p>\n<h3>结论</h3>\n<p>通过对生产环境服务器的监控，我们能够定位并删除服务器上没必要的功能。下面是我们这次经历中几个关键的步骤：</p>\n<ol>\n<li>用火焰图等性能检测工具定位那些霸占 CPU 的功能方法。</li>\n<li>压缩和其他编码也会非常耗资源。</li>\n<li>如果客户端能够直接获取到数据，那么直接发给它一个连接而非转发数据会提升整体的性能。（声明：这并不是灵丹妙药，有些情况下会对客户端性能造成损失，因为它必须要做二次请求）。</li>\n</ol>\n<p>#1: 负载是指线程消耗和 CPU 等待的平均值。见 <a href=\"https://en.wikipedia.org/wiki/Load_%28computing%29\">Wikipedia</a>。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/19b948cb00fa062128f45b2b53fa09e2.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d327bdec80a27c733bd7b9edb35d30f4.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111725\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111725votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111725\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/haowang1989\">王浩</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/haowang1989\">\r\n			<img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/47586e0af10336a9ced0cb16d851200f.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            phper @深圳        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/haowang1989\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/haowang1989/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/haowang1989/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ontheroads\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('如何从参与开源项目的过程中获取自信', '2017-07-12', 'http://blog.jobbole.com/109892/', '9261ff54c843739fda641c040280ce25', 'http://jbcdn2.b0.upaiyun.com/2017/05/b94146f42c8e0ca2b0f04ed89b59053c.jpg', 'full/dd36e1ac9db2af41888b4a17b76a865bb91d4510.jpg', '0', '1', '1', '其他,开源', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/1/3-ways-improve-your-confidence\">Laura Hilliger</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8592-1.html\">Linux中国/GHLandy</a>   </div><p>随着大脑的发育，你渐渐学会了这世上什么事情可以/应该做，以及什么事情不能/不应该做。你所有的行为都受到周围大众的影响，很多时候，阻碍你参与某事的原因就是你缺乏自信。</p>\n<p>纵观我们的生活，我们都或多或少的受到了世俗和社会行为的“教条”影响。我们可能从小就被这样教育：演说家说的都是真理、CEO 都是有远见的、警察维护社会秩序，尊重别人代表着静听让人把话说完，如果人家说错了，你要看场合轻柔的指出来 —— 好吧，这有点复杂。</p>\n<p>当你决心参与到开源项目之中去的时候，自信将扮演重要角色。开源社区有其固有的参与性。参与就相当于开源世界的流通货币，持有该货币的量取决于你的自信。你的参与性越高、技能越高、分享你的想法和简洁次数越多，你就越能通过自己的<ruby>提交<rt>commit</rt></ruby>来改善某一个项目。所有这些都需要你有很强的信念 —— 你有值得分享的事情 —— 并且你会常常思考自己要做什么、分享什么。</p>\n<p>这里不得不说说这样一个事实：我们每一个人都一些值得分享的事情。但是你要找出这个值得分享的事情是什么，以及在哪个位置分享它才能把这个分享推向最积极、最有意义的一面。</p>\n<p>认真思考一下三点，这将增强你的自信，并能让你在开源社区中更容易取得进步。</p>\n<h3 id=\"toc_1\">没有人会站在你的角度来看待你</h3>\n<p>你要时刻谨记着：你是完全独立的个人，他人对你做出的评论就像是不存在一样，只有这样才能更好的获得自信。</p>\n<p>我们都习惯了这样认知，周围的人都是根据我们的行为来做出评判的。这一习惯是学习如何更像社会群体一样生活的副产品。而且很可能在我们的童年，父母根据我们的行为设置的奖励机制时，这个习惯就根植我们心底。到了青春期，老师们对我们的表现来评价，给我们划分等级和分数，拿我们和身边的小伙伴对比。这样的动力和奖励机制给我们的大脑建立了一个包括自我反思在内的反馈回路。我们需要预测自己能否得到回报，并要为那些可能发生的事情做好应对。</p>\n<p>现今的我们都有这样第一个疑惑：身边的人是如何看我的？然而，真相是多数人都不会花太多时间来对你进行正确客观的评价。我们所有人只是关注自己的回报，我们有自己热衷于某件事的的热情、有大量急待解决的问题。也有一些人忙于关心他们自己如何影响身边的人，他们并不会在身上花费时间。他们根本不会注意到你是否出错、大声谈话还是像他们的背景音乐一样。所有的那些疑惑都只是在你自己的脑海中而已，而非在其他任何人脑中。</p>\n<p>我们需要被人们所接受的愿望也是人生意义的一部分，但是这类受我们所遇之人的一时兴起。这些人可能对我们缺乏全面认识，比如我们叫什么、我们来自哪里、形成我们认知的经历，等等。我们能否为人们所接受是一件不受我们自身控制的事情。但是，我们是可以通过与之交流来改变的。</p>\n<p>在开源的社区化世界里，记住这一点是非常重要的：人们是不会过多的考虑你的感受的。因为你的同事和导师都在忙于其它项目或则社区成员。</p>\n<p>一旦你认知了这一点，通过积极地沟通来热情拥抱这个世界吧。寻求帮助、告知他人你的需求、指出你的贡献、让人们知道你和他们在一起努力、你也是这个社区中的活跃分子。当人们向你靠拢 ——而非相反 —— 时，你的开源可信度和自信会得到极大的提高。</p>\n<h3 id=\"toc_2\">所有人都热衷于分享自己熟知的事情</h3>\n<p>任何成功的开源社区都是一个包含教和学的社区。为沐浴在开源中，你不仅需要用到自身的已有知识，还需要不断的吸收消化其他人提供课程中的知识。幸运的是，人们都普遍热衷于分享他们熟悉的事情。</p>\n<p>思考一下，当他人问及你的观点时，你是什么感受。得知他人认可了你所说的观点，对你的本我和自我是多么美好的一件事。</p>\n<p>在儿童期时，我们的大脑并没有那么发达，无法为我们容纳现实世界中大量的信息量。我们曾一度认为自己是世界的中心。在六岁以前，我们的认知一直在不断成长。在此期间，我们的父母会因我们哭泣而做出回应，周围的成年人都会满足我们要求。这会在我们心底形成自己在世界上最重要的证据。</p>\n<p>我们的神经回路在此期间建立完成，我们的性格也在此期间形成。随着我们学会参与社会和城市的生活，我们逐渐的认识到自己并非世界的中心。然而，最初形成并深植我们心底那种意识并不会因此马上就消除掉。正确理解我们在整个社会氛围中的个人意识将有助于你与他人建立连接并融洽相处。</p>\n<p>在团结协作中慢慢积累学习经验可以很好的磨练自己、发展自己社会关系和提高自身技能。想要进军开源的世界，不断地学习是不可或缺的。</p>\n<p>那么，这些和自信有些什么关系呢？通过表明你重视他人的知识和付出，你提高的不仅是他们的自信，还有你自己的自信。那时你将会感到更加灵活。有些时候，你不得不承认自己也有不懂的地方。</p>\n<p>自信的人也许会说“是的，我不知道”，但却不会因此而沮丧。</p>\n<h3 id=\"toc_3\">一分耕耘，一分收获</h3>\n<p>你一定听过“不懂装懂，永远是饭桶”。这样说吧，自信就像其他很多的心理现象。积极地提示自己：我很聪明、有趣、引人关注、极富天赋、健谈、是一个很好的伙伴、独一无二、知识面广、学习能力强、常常自省的思想者，或者是其他你想要具备的特质，久而久之你就会觉得自己就是这样的人。并且，如果这可以在你身上生效，在其他人身上也一样。。</p>\n<p>我们把这个称为自我肯定。</p>\n<p>此外，在开源的世界中，你是如何为人考虑、如何待人，那么反过来，他人也会是这样的。如果你想在开源贡献中获得成功，你就要有足够的自信来相信自己坚持的立场和事物，当然了，你要以一种可以让人接受的方式来表现，同时还要包容其他的意见和观点。领导者的标志就是，在生活中塑造他们想要看到的形象，而不管是否有他人模仿。</p>\n<p>那么，你是否有其他增强自信的方法呢？记得在评论区告诉我们哦。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"109892\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"109892votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"109892\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('王垠：如何掌握所有的程序语言', '2017-07-12', 'http://blog.jobbole.com/111469/', '939ee37643c72df31691e8a75739908f', 'http://jbcdn2.b0.upaiyun.com/2017/01/f9dc3a6611e10b616985757498ed6a74.jpg', 'full/9a8539839727cdcb8492a550ef7b35f838a85f14.jpg', '2', '15', '5', '开发,,编程语言', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.yinwang.org/blog-cn/2017/07/06/master-pl\">王垠</a>   </div><p>对的，我这里要讲的不是如何掌握一种程序语言，而是所有的……</p>\n<p>很多编程初学者至今还在给我写信请教，问我该学习什么程序语言，怎么学习。由于我知道标题问题的答案，所以总感觉这个问题是如此“低级”，一直没来得及回复 :P 可是逐渐的，我发现原来不只是小白们有这个问题，就连美国大公司的很多资深工程师，其实也没搞明白。</p>\n<p>今天休闲活动进入第二个星期，稍微闲下来一点，我想来统一回答一下这个搁置已久的“初级问题”。这个话题貌似曾经写过，然而现在我想把它重新写一遍。因为通过跟很多人的交流，我对自己头脑中的（未转化为语言的）想法，有了更精确的表达。</p>\n<p>如果你存在以下的种种困惑，那么这篇文章也许会对你有所帮助：</p>\n<ol>\n<li>你是编程初学者，不知道该选择什么程序语言来入门。</li>\n<li>你是资深的程序员或者团队领导，对新出现的种种语言感到困惑，不知道该“投资”哪种语言。</li>\n<li>你的团队为使用哪种程序语言争论不休，发生各种宗教斗争。</li>\n<li>你追逐潮流采用了某种时髦的语言，结果两个月之后发现深陷泥潭，痛苦不堪……</li>\n</ol>\n<p>虽然我已经不再过问这些世事，然而无可置疑的现实是，程序语言仍然是很重要的话题，这个情况短时间内不会改变。程序员的岗位往往会要求熟悉某些语言，甚至某些奇葩的公司要求你“深入理解 OOP 或者 FP 设计模式”。对于在职的程序员，程序语言至今仍然是可以争得面红耳赤的宗教话题。它的宗教性之强，以至于我在批评和调侃某些语言（比如 Go 语言）的时候，有些人会本能地以为我是另外一种语言（比如 Java）的粉丝。</p>\n<p>显然我不可能是任何一种语言的粉丝，我甚至不是 Yin 语言的粉丝 ;) 对于任何从没见过的语言，我都是直接拿起来就用，而不需要经过学习的过程。看了这篇文章，也许你会明白我为什么可以达到这个效果。理解了这里面的东西，每个程序员都应该可以做到这一点。嗯，但愿吧。</p>\n<h3 id=\"重视语言特性而不是语言\">重视语言特性，而不是语言</h3>\n<p>很多人在乎自己或者别人是否“会”某种语言，对“发明”了某种语言的人倍加崇拜，为各种语言的孰优孰劣争得面红耳赤。这些问题对于我来说都是不存在的。虽然我写文章批评过不少语言的缺陷，在实际工作中我却很少跟人争论这些。如果有其它人在我身边争论，我甚至会戴上耳机，都懒得听他们说什么 ;) 为什么呢？我发现归根结底的原因，是因为我重视的是“语言特性”，而不是整个的“语言”。我能用任何语言写出不错的代码，就算再糟糕的语言也差不了多少。</p>\n<p>任何一种“语言”，都是各种“语言特性”的组合。打个比方吧，一个程序语言就像一台电脑。它的牌子可能叫“联想”，或者“IBM”，或者“Dell”，或者“苹果”。那么，你可以说苹果一定比 IBM 好吗？你不能。你得看看它里面装的是什么型号的处理器，有多少个核，主频多少，有多少 L1 cache，L2 cache……，有多少内存和硬盘，显示器分辨率有多大，显卡是什么 GPU，网卡速度，等等各种“配置”。有时候你还得看各个组件之间的兼容性。</p>\n<p>这些配置对应到程序语言里面，就是所谓“语言特性”。举一些语言特性的例子：</p>\n<ul>\n<li>变量定义</li>\n<li>算术运算</li>\n<li>for 循环语句，while 循环语句</li>\n<li>函数定义，函数调用</li>\n<li>递归</li>\n<li>静态类型系统</li>\n<li>类型推导</li>\n<li>lambda 函数</li>\n<li>面向对象</li>\n<li>垃圾回收</li>\n<li>指针算术</li>\n<li>goto 语句</li>\n</ul>\n<p>这些语言特性，就像你在选择一台电脑的时候，看它里面是什么配置。选电脑的时候，没有人会说 Dell 一定是最好的，他们只会说这个型号里面装的是 Intel 的 i7 处理器，这个比 i5 的好，DDR3 的内存 比 DDR2 的快这么多，SSD 比磁盘快很多，ATI 的显卡是垃圾…… 如此等等。</p>\n<p>程序语言也是一样的道理。对于初学者来说，其实没必要纠结到底要先学哪一种语言，再学哪一种。曾经有人给我发信问这种问题，纠结了好几个星期，结果一个语言都还没开始学。有这纠结的时间，其实都可以把他纠结过的语言全部掌握了。</p>\n<p>初学者往往不理解，每一种语言里面必然有一套“通用”的特性。比如变量，函数，整数和浮点数运算，等等。这些是每个通用程序语言里面都必须有的，一个都不能少。你只要通过“某种语言”学会了这些特性，掌握这些特性的根本概念，就能随时把这些知识应用到任何其它语言。你为此投入的时间基本不会浪费。所以初学者纠结要“先学哪种语言”，这种时间花的很不值得，还不如随便挑一个语言，跳进去。</p>\n<p>很多初学者不了解，一个高明的程序员如果开始用一种新的程序语言，他往往不是去看这个语言的大部头手册或者书籍，而是先有一个需要解决的问题。手头有了问题，他可以用两分钟浏览一下这语言的手册，看看这语言大概长什么样。然后，他直接拿起一段例子代码来开始修改捣鼓，想法把这代码改成自己正想解决的问题。在这个简短的过程中，他很快的掌握了这个语言，并用它表达出心里的想法。</p>\n<p>在这个过程中，随着需求的出现，他可能会问这样的问题：</p>\n<ul>\n<li>这个语言的“变量定义”是什么语法，需要“声明类型”吗，还是可以用“类型推导”？</li>\n<li>它的“类型”是什么语法？是否支持“泛型”？泛型的 “variance” 如何表达？</li>\n<li>这个语言的“函数”是什么语法，“函数调用”是什么语法，可否使用“缺省参数”？</li>\n<li>……</li>\n</ul>\n<p>注意到了吗？上面每一个引号里面的内容，都是一种语言特性（或者叫概念）。这些概念可以存在于任何的语言里面，虽然语法可能不一样，它们的本质都是一样的。比如，有些语言的参数类型写在变量前面，有些写在后面，有些中间隔了一个冒号，有些没有。</p>\n<p>这些实际问题都是随着写实际的代码，解决手头的问题，自然而然带出来的，而不是一开头就抱着语言手册看得仔仔细细。因为掌握了语言特性的人都知道，自己需要的特性，在任何语言里面一定有对应的表达方式。如果没有直接的方式表达，那么一定有某种“绕过方式”。如果有直接的表达方式，那么它只是语法稍微有所不同而已。所以，他是带着问题找特性，就像查字典一样，而不是被淹没于大部头的手册里面，昏昏欲睡一个月才开始写代码。</p>\n<p>掌握了通用的语言特性，剩下的就只剩某些语言“特有”的特性了。研究语言的人都知道，要设计出新的，好的，无害的特性，是非常困难的。所以一般说来，一种好的语言，它所特有的新特性，终究不会超过一两种。如果有个语言号称自己有超过 5 种新特性，那你就得小心了，因为它们带来的和可能不是优势，而是灾难！</p>\n<p>同样的道理，最好的语言研究者，往往不是某种语言的设计者，而是某种关键语言特性的设计者（或者支持者）。举个例子，著名的计算机科学家 Dijkstra 就是“递归”的强烈支持者。现在的语言里面都有递归，然而你可能不知道，早期的程序语言是不支持递归的。直到 Dijkstra 强烈要求 Algol 60 委员会加入对递归的支持，这个局面才改变了。Tony Hoare 也是语言特性设计者。他设计了几个重要的语言特性，却没有设计过任何语言。另外大家不要忘了，有个语言专家叫王垠，他是早期 union type 的支持者和实现者，也是 checked exception 特性的支持者，他在自己的<a href=\"http://www.yinwang.org/blog-cn/2017/05/23/kotlin\">博文</a>里指出了 checked exception 和 union type 之间的关系 :P</p>\n<p>很多人盲目的崇拜语言设计者，只要听到有人设计（或者美其民曰“发明”）了一个语言，就热血沸腾，佩服的五体投地。他们却没有理解，其实所有的程序语言，不过是像 Dell，联想一样的“组装机”。语言特性的设计者，才是像 Intel，AMD，ARM，Qualcomm 那样核心技术的创造者。</p>\n<h3 id=\"合理的入门语言\">合理的入门语言</h3>\n<p>所以初学者要想事半功倍，就应该从一种“合理”的，没有明显严重问题的语言出发，掌握最关键的语言特性，然后由此把这些概念应用到其它语言。哪些是合理的入门语言呢？我个人觉得这些语言都可以用来入门：</p>\n<ul>\n<li>Scheme</li>\n<li>C</li>\n<li>Java</li>\n<li>Python</li>\n<li>JavaScript</li>\n</ul>\n<p>那么相比之下，我不推荐用哪些语言入门呢？</p>\n<ul>\n<li>Shell</li>\n<li>PowerShell</li>\n<li>AWK</li>\n<li>Perl</li>\n<li>PHP</li>\n<li>Basic</li>\n<li>Go</li>\n</ul>\n<p>总的说来，你不应该使用所谓“<a href=\"http://www.yinwang.org/blog-cn/2013/03/29/scripting-language\">脚本语言</a>”作为入门语言，特别是那些源于早期 Unix 系统的脚本语言工具。PowerShell 虽然比 Unix 的 Shell 有所进步，然而它仍然没有摆脱脚本语言的根本问题——他们的设计者不知道他们自己在干什么 :P</p>\n<p>采用脚本语言学编程，一个很严重的问题就是使得学习者抓不住关键。脚本语言往往把一些系统工具性质的东西（比如正则表达式，Web 概念）加入到语法里面，导致初学者为它们浪费太多时间，却没有理解编程最关键的概念：变量，函数，递归，类型……</p>\n<p>不推荐 Go 语言的原因类似，虽然 Go 语言不算脚本语言，然而他的设计者显然不明白自己在干什么。所以使用 Go 语言来学编程，你不能专注于最关键，最好的语言特性。</p>\n<h3 id=\"掌握关键语言特性忽略次要特性\">掌握关键语言特性，忽略次要特性</h3>\n<p>为了达到我之前提到的融会贯通，一通百通的效果，初学者应该专注于语言里面最关键的特性，而不是被次要的内容分心。我发现很多编程培训班和野鸡大学的编程入门课，往往一来就教学生如何使用 printf 打印“Hello World！”，进而要他们记忆 printf 的各种“格式字符”的意义，要他们实现各种复杂格式的打印输出，甚至要求打印到文本文件里，然后再读出来……</p>\n<p>可是殊不知，这种输出输入操作其实根本不算是语言的一部分，而且对于掌握编程的核心概念来说，都是次要的。有些人的 Java 课程进行了好几个星期，居然还在布置各种 printf 的作业。学生写出几百行的 printf，却不理解变量和函数是什么，甚至连算术语句和循环语句都不知道怎么用！这就是为什么很多初学者感觉编程很难，我连 <code class=\"highlighter-rouge\">%d</code>，<code class=\"highlighter-rouge\">%f</code>，<code class=\"highlighter-rouge\">%.2f</code>的含义都记不住，还怎么学编程！</p>\n<p>然而这些野鸡大学的“教授”头衔是如此的洗脑，以至于被他们教过的学生（比如我女朋友）到我这里请教，居然骂我净教一些没用的东西，学了连 printf 的作业都没法完成 :P 你别跟我讲 for 循环，函数什么的了…… 可不可以等几个月，等我背熟了 printf 的用法再学那些啊？</p>\n<p>所以你就发现一旦被差劲的老师教过，这个程序员基本就毁了。就算遇到好的老师，他们也很难纠正过来。</p>\n<h3 id=\"自己动手实现语言特性\">自己动手实现语言特性</h3>\n<p>在基本学会了各种语言特性，能用它们来写代码之后，下一步的进阶就是去实现它们。只有实现了各种语言特性，你才能完完全全的拥有它们，成为它们的主人。否则你就只是它们的使用者，你会永远做语言创造者们的仆人。</p>\n<p>有个大师说得好，完全理解一种语言最好的方法就是自己动手实现它，也就是自己写一个解释器来实现它的语义。但我觉得这句话应该稍微修改一下：完全理解一种“语言特性”最好的方法就是自己亲自实现它。</p>\n<p>注意我在这里把“语言”改为了“语言特性”。你并不需要实现整个语言来达到这个目的，因为我们最终使用的是语言特性。只要你自己实现了一种语言特性，你就能理解这个特性在任何语言里的实现方式和用法。</p>\n<p>举个例子，学习 SICP 的时候，大家都会亲自用 Scheme 实现一个面向对象系统。用 Scheme 实现的面向对象系统，跟 Java，C++，Python 之类的语言语法相去甚远，然而它却能帮助你理解任何这些 OOP 语言里面的“面向对象”这一概念，它甚至能帮助你理解各种面向对象实现的差异。</p>\n<p>这种效果是你直接学习 OOP 语言得不到的，因为在学习 Java，C++，Python 之类语言的时候，你只是一个用户，而用 Scheme 自己动手实现了 OO 系统之后，你成为了一个创造者。</p>\n<p>类似的特性还包括类型推导，类型检查，惰性求值，如此等等。我实现过几乎所有的语言特性，所以任何语言在我的面前，都是可以被任意拆卸组装的玩具，而不再是凌驾于我之上的神圣。</p>\n<h3 id=\"总结\">总结</h3>\n<p>写了这么多，重要的话重复三遍：语言特性，语言特性，语言特性，语言特性！不管是初学者还是资深程序员，应该专注于语言特性，而不是纠结于整个的“语言品牌”。只有这样才能达到融会贯通，拿起任何语言几乎立即就会用，并且写出高质量的代码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111469\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111469votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111469\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 15 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('数据科学家和机器学习工程师有什么不同', '2017-07-12', 'http://blog.jobbole.com/108466/', '94888647819d6f970f3339f019f4c5a9', 'http://wx3.sinaimg.cn/large/7cc829d3gy1fgkj97pnkuj20m00ejjtd.jpg', 'full/49c6509b4b6997ea4dc3eadffba385b0196497cb.jpg', '2', '3', '1', '开发,,数据科学,机器学习', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.oreilly.com/ideas/what-are-machine-learning-engineers\">Ben Lorica、Mike Loukides</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32480\">ITEYE/何冰心</a>   </div><p>近十年来，“数据科学”和“数据科学家”备受关注。但对于哪些人可以被称为是“数据科学家”，则争论不休。业界最后达成一致：只要取得数据科学相关学位、认证的研究数据的，不论是在大学还是从在线课程，都称之为数据科学家。统计数据是枯燥单一的，是非自然的，只有各种各样的数据才使得世界丰富多彩。那么，如何去分析多样的数据呢？数据科学家便应需求而生。</p>\n<p>数据科学领域飞速发展，一大波数据专家正在袭来。在企业中，他们被称为“数据科学家”或“数据科学团队”，包括：</p>\n<ul>\n<li>普通员工：执行临时的分析或报告任务（包括商业智能和商业分析）</li>\n<li>数据分析者：负责统计分析，建模，包括实验和测试</li>\n<li>机器学习建模者：构建模型原型</li>\n</ul>\n<p>那么问题来了。创造出“数据科学家”此概念并且从数据中挖掘出产品的 DJ Patil 和 Jeff Hammerbacher 属于哪一类呢？他们看似并不属于以上任何一种。若非要归类，他们大概更倾向于被看做是机器学习的建模者。他们是研究者，并没有通过数据进行产出。那么，究竟如何定义数据科学家呢？我们认为，数据科学家不仅仅是统计学家，他们一般拥有计算机科学领域的博士学位，有着大量的数据实践经验，有着很强的编码能力，精通数据提取、清洗、建模、将原型变成产品、产品设计以及数据基础建设，等等。<strong>实际上，数据科学家更应该被称作为硅谷的“独角兽”，稀有且昂贵。</strong></p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fgkj97pnkuj20m00ejjtd.jpg\"></p>\n<p>“数据科学”不分领域不分专业，它不只是精算统计、商务智能、数据仓库等，它打破了已有行业的壁垒，比如软件、市场、管理、人力等。数据科学的灵魂所在是它涵盖了数据的方方面面，各个领域。而数据科学家的任务便是收集、使用所有数据，而不是某一领域的数据。</p>\n<p>然而，找到这些稀有的“独角兽”是极其困难的。因此，我们把其职能根据专业性进行划分，数据工程师便诞生了。数据工程师精通数学和统计学，但他们不只是数学家或统计学家，他们精通软件开发和编程，但又不只是程序员。数据工程师负责数据栈操作和维护，Hadoop 或 Spark 的构建和维护，以及众多数据库（比如 HBase 和 Cassandra）和平台（比如 Kafka、Spark Streaming 和 Apache Flink ）等等。他们要知道如何操作云端，如何使用 Amazon Web Services，Microsoft Azure 和 Google Compute Engine。</p>\n<p>2015 年有一篇被广泛引用的文献突出强调，真实世界的机器学习系统不只是分析模型。各个公司开始着眼于研发基于数据的产品，并把相关技术投入生产中去。在这众多项目中，严格属于“机器学习”的部分并不是很多。然后，我们发现越来越多的公司组成了机器学习工程师团队。这并不难想象，当今机器学习盛行，数据工程师肯定会顺应潮流寻求突破。那么，机器学习工程师与数据工程师有什么区别呢？</p>\n<p>一般来讲，机器学习工程师的职责涵盖软件工程师（和一些好的数据工程师）的职责：</p>\n<ul>\n<li>他们拥有比普通数据科学家更强的软件编码能力。</li>\n<li>由于他们的工作重心是产出数据产品，他们需要通观全局。</li>\n<li>他们监管数据型产品的生产，并了解产品可能会出现的问题。</li>\n<li>深度学习的盛行引领一个相关的更专业的职位出现：深度学习工程师。</li>\n</ul>\n<p>机器学习工程师不仅仅要了解，更要参与到软件架构和设计中去。比如，他们了解 A/B 测试，同时也要知道如何 A/B 测试。他们了解日志或安全性问题，同时也要知道如何让数据工程师能够有效使用日志数据。对于机器学习工程师这个头衔来说，并无新鲜和特殊之处，更多的是深挖而不是改变。</p>\n<p>机器学习与数据科学有什么区别呢？数据科学涵盖面更广。最大的区别是深度学习的运作方式。容易想象的是数据科学家如何挖掘数据，比如 Tukey 的 Exploratory Data Analysis 中介绍了挖掘并分析大量数据去发现其价值所在。</p>\n<p>但是深度学习改变了数据挖掘方式。我们不直接接触数据，我们只是知道结果，让程序自己去建模并发现数据的价值。比如，如何构建一个能够打败围棋冠军的智能机器人，如何准确地标记图片，如何精准地翻译。这些问题，需要大量的数据和维度，人力难以实现，而机器学习便是构造一个模型，让这个模型自主发掘数据。那么，数据科学家的工作便不再是自己从数据中发掘价值，而是构建一个能够分析数据并产生结果的机器。实现“平民化”是机器学习领域的梦想，其含义便是任意领域的专家都能构建一个机器学习系统，而非 AI 博士。比如，我们希望一个围棋选手便能够构建下一代 AlphaGo，一个西班牙语者便能够构建一个西班牙语翻译引擎，而非机器学习专家。</p>\n<p>这种转变影响着机器学习工程师。机器学习模型不是静态的，会随着需求变化而成长。应该有专人去监管机器学习系统并在必要时进行重新训练。</p>\n<p>所有从事软件或IT行业的人都知道安全问题很重要。如今，机器学习系统的安全性上还未出现问题，但依然要防范于未然。那么，如今的机器学习系统在哪方面容易被攻击？系统中的数据是否会被感染？是否能够强迫系统进行非必要的重训练？由于该系统的自主训练模式，我们需要重新认知其在安全性上的易攻击点。</p>\n<p>随着系统日益完善，我们发现更多的数据科学家使之转变为生产系统。比如，云端和 SaaS 使数据科学家得以充分利用数据模型并运用到生产中，一些开源项目像是 Clipper 和 Ground（加州大学伯克利分校的 RISELab 的新项目）也逐渐开始进行。但是我们依旧需要数据工程师和机器学习工程师：精通数据科学和机器学习，深入理解数据如何进行产出，敢于挑战创造基于机器学习的产品。他们是 “humans in the loop” 的终点。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"108466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"108466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"108466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('15位身份证补全为18位身份证算法', '2017-07-12', 'http://blog.jobbole.com/111556/', '965c6835ed4cba16fd9cb2cfda0a99a2', 'http://jbcdn2.b0.upaiyun.com/2014/10/9184208f96827c412ab7d3570590ef76.jpg', 'full/506f77aba037cb2bd78064b80470760038a6d491.jpg', '0', '1', '2', 'IT技术,算法', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/10158wsj/p/7050736.html\">我心自在</a>   </div><p>最近在参与一个银行项目-某银行安防系统-反洗钱需求的开发，银行项目的离不开身份证号码，身份证号码作为我国公民的唯一标识，有这非同寻常的意义，由于业务的要求15位的身份证号码无法命中，所以需要补全为18位，一开始自己想着加个年份的前两位，后面再加个X不就行了嘛，后来代码写不下去了，上网查了资料，才知道自己想的是多么天真，还是比较复杂的，折腾了一下午终于有了眉目。</p>\n<h2>一、15位身份证和18位身份证号码结构介绍</h2>\n<p>要进行身份证号码的验证，首先需要了解我国身份证号码的编码规则。我国身份证号码多由若干位数字或者数字与字母混合组成。早期身份证由15位数字构成，这主要是在1980年以前发放的身份证，后来考虑到千年虫问题，因为15位的身份证号码只能为1900年1月1日到1999年12月31日出生的人编号，所以又增加了18位身份证号码编号规则。</p>\n<p>1     2     3     4     5     6     7     8     9     10   11   12   13   14   15</p>\n<p>A     A     A     A     A     A     Y     Y     M    M    D     D     N    N    S</p>\n<p>前六位AAAAAA是身份证编码对象的所在地（出生地）的编码，该号码可由国家统计局公布的相关标准中得到。YY表示出生年的后两位，MM和DD表示出生月和日，不足两位的高位补0，NNS为顺序号，无法确定。S为性别识别码，男性为奇数，女性为偶数。了解了这些，再来写代码就变得容易多了。</p>\n<h2>二、算法实现</h2>\n<p>了解了身份证号码的规则后，我们就可以推断出，身份证的15位转化位需要两步。首先把15位身份证号补全为17位，然后再补全最后一位。但是最后一位是数字还是字母X？这里又出现了问题。我们知道，身份证的最后一位为校验位，那么最后一位是怎么得到的呢？原来，最后一位是由数字1-9组成，超过9的比如11就用字母X表示，否则号码就变成了19位。了解了这些，经过整理得出身份证补全算法实现思想如下：</p>\n<p><strong>step1</strong>、将15位身份证号码加入出生年变为17位</p>\n<p><strong>step2</strong>、将step1得到的身份证17位数分别乘以不同的系数。从第1位到第17位的系数分别为：7-9-10-5-8-4-2-1-6-3-7-9-10-5-8-4-2.</p>\n<p><strong>step3</strong>、将这17位数字和系数相乘的结果相加</p>\n<p><strong>step4</strong>、将step3的结果除以11，得出余数</p>\n<p>由于数字的特殊性，这些余数只可能是0-10这11个数字，身份证最后一位的对应数字为1-0-X-9-8-7-6-5-4-3-2.。例上面的余数结果为3那么对应身份证号码的最后一位就是9，如果是10，身份证最后一位便是2。</p>\n<p>代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562ceb94f5696708498\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic static void main(String[] args) {\r\n        System.out.println(transIDCard15to18(\"370986890623212\"));\r\n        System.out.println(transIDCard15to18(\"370725881105149\"));\r\n    }\r\n    /* 18位标准身份证号\r\n     * 方法用途：15位身份证转化为18位标准证件号\r\n     */\r\n    public static String transIDCard15to18(String IdCardNO){\r\n        String cardNo=null;\r\n        if(null!=IdCardNO&amp;&amp;IdCardNO.trim().length()==15){\r\n            IdCardNO=IdCardNO.trim();\r\n            StringBuffer sb=new StringBuffer(IdCardNO);\r\n            sb.insert(6, \"19\");\r\n            sb.append(transCardLastNo(sb.toString()));\r\n            cardNo=sb.toString();\r\n        }\r\n        return cardNo;\r\n    }\r\n    /* 方法用途：15位补全‘19’位后的身份证号码\r\n     */\r\n    private static String transCardLastNo(String newCardId){\r\n        char[] ch=newCardId.toCharArray();\r\n        int m=0;\r\n        int [] co={7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2};\r\n        char [] verCode=new char[]{\'1\',\'0\',\'X\',\'9\',\'8\',\'7\',\'6\',\'5\',\'4\',\'3\',\'2\'};\r\n        for (int i = 0; i &lt; newCardId.length(); i++) {\r\n            m+=(ch[i]-\'0\')*co[i];\r\n        }\r\n        int residue=m%11;\r\n        return String.valueOf(verCode[residue]);\r\n         \r\n    }</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-596562ceb94f5696708498-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562ceb94f5696708498-32\">32</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">transIDCard15to18</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"370986890623212\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">transIDCard15to18</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"370725881105149\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 18位标准身份证号</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-6\"><span class=\"crayon-c\">     * 方法用途：15位身份证转化为18位标准证件号</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-7\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">transIDCard15to18</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cardNo</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">!=</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">StringBuffer </span><span class=\"crayon-v\">sb</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringBuffer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">IdCardNO</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"19\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">transCardLastNo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cardNo</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">sb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cardNo</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 方法用途：15位补全‘19’位后的身份证号码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-20\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">transCardLastNo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newCardId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">newCardId</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toCharArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">co</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">verCode</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\'1\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'0\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'X\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'9\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'8\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'7\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'6\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'5\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'4\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'3\'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\'2\'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newCardId</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">m</span><span class=\"crayon-o\">+=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-s\">\'0\'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">co</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">residue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">m</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">verCode</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">residue</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596562ceb94f5696708498-31\"><span class=\"crayon-h\">         </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562ceb94f5696708498-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p>测试结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/4de63d1dfe6ae7d0e16eb62169a51728.png\"><img class=\"alignnone wp-image-111567 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/4de63d1dfe6ae7d0e16eb62169a51728.png\" alt=\"1153367-20170619213856382-410871354\" width=\"760\" height=\"154\"></a></p>\n<h2>三、总结</h2>\n<p>身份证号码补全虽然简单，但是前提需要了解我国公民的身份证构成原理才能正确验证，今天将这个学习过程分享给大家，希望对大家有所帮助，学习是个永无止境的过程，只有不断学习才能有进步！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111556\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111556votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111556\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('2017 十大最佳用于隐私和安全保护的 Linux 发行版', '2017-07-12', 'http://blog.jobbole.com/111466/', '9ee795c61ba918ee74aef13fbaab16a9', 'https://static.oschina.net/uploads/space/2017/0613/195235_iFxM_2918182.jpg', 'full/afce380e67e6757fa681cdf46ce584920cb491a3.jpg', '0', '2', '1', '工具与资源,Linux', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/920550\">开源中国 - 局长</a>   </div><p><img class=\"aligncenter\" src=\"https://static.oschina.net/uploads/space/2017/0613/195235_iFxM_2918182.jpg\" alt=\"\" width=\"650\" height=\"400\"></p>\n<h2 id=\"h2_0\"><strong>介绍</strong></h2>\n<p>优秀的 Linux 操作系统是自由和开源的。因此，有数千种不同的“风味”可供选择——而某些类型的 Linux，例如 Ubuntu 是通用的，而且适用于许多不同的用途。</p>\n<p>但安全意识高的用户会对专为隐私和安全设计的 Linux 发行版更有兴趣，它们可以帮助你通过加密操作来保护数据的安全，并支持在 Live 模式下运行，无需将数据写入在使用中的硬盘。</p>\n<p>这篇文章将列出十个关注隐私和安全性的 Linux 发行版。</p>\n<h2 id=\"h2_1\" style=\"text-align: left\"><strong>1. Qubes OS</strong></h2>\n<p><img class=\"aligncenter\" src=\"https://static.oschina.net/uploads/space/2017/0613/195433_DrFR_2918182.png\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>虽然不是面向新手用户的发行版，但 Qubes 是顶级的关注隐私的发行版之一。该发行版必须使用图形化安装程序将操作系统安装到硬盘驱动器，这是被加密的。</p>\n<p>Qubes OS 使用 Xen Hypervisor 来运行多个虚拟机，其主要理念就是基于隔离的安全，它会将系统隔离为“个人”、“工作”和“上网”。这样，即便你不小心在工作机器上下载了恶意软件，但个人文件不会受到影响。</p>\n<p>主桌面会使用颜色编码的窗口，用于展示不同的虚拟机，以方便区分。</p>\n<p>https://www.qubes-os.org/</p>\n<h2 id=\"h2_2\"><strong>2. Tails</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/195623_NeGI_2918182.png\" alt=\"\" width=\"650\" height=\"520\"></p>\n<p>Tails (The Amnesiac Incognito Live System) 可能是最有名的关注隐私的 Linux 发行版之一，它是基于 Debian 的自启动光盘和 USB 发行。Tails 可以在 Live 模式下从 DVD 运行，从而将其完全加载进系统 RAM，并且其活动不会产生任何痕迹。这款系统也可以像普遍的系统一样在“持久”模式下运行，关于系统的设置会存储在加密的 U 盘上。</p>\n<p>Tails 为用户提供了完整的因特网匿名功能，所有的网络流量都会经过匿名网络 Tor，它可隐藏你的上网痕迹，使得网络流量难以被追踪。Tails 中配备的应用程序也是经过谨慎选择的，以安全为理念进行了预配置，以增强用户的隐私安全。例如，KeePassX 密码管理器、网页浏览器、IRC客户端、邮件mail客户端等。值得注意的是 Tails 会不断发现漏洞，因此请务必经常检查更新。（当然对待任何操作系统都应如此）</p>\n<p>https://tails.boum.org/</p>\n<h2 id=\"h2_3\"><strong>3. BlackArch Linux</strong></h2>\n<p><img class=\"aligncenter\" src=\"https://static.oschina.net/uploads/space/2017/0613/195923_uICR_2918182.png\" alt=\"\" width=\"650\" height=\"520\"></p>\n<p>这个基于 Arch Linux 的轻量级渗透测试发行，包含了 1,600 多种不同的黑客工具以用于渗透测试和计算机取证分析，这节省了每次下载需要的时间。BlackArch Linux 被设计为服务于系统渗透测试人员及安全研究人员，包含有多个轻量级窗口管理器如 Fluxbox、Openbox、Awesome、spectrwm。</p>\n<p>BlackArch Linux的提供形式是一张自启动运行 DVD 镜像，可以从 U 盘或 CD 上直接运行，也可以安装到电脑或虚拟机，甚至可以安装在树莓派上以给你提供一个便携的渗透测试计算机。</p>\n<p>特别值得一提的是它的 ‘anti-forensics’ 目录，因为它包含了为已加密的设备扫描内存的工具，这有助于保护机器免受“冷启动攻击”。</p>\n<p>https://blackarch.org/</p>\n<h2 id=\"h2_4\"><strong>4. Kali</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0426/080144_KZXe_2720166.png\"></p>\n<p>Kali Linux（以前叫做BackTrack），以印度教的一个女神命名，是最著名的渗透测试发行版之一，也是一份基于 Debian 的发行。它带有一套安全和计算机取证工具。其特色在于及时的安全更新（每周提供更新的 ISO 镜像），对 ARM 架构的支持（可在树莓派上运行），有四种流行的桌面环境供选择，以及能平滑升级到新版本。</p>\n<p>Kali 有着令人敬畏的声望，它的创作者会通过 <a href=\"https://www.kali.org/kali-linux-dojo-workshop/\" target=\"_blank\" rel=\"nofollow\">Kali Linux Dojo</a> 提供培训。课程内容包括定制自己的 Kali Linux ISO 和学习渗透测试的基础。对于无法参加培训的人士，所有的课程教育资源都可通过 Kali 的网站免费获取。</p>\n<p>https://www.kali.org/</p>\n<h2 id=\"h2_5\"><strong>5. IprediaOS</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/200242_tDsT_2918182.jpg\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>IprediaOS 是一个基于 Linux 的快速、强大和稳定的操作系统，提供了匿名的环境。所有的网络流量都会被自动和透明地加密和匿名化。这个面向隐私的操作系统基于 Fedora Linux，可在 Live 模式下运行也可安装到硬盘上。正如 Tails OS 会将所有网络流量通过 Tor 网络以避免被追踪，Ipredia 中所有的网络流量都会经过匿名的 I2P 网络。</p>\n<p>它的功能包括匿名电子邮件和 BitTorrent 客户端，IRC 聊天，以及浏览 eepsites（特殊的 .i2p 扩展名）的功能。与 Tor 不同的是，I2P 不能作为访问正常的互联网的网关，所以 Ipredia 无法安全地访问常规网站。不过只能访问 eepsites 的优点是你的连接是真正无法被追溯的。</p>\n<p>http://www.ipredia.org/os</p>\n<h2 id=\"h2_6\"><strong>6. Whonix</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/200603_Z1TH_2918182.png\" alt=\"\" width=\"650\" height=\"520\"></p>\n<p>引导一份 Live 操作系统是一个麻烦，因为必须重新启动计算机，但将其安装到硬盘意味着有被攻击的风险。Whonix 提供了一个优雅的方案，它被设计为运行在 Virtualbox 中作为一个虚拟机而工作。由于它在虚拟机中运行，所以 Whonix 与所有可运行 Virtualbox 的操作系统兼容。</p>\n<p>Whonix 是一份聚焦于匿名性、隐私、安全的操作系统。它基于 Tor 匿名网络、Debian GNU/Linux、基于隔离的安全性。Whonix 包括两部分，一部分只运行在 Tor 上并扮演网关角色，这部分叫做 Whonix-Gateway；另一部分叫做 Whonix-Workstation，位于隔离网络中。只有经由 Tor 的连接被允许。有了 Whonix，你就可以匿名使用应用程序并在因特网上运行服务器。因匿名解析而造成的信息泄漏不可能存在，即便获得了根权限的恶意软件也无法发现用户的真实 IP 地址。</p>\n<p>https://www.whonix.org/</p>\n<h2 id=\"h2_7\"><strong>7. Discreete Linux</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/200511_1ovk_2918182.jpg\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>这个故意拼写错的发行版是优秀的 Ubuntu Privacy Remix 的继承者。该操作系统不支持网络硬件或内部硬盘驱动器，因此所有的数据都离线存储在 RAM 或 USB 设备中。它可以在 Live 模式下运行，但当从卷启动时也允许将一些设置存储在加密的‘Cryptobox’中。</p>\n<p>还有另外一个值得关注的功能是它的内核模块只能在 Discreete Linux 团队进行数字签名后才能安装。这可以防止黑客试图偷偷安装恶意软件。请注意，该操作系统目前尚处于 Beat 测试阶段。</p>\n<p>https://www.discreete-linux.org/</p>\n<h2 id=\"h2_8\"><strong>8. Parrot Security OS</strong></h2>\n<p><img src=\"http://static.oschina.net/uploads/space/2016/1017/071656_YYvN_2720166.png\"></p>\n<p>这款渗透测试系统由来自意大利的团队 Frozenbox 开发。和 Kali 和 BlackArch 一样，它也包含着许多易用的工具。Parrot Security OS 是面向安全的操作系统，它被设计为用于渗透测试、计算机取证、反向工程、攻击、云计算渗透测试、隐私/匿名、密码等场合。</p>\n<p>Parrot 基于 Debian，其特色在于 MATE 桌面环境，拥有更丰富多彩的背景和菜单。因此，它对硬件的要求比其他渗透测试发行版（例如 Kali）更高。建议至少使用 2GB 的 RAM。</p>\n<p>对于资源有限的用户，Parrot Cloud 是专门用于在服务器上运行的特殊发行版。它没有图形界面，但包含了一些网络和取证工具，可用于远程运行测试。</p>\n<p>https://www.parrotsec.org/</p>\n<h2 id=\"h2_9\"><strong>9. Subgraph OS</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/201019_7SbG_2918182.png\" alt=\"\" width=\"650\" height=\"365\"></p>\n<p>Subgraph OS 是基于 Debian 的 Linux 发行，为超强的安全性而设计，它提供了多种安全、匿名上网、加固的特性。它的内核通过许多安全性的增强进行了加固，Subgraph 还在诸如浏览器之类的高风险应用中创建了虚拟的“沙盒”。因此，任何针对独立应用程序的攻击都不会危及整个系统。</p>\n<p>Subgraph OS 使用加固过的 Linux 内核及应用防火墙来阻止特定的可执行程序去访问网络，并强制要求所有的因特网流量都经由 Tor 网络。每个应用程序需要连接到网络和访问其他应用程序的“沙盒”都需经过手动的允许。</p>\n<p>该发行的文件管理器带有特色工具可以从数据文件中移除元数据，并且还集成了 OnionShare 文件共享软件。该发行使用 Icedove 邮件客户端以自动配合 Enigmail 对电子邮件进行加密。</p>\n<p>在 Subgraph 中，对文件系统的加密是强制性的，这意味着没有写入未加密数据的危险。要注意的是，Subgraph 还处于测试阶段，因此不要依赖使用它来保护任何真正敏感的数据（并且一如既往地保持常规的备份）。</p>\n<p>https://subgraph.com/</p>\n<h2 id=\"h2_10\"><strong>10. TENS</strong></h2>\n<p><img src=\"https://static.oschina.net/uploads/space/2017/0613/194931_D4L5_2720166.png\"></p>\n<p>第十个发行版恰好是 TENS(Trusted End Node Security)。以前被称为 LPS(Lightweight Portable Security)，这份 Linux 发行版是美国国防部的产品。Trusted End Node Security (TENS)是基于 Linux 的自启动运行光盘，其目标是让用户能在计算机上工作而不会有向恶意软件、键盘记录程序及其他因特网时代的恶疾泄露信息凭证及私人数据的风险。</p>\n<p>它包含了最必需的一套应用软件及实用工具，例如 Firefox 网页浏览器，以及一份加密向导以对个人文件进行加解密。但有一个‘Public Deluxe’（公开豪华版）也包含了 Adobe Reader 和 LibreOffice 这样的工具。所有的版本都包含一个自定义防火墙，值得注意的是该操作系统支持通过 Smart Card 登录。</p>\n<p>https://spi.dod.mil/lipose.htm</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('给非英语母语的人从事开源项目的若干建议', '2017-07-12', 'http://blog.jobbole.com/111506/', 'a374e125ab3d41e57b4634a2be532439', 'http://jbcdn2.b0.upaiyun.com/2017/05/b94146f42c8e0ca2b0f04ed89b59053c.jpg', 'full/dd36e1ac9db2af41888b4a17b76a865bb91d4510.jpg', '0', '4', '1', 'IT技术,开源,英语', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/1/non-native-speakers-take-open-source-communities\">opensource.com</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8619-1.html\">Linux中国/zhousiyu325</a>   </div><p>大多数的开源项目的主要语言都是英语，但是开源项目的用户和贡献者却遍布全球。非英语母语的人在参与这个生态系统时会面临许多沟通和文化上的挑战。</p>\n<p>在这篇文章中，作为不以英语为母语的 OpenStack 的贡献者的我们将会分享一些所面临挑战——如何去克服它们，还有一些好的方案，它们能够减轻不以英语为母语且刚开始从事的人的焦虑。我们的总部在日本、巴西和中国，每天都会与世界各地的大型 OpenStack 社区合作。</p>\n<p>OpenStack 的官方语言是英语，这意味着我们是作为非英语为母语的人士来进行交流。</p>\n<h3 id=\"toc_1\">挑战</h3>\n<p>非英语为母语的人士在开源社区工作时会面临具体沟通挑战：它们与有限的语言技能和文化差异有关。</p>\n<h4 id=\"toc_2\">语言技能</h4>\n<p>让我们来关注在阅读、写作、听力和口语背后的具体语言技能。</p>\n<p><strong>阅读</strong>：这是最简单也是最重要的技能。最简单是因为：如果你不明白写了什么，你有机会再次阅读它，或者需要的话可以多次阅读。如果你遇到了一个不常见的短语、表达式或者缩写，你可以使用一个词典或者翻译器。在另一方面，它是最重要的技能是因为：对大多数开源项目而言，主要的交流方式都是邮件列表和 IRC。</p>\n<p><strong>写作</strong>：英语语法是一个问题，尤其是对句子结构不同的语言而言。这可能会在用电子邮件进行通信和通过 IRC 频道进行通信时产生问题。对一些人来说，写出又长又漂亮的句子比较困难，而普遍依赖于简单句子，这是因为这些易于书写和理解。</p>\n<p><strong>听力</strong>：这对非英语为母语的人来说比阅读和写作更加困难。通常，英语为母语的人之间的对话在非常快的，这就使得那些仍然处于刚从事阶段的人很难理解他们的讨论，同时也限制了他们参与到讨论当中。此外，试图理解一个遍布全球的社区的各种口音也增加了复杂性。有意思的是，美国人的发音往往比其他的容易理解。</p>\n<p><strong>口语</strong>：口语比听力更加的困难，因为参与者的词汇量可能会比较有限。而且，英语的音素和语法通常与那些母语不是英语的人的母语相差很大，这就使得互动更加的难以理解。</p>\n<h4 id=\"toc_3\">文化差异</h4>\n<p>在开源社区与其他人交流时，每种文化都有它自己不同的规范。例如，日本人通常不会明确的说好的或者不，他们认为这是尊重别人的一种方式，可以避免彼此间的争论。这通常与其他的文化大不一样，可能会对所表达的内容造成误解。</p>\n<p>在中国文化中，人们倾向于只是说好的，而不是说不，或者试图商讨。在一个像 OpenStack 这样的分布于全球的社区里，这通常会导致在表达意见时缺乏自信。另外，中国人喜欢首先列出事实，然后在后面给出结论，而这会对来自其他文化中的人造成困惑，因为这不是他们所期望的。</p>\n<p>例如，巴西人可能会认为讨论是以类似的方式进行的；然而，其他文化的反应会很直接和简短，这听起来可能会有点粗鲁。</p>\n<h3 id=\"toc_4\">克服障碍</h3>\n<p>语言技能方面的挑战要比文化差异方面的挑战容易克服。文化差异需要被受到尊重，然而英语技能却总是可以被改善的。</p>\n<p>为了刷新你的语言技能，你应该尽可能多地接触该语言。不要担心你的局限，只管尽自己所能，你终将会得到改善。</p>\n<p>尽可能多的阅读，因为这有助于你积累词汇。通过日常的聊天和邮件列表进行交流也很有帮助。一些工具，如实时字典和翻译器，对这些平台非常有用。</p>\n<p>与别人或者你自己交谈可以帮助你更自如地频繁地说话。进行一对一的对话来表达你的想法比在更大的群体中讨论更容易。</p>\n<h3 id=\"toc_5\">新手的融入</h3>\n<p>来自新手和母语者的一些举措可能会对学习过程产生积极的影响。</p>\n<h4 id=\"toc_6\">新手</h4>\n<p>说出和写下你的意见，并且提出你的问题；参与其中总是一个练习你的英语的很好的机会。不要害怕。</p>\n<p>对于会议，确保你提前准备过，这样你将会对会议主题比较熟悉，而且会对自己要表达的意见更加的自信。</p>\n<p>与英语为母语的人结交朋友，多和他们讨论来提高你的英语技能。</p>\n<p>用英语写博客和技术文章也是不错的主意。</p>\n<h4 id=\"toc_7\">给英语为母语的人士的建议</h4>\n<p>请说话慢一点儿，同时使用一些简单的单词和句子。如果你发现了非英语为母语的人使用英语中的一些错误请不要嘲笑他们，尝试鼓励新来的人表达自己的意见，让他们非常舒适地表达意见。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111506\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111506votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111506\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('性能优化知多少', '2017-07-12', 'http://blog.jobbole.com/111734/', 'a59acd84141cd48da7828b24421ff6cb', 'http://jbcdn2.b0.upaiyun.com/2017/07/7e8f770aaadb755d790b921b68fb2214.png', 'full/5b48951660a3dd574009dd9dfb69981fce68b26a.jpg', '0', '5', '3', 'IT技术,性能', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/sheng-jie/p/7109385.html\">『圣杰』</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7e8f770aaadb755d790b921b68fb2214.png\"></p>\n<div id=\"cnblogs_post_body\">\n<h1 id=\"引言\">1. 引言</h1>\n<p>最近一段时间，系统新版本要发布，在beta客户测试期间，暴露了很多问题，除了一些业务和异常问题外，其他都集中在性能上。有幸接触到这些性能调优的机会，当然要学习总结了。</p>\n<p>性能优化是一个老生常谈的问题了，典型的性能问题如页面响应慢、接口超时，服务器负载高、并发数低，数据库频繁死锁等。而造成性能问题又有很多种，比如磁盘I/O、内存、网络、算法、大数据量等等。我们可以大致把性能问题分为四个层次：代码层次、数据库层次、算法层次、架构层次。<br>\n所以下面我会结合实际性能优化案例，和大家分享下性能调优的工具、方法和技巧。</p>\n<h1 id=\"先说心态\">2. 先说心态</h1>\n<p>说到性能问题，你可能首先就想到的是麻烦或者头大，因为一般性能问题都比较紧急，轻则影响客户体验，重则宕机导致财务损失，而且性能问题比较隐蔽，不易发现。因此一时间无从下手，而这时我们就很容易从心底开始去排斥它，不愿接这烫手的山芋。</p>\n<p>而恰巧，性能调优是体现程序员水平的一个重要指标。</p>\n<blockquote><p>因为处理bug、崩溃、调优、入侵等突发事件比编程本身更能体现平庸程序员与理想程序员的差距。当面对一个未知的问题时，如何定位复杂条件下的核心问题、如何抽丝剥茧地分析问题的潜在原因、如何排除干扰还原一个最小的可验证场景、如何抓住关键数据验证自己的猜测与实验，都是体现程序员思考力的最好场景。是的，在衡量理想程序员的标准上，思考力比经验更加重要。</p></blockquote>\n<p>所以，若你不甘平庸，请拥抱性能调优的每一个机会。当你拥有一个正确的心态，你所面对的性能问题就已经解决了一半。</p>\n<h1 id=\"再说技巧\">3. 再说技巧</h1>\n<p>拿到一个性能问题，不要忙着先上工具，先了解问题出现的背景，问题的严重程度。然后大致根据自己的经验积累作出预估。比如客户来了个性能问题说系统宕机了，已经造成资金损失了。这种涉及到钱的问题，大家都比较敏感，根据自己的level，决定是否要接这个锅。这不是逃避，而是自知之明。</p>\n<p>了解问题背景之后，下一步就来尝试问题重现。如果在测试环境能够重现，那这种问题就很好跟踪分析。如果问题不能稳定重现或仅能在生产环境重现，那问题就相对比较棘手，这时要立刻收集现场证据，包括但不限于抓dump、收集应用程序以及系统日志、关注CPU内存情况、数据库备份等等，之后不妨再尝试重现，比如恢复客户数据库到测试环境重现。</p>\n<p>不管问题能否重现，下一步，我们就要大致对问题进行分类，是代码层次的业务逻辑问题还是数据库层次的操作耗时问题，又或是系统架构的吞吐量问题。那如何确定呢？而我倾向于先从数据库动手。我的习惯做法是，使用数据库监控工具，先跟踪下Sql耗时情况。如果监控到耗时较长的SQL语句，那基本上就是数据库层次的问题，否则就是代码层次。若为代码层次，再研究完代码后，再细化为算法或架构层次问题。</p>\n<p>确定问题种类后，是时候上工具来精准定位问题点了：</p>\n<ul>\n<li>Sql耗时问题，推荐使用免费的<a href=\"https://www.sentryone.com/plan-explorer\">Plan Explorer</a>分析执行计划。</li>\n<li>代码问题定位，优先推荐使用VS自带的Performance Analysis，其次是RedGate的性能分析套件<a href=\"http://www.red-gate.com/products/dotnet-development/dotnet-developer-bundle/\">.NET Developer Bundle</a>；然后还有Jet Brains的<a href=\"http://www.jetbrains.com/profiler/?fromMenu\">dotTrace — .NET performance profiler</a>，<a href=\"http://www.jetbrains.com/dotmemory/?fromMenu\">dotMemory– .NET memory profiler</a>；再然后就是反人类的Windbg；等等。</li>\n</ul>\n<p>精准定位问题点后，就是着手优化了。相信到这一步，就是优化策略的选择了，这里就不展开了。</p>\n<p>优化后，最后当然要进行测试了，毕竟优化了多少，我们也要做到心里有谱才行。</p>\n<p>以上啰啰嗦嗦有点多，下面我们直接上案例。</p>\n<h1 id=\"案例分享\">4. 案例分享</h1>\n<p>下面就分享下我针对代码层面、数据库层面和算法层面的优化案例。</p>\n<h1 id=\"sql优化案例\">4.1. SQL优化案例</h1>\n<blockquote><p>案例1：客户反馈某结算报表统计十天内的数据耗时10mins左右。</p></blockquote>\n<p>由于前几天刚学会用RedGate的分析工具，拿到这个问题，本地尝试重现后，就直接想使用工具分析。然而，这工具在使用webdev模式起站点时，总是报错，而当时时一根筋，老是想解决这个工具的报错问题。结果，白白搞了半天也没搞定。最后不得已放弃工具，转而选择使用sql server profiler去监控sql语句耗时。一跟踪不要紧，问题就直接暴露了，整个全屏的重复sql语句，如下图。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/06c352459b736d66075fe293d43e97f3.png\" alt=\"Sql Profiler监控结果\"></p>\n<p>这下问题就很明显了，八成是代码在循环拼接sql执行语句。根据抓取到sql关键字往代码中去搜索，果然如此。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d1ed00041082035\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#region更新三张表数据结合的中间临时表数据，有上游单据的直接调拨单分多次下推时，只计算一次的调拨数量和价税合计\r\nstring sSql = string.Format(@\r\n\"SELECT FENTRYID FROM {0} GROUP BY FENTRYID HAVING COUNT(FENTRYID) &gt; 1\", sJoinDataTempTable);\r\nusing(IDataReader reader = DBUtils.ExecuteReader(this.Context, sSql)) {\r\n    while (reader.Read()) {\r\n        sbSql.AppendFormat(@\"\r\nUPDATE {0} SET FDIRECTQTY = 0,FALLAMOUNT = 0 \r\nWHERE FSEQ NOT IN (\r\nSELECT TOP 1 FSEQ FROM {0} WHERE FENTRYID = {1}) AND FENTRYID = ({1});\"\r\n, sJoinDataTempTable, Convert.ToInt32(reader[\"FENTRYID\"]));\r\n        listSqlObj.Add(new SqlObject(sbSql.ToString(), new List &lt; SqlParam &gt; ()));\r\n        sbSql.Clear();\r\n    }\r\n}\r\n#endregion</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed00041082035-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed00041082035-15\">15</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-1\"><span class=\"crayon-p\">#region更新三张表数据结合的中间临时表数据，有上游单据的直接调拨单分多次下推时，只计算一次的调拨数量和价税合计</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-2\"><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sSql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-3\"><span class=\"crayon-s\">\"SELECT FENTRYID FROM {0} GROUP BY FENTRYID HAVING COUNT(FENTRYID) &gt; 1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sJoinDataTempTable</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-4\"><span class=\"crayon-e\">using</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">IDataReader </span><span class=\"crayon-v\">reader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DBUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ExecuteReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sSql</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AppendFormat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-7\"><span class=\"crayon-s\">UPDATE {0} SET FDIRECTQTY = 0,FALLAMOUNT = 0 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-8\"><span class=\"crayon-s\">WHERE FSEQ NOT IN (</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-9\"><span class=\"crayon-s\">SELECT TOP 1 FSEQ FROM {0} WHERE FENTRYID = {1}) AND FENTRYID = ({1});\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-10\"><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sJoinDataTempTable</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Convert</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ToInt32</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"FENTRYID\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">listSqlObj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SqlObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ToString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SqlParam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed00041082035-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed00041082035-15\"><span class=\"crayon-p\">#endregion</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>看到这段代码，咱先不评判这段代码的优劣，因为毕竟代码注释清晰，省了我们理清业务的功夫。这段sql主要是想做去重处理，很显然选用了错误的方案。改后代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d1ed0e683320904\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstring sqlMerge = string.Format(@\"\r\nmerge into {0} t1\r\nusing(\r\nselect min(Fseq) fseq,Fentryid from {0} t2 group by fentryid\r\n) t3 on (t1.fentryid = t3.fentryid and t1.fseq &lt;&gt; t3.fseq)\r\nwhen matched then\r\nupdate set t1.FDIRECTQTY = 0, t1.FALLAMOUNT = 0\r\n\", sJoinDataTempTable);\r\n\r\nlistSqlObj.Add(new SqlObject(sqlMerge, new List &lt; SqlParam &gt; ()));\r\nsbSql.Clear();</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed0e683320904-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed0e683320904-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed0e683320904-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed0e683320904-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed0e683320904-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed0e683320904-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed0e683320904-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed0e683320904-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed0e683320904-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed0e683320904-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed0e683320904-11\">11</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d1ed0e683320904-1\"><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sqlMerge</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed0e683320904-2\"><span class=\"crayon-s\">merge into {0} t1</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed0e683320904-3\"><span class=\"crayon-s\">using(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed0e683320904-4\"><span class=\"crayon-s\">select min(Fseq) fseq,Fentryid from {0} t2 group by fentryid</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed0e683320904-5\"><span class=\"crayon-s\">) t3 on (t1.fentryid = t3.fentryid and t1.fseq &lt;&gt; t3.fseq)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed0e683320904-6\"><span class=\"crayon-s\">when matched then</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed0e683320904-7\"><span class=\"crayon-s\">update set t1.FDIRECTQTY = 0, t1.FALLAMOUNT = 0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed0e683320904-8\"><span class=\"crayon-s\">\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sJoinDataTempTable</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed0e683320904-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed0e683320904-10\"><span class=\"crayon-v\">listSqlObj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SqlObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sqlMerge</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SqlParam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed0e683320904-11\"><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>改后测试相同数据量，耗时由10mins降到10s左右。</p>\n<h1 id=\"代码优化案例\">4.2. 代码优化案例</h1>\n<blockquote><p>案例2：客户反馈销售订单100条分录行，保存进行可发量校验时，耗时7mins左右。</p></blockquote>\n<p>拿到这个问题后，本地重现后，监控sql耗时没有异常，那就着重分析代码了。因为可发量校验的业务逻辑极其复杂，又加上又直接再一个类文件实现该功能，3500+行的代码，加上零星注释，真是让人避之不及。逃避不是办法，还是上工具分析一把。<br>\n这次我选用的时VS自带的<strong><a href=\"https://msdn.microsoft.com/en-us/library/ms182372.aspx\">Performance Profiler</a></strong>，开发环境下极其强大的性能调优工具。针对我们当前案例，我们仅需要跟踪指定服务对应的dll即可，使用步骤如下：</p>\n<ol>\n<li>Analyze–&gt;Profiler–&gt;New Performance Session</li>\n<li>打开Performance Explorer</li>\n<li>找到新添加的Performance Session，右键Targets，然后选择Add Target Binary，添加要跟踪的dll文件即可</li>\n<li>将应用跑起来</li>\n<li>选中Performance Session，右键Attach对应进程即可跟踪分析性能了</li>\n<li>在跟踪过程中，可随时暂停跟踪和停止跟踪</li>\n</ol>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/864dcb9eca7c345f430a8da89eac5fd1.png\" alt=\"图示步骤\"></p>\n<p>跟踪结束后本案例跟踪到的采样结果如下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9647efb1b254108019ea972563dc630f.png\" alt=\"VS Performance Profiler分析报告\"></p>\n<p>同时Performance Profiler也给出了问题的建议，如下图：<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/88c42b11fa5d0dd0e4471c3d0bccaf10.png\" alt=\"VS Performance Profiler分析提示\"></p>\n<p>其中第1、4条大致说明程序I/O消耗大，第一代的GC上存在未及时释放的垃圾占比过高。而根据上图的采样结果，我们可以直接看出是由于再代码中频繁操作DataTable引起的性能瓶颈。走读代码发现的确如此，所有的数量统计都是在代码中循环遍历DataTable进行处理的。而最终的优化策略，就相当于一次大的重构，将所有代码中通过遍历DataTable的计算逻辑全部挪到SQL中去做。由于代码过多，就不再放出。</p>\n<blockquote><p>案例3：客户反馈批量引入1000张订单，耗时40mins左右，且容易中断。</p></blockquote>\n<p>同样，我们还是先尝试本地重写。经测试批量引入101张单据，就耗时5mins左右。下一步打开Sql监控工具也未发现耗时语句。但考虑到是批量导入操作，虽然单个耗时不多，但乘以100这个基数，就明显了。下面我们就使用RedGate的<a href=\"http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/\">Ants Performance Profiler</a>跟踪一下。</p>\n<p>该工具比较直观，可以同时监控代码和SQL执行情况。第一步，New Profiler Session，第二步进行设置，如下图。根据自己的应用程序类别，选择相应的跟踪方式。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/12d765271a5c2637c6242b6a4df95256.png\" alt=\"跟踪设置\"></p>\n<p>针对这个问题，我们跟踪到的调用堆栈和SQL耗时结果如下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9610679af9557a4ae695b8b1c675c787.png\" alt=\"调用堆栈监控结果\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/754712efddfa3eb40a7eb32b192db06c.png\" alt=\"SQL监控结果\"></p>\n<p>首先从调用堆栈中的Hit Count，我们可以首先看出它是一个批量过程，因为入口函数仅调用一次；第二个我们可以代码中是循环处理每一个单据，因为Hit Count与我们批量引入的单据数量相符；第三个，突然来了个10201，如果有一定的数字敏感性的话，这次性能问题的原因就被你找到了。这里就不卖关子了，101 x 101 = 10201。<br>\n是不是明白了什么，存在循环嵌套循环的情况。我们走读代码确定一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5966007d1ed15652213466\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//Save.cs\r\npublic override void EndOperationTransaction(EndOperationTransactionArgs e) {\r\n    //省略其他代码\r\n    foreach(DynamicObject dyItem in e.DataEntitys) {\r\n        //反写收款单\r\n        WriteBackReceiveBill wb = new WriteBackReceiveBill();\r\n        wb.WriteBackForSave(e, this.Context);\r\n    }\r\n}\r\n\r\n//WriteBackReceiveBill .cs\r\npublic void WriteBackForSave(EndOperationTransactionArgs e, Context contx) {\r\n    //省略其他代码：\r\n    foreach(DynamicObject item in e.DataEntitys) {\r\n        //do something \r\n    }\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5966007d1ed15652213466-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5966007d1ed15652213466-17\">17</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-1\"><span class=\"crayon-c\">//Save.cs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">override </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EndOperationTransaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EndOperationTransactionArgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//省略其他代码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">DynamicObject </span><span class=\"crayon-e\">dyItem </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataEntitys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//反写收款单</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">WriteBackReceiveBill </span><span class=\"crayon-v\">wb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WriteBackReceiveBill</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">WriteBackForSave</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-10\"> </div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-11\"><span class=\"crayon-c\">//WriteBackReceiveBill .cs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-12\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WriteBackForSave</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EndOperationTransactionArgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Context </span><span class=\"crayon-v\">contx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//省略其他代码：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">DynamicObject </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataEntitys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//do something </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5966007d1ed15652213466-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5966007d1ed15652213466-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>好嘛，外层套了一个空循环却什么也没做。修改就很简单了，删除无效外层循环即可。</p>\n<h1 id=\"算法优化案例\">4.3. 算法优化案例</h1>\n<blockquote><p>案例4：某全流程跟踪报表超时。</p></blockquote>\n<p>这个报表是用来跟踪所有单据从下单到出库的业务流程数据流转情况。而所有的流程数据都是按照树形结果存储在数据库表中的，类似这样：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1a5f6eb8189dc0b3c9fa092e00488f2e.png\" alt=\"流程树表\"></p>\n<p>图中的流程为：<br>\n销售合同–&gt;销售订单–&gt;发货通知单–&gt;销售出库单</p>\n<p>为了构造流程图，之前的处理方法是把流程数据取回来，通过代码构造流程图。这也就是性能差的原因。</p>\n<p>而针对这种情况，就是考验我们平时经验积累了。对于树形结构的表，我们也是可以通过SQL来进行直接查询的，这就要用到了SQL Server的CTE语法来进行递归查询。关于递归查询，可参考我这篇文章：<a href=\"http://www.jianshu.com/p/ab9d268aa54c\">SQL递归查询知多少</a>。这里就不展开了。</p>\n<h1 id=\"总结\">5.总结</h1>\n<p>性能调优是一个循序渐进的过程，不可能一蹴而就，重在平时的点滴积累。关于工具的选择和使用，本文并未展开，也希望读者也不要纠结与此。当你真正想解决一个问题的时候，相信工具的使用是难不住你的。</p>\n<p>最后就大致总结下我的调优思路：</p>\n<ol>\n<li>调整心态，积极应对</li>\n<li>了解性能背景， 收集证据， 尝试重现</li>\n<li>问题分类，先监控SQL耗时，大致确定是SQL或是代码层次原因</li>\n<li>使用性能分析工具，确定问题点</li>\n<li>调优测试</li>\n</ol>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111734\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111734votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111734\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('程序员生涯第一生存法则', '2017-07-12', 'http://blog.jobbole.com/111627/', 'a6d7be3180bc17350825a84d5e402c60', 'http://jbcdn2.b0.upaiyun.com/2012/08/programmer-developer-at-work.jpg', 'full/bb38d11fb4038702790e0370ed966c50f186ff40.jpg', '3', '7', '5', '职场,,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s/deP25x394QP0lSItHFWs4Q\">世相微语</a>   </div><p><strong>程序员的职业生涯，第一生存法则是什么？</strong></p>\n<p>追求理想、兴趣与爱好？ 不免有点奢侈。坚守道德、信仰与纯粹？ 也许太高尚了。</p>\n<p>平衡生活与工作、兼顾家庭与公司、妥善处理人际关系、熟练掌握沟通能力与谈判能力、扩大社交圈、耐得住寂寞、熬得了夜、活到老充电充到老、懂得取舍与妥协、低调做人高调做事… <strong>本文暂不打算灌输这类心灵鸡汤。</strong></p>\n<p>打开格局、扩大视野、开阔眼界、看准趋势、远见卓识，成为华尔街的宽客、CEO、CTO、首席科学家、首席架构师… 不幸的是，<strong>90%的量产程序员穷极一生，也注定无缘赖此生存，因为这个领域，天赋与机遇缺一不可。</strong></p>\n<p>数据结构、设计模式、算法架构、模型抽象、操作系统原理、编译器原理、概率统计、数论、代数、几何、微分… 相信我，<strong>90%的量产程序员编程10年，赖此生存的时间也不超过10天。</strong></p>\n<hr>\n<p>那程序员生涯的第一生存法则是什么？</p>\n<p><strong>很简单，拥抱开源，拥抱变化。</strong><strong>远离远离开源的公司，远离技术落伍许久的团队。</strong></p>\n<p><strong>职业生涯，无论做什么，第一要务是生存，而且应该是越过越舒适的生存。</strong><strong>譬如律师、医生，程序员亦是如此。</strong></p>\n<p>程序员，到 34 岁了，被公司直接或变相辞退了，是挺悲催的。</p>\n<p>但更悲催的是，离开这里，居然无法找到（至少）和之前同水平待遇的工作…</p>\n<hr>\n<p><strong>原因何在？</strong></p>\n<p>因为不少程序员都固执的认为自己所在的公司、所在的部门、所在的团队会基业长青，自己只需要埋头苦干，耕耘好自己的一亩三分地就能安享太平。</p>\n<p><strong>可现实是，你的工作并不是你想象的那样不可替代，你的业务代码也许一个初出茅庐的毕业生就可以接手，你的团队、部门、甚至公司也可能会在你想象不到的时刻宣布解散。</strong></p>\n<p>如果你的工作只是基于公司内部的闭源框架或陈旧的架构体系，调用一下接口，写写业务代码，修复一下bug，离开这里，还剩多少竞争力呢？</p>\n<p>试想一下，同样是业务系统开发，一个基于Spring（称得上Java第一开源框架）、Spark（大数据开源框架）、Kafka（消息中间件）开发的程序员，和一个基于Spriii、Spaaa、Kafff（泛指公司内部专用的框架）开发的程序员，能力相当，走出这家公司谁更吃香？</p>\n<p>再试想一下，同样是应用开发，一个玩转 Spring、Struts、Hibernate（Java开源老三样）的程序员，和一个玩转 Spring、SpringMVC、Mybatis （Java开源新三样）或 Spring Boot 的程序员，水平相当，出去面试谁更可受欢迎？</p>\n<p><strong>即使只是一颗螺丝钉，也要做一颗技术领先，在外界受欢迎的螺丝钉。去哪都能如鱼得水、畅快优游。</strong></p>\n<p><strong>这也是90%的普通程序员，首要应该思考的问题。</strong></p>\n<p>当然，这不是让你心猿意马，而是要时刻保持危机感，否则一不小心就走入了职场死胡同。</p>\n<hr>\n<p><strong>职场上，最好的生存保障是，走出这家公司，我依然能过得很好，或更好。</strong></p>\n<p>公司实行成本优化，开始清退 34+ 的程序员了？挺好，对面那家公司正想双薪挖人。</p>\n<p>项目市场反馈不行，团队面临解散？没事，另外团队的 Leader 前几日刚找我聊了，正希望我加入。</p>\n<p>Salesforce 来推销他们的 SaaS（企业软件即服务）服务了，IT部门又可以优化几个人员了。正好，那家18薪出国游的公司正在招人，技术要求很匹配…</p>\n<hr>\n<p><strong>在一家远离开源的公司，或技术落伍许久的团队，即使你是首席架构、技术总监，熟练掌握公司或团队内部的各种框架，配置和接口倒背如流，还能一一填埋这些框架的各种坑，那又如何？</strong></p>\n<p><strong>35岁了，换了一家公司，也许你又归零成了小白，因为别人不玩你这一套。</strong></p>\n<p>诺基亚塞班系统的专家，别说去微软了，即使去诺西（诺基亚西门子通信的简称），很多都得从头再来。</p>\n<p>百度 Pyramid（细节自行百度）项目组的大拿，还不如一个精通 Hadoop 配置的工程师更有市场。</p>\n<p>SAP、Oracle EBS 开发的资深工程师，选择公司的余地远比不上一个初级 React 工程师。</p>\n<p>之前参加过一些创业项目的路演，遇到过一个项目，创始人是两位博士，号称研发了最先进的深度学习算法，用于医学扫描成像的癌症诊断。</p>\n<p>但是，TensorFlow（谷歌）、CNTK（微软）等深度学习开源框架的图像识别算法，在癌症检测方面也许可以碾压小创业团队所谓的绝门秘笈。挺替他们的投资人担心的…</p>\n<hr>\n<p><strong>目前为止，只说了 90% 的普通程序员，那还有 10% 精英程序员呢？</strong></p>\n<p><strong>毫无疑问，精英程序员更应该拥抱开源，因为那才是实现个人价值，提升个人影响力的最佳途径。</strong></p>\n<p>如果 Spring 没有开源，就不可能获得如此广泛的应用，Rod Johnson（Spring 之父）的影响力也会大打折扣。</p>\n<p>如果 Lucene、Hadoop 没有开源，很多人可能都不知道 Doug Cutting（Lucene、Hadoop 之父）为何许人也。</p>\n<p>如果 Linux、Git 没有开源，也许就没有 Linus Torvalds（Linux、Git 之父）的享誉世界。更重要的是，这个世界可能会被更多的蝗虫入侵。</p>\n<p><em>注：“突然间，到处都是微软的产品了，被蝗虫入侵了似的。我并不是说蝗虫是坏蛋，我喜欢所有的动物和昆虫。” —— 摘自 Linus Torvalds 语录：</em></p>\n<p><strong>诚然，如上的大神毕竟凤毛麟角。但大牛级别的程序员走向开源，带来的个人影响力、声誉、技术伙伴、收入、成就感等，都是实实在在的。</strong></p>\n<hr>\n<p><strong>说了这么多，也许你也挺无奈的，因为你所在的项目所用的技术体系，刚好是公司专有且闭源的，那怎么办？</strong></p>\n<p>你可以默默的把这篇文章转给你们技术领导看看，看他有没有这个思想觉悟。</p>\n<p>如果领导悟性不够，半晌没有回应，你可以提点他一下：无论实习码农，还是技术大牛，现在优秀的人才都拥抱开源去了，我们再这样下去，会招不到优秀的人才的…</p>\n<hr>\n<p><strong>如果非常不幸，你从事的是银行、基金、保险、电信、电力、石油等领域的业务，而且还是古董级别的项目，领导说稳定才是第一位的。那你也有三条路可以走：</strong></p>\n<p>1、祈祷自己早日实现财务自由（据年初的胡润报告，一线城市财富自由门槛是 2.9亿）</p>\n<p>2、祈祷所在的公司（部门）能够基业长青</p>\n<p>3、更新一下简历，准备跳槽吧~</p>\n<p><strong>那这种古董级别的项目怎么办？总得有人维护吧？</strong></p>\n<p><strong>加薪！加薪！加薪！不能给予锦绣未来，就给予更猛烈的薪水吧！</strong></p>\n<hr>\n<p><strong>最后，即使是第一生存法则，也不是金科玉律。因为世上总存在一些奇葩的人，码农这个群体也不例外。</strong></p>\n<p>譬如我找人，最关注的还是逻辑思考能力。写一个新算法，学一门新语言，用一套新框架，不过几周的事情，何必那么纠结。</p>\n<p>不过，玩过 Tensorflow 图像识别与目标检测，跑过 ResNet、Inception 等网络的优先…</p>\n<hr>\n<p><strong>题外话</strong></p>\n<p>本文通篇都是从务实的角度来谈开源的好处，事物都有两面性，那开源的坏处在哪里？</p>\n<p>其实前面也提到了一点，TensorFlow、CNTK 等开源框架的算法，完全可以碾压大多数人工智能创业团队所研发的所谓独门秘诀，特别是通用算法领域。</p>\n<p><strong>也就是说，不少创业团队、研究院、实验室里，一门心思研究底层算法（包括图像识别、语音识别、翻译、NLP等前沿领域）造轮子的精英程序员、研究员可能会因此荒废多年的心血…</strong></p>\n<p>譬如，两个月前，百度推出阿波罗计划，将自家的自动驾驶平台开放。这同时意味着，国内自动驾驶领域的不少创业团队可能会面临被洗牌、解散。如果今后谷歌也来这么一出，行业震荡可想而知。</p>\n<p>前些日子，还听我一位在某大厂研究院视觉识别组的同学说：谷歌物体检测与图像识别的API一开放，他们视觉组辛苦了3、4年的研发心血又白费了…</p>\n<p><strong>可开源是人类社会进化的最优选择，因为只有开源，才能实现人类顶级智慧的充分共享与协作。</strong>除了谷歌、脸书，连一贯封闭的微软、苹果两大巨头都已走向开放。</p>\n<p><strong>开源大潮，浩浩荡荡，顺之者势如破竹，逆之者举步维艰。</strong></p>\n<p>也许自然规律如此，人类宿命如此吧。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111627\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111627votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111627\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('漫画算法：什么是跳跃表？', '2017-07-12', 'http://blog.jobbole.com/111731/', 'a7e761864e16693a072a866a8afdabb1', 'http://jbcdn2.b0.upaiyun.com/2017/07/daab64eb4fff66513ac482d07e5ae054.jpeg', 'full/27823440373381b04421fc70634750dfcfca3b30.jpg', '5', '8', '1', '趣文小说,,算法,跳跃表', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>这是发生在很多年以前的故事……</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/daab64eb4fff66513ac482d07e5ae054.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/890d2a8f840ed95165dcd3df24ed584c.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1ec995966632cc86d75a2511bba11c5c.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b0c602dc9acb987c129f35169341b74d.jpeg\"></p>\n<p>几天以前……</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/53f3319b898ce41a545b29d930946a2a.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5f1e257214c48a4d8246b9395bb0f0df.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/10dd099feb00060dad6b1339e0db8799.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/45606dfe47cc5586318007d1970f26e5.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0716a40761dbfdbf797543bb24b58945.jpeg\"></p>\n<p>几天之后……</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5f5785668595f59e8ba4778cae9f2d6a.jpeg\"></p>\n<p>拍卖行的商品总数量有几十万件，对应数据库商品表的几十万条记录。</p>\n<p>如果是按照商品名称精确查询还好办，可以直接从数据库查出来，最多也就上百条记录。</p>\n<p>如果是没有商品名称的全量查询怎么办？总不可能把数据库里的所有记录全查出来吧，而且还要支持不同字段的排序。</p>\n<p>所以，只能提前在内存中存储有序的全量商品集合，每一种排序方式都保存成独立的集合，每次请求的时候按照请求的排序种类，返回对应的集合。</p>\n<p>比如按价格字段排序的集合：</p>\n<p>比如按等级字段排序的集合：</p>\n<p>需要注意的是，当时还没有Redis这样的内存数据库，所以小灰只能自己实现一套合适的数据结构来存储。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8eadcb96909cbebc38292974d5216fab.jpeg\"></p>\n<p>拍卖行商品列表是线性的，最容易表达线性结构的自然是数组和链表。可是，无论是数组还是链表，在插入新商品的时候，都会存在性能问题。</p>\n<p>按照商品等级排序的集合为例，如果使用数组，插入新商品的方式如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/af7f12cccfbda80b967d515acebe79d9.jpeg\"></p>\n<p>如果要插入一个等级是3的商品，首先要知道这个商品应该插入的位置。使用二分查找可以最快定位，这一步时间复杂度是O（logN）。</p>\n<p>插入过程中，原数组中所有大于3的商品都要右移，这一步时间复杂度是O（N）。所以总体时间复杂度是O（N）。</p>\n<p>如果使用链表，插入新商品的方式如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1bce6be23668647edf9eff28d305c84f.jpeg\"></p>\n<p>如果要插入一个等级是3的商品，首先要知道这个商品应该插入的位置。链表无法使用二分查找，只能和原链表中的节点逐一比较大小来确定位置。这一步的时间复杂度是O（N）。</p>\n<p>插入的过程倒是很容易，直接改变节点指针的目标，时间复杂度O（1）。因此总体的时间复杂度也是O（N）。</p>\n<p>这对于拥有几十万商品的集合来说，这两种方法显然都太慢了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e3be5ef6ac109306ee1dd169fb6b8df3.jpeg\"></p>\n<p>——————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/00e8f84563ba3fc4e926f4b8b2f5fe7a.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e795edb90cf7d598d733592920657a97.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3cd2a28c4e3e48550d33f7fe4a47fd0.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/02717bbe18ec7d1034580481ffa22e7e.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9bfe1887ff9177a8c0f303de054c79fe.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/377693e7b3f37892f42e4e144f92c362.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b9b3c90dc0681f0af4963d783dff24d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/15ece5c25170a528131c4e7803c8e0e8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a58d35069f85e181659f2c8dc98cffbc.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/325af9d7f350486e58b41b32bd254227.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c708e4a0c267b5e9f3a37ad309e6c3e8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fa5f0684ada4d509f3e978c104f576ac.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4d469cbe0d0afb9bb7cf2c99f266a5f9.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d972154799e05c43dc61c56cbc182203.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e0ef1f5c4cbfa110713984f06904c97a.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bb33df3e70571a35b0d38cfa2aa0f719.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c66bd9b6ba634f5df05dfb4931201217.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/757e77b87645239013108a7eac7cac78.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a502d32bad14a5943b78e5ec283eb6a3.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ea99ed67b7cdb47d04c3703f12a64bc4.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e98cfa966bb1cfa58a5e8a11505a3e0f.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e5972f05c028476a0b2eb43850a1432.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ea50cbc49ca84c72b94cb693d121c017.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3063e527ca511c457824b146b3047fb2.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ad1e060829476ef9de94d33ea246009d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f0fed037f81a07b51108a6d6468e4235.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6f7628b9803eaae385222da353b34b83.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b69b19d022c8a75aa2d83fca3d10066.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a327ac84038bdf376496a07a5d61d23d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/98b8caa7a5b7da9aaf7999a7f502fd92.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/df485893afb0b40cfec65ce19233faa6.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0c38e0ee3659932960bbc9b3c310fab8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dedddf4bf8ad251e479ce73ef0f628c9.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4b8a95bfc81b232d79b2c8056ca454ec.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4f6bafe8717d30780a0bc7ae1110c37d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9e92dc231f4069da54a71fa6be3bd12e.jpeg\"></p>\n<p>新节点和各层索引节点逐一比较，确定原链表的插入位置。O（logN）</p>\n<p>把索引插入到原链表。O（1）</p>\n<p>利用抛硬币的随机方式，决定新节点是否提升为上一级索引。结果为“正”则提升并继续抛硬币，结果为“负”则停止。O（logN）</p>\n<p>总体上，跳跃表插入操作的时间复杂度是O（logN），而这种数据结构所占空间是2N，既空间复杂度是 O（N）。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/95b14789cf228b85159be05aa93cbaa4.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0a64ff5e6453328bf1360416339c0adb.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0da2ce061fbca4790c93b0139e66d289.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/86a6084f88fa592dd304e890b72409eb.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7c32aa5ab5f2c936078f16840eabf1b2.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/41d9de8c654dc43b0f1703b0e29c6590.jpeg\"></p>\n<p>自上而下，查找第一次出现节点的索引，并逐层找到每一层对应的节点。O（logN）</p>\n<p>删除每一层查找到的节点，如果该层只剩下1个节点，删除整个一层（原链表除外）。O（logN）</p>\n<p>总体上，跳跃表删除操作的时间复杂度是O（logN）。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/24f060f88decdf946d1069ce4c82f57d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e7566dee2274eb9bfcefcc13c1a7494c.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/869228a1933d8e4a9e8ec81afc0603d5.jpeg\"></p>\n<p>小灰和大黄并不知道，他们的这一解决方案和若干年后Redis当中的Sorted-set不谋而合。而Sorted-set这种有序集合，正是对于跳跃表的改进和应用。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111731\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111731votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111731\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/7ce4028f2cece3294efcb3e5caa73af1.jpeg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网公司的码农一枚，喜欢算法和面向对象设计。个人微信号：13522239721 个人订阅号：dreamsee321欢迎一起交流讨论！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bjweimengshu\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/bjweimengshu/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 94</a> · <a title=\"个人微信：bjweimengshu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('走近比特币：一个故事看懂“区块链”', '2017-07-12', 'http://blog.jobbole.com/111768/', 'b727b9066b0e290ea3a28731fb346c13', 'http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png', 'full/63f2aa24b2b070edaefbb38b67ace3ebd11241ce.jpg', '0', '8', '3', 'IT技术,区块链,比特币', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"\">赛博朔方</a>   </div><p>区块链是比特币的底层技术和基础架构，本质上是一个去中心化的数据库。区块链是一串使用密码学方法相关联产生的数据块，每一个数据块中包含了一次比特币网络交易的信息，用于验证其信息的有效性（防伪）并生成下一个区块。</p>\n<p>狭义来讲，区块链是一种按照时间顺序将数据区块以顺序相连的方式组合成的一 种链式数据结构， 并以密码学方式保证的不可篡改和不可伪造的分布式账本。</p>\n<p>以上定义摘自百度百科。很多菜鸟朋友看完这段解释依然满脸懵逼，到底什么是“区块链”？</p>\n<p><strong>起因</strong></p>\n<p>除非你完全没有接触过信息安全，否则一定听说过比特币和区块链。毕竟这两个名词也是近两年来各大国内外媒体争相报道的热词。尤其是继今年5月爆发的WannaCry病毒爆发以后，很多从未接触过的人都开始加入讨论大军。</p>\n<p>我的很多朋友都不懂技术。最近几周他们一个个都变身好奇宝宝，围着我问比特币和区块链。我想这两个名词的热度一定还会持续攀高，对他们不够了解的人也还有很多很多。何不采用通俗的语言对“区块链”做一个解释，把这个概念传播开来？</p>\n<p>和网上一般的名词解释不同（不管三七二十一，下个定义再说，其实并没有什么卵用），我们以它的作用为切入点来理解区块链的工作机制。</p>\n<p><strong>故事的开端</strong></p>\n<p>Joe是你最好的朋友。他出国旅游后的第五天给你打了个电话：“兄弟，我需要点钱，出国之后把身上的钱都花完了。”</p>\n<p>你回复：“我马上打过来”，然后挂了电话。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png\"><img class=\"aligncenter wp-image-111770 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>接着你又打电话给你的银行客户经理：“麻烦你马上从我的账户转1000美元给Joe。”</p>\n<p>客户经理：“好的，明白。”</p>\n<p>客户经理随后确认了你的账户是否有足够的余额。因为你是百万富翁，所以客户经理进行了如下的操作：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/01ba164bb2faac9366790f480929ba0d.png\"><img class=\"aligncenter wp-image-111771 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/01ba164bb2faac9366790f480929ba0d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>交易账单</p>\n<p>你打电话给Joe说你已经把1000美元转过去了。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/63a42b41972d79baeb70657d8fa43e4d.png\"><img class=\"aligncenter wp-image-111772 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/63a42b41972d79baeb70657d8fa43e4d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>回头我们再来看看刚刚到底发生了什么。你和Joe都信任那家银行来管理你们各自的财产。整个过程中实际并没有真实货币的物理流动。整个过程只涉及录入系统的两个账户即可。更准确地说，全程只需主动权属于该银行的两个账户就可以完成。</p>\n<p>在这样传统的货币体系中，我的问题就来了。</p>\n<p>交易双方的信任机制建立需要借助第三方。这种“中间人”的方式由来已久。那么你可能又要问了：“这种信任机制有什么问题吗？”问题在于除交易双方以外的“监督者”只是单个个体。这种情况可能存在以下风险：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965feed98f86546448783\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n如果有人有意或无意地摧毁了某个人或某个第三方组织机构就可能足以引起社会混乱。\r\n如果记录了某个交易的注册表遭遇火灾怎么办？\r\n万一你的客户经理不小心划了1500美元到你朋友的账户怎么办？\r\n如果他是故意这么做的呢？</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965feed98f86546448783-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965feed98f86546448783-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965feed98f86546448783-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965feed98f86546448783-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965feed98f86546448783-1\">如果有人有意或无意地摧毁了某个人或某个第三方组织机构就可能足以引起社会混乱。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965feed98f86546448783-2\">如果记录了某个交易的注册表遭遇火灾怎么办？</div><div class=\"crayon-line\" id=\"crayon-5965feed98f86546448783-3\">万一你的客户经理不小心划了<span class=\"crayon-cn\">1500</span>美元到你朋友的账户怎么办？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965feed98f86546448783-4\">如果他是故意这么做的呢？</div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>世界上有没有无需借助银行就能帮助我们完成安全转账的系统？</p>\n<p>要想解决这个问题，我们首先应该静下心来好好思考，问自己一个更深层次的问题：我们能不能自己掌握账户和历史交易的信息呢？</p>\n<p>这的确是一个值得探讨的问题。答案当然你一定也已经猜到了——那就是“区块链”。现在我们就开始学习这个分布式账本是如何运作的。</p>\n<p><strong>故事的发展</strong></p>\n<p>该方法得以实行的必要条件是必须有足够多的人愿意在交易时不依赖于第三方。只有这样，这一部分的人才能够自己掌控账本资料。</p>\n<p>那么人数要达到多少才足够呢？在下面的例子中，我们假设有10个人愿意放弃银行或其它任何第三方机构。在双方达成协议的前提下，他们互相之间能够在不知道对方身份的情况下时刻掌握对方账户的一切信息和动态。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3b01673d22d6a83ed4ab9a6ec0f20b.png\"><img class=\"aligncenter wp-image-111773 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3b01673d22d6a83ed4ab9a6ec0f20b.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>1. 一个空文件夹</p>\n<p>一开始每个人都会获得一个空文件夹。随着时间推进，这十个人都会在他们现在空的文件夹里不断添加记录交易信息的纸张。</p>\n<p>2. 交易发生时</p>\n<p>接下来，这个交易网络中的每个人都带着纸和笔坐下来，准备记录下在这个系统中发生的每一笔交易。</p>\n<p>假设，2号想给9号10美元。</p>\n<p>为了完成这笔交易，2号大声地告诉每个人：“我要转10美元给9号。请大家都在自己的纸上记下来。”</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/81b4ecaa4773d202ad3bfbecd6a37b70.png\"><img class=\"aligncenter wp-image-111774 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/81b4ecaa4773d202ad3bfbecd6a37b70.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>然后每个人都检查确认2号是不是有10美元及以上的余额能够转给9。如2号余额足够，那么大家都在空白纸上记录下这笔交易。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/1183d1ddac95cb55be40dd6f13215cf4.png\"><img class=\"aligncenter wp-image-111775 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1183d1ddac95cb55be40dd6f13215cf4.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>纸上的第一笔交易</p>\n<p>这笔交易这样就算完成了。</p>\n<p>3. 持续发生的交易</p>\n<p>随着时间的流逝，这个交易网络中出现交易需求的人越来越多。无论何时他们产生交易需求，都会通知网络中的每个人。只要有人听到了这个通知，他/她就会在他们各自的纸上记录下来。</p>\n<p>这个过程会持续进行，直到这张纸上的空间不足。假设每张纸只能记录10次交易，那么只要第10次交易完成，每个人纸上的空间也就随之耗尽。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/5bd3935a377f1251c6165091f6270aa6.png\"><img class=\"aligncenter wp-image-111776 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5bd3935a377f1251c6165091f6270aa6.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>当白纸被填满</p>\n<p>这时候我们就需要把这张纸放进文件夹并拿出另一张新的白纸，重复上面步骤2的过程。</p>\n<p>4. 把纸张放进文件夹的注意点</p>\n<p>在把纸张放进文件夹之前，我们需要对这张纸用网络中每个人都认可的专有密钥进行密封。但是密封后我们要确保的是，这张纸就只能尘封在文件夹里，无论是谁无论何时都不能对其作任何修改。并且如果每个人都相信这个“封印”，那么也就意味着每个人都绝对信任这张纸上的内容。这种密封方式也是区块链的关键所在。</p>\n<p>以前第三方或中间人都会说服我们相信无论他们在注册表中记录了什么，里面的内容都不会发生改变。但在现在这个分布式的、去中心化的系统中，这个印章（密钥）就为我们建立了这种信任机制。</p>\n<p><strong>故事的高潮 （一）</strong></p>\n<p>新的问题又来了。我们应该如何密封这张纸？</p>\n<p>在学习如何密封之前，我们先来了解印章的工作原理。</p>\n<p>假设我们现在有一个机器，如果你把一个里面装着东西的盒子从左边放进去，这个魔法机器会从右边吐出一个装着其它东西的盒子。</p>\n<p>【术语解析】这个机器实际叫作“哈希函数”，但是今天我们不讨论技术。所以我们暂且称它为“魔法机器”。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e3f892be4247730976be45fb1f1e270.png\"><img class=\"aligncenter wp-image-111777 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e3f892be4247730976be45fb1f1e270.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>魔法机器（即哈希函数）</p>\n<p>如果我们把装有数字4的盒子从左边放进去，它会从右边给出下列字符：dcbea。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/7f0d5928f1188ea21c9480dcff258578.png\"><img class=\"aligncenter wp-image-111778 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7f0d5928f1188ea21c9480dcff258578.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>如果已知条件是输出结果为“dcbea”，要想知道从左边输入的是什么非常困难。但是每次如果你把4放进去，最终的输出结果“dcbea”是肯定的。</p>\n<p>我们来试试发送其它数字。如果放入26会得到什么呢？</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/1e6ae033a33080a677a6191ea391e5f0.png\"><img class=\"aligncenter wp-image-111779 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1e6ae033a33080a677a6191ea391e5f0.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>哈希（26）=94c8e</p>\n<p>这次我们得到的是“94c8e”。从26的输出结果来看，结果也可以包含数字。</p>\n<p>了解到这儿，我们可以开始思考下一个更加深入的问题了：</p>\n<p>“如果我想从右边得到一个以3个零为开头的结果（如000ab、00098、000fa等），那么我应该从机器的左边放入什么内容？”</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b5094d27681e08d4fd51ff4fe96457f.png\"><img class=\"aligncenter wp-image-111780 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b5094d27681e08d4fd51ff4fe96457f.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>预测输入的内容</p>\n<p>这个机器有一个单向性的属性：给出右边的预期结果后，我们无法计算出左边放入的内容。那是不是意味着这个问题无解？倒也未必。</p>\n<p>我能想到一种方法——把每个数字都输入一遍，直到机器输出以3个零为开头的结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/f8de38b5d93b04da9c1cef1bf1857e6c.png\"><img class=\"aligncenter wp-image-111781 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f8de38b5d93b04da9c1cef1bf1857e6c.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>把每个数字都尝试一遍</p>\n<p>有耐心的人试上几千次可能也就找到了这个符合我们输出要求的数字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/772ab83f8b259605193ef6eafda2b66e.png\"><img class=\"aligncenter wp-image-111782 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/772ab83f8b259605193ef6eafda2b66e.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>通过输出结果来获得输入数字这种逆向计算的确非常困难。但是如果我们得到了预测的输入内容，验证该输入是否能得出我们想要的结果就非常非常容易了。记住，这个机器最大的特点就是每个结果只对应一个数字，绝无例外的“一夫一妻制”。</p>\n<p>如果我给你72533这个数字，然后问你：“这个数字输入魔法机器后会不会输出以3个零为开头的结果？”这个问题就简单到简直在侮辱我们的智商了。</p>\n<p>因此这个机器最最最重要的属性是——知道结果，要想算出输出非常困难，但是如果我们知道输入的数字和输出结果，验证两者是否匹配很简单。</p>\n<p><strong>如何利用这个机器密封纸张？</strong></p>\n<p>怎样利用魔法机器生成每张纸独有的封印？还是老办法，采用情境模拟的方法展开解释。</p>\n<p>假设我给了你两个盒子。第一个盒子里面有数字20893，你能不能想出一个数字，这个数字与第一个盒子里的数字相加后的结果放入魔法机器后，我们能够得到一个以3个零为开头的字符结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/21d6fade61921245e50fb1a30147c031.png\"><img class=\"aligncenter wp-image-111783 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/21d6fade61921245e50fb1a30147c031.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>这个情景和之前的难题几乎相同。唯一的办法就是把每个数字都放入机器尝试一遍。</p>\n<p>经过几千次的尝试，我们会在21191这个数字这里停下，21191+20893=42084，把42084放入这个机器后所得到的结果正是我们想要的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/449e0679475edf81e6cbfc2a763db20d.png\"><img class=\"aligncenter wp-image-111784 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/449e0679475edf81e6cbfc2a763db20d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>在这个案例中，21191这个数字就是20893这个数字的“封印”。假设有张纸上写着20893这个数字。为了密封这张纸（即没有人能够再对其内容作改动），我们把带有21191标签的徽章贴在纸上，密封完成。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c01dc72fb256585c8432e1ca563ec34a.png\"><img class=\"aligncenter wp-image-111785 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c01dc72fb256585c8432e1ca563ec34a.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>被密封的数字</p>\n<p>【术语解析】用来密封的数字实际被称为“工作证明（Proof Of Work）”，因为这个数字是通过努力计算得来的。本文为了简单易懂，我们称它为“密封数字”。</p>\n<p>无论谁想验证这个页面是否被改动过，只要把页面上的内容与密封号码叠加后放入魔法机器。如果机器输出的内容是以3个零为开头的，那么该页面内容是没有被“污染”过的。但如果结果不满足这个特点，我们就应果断丢弃这个页面，因为上面的内容已经被改动、已经失效。</p>\n<p><strong>密封过程总结</strong></p>\n<p>要想密封记录整个交易网络中交易流水的页面，我们需要找到那个加入交易内容并输入机器后会得到以3个零为开头的字符的关键数字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/acf9c1fe14e240e49751ed7852fcdaa1.png\"><img class=\"aligncenter wp-image-111786 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/acf9c1fe14e240e49751ed7852fcdaa1.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>注意：“以3个零为开头的字符”只是一个举例，简单地反应哈希函数的工作原理。实际问题处理起来会复杂得多。</p>\n<p>只要花费一定的时间，交易网络中的参与者就能够计算出这个数字，该页面也就随之密封。一旦有人更改了页面上的内容，任何人都能够通过这个密封号码来验证这个页面的完整性。</p>\n<p><strong>故事的高潮（二）</strong></p>\n<p>了解如何密封页面后，我们再把思绪拉回10个人用完了一张纸上所有空间的时候。</p>\n<p>当这个页面上记不下更多的交易记录时，交易网络中的每个人都会停下来计算该页面的密封数字，然后将其放入文件夹。如果第一个人算好了密封数字，他就会向所有人公布。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/a3985de89845392cf48ab2239b4615ea.png\"><img class=\"aligncenter wp-image-111787 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a3985de89845392cf48ab2239b4615ea.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>听到密封号码后，大家都去验证这个数字是否能满足输出需求。如是，则在他们的页面上贴上这个标签，再把这个页面放进文件夹。</p>\n<p>但是如果7号算出了密封号码并“昭告了天下”，但结果大家发现这个数字并不满足他们的输出需求怎么办？这样的情况也很常见。原因可能有以下几点：</p>\n<p>1. 公布交易信息时听错了；</p>\n<p>2. 记录交易信息时出现笔误；</p>\n<p>3. 为了一己之利，记录交易时故意犯错。</p>\n<p>不管出于什么原因，7号只有一种选择——丢弃自己这张纸，然后从别人那里复制一份副本放进他自己的文件夹。如果不把这个页面放进文件夹，他就不能继续记录接下来的交易记录，这也就相当于把他从这个交易网络中踢掉了。</p>\n<p>说到这里，我相信有的人脑海里又出现了一个疑惑：既然有人计算好密封号码后会公布，为什么我们每个人还要花费那么多时间都去计算一遍？其他人为什么不歇着、坐等公布？</p>\n<p>Good question!区块链包含特殊的奖励机制，网络中每个人都有资格获得奖励。第一个计算出密封号码的人能够获得一定奖励。</p>\n<p>我们再来简单地假设一下，如果5号第一个算出了页面的密封号码，并获得了1美元的金额奖励，那么这1美元就是凭空出现的。换句话说，假如他账户里本来余额5美元，现在增加了1元，但是这1元没有从其它任何人的账户里扣除，即没有减少任何人的账户余额。</p>\n<p>这就是比特币的起源。它是在区块链（分布式账目）上发生交易的第一种货币。如果在这个交易网络上持续努力，你同样也能获得回报，这个过程就是我们所说的“挖矿”。</p>\n<p>拥有比特币的人越来越多，这些人一刻不闲着地开始炒这种虚拟货币，不断扩大市场对比特币的需求，再进一步提高比特币的价值。就这样周而复始地把比特币的价格炒得很高。</p>\n<p>这种奖励机制让交易网络中的每个人都勤勤恳恳地劳作。</p>\n<p>他们把纸张放进文件夹后，拿出一张新的空白纸张，然后再次重复前面的过程——循环往复、永无止境。</p>\n<p>假设文件夹中已经有5个被密封的页面。如果我为了谋取私利修改了第二个页面的其中一笔交易会发生什么？前面已经提到过，所有人都可以通过密封号码查出交易内容已经发生改变。但是如果我根据修改的内容重新计算密封号码，然后把新号码贴在纸上，出现这样的情况怎么办？</p>\n<p>为了防止有人同时修改页面和密封号码，计算密封号码时有一个小技巧。</p>\n<p><strong>如何防止密封号码被重新计算、更改？</strong></p>\n<p>还记得之前我假设你有两个盒子，一个包含20893这个数字，一个是用于计算的空盒子吗？在区块链中计算密封号码，实际上存在三个盒子，而不是两个，其中两个是有内容的，一个是待计算填充的。</p>\n<p>当三个盒子的内容都填好放入机器后，机器右边输出的结果能够满足我们的需求。</p>\n<p>一个盒子里是交易记录、一个盒子是密封号码，第三个盒子是通过哈希函数计算出来的前一页的输出结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/e21b6b9e3ecaf688e7062ac64e85e53c.png\"><img class=\"aligncenter wp-image-111788 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e21b6b9e3ecaf688e7062ac64e85e53c.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>通过这个小技巧，我们能够确保每一页的密封号码都与前一页的内容相关联。因此如果有人修改了历史页面的内容，他需要改动接下来每一页的密封号码，从而保证整个链路的一致性。</p>\n<p>我们假设十个人中有一个人想要恶意修改区块链中的内容（包含记录了交易历史页面的文件夹），那么他需要调整很多页面，计算改动页面之后所有页面的密封号码。我们都知道计算密封号码的工作非常困难。因此，整个交易网络中的一个叛徒最终还是会输个剩下的9个好人。</p>\n<p>从这个叛徒想要更改内容的页面开始，他就需要在整个网络中创建另一个区块链，但是这个区块链几乎不可能赶上好人们创建的链路——一个人的力量赶不上剩下9个人的共同努力。因此，有一点非常明确，区块链规模越大，安全性和可信度越高。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0cccd45985994d1e22ee95332fe1fb1c.png\"><img class=\"aligncenter wp-image-111789 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0cccd45985994d1e22ee95332fe1fb1c.png\" alt=\"1\" width=\"1000\" height=\"637\"></a></p>\n<p>但是如果10个人中有6个人都叛变了怎么办？</p>\n<p>如果出现这样的情况，这个协议就有点打脸了。这种情况被称为“51%攻击”。如果整个网络中的大多数人都决定叛变，欺骗剩下不到半数的人，那么整个协议就自然而然地走向了灭亡。</p>\n<p>这是区块链最大的弱点。尽管这样的情况不可能出现，但我们还是要谨记这个系统的弱点。整个体系都是基于一个假设：整个交易网络中的大多数人都不会叛变。</p>\n<p><strong>结 局</strong></p>\n<p>解释到这里也就差不多了。还请亲爱的们再回头看看百度百科给出的定义，现在是不是理解起来容易很多了？</p>\n<p>如果还有人问起到底什么是区块链，比特币的运作机制是怎样的，我相信本文的读者都能够解释给更多的小白们听啦。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111768\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111768votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111768\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('谷歌地图基于 ML 的停车难度预测', '2017-07-12', 'http://blog.jobbole.com/111318/', 'b750bb78dea06e0f01755bcd8f2b5cea', 'http://wx3.sinaimg.cn/large/7cc829d3gy1fga18qfp86j20hp0hsqfe.jpg', 'full/821a240836719752ee8f1be9281e9373dabc2aa2.jpg', '0', '1', '1', 'IT技术,机器学习', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/CrazyEric1994\">CrazyEric</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://iot-for-all.com/using-machine-learning-to-predict-parking-difficulty-d0af0cd3b9a9#.gtso3qtnz\">Yitaek Hwang</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p style=\"text-align: center;\"><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fga18qfp86j20hp0hsqfe.jpg\"></p>\n<p style=\"text-align: center;\"><span class=\"md-line md-end-block\" style=\"color: #999999;\"><span class=\"\">（一周不同日子里旧金山的停车困难度模型，越红代表停车越困难）</span></span></p>\n<p>据英国每日电讯报报道，平均每位司机在找车位上要花费 2549 个小时，也就是106 天。这些是英国的统计数据，但是我打赌住在美国大都市的司机花在找车位上面的时间并不会比这个少。</p>\n<p>今年 2 月份，Google 悄悄地在安卓版谷歌上针对美国 25 个主要城市推出了一个新的停车功能。如果你在这些城市范围内，你会看到一个红色的停车标志表示着停车位紧张，以此来帮助你规划你的出行。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fga18r026zj20i20i2q7m.jpg\"></p>\n<p>这次更新有趣的部分是，它不依赖联网的停车状况数据，因为（联网数据）经常由于某些车主违规停车或者提早离开车位，而导致提供不完整或者错误的信息。Google 地图用了另一种替代方案，就是结合众包数据以及相对简单的机器学习算法来给停车困难度做分类。</p>\n<p>Google 同时也提到，他们在早期的一个实验中发现“公共交通出行模式按钮的点击率有显著上升”，也就意味着知道了停车难度信息的用户更容易去考虑公共交通出行而不是驾车。仅仅通过提示停车难度，在城市里就可以鼓励人们多乘坐公交少开车，这有可能会缓解交通问题。</p>\n<h3>机器学习方案</h3>\n<p>为了训练算法，Google 通过测量用户停车所需时间来分类找车位是“困难”还是“简单”，在把这个信息和位置数据关联之后，Google 需要过滤掉那些误报的信息（false positives）：用户停在私家车位里或者乘坐出租车到达，会让系统误以为那个区域很好停车。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fga18ro61yj20hs0gbgus.jpg\"></p>\n<p>为了解决这个问题，Google 决定，如果用户像上图所示那样在某个位置绕来绕去，那么这通常意味着停车困难。为了识别出这种行为，他们对比了用户预计抵达的时间和实际抵达的时间的差异，差异越大，也就意味着找车位越困难。Google 同时还添加了其它特征，比如每天时间的变化、日期以及历史停车数据来调校模型。</p>\n<p>Google 用了简单的 Logistic 回归模型来训练算法。他们解释说 Logistic 回归很适合这个案例，因为：</p>\n<ul class=\"ul-list\">\n<li class=\"\">算法很好理解并且对噪声数据的容错能力强；</li>\n<li class=\"\">模型的解释很直观（停车困难度可以被映射到“简单”或者“停车困难“）</li>\n<li class=\"\">验证每个特征对于模型的影响相对简单。令人意外的是，停车位置的分布是停车困难度最重要的变量，比预计到达时间和实际到达时间的差异更重要。</li>\n</ul>\n<p>Google 最新的停车困难度预测，带给我们两点在智慧城市建设方面的经验：</p>\n<ul class=\"ul-list\">\n<li>第一，不是所有的智慧城市应用都需要传感器。有时候数据就在那里，我们不需要借助于添加新的传感器去获取那些信息。</li>\n<li class=\"\">第二，虽然神经网络目前很流行并且准确率很高，但有时候更简单的算法也能很好地满足需求。</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111318\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111318votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111318\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/CrazyEric1994\">CrazyEric</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/CrazyEric1994\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/3eef01c43b9bf8ae2fa94beeb9a474de.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            墨尔本大学在读研究生，沉迷于机器学习。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/CrazyEric1994\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/crazyeric1994/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/CrazyEric1994/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"https://github.com/CrazyEric1994\"><i class=\"fa fa-link\"></i></a> <a title=\"QQ：17737775\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：qq17737775\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/CrazyEric1994\"><i class=\"fa fa-github\"></i></a> <a title=\"Linked主页\" target=\"_blank\" href=\"https://au.linkedin.com/in/jiawei-zhang-a56064a6\"><i class=\"fa fa-linkedin\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('用 C 语言写一个简单的 Unix Shell（1）', '2017-07-12', 'http://blog.jobbole.com/111738/', 'b7afdd1e2e7420b9ab8f1ad96f32df50', 'http://jbcdn2.b0.upaiyun.com/2015/11/746b03c66c6e4568ab9770632e5c69e9.jpg', 'full/6a97cfe7f7f14e4e38447a57e0284a25fe3ecdad.jpg', '0', '2', '1', 'C/C++,开发,C语言,shell', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qdoverture\">效楚</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-1/\">Indradhanush Gupta</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：作者用 C 语言实现了一个简易的unix shell，通过本文可加深对 shell 和 Unix 系统原理的理解。</p>\n<hr>\n<p>写 Unix shell 是我正在 RC 研究的一个项目。这是第一部分，后续会有一系列的文章。</p>\n<p><strong>免责声明：我不是编写 shell 这个课题的专家，我是一边自学一边分享我的发现。</strong></p>\n<h2>shell 是什么？</h2>\n<p>关于这一点已经有很多书面资料，所以对于它的定义我不会探讨太多细节。只用一句话说明：</p>\n<blockquote><p>shell 是允许你与操作系统的核心作交互的一个界面（interface）。</p></blockquote>\n<h2 id=\"how-does-a-shell-work\">shell 是怎样工作的？</h2>\n<p>shell解析用户输入的命令并执行它。为了能做到这一点，shell的工作流程看起来像这样：</p>\n<ol>\n<li style=\"padding-left: 30px;\">启动shell</li>\n<li style=\"padding-left: 30px;\">等待用户输入</li>\n<li style=\"padding-left: 30px;\">解析用户输入</li>\n<li style=\"padding-left: 30px;\">执行命令并返回结果</li>\n<li style=\"padding-left: 30px;\">回到<span style=\"color: #808080;\">第 2 步</span>。</li>\n</ol>\n<p>但在这整个流程中有一个重要的部分：<strong>进程</strong>。shell是父进程。这是我们的程序的<span style=\"color: #808080;\">主</span>线程，它等待用户输入。然而，由于以下原因，我们不能在<span style=\"color: #808080;\">主</span>线程自身中执行命令：</p>\n<ol>\n<li style=\"padding-left: 30px;\">一个错误的命令会导致整个shell停止工作。我们要避免此情况。</li>\n<li style=\"padding-left: 30px;\">独立的命令应该有他们自己的进程块。这被称为隔离，属于容错（机制）。</li>\n</ol>\n<h2 id=\"fork\">Fork</h2>\n<p>为了能避免此情况，我们使用系统调用 <span style=\"color: #808080;\">fork</span>。我曾以为我理解了 <span style=\"color: #808080;\">fork</span>，直到我用它写了大约4行代码（才发现我没有理解）。</p>\n<p><code class=\"highlighter-rouge\"></code><span style=\"color: #808080;\">fork</span> 创建当前进程的一份拷贝。这份拷贝被称为<span style=\"color: #808080;\">“子进程”</span>，系统中的每个进程都有与它联系在一起的唯一的进程 id（pid）。让我们看以下代码片段：</p>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-1/fork.c\"><i>fork.c</i></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a588547217665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;unistd.h&gt;\r\n\r\nint\r\nmain() {\r\n    pid_t child_pid = fork();\r\n        \r\n    // The child process\r\n    if (child_pid == 0) {\r\n        printf(\"### Child ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    } else {\r\n        printf(\"### Parent ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    }\r\n \r\n    return 0;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a588547217665-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a588547217665-19\">19</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-3\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-4\"> </div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-5\"><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-6\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-8\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// The child process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Child ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-12\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Parent ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-15\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a588547217665-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a588547217665-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p><span style=\"color: #808080;\">fork</span> 系统调用返回两次，每个进程一次。这一开始听起来是反直觉的。但让我们看一下在底层发生了什么。</p>\n<ol>\n<li style=\"padding-left: 30px;\">通过调用 <span style=\"color: #808080;\">fork</span>，我们在程序中创建了一个新的分支。这与传统的 <span style=\"color: #808080;\">if-else</span> 分支不同。<span style=\"color: #808080;\">fork</span> 对当前进程创建一份拷贝并从中创建了一个新的进程。最终系统调用返回子进程的进程 id。</li>\n<li style=\"padding-left: 30px;\">一旦 <span style=\"color: #808080;\">fork</span> 调用成功，子进程和父进程（我们的代码的主线程）会同时运行。</li>\n</ol>\n<p>为了让你更好理解程序流程，看这个图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/309a7a84764a07033c28b6ce5511c45c.jpg\"><img class=\"alignnone wp-image-65028 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/309a7a84764a07033c28b6ce5511c45c.jpg\" alt=\"fork\" width=\"594\" height=\"442\"></a></p>\n<p><span style=\"color: #808080;\">fork()</span> 创建了一个新的子进程，但与此同时，父进程的执行并没有停止。子进程执行的开始和结束独立于父进程，反之亦然。</p>\n<p>更进一步讨论以前，先说明一点：<span style=\"color: #808080;\">getpid</span> 系统调用返回当前的进程 id。</p>\n<p>如果你编译并执行这段代码，会得到类似于下面的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a594062740062\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### Parent ###\r\nCurrent PID: 85247 and Child PID: 85248\r\n### Child ###\r\nCurrent PID: 85248 and Child PID: 0</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a594062740062-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a594062740062-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a594062740062-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a594062740062-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a594062740062-1\"><span class=\"crayon-p\">### Parent ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a594062740062-2\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85247</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85248</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a594062740062-3\"><span class=\"crayon-p\">### Child ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a594062740062-4\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85248</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在 <span style=\"color: #808080;\">### Parent ###</span> 下面的片段中，当前进程 ID 是 <span style=\"color: #808080;\">85247</span>，子进程 ID 是 <span style=\"color: #808080;\">85248</span>。注意，子进程的 pid 比父进程的大，表明子进程是在父进程之后创建的。（更新：正如某人在 <a href=\"https://news.ycombinator.com/item?id=14439781\">Hacker News</a> 上正确指出的，这并不是确定的，虽然往往是这样。原因在于，操作系统可能回收无用的老进程 id。）</p>\n<p>在 <span style=\"color: #808080;\">### Child ###</span> 下面的片段中，当前进程 ID 是 <span style=\"color: #808080;\">85248</span>，这与前面片段中子进程的 pid 相同。然而，这里的子进程 pid 为 <span style=\"color: #808080;\">0</span>。</p>\n<p>实际的数字会随着每一次执行而变化。</p>\n<p>你可能在想，我们已经在<span style=\"color: #808080;\">第 9 行</span>明确的给 child_pid 赋了一个值<span style=\"color: #808080;\">（译者注：应该是第7行）</span>，那么 <span style=\"color: #808080;\">child_pid</span> 怎么会在同一个执行流程中呈现两个不同的值，这种想法值得原谅。但是，回想一下，调用 <span style=\"color: #808080;\">fork</span> 创建了一个新进程，这个新进程与当前进程相同。因此，在父进程中，<span style=\"color: #808080;\">child_pid</span> 是刚创建的子进程的实际值，而子进程本身没有自己的子进程，所以 <span style=\"color: #808080;\">child_pid</span> 的值为 <span style=\"color: #808080;\">0</span>。</p>\n<p>因此，为了控制哪些代码在子进程中执行，哪些又在父进程中执行，需要我们在 12 到 16 行定义的 <span style=\"color: #808080;\">if-else</span> 块<span style=\"color: #0000ff;\">（译者注：应该是 10 到 16 行）</span>。当 <span style=\"color: #808080;\">child_pid</span> 为 <span style=\"color: #808080;\">0</span> 时，代码块将在子进程下执行，而 else 块却会在父进程下执行。这些块被执行的顺序是不确定的，取决于操作系统的调度程序。</p>\n<h2>引入确定性</h2>\n<p>让我向你介绍系统调用 <span style=\"color: #808080;\">sleep</span>。引用 linux man 页面的话：</p>\n<blockquote><p>sleep – 暂停执行一段时间</p></blockquote>\n<p>时间间隔以秒为单位。</p>\n<p>让我们给父进程，即我们代码中的 else 块，加一个 sleep(1) 调用：</p>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-1/sleep_parent.c\"><i>sleep_parent.c</i></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a59c779808180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;unistd.h&gt;\r\n\r\nint\r\nmain() {\r\n    pid_t child_pid = fork();\r\n\r\n    // The child process\r\n    if (child_pid == 0) {\r\n        printf(\"### Child ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    } else {\r\n        sleep(1); // Sleep for one second\r\n        printf(\"### Parent ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    }\r\n \r\n    return 0;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a59c779808180-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a59c779808180-20\">20</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-3\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-4\"> </div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-5\"><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-6\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-8\"> </div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// The child process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Child ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-12\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Sleep for one second</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Parent ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-16\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-18\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a59c779808180-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a59c779808180-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>当你执行这段代码时，输出将类似这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a5a0030278132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### Child ###\r\nCurrent PID: 89743 and Child PID: 0</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5a0030278132-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5a0030278132-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a5a0030278132-1\"><span class=\"crayon-p\">### Child ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5a0030278132-2\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89743</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>1秒钟以后，你将看到</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a5a4521584272\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### Parent ###\r\nCurrent PID: 89742 and Child PID: 89743</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5a4521584272-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5a4521584272-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a5a4521584272-1\"><span class=\"crayon-p\">### Parent ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5a4521584272-2\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89742</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89743</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>每次执行这段代码时你会看到同样的表现。这是因为：我们在父进程中做了一个阻塞性的 <span style=\"color: #808080;\">sleep</span> 调用，与此同时，操作系统调度程序发现有空闲的 CPU 时间可以给子进程执行。</p>\n<p>类似的，如果你反过来，把 <span style=\"color: #808080;\">sleep(1)</span> 调用加到子进程，也就是我们代码中的 <span style=\"color: #808080;\">if</span> 块里面，你会发现父进程块立刻输出到控制台上。但你也会发现程序终止了。子进程块的输出被转存到<span style=\"color: #808080;\">标准输出</span>。看起来是这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a5a9307363365\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ gcc -lreadline blog/sleep_child.c -o sleep_child &amp;&amp; ./sleep_child\r\n### Parent ###\r\nCurrent PID: 23011 and Child PID: 23012\r\n$ ### Child ###\r\nCurrent PID: 23012 and Child PID: 0</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5a9307363365-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5a9307363365-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5a9307363365-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5a9307363365-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5a9307363365-5\">5</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a5a9307363365-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">lreadline </span><span class=\"crayon-v\">blog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sleep_child</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sleep_child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sleep_child</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5a9307363365-2\"><span class=\"crayon-p\">### Parent ###</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5a9307363365-3\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23011</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23012</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5a9307363365-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">### Child ###</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5a9307363365-5\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23012</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这段源代码可在 <a href=\"https://indradhanush.github.io/code/shell-part-1/sleep_child.c\">sleep_child.c</a> 获取。</p>\n<p>这是因为父进程在 <span style=\"color: #808080;\">printf</span> 语句之后无事可做，被终止了。然而，子进程在 <span style=\"color: #808080;\">sleep</span> 调用处被阻塞了 1 秒钟，之后才执行 <span style=\"color: #808080;\">printf</span> 语句。</p>\n<h2>正确实现的确定性</h2>\n<p>然而，使用 <span style=\"color: #808080;\">sleep</span> 来控制进程的执行流程不是最好的方法，因为你做了一个 <span style=\"color: #808080;\">n 秒</span>的 <span style=\"color: #808080;\">sleep</span> 调用：</p>\n<ol>\n<li style=\"padding-left: 30px;\">你怎么确保不管你等待的是什么，都会在 <span style=\"color: #808080;\">n 秒</span>内完成执行呢？</li>\n<li style=\"padding-left: 30px;\">不管你等待的是什么，要是它在远远早于 <span style=\"color: #808080;\">n 秒</span>时就结束了呢？在此情况下你不必要地闲置了。</li>\n</ol>\n<p>有一种更好的方法是，使用 <span style=\"color: #808080;\">wait</span> 系统调用（或一种变体）来代替。我们将使用 <span style=\"color: #808080;\">waitpid</span> 系统调用。它带有以下参数：</p>\n<ol>\n<li style=\"padding-left: 30px;\">你想要程序等待的进程的进程 ID。</li>\n<li style=\"padding-left: 30px;\">一个变量，用来保存进程如何终止的相关信息。</li>\n<li style=\"padding-left: 30px;\">选项标志，用来定制 <span style=\"color: #808080;\">waitpid</span> 的行为</li>\n</ol>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-1/wait.c\"><i>wait.c</i></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965524c3a5ae582530052\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n\r\nint\r\nmain() {\r\n    pid_t child_pid;\r\n    pid_t wait_result;\r\n    int stat_loc;\r\n\r\n    child_pid = fork();\r\n        \r\n    // The child process\r\n    if (child_pid == 0) {\r\n        printf(\"### Child ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n        sleep(1); // Sleep for one second\r\n    } else {\r\n        wait_result = waitpid(child_pid, &amp;stat_loc, WUNTRACED);\r\n        printf(\"### Parent ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    }\r\n \r\n    return 0;\r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965524c3a5ae582530052-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965524c3a5ae582530052-26\">26</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-3\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-4\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-6\"><span class=\"crayon-t\">int</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-7\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">wait_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-13\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// The child process</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Child ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-17\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Sleep for one second</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wait_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WUNTRACED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Parent ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-22\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-24\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5965524c3a5ae582530052-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965524c3a5ae582530052-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>当你执行这段代码，你会发现子进程块立刻被打印，然后等待很短的一段时间（这里我们在 <span style=\"color: #808080;\">printf</span> 后面加了 <span style=\"color: #808080;\">sleep</span>）。父进程等待子进程执行结束，之后就有空执行它自己的命令。</p>\n<p>第一部分到此结束。这篇博客中的所有代码示例可以在<a href=\"https://github.com/indradhanush/indradhanush.github.io/tree/master/code/shell-part-1/\">这里</a>获取。在<a href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-2/\">下一篇</a>中，我们将研究怎样在用户输入时接受命令并执行它。敬请期待。</p>\n<p><strong>致谢</strong></p>\n<p>谢谢 <a href=\"https://github.com/saulpw\">Saul Pwanson</a> 帮助我理解 <span style=\"color: #808080;\">fork</span> 的表现方式，谢谢 <a href=\"https://github.com/jaseemabid\">Jaseem Abid</a> 阅读草稿并提出编辑建议。</p>\n<p id=\"resources\"><strong>参考资料</strong></p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=k6TTj4C0LF0\">EnthusiastiCon – Stefanie Schirmer：《天哪！在 10 分中内构建一个 shell”</a>》</li>\n<li><a href=\"https://linux.die.net/man/\">Linux man 页面</a></li>\n</ul>\n<p>99e05c43dc61c56cbc182203.jpeg”&gt;</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/8204a635b9f0335c5b2e27498c3d5c97.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/0fbc02d33dc26bbfebc27f81bea9cdf9.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111738\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111738votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111738\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">效楚</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/72a13d3690f7c6edc018286f0ae732f6.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            本职工作是IC设计，工作中也经常做脚本编写、嵌入式编程等，对软件和文字翻译亦有浓厚的兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qdoverture\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qdoverture/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a>        </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('无我编程的 10 条戒律', '2017-07-12', 'http://blog.jobbole.com/111796/', 'ba6118e0816d19137e375492919002d7', 'http://wx2.sinaimg.cn/large/7cc829d3gy1fhh7jbexxkj20fa0akwjc.jpg', 'full/a01ba8722479a3c05e927ef40ac381fcf60c6f35.jpg', '0', '0', '1', '职场,Code Review,程序员', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/tecla\">tecla</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://blog.codinghorror.com/the-ten-commandments-of-egoless-programming/\">Jeff Atwood</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：无我编程（Egoless Programming）是一种编程风格，不是代码规范，旨在把代码评审中的人为因素最小化，应当在一个友好、合议方式进行，个人感情放一边，从而提高代码质量。</p>\n<p>在《<a href=\"https://www.amazon.cn/gp/product/B00Z7D9GYG/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00Z7D9GYG&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The Psychology of Computer Programming | 程序开发心理学</a>》书中，温伯格首次提出了无我编程十诫。本文则是 Stack Overflow 联合创始人 Jeff Atwood 对这十诫的注解。程序员普遍很自我（ego），都应该看看本文，时刻提醒自己。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhh7jbexxkj20fa0akwjc.jpg\"></p>\n<h3>1. 理解并接受这个事实：人都会犯错</h3>\n<p>关键是在错误引入到产品前，尽早发现。幸运的是，在我们的行业中，除了那些在喷气推进实验室（JPL）开发火箭导航软件的人来说，大多数错误并不要命，所以我们可以并且应该从错误中学习，一笑了之然后向前看。</p>\n<h3>2. 你和你的代码是两回事</h3>\n<p>切记，审查代码是为了找出问题，问题当然会被发现。当发现问题时，别有情绪，别往心里去。</p>\n<h3>3. 天外有天，人外有人</h3>\n<p>三人行必有我师焉。寻求并且接受其他人的意见，特别是当你认为不必要的时候。</p>\n<h3>4. 不要盲目地重写代码</h3>\n<p>修改代码和重写代码，两者有明确的界限。搞清楚区别，通过代码审查，改变代码风格，而不是做一个孤独的执行者。</p>\n<h3>5. 以尊重、敬意、耐心对待非技术人员</h3>\n<p>经常和程序员打交道的非技术人员普遍认为程序员充其量不过是一群自负的人，还是爱哭的娇气包。不要用生气和不耐烦强化这种偏见。</p>\n<h3>6. 惟有改变方永恒</h3>\n<p>以开放的态度对待改变并用微笑接受改变。将每一次需求、平台、工具的改变看作一个新挑战，而不是一些要反对的麻烦。</p>\n<h3>7. 真正且唯一的权威来自知识，不是地位</h3>\n<p>知识带来权威，权威带来尊敬。所以如果想在无我的环境里获得尊敬，那么请增长知识。</p>\n<h3>8. 为信仰战斗，但也要优雅地接受失败</h3>\n<p>要清楚，有时候你的想法会被否定。即使结果证明你是对的，不要报复，或者最多说几次‘我早就告诉过你’，不要让你过去的想法成为殉道者或者战斗口号。</p>\n<h3>9. 不要做个死宅</h3>\n<p>不要成为一直在小黑屋里编程，只在买可乐时出现的人。这样的人不与人接触，不被重视，不受控制并且不能融入开放合作的环境。</p>\n<h3>10. 对事不对人</h3>\n<p>要批评的是代码，不是写代码的人。尽可能让评论正面，并且只关注于提升代码。评论只涉及内部标准、编程规范、提升性能等等方面。</p>\n<p> </p>\n<p>软件的人性标准是永不过时的，《<a href=\"https://www.amazon.cn/gp/product/B00Z7D9GYG/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00Z7D9GYG&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The Psychology of Computer Programming | 程序开发心理学</a>》英文版早在 1971 年出版了，正好是我出生后第二年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111796\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111796votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111796\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/tecla\">tecla</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/tecla\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/e7e39d569b983a82c96dbebcc426da0f.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢逻辑，虽然不是很精通，喜欢英语，虽然不是都能完全理解。不是聪明人，但是希望能成为快乐的奋斗人。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/tecla\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/tecla/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/tecla/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"QQ：1942295950\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：ting-lyu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/xiangshang\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('这10本由浅入深的好书，或让你成为机器学习领域的专家', '2017-07-12', 'http://blog.jobbole.com/111360/', 'c5d7e56a1de2cc88a5d5fb385d6ada98', 'http://wx2.sinaimg.cn/mw690/63918611gy1fh85n8s3rfj207809174z.jpg', 'full/3a37dbff6f5ba32ea00f037e38047dade9a3d888.jpg', '1', '19', '3', 'IT技术,,机器学习', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://whatpixel.com/best-machine-learning-books/\">Alex Turner</a>   译文出处：<a target=\"_blank\" href=\"https://yq.aliyun.com/articles/66489\">云栖社区</a>   </div><p>机器学习是个跨领域的学科，而且在实际应用中有巨大作用，但是没有一本书能让你成为机器学习的专家。</p>\n<p>在这篇文章中，我挑选了 10 本书，这些书有不同的风格，主题也不尽相同，出版时间也不一样。因此，无论你是新手还是领域专家，一定能找到适合你的。</p>\n<p><strong>新手的最佳读物</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fh85n8s3rfj207809174z.jpg\" width=\"260\" height=\"325\"></p>\n<p>这本书绝对是初学者非常期待的入门书。这本书条理清晰，学习成本低，因此我把它列为新手的最佳读物。</p>\n<p>下面让我们深入讨论一些关于人工智能程序的话题。</p>\n<p><strong>人工智能编程范例</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fh85n94ywsj207808v74o.jpg\" width=\"260\" height=\"319\"></p>\n<p>如果您想接触最新的人工智能技术，那么 Peter Norvig 写的人工智能编程范例将非常适合。</p>\n<p>这被广泛认为是有史以来最好的编程书籍之一。实际的写作风格很容易遵循。它会引导你在学习的过程中自我发现。而且例子也帮助你用最清晰的方式写出高质量的 LISP 程序。</p>\n<p>请注意，在打开这本书之前，作者默认你应该有编程经验。这并不是说你要成为一个编程方面的专家，但如果你从来没有写代码(或者写的不太好)，那么你可能在学习的过程中遇到很多困难。</p>\n<p>这本书长达 900 多页，但它仍然是无可争议学习人工智能这一与机器学习非常相关的主题的最好的资源。</p>\n<p><strong>傻瓜机器学习</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fh85n9jkzvj207809174z.jpg\" width=\"260\" height=\"325\"></p>\n<p>以前，我一直是讨厌推荐“For dummies”系列的书籍，因为它们都太过简单直白。但是，由于这本书的作者都是经验丰富的数据科学家，我决定破一次例。</p>\n<p>即使是零基础，傻瓜机器学习这本书也能让读者快速体验到机器学习的魅力。尽管书中的例子是用 python 语言写的，但是其实你并不需要了解 python 的语法。</p>\n<p>在本书中，你将了解到机器学习的历史以及机器学习与人工智能的不同。作者为我们详尽地讲解了每一个知识点。</p>\n<p>在读本书之前，你只需要一些数学和逻辑方面的基本知识，而并不需要编程的经验。如果你在读这本书前从没接触过算法，可能你会有点痛苦，不过仍然可以做一些互补的研究。</p>\n<p><strong>机器学习：新的人工智能</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fh85na8976j20780a5weu.jpg\" width=\"260\" height=\"365\"></p>\n<p>这本书应该是本篇文章中推荐书目中最新的。为什么要把这本书列进来呢?因为这本书着力于用算法处理数据集并且帮助编程者从数据集中学习。</p>\n<p>作者 Ethem Alpaydin 是领域里知名的学者。他还出版了机器学习导论。 Ethem 有丰富的经验，并且他之前的作品也是拔尖的。</p>\n<p>Ethem 向我们描述了机器学习的演化过程，并且告诉我们如何在实际的应用中使用机器学习的算法。在读这本书之前，你需要有一些编程的经验。当然如果你对机器学习有浓厚的兴趣，这样也是可以的。</p>\n<p>由于它是这个书单中最新的一本书，可以确定的是这本书和当前科技行业紧密结合。</p>\n<p><strong>人工智能：一种现代的方法</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fh85nay702j207809vab2.jpg\" width=\"260\" height=\"355\"></p>\n<p>虽然人工智能和机器学习是不同的，但是它们有很多相通之处。编程人员可以从中学到很多。你应该学习如何找到解决机器学习项目中问题的方法。</p>\n<p>这本书是一个非常棒的导论，总共有 1100 多页，并涵盖了许多的技术。</p>\n<p>中高级编程人员可能会觉得这本书过于简单。这本书并不是为有经验者而写，而是一本新手的入门书籍。它是你学习人工智能和机器学习基础的一盘开胃菜。</p>\n<p><strong>机器学习：用算法让数据说话</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fh85nb6tu1j20780ab3z8.jpg\" width=\"260\" height=\"371\"></p>\n<p>Peter Flach 写的这本机器学习包含了很多机器学习的实际案例。我认为这本书是为中高级开发人员而写。他们可以用这本书巩固机器学习方面的基础知识，因为这本书比其它书更详细。</p>\n<p>用这本书，你将利用机器学习方法来生成，分析和预测统计模型。Peter 阐述了自定义垃圾邮件过滤器如何工作，并且解释了为何这种方法现在这么火。</p>\n<p>从 ROC 分析开始，后面的章节中会比之前深一些。</p>\n<p>在每个知识点处，这本书都配有图形、图表的说明。机器学习是一个很宽的领域，而 Peter 通过例子的方式，分解了其中主要的部分。</p>\n<p>如果你对大数据和机器学习感兴趣，那么我极力推荐这本书，但是这有一个前提，那就是你有一定的背景知识。</p>\n<p><strong>Python 机器学习</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fh85nbhysoj207808wjs0.jpg\" width=\"260\" height=\"320\"></p>\n<p>在我之前提到的书中，几乎没有限定语言的。而这本 Sebastian Raschka 的 450 多页的书将打破这一记录。</p>\n<p>对于想学习机器学习的 python 开发人员来说，这本是最好的导论。</p>\n<p>很多人选择 python 作为工具是因为 python 语法简单，功能强大，而且像 scikit-learn 这样的机器学习类库众多。</p>\n<p>这本书详细地讲解了 scikit-learn，并引导我们应用它来做数据分析。这本书的作者推崇在编写算法的同时进行可视化。因此，你不仅能学到如何编写算法，还能学会对数据进行可视化。</p>\n<p>总的来说，这本书偏重技术，但是也不是专门为 python 专家写的。如果你对 python 语言很熟悉，最好还了解 scikit-learn，那么这本书一定很适合你。</p>\n<p><strong>数据科学从零开始</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fh85nc13hbj207809jt99.jpg\" width=\"260\" height=\"343\"></p>\n<p>这是另一本基于 python 的作品。尽管这本书比大多数书籍简洁，但却对例子进行了详尽的描述。在数据科学这本书中，每一段代码前作者都附上了一段介绍。所以即使是新手也可以很快上手。</p>\n<p>尽管这样，我仍然要向中高级 Python 开发人员推荐这本书。你不必知道机器学习的的方法或者数据分析的过程就能得到你想要的(正如标题中所写的“从零开始”)。</p>\n<p>这本书的风格简洁而准确，深度上比 python 机器学习浅一些。如果你想深入研究机器学习，那么这两个都是不错的选择。</p>\n<p>这本书中的编码风格我非常喜欢。每一小片的代码都是基于之前的工作，而且作者都附上了详细的思路和过程。</p>\n<p><strong>搭建自己的神经网络</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fh85nchgx9j207809dq3e.jpg\" width=\"260\" height=\"337\"></p>\n<p>尽管在标题中没有明言，这本书构建神经网络的语言仍然是 python。Tariq Rashid 将神经网络作为机器学习过程中的基本组件，而这本书也是深入理解神经网络的最佳选择之一。</p>\n<p>这本书是杰出的，但价格却并不昂贵。读这本书之前，你需要有一定的 python 基础，这样读起来才会比较顺利。</p>\n<p>作者希望通过用鲜活的例子来帮读者建立对神经网络的理解。在读这本书前，你并不需要成为专家，但是你要有足够的决心来克服书中较难的章节。</p>\n<p>值得庆幸的是作者的写作风格温和且易懂，因此你在阅读过程中不会遇到太多阻碍。神经网络是非常难掌握的，而拥有这本书就足够了!</p>\n<p><strong>机器学习原理：预测数据分析</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fh85ncrqumj2078098gmh.jpg\" width=\"260\" height=\"332\"></p>\n<p>这本书的标题有点拗口，价格在所有书中也偏贵，但这本 MIT 出版社出版的书确实是一本非常棒的书。</p>\n<p>机器学习原理：预测数据分析向我们展示了基于关系和自定义算法的分析和数据选择过程。这包括能从其他相关资源中获取信息的更通用的信息学习。这本书还包含了复杂的基于概率的机器学习方法。</p>\n<p>你将学习到让机器学习算法按照你的指示进行数据分析的高级技能。这本书通过例子的方式引导读者，并且驱动读者考虑不同的方式分析数据。</p>\n<p>在读这本书之前，你需要足够的编程知识和矩阵知识。我想将这本书推荐给了解机器学习并想更进一步的数据科学家。</p>\n<p><strong>模式识别和机器学习</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fh85ncxettj207809smyo.jpg\" width=\"260\" height=\"352\"></p>\n<p>这本书也是为高级数据科学家和高级开发人员准备的。每一章节包含基于数据集中模式的概率和机器学习的话题。</p>\n<p>模式识别和机器学习是掌握模式识别的导论。这本书用基本的概念带你从宏观进入到鲜活的实例中。</p>\n<p>这本书的写作风格是没的挑的。作者倾向与重复的阐明一个观点。因此尽管这书的内容很难，这仍然是将知识灌进读者脑子的最佳方式。</p>\n<p>你需要有深厚的数学功底，甚至数据科学的知识也是非常必要的。这本书很难，但是简洁的书写风格和清晰的例子会让你对模式识别有更深的认识。</p>\n<p>这 10 本书是我精心挑选的，它们涵盖了很宽泛的领域。如果你想更好的理解机器学习或者解决项目中的问题，你需要根据你的实际情况选择最适合你的书，因为它们值得拥有。</p>\n<p>对于没有基础的新手来说，我会推荐《傻瓜机器学习》这本书。如果你想着手于 python，那么 python 机器学习是个很好的选择。</p>\n<p>这些书都是很棒的。我建议你先理解一门语言，这样就可以从一个真实场景中理解这些概念。</p>\n<p>很多书都非常专业，因此很难去广泛的推荐。但是读完本文后，一定会有你想要的。</p>\n<p>文章原标题《The Best Machine Learning Books To Go From Novice To Expert》，作者： Alex Turner，译者：爱小乖</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111360\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111360votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111360\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 19 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('程序员最核心的竞争力是什么？', '2017-07-12', 'http://blog.jobbole.com/111363/', 'cf637291f448054bd8f68acf77229cad', 'http://jbcdn2.b0.upaiyun.com/2017/04/cd529ebd5eb174b2847e9128628472ab.jpg', 'full/fbf77e2aa965d1b486dc656efd17cb1116cdc445.jpg', '6', '28', '4', '职场,,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://mp.weixin.qq.com/s/7xInAax-vTtnX0bgwZiUFg\">张砷镓</a>   </div><p>进行社招面试时，有一个问题几乎是必问的：</p>\n<blockquote><p>你为什么要离开上一家公司？</p></blockquote>\n<p>其实这个问题主要是想试探一下求职者的核心诉求，并借此预估一下他在本公司工作的稳定性。常见的答案也无非就是这么几种：对薪酬不满意、干得不爽，或者是想换个环境。</p>\n<p>然而，我遇到过好几个初次跳槽的求职者给出的答案是：<em>「在原来的公司学不到技术」</em>。</p>\n<p>一听到这个，我就不由得叹口气：今天这一小时又算是交代了，这人基本上没戏。因为根据我的经验，这句话如果由工作不满两年的人说出来，很大概率这是个不会学习不会感恩又特别爱抱怨的人。</p>\n<h3>程序员最核心的竞争力——「学习力」</h3>\n<p>如果有人问我：你在面试程序员时，最看中的是什么能力？那我的答案一定是：<strong>学习力</strong>。</p>\n<p>互联网时代的技术来得快，去得更快。就像Flash这样曾经雄霸天下多年的技术，都有被人人唾弃的一天。如果没有足够强的学习能力，就无法跟上变化，被淘汰只是迟早的事。想想看，你苦心钻研多年引以为傲的技术，一夜之间就没有用武之地了，难免会有一种「身体被掏空」的感觉。</p>\n<p>学习力强的程序员敢大胆地体验尝试新技术，他们的技术栈始终在保持不断地更新。他们能快速把握事物的本质，并判断出它能用来做什么，不能用来做什么。他们拥抱技术升级和革命，因为他们学习并掌握新技术的速度比其他人更快，所以他们永远不用担心失业。事实上，他们掌握的是<strong>「驾驶」和「学习驾驶」的技术，而不是「驾驶XX牌汽车」的技术。</strong></p>\n<p>而学习力差的程序员呢？为了继续停留在旧技术的舒适区，他们往往会抵制新技术的推广，甚至百般阻挠。因为那会使他们过去的经验统统无效，只能和后来者站在同一起跑线上。抱死一个框架好几年，脱离了框架啥都干不了的程序员实在太多了。事实上，<strong>这样的人不能驾驭技术，反而是被技术给奴役了。</strong></p>\n<p>同样是自行车，为什么山地车比公路车更普及更流行？除了皮实耐用价格低外，主要是因为它的通过性好，什么泥地沙地都不在话下，上下马路牙子跟玩一样。而公路车呢？只能老老实实地跑在平路上。</p>\n<h3>公司不是学校</h3>\n<p>面对这些因为「想学点技术」而换工作的求职者，评价他们「不思进取」貌似不太合适。但显然他们的思维模式还是被学校洗脑的那一套，没能真正地融入社会。也许他们认为，学习就是要由老师手把手带着，而自己之所以学不到技术，就是因为<em>没遇到一个好leader</em>，能替自己设计好成长路线，指出所有重难点，提供各种参考资料……</p>\n<p>在中国传统文化里，不管是匠人还是武师，收徒都要找毫无根基的幼童。这一方面是为了保持师父的绝对权威，方便贯彻落实教学；另一方面是为了尽量延长学徒期，以考察徒弟的品性。拜师之后，徒弟便跟随师父一起生活，经过数年的言传身教，这才得以出师。</p>\n<p><em>师父收徒的核心诉求，是「传承」自己的技艺和名声</em>，希望徒弟日后能做出一番成就来光耀师门。这就要求徒弟流动性低、忠诚度高、归属感强。与其说是收徒，还不如说是在挑儿子，所以有句俗话叫作「一日为师，终身为父」。</p>\n<p>然而公司是盈利性的商业组织，不是学校，更不是新手训练营。<strong>公司招聘员工的核心诉求，是生产出实实在在、对得起薪水的价值，而不是传承技艺。</strong>公司希望员工入职前就具备工作的能力，至少在经过短暂的培训和指导后就能独立开展工作，正所谓「能干就干，干不了走人」。</p>\n<p>一般情况下，为了使新人尽快进入工作状态，公司会安排一位老员工来做一段时间的导师。但<strong>导师只有为你解惑的义务，却没有教你技术的责任。</strong> 因为导师自己手里还有做不完的工作，带新人又没什么利益可图，凭什么为你提供私人教练级的服务？能有耐心听完你的问题，指点一下方向，就已经很不错了。</p>\n<p><strong>学习是自己的事，没有人能替你去做。</strong>这就跟吃饭一样，谁真的关心你吃没吃、饱没饱？就算你的亲人再怎么关心你，也不能替你去吃。我们都知道，人不吃饭肯定是要饿死的，那你为什么不去给自己找吃的，却在埋怨没有人给你嘴里喂食呢？</p>\n<h3>为什么你学不到技术？</h3>\n<p>很多人在学习之路上已经饱尝了痛苦的滋味，因此在离开学校之后。他们不到万不得已，是决然不会去学习的。你不妨回顾一下，从参加工作以来到现在，自己哪段时间里学习最认真，进步最明显？</p>\n<p>如果不出意外的话，应该就是你找到的第一份工作的试用期。因为<em>不想失去自己通过努力争取到的工作机会</em>，所以你不得不逼自己打起十二份精神来学习，结果居然以自己都无法想象的速度掌握了工作必备的知识和技能。</p>\n<p>然而，<em>大多数人在自己的能力满足当前工作的要求之后，就丧失了学习的动力。</em>下班之后要追剧，要玩游戏，要打球，要谈恋爱……为啥我要学习？不学又不会失业！学这个有啥用？谁知道用得上用不上？等要用的时候再学呗！</p>\n<p>其实，<strong> 学不到技术最核心的原因只有一个：动机不足。</strong>至于环境条件，只是影响学习效果的因素之一，但绝对不是最重要的因素。在一个恶劣的环境里选择放弃学习的人，不可能到了一个优越的环境里就会去主动学习，因为在他内心深处对学习是抗拒的。</p>\n<blockquote><p>难道说换上了Macbook Pro和4k显示器，坐在数千元的人体工学座椅上，下班后就会有兴趣看框架源码了吗？看电影、打游戏不是更舒服一些？</p></blockquote>\n<p>在我看来，<strong>学习力的源泉就是好奇心，也就是对新知识的渴求，以及对探索未知的冲动。</strong>我们的大脑是「用进废退」的，如果不定期给它输送新鲜的知识营养，它就会逐渐退化。有学习力的人一段时间不看书，不折腾点新玩意，大脑真的是会「饿」的。</p>\n<h3>程序员该怎么学习技术？</h3>\n<p>有的求职者觉得自己没学到技术，是因为<em>公司不给机会，或者缺乏条件</em>：</p>\n<blockquote><p>「上次的H5让小王做了，这次的微信小程序又给了小李……完全没我什么事啊！」<br>\n「公司最大一张表才10W数据，根本用不着分库分表啊！」<br>\n……</p></blockquote>\n<p><strong>学习技术最有效的方式是阅读、实践和交流。</strong>公司没给你安排这方面的工作，那你自己都做了些什么呢？八小时之外的时间都用在哪了？有没有读源码？有没有看原版书？有没有泡技术社区？有没有尝试最新流行的技术？有没有尝试把它们用在公司的项目上？有没有主动去接触行业里使用这些技术的团队和大牛？</p>\n<p><strong>「看文档」</strong>其实是最快的学习方法。对于自己工作中常用到的技术，抽时间把官方文档通读一遍（其实篇幅都不大），绝对收获满满。没事的时候多翻翻自己使用的框架/系统/平台的API，看看有哪些自己不知道或者没用过的功能，想想这个功能可以用来做什么，能不能解决现存的问题，或者优化当下的解决方案。</p>\n<blockquote><p>如果你是前端工程师，通读HTTP协议和ECMAScript标准，就能秒杀95%的同行，不开玩笑。</p></blockquote>\n<p><strong>「读源码」</strong>是深入学习开源技术的唯一途径。只有理解了某个功能在底层是如何实现的，你才能真正把握它更适合用来做什么，不能用来做什么。正如不明显汽车的构造和原理，我们也能把车开好。而如果多少知道一点，开起来就会更得心应手。当车出现问题时，也不至于完全束手无策，只能蹲在路边等待救援。</p>\n<blockquote><p>你一个框架用了N年了，却连一行源码都没读过？如果它是你女朋友，估计早该分手了。</p></blockquote>\n<p><strong>「折腾」</strong>是学习任何技术的必经之路。在有保护的环境下进行大量的试错，是最高效的学习方法。现在虚拟机技术已经那么成熟，VPS也很便宜，你为什么不分分钟弄一个，然后在上面花式作死呢？</p>\n<blockquote><p>听说过无数次 <strong>rm -rf /</strong> 的事故，可你居然一次都没试过？知道输出啥样子么？</p></blockquote>\n<p><strong>公司给你提供的最有价值的东西，就是实战的机会。</strong> 你所学习的技术，最终需要通过工作来变现。你有机会接触到真实的数据，了解真实的用户，观察真实系统是怎样运转的，积累真实的经验……</p>\n<p>然而，<strong>所谓的机会，只属于已经提前准备好的人。</strong> 不要等到工作都安排到你身上了再去学习。公司不是你的试验田，你也不该拿用户当小白鼠。公司不给你机会，那只说明你还没有准备好。</p>\n<h3>后话</h3>\n<blockquote><p>「吾生也有涯，而知也无涯 。以有涯随无涯，殆已！」*——《庄子·内篇·养生主第三》</p></blockquote>\n<p>技术世界就如同一片汪洋大海，细分领域真是多如牛毛。我们只是站在其中一个小岛上，<em>怎么确定自己该朝哪个方向进发呢？</em></p>\n<p>学习技术不外乎以下两个方向：</p>\n<p><strong>1、广度</strong>：整个使用链条由哪些环节构成？每个环节的作用是什么？都有哪些类似的可替代方案？它们之间有什么区别？各自优劣点是什么？……</p>\n<p><strong>2、深度</strong>：这个「技术 / 产品」的本质是什么？都能做什么？运作原理是什么？底层是如何实现的？可以做怎样的改进？……</p>\n<p>不管你在做什么工作，都应该<em>先把自己每天都要用的核心技术做到一定深度，再去拓展广度。</em> 「什么都知道一点，但都不甚了解」是最可怕的，它会让你误以为自己已经很NB了。</p>\n<p><strong>学习，是一辈子的事。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111363\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111363votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111363\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 28 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('使用 Go 语言来理解 Tensorflow', '2017-07-12', 'http://blog.jobbole.com/111491/', 'd30f567903f1e7312bf578c3ca0c3935', 'http://jbcdn2.b0.upaiyun.com/2017/03/86a72531c8845e07f09b2d42649f2253.jpg', 'full/5c3e802fa7c46fa53f8411355279d527314c20be.jpg', '0', '2', '1', '开发,Go,TensorFlow', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://pgaleone.eu/tensorflow/go/2017/05/29/understanding-tensorflow-using-go/\">P. Galeone</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32467\">雁惊寒</a>   </div><p><em>译者注：本文通过一个简单的Go绑定实例，让读者一步一步地学习到Tensorflow有关ID、作用域、类型等方面的知识。以下是译文。</em></p>\n<p>Tensorflow并不是机器学习方面专用的库，而是一个使用图来表示计算的通用计算库。它的核心是用C++实现的，并且还有不同语言的绑定。Go语言绑定是一个非常有用的工具，它与Python绑定不同，用户不仅可以通过Go语言使用Tensorflow，还可以了解Tensorflow的底层实现。</p>\n<p><strong>绑定</strong></p>\n<p>Tensorflow的开发者正式发布了：</p>\n<ul>\n<li>C++源代码：真正的Tensorflow核心，实现了具体的高级和低级操作。</li>\n<li>Python绑定和Python库：这个绑定是由C++实现自动生成的，这样我们可以使用Python来调用C++函数。此外，这个库将调用融合到了绑定中，以便定义更高级别的API。</li>\n<li>Java绑定。</li>\n<li>Go绑定。</li>\n</ul>\n<p>作为一个Go开发者而不是一个Java爱好者，我开始关注Go绑定，以便了解他们创建了什么样的任务。</p>\n<p><strong>Go绑定</strong></p>\n<div><img class=\"aligncenter\" src=\"http://dl2.iteye.com/upload/attachment/0125/3210/5d4bd576-2c19-330c-aee5-8eb9da01eb3e.png\"></div>\n<div style=\"text-align: center\">地鼠与Tensorflow的徽标</div>\n<p>首先要注意的是，Go API缺少对Variable的支持：该API旨在使用已经训练过的模型，而不是从头开始训练模型。安装Tensorflow for Go的时候已经明确说明了：</p>\n<blockquote><p>TensorFlow提供了可用于Go程序的API。这些API特别适合于加载用Python创建并需要在Go程序中执行的模型。</p></blockquote>\n<p>如果我们对培训ML模型不感兴趣，万岁！相反，如果你对培训模型感兴趣，那就有一个建议：</p>\n<blockquote><p>作为一个真正的Go开发者，保持简单！使用Python定义并训练模型；你可以随时使用Go来加载并使用训练过的模型！</p></blockquote>\n<p>简而言之，go绑定可用于<strong>导入和定义</strong>常量图；在这种情况下，常量指的是没有经过训练的过程，因此没有可训练的变量。</p>\n<p>现在，开始用Go来深入学习Tensorflow吧：让我们来创建第一个应用程序。</p>\n<p>在下文中，我假设读者已经准备好Go环境，并按照<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/README.md\" target=\"_blank\">README</a>中的说明编译并安装了Tensorflow绑定。</p>\n<p><strong>理解Tensorflow结构</strong></p>\n<p>让我们来重复一下什么是Tensorflow：</p>\n<blockquote><p>TensorFlow™是一款使用数据流图进行数值计算的开源软件库。图中的节点表示数学运算，而图的边表示在节点之间传递的多维数据数组（张量）。</p></blockquote>\n<p>我们可以把Tensorflow视为一种描述性语言，这有点像SQL，你可以在其中描述你想要的内容，并让底层引擎（数据库）解析你的查询、检查句法和语义错误、将其转换为内部表示形式、进行优化并计算出结果：所有这一切都会给你正确的结果。</p>\n<p>因此，当我们使用任何一个API时，我们真正做的是描述一个图：当我们把图放到Session中并显式地在Session中运行图时，图的计算就开始了。</p>\n<p>知道了这一点之后，让我们试着来定义一个计算图并在一个Session中进行计算吧。<a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go\" target=\"_blank\">API文档</a>为我们提供了tensorflow（简写为 tf）和op包中所有方法的列表。</p>\n<p>我们可以看到，这两个包包含了我们需要定义和计算图形的所有内容。</p>\n<p>前者包含了构建一个基本的“空”结构（就像Graph本身）的功能，后者是包含由C++实现自动生成绑定的最重要的包。</p>\n<p>然而，假设我们要计算A与x的矩阵乘法，其中</p>\n<div><img class=\"aligncenter\" src=\"http://dl2.iteye.com/upload/attachment/0125/3212/b2aca1f7-5bfc-3c34-a4a3-6e1e640db759.png\"></div>\n<p>我假设读者已经熟悉了tensorflow图定义的基本思想，并且知道占位符是什么以及它们如何工作。下面的代码是对Tensorflow Python绑定的第一次尝试。我们来调用这个文件attempt1.go</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae38950535137\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage main  \r\n  \r\nimport (  \r\n    \"fmt\"  \r\n    tf \"github.com/tensorflow/tensorflow/tensorflow/go\"  \r\n    \"github.com/tensorflow/tensorflow/tensorflow/go/op\"  \r\n)  \r\n  \r\nfunc main() {  \r\n    // 这里，我们打算要: 创建图  \r\n  \r\n    // 我们要定义两个占位符用于在运行的时候传入  \r\n    // 第一个占位符 A 将是一个 [2, 2] 的整数张量  \r\n    // 第二个占位符 x 将是一个 [2, 1] 的整数张量  \r\n  \r\n    // 然后，我们要计算 Y = Ax  \r\n  \r\n    // 创建图的第一个节点： 一个空的节点，位于图的根  \r\n    root := op.NewScope()  \r\n  \r\n    // 定义两个占位符  \r\n    A := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 2)))  \r\n    x := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 1)))  \r\n  \r\n    // 定义接收A和x作为输入参数的操作节点  \r\n    product := op.MatMul(root, A, x)  \r\n  \r\n    // 每次我们把一个`Scope`穿给操作符的时候，把操作放在作用域的下面。  \r\n    // 这样，我们有了一个空的作用域（由NewScope创建）：空的作用域是图的根，因此可以用“/”来表示。  \r\n  \r\n    // 现在，我们让tensorflow按照我们的定义来创建图。  \r\n    // 把作用域和OP结合起来，创建具体的图。  \r\n  \r\n    graph, err := root.Finalize()  \r\n    if err != nil {  \r\n        // 这里没办法处理这个错误：  \r\n        // 如果我们错误的定义了图，我们必须手工修改这个定义。  \r\n  \r\n        // 这就跟SQL查询一样：如果查询语句在语法上有问题，我们只能重新写  \r\n        panic(err.Error())  \r\n    }  \r\n  \r\n    // 如果在这里，图在语法上是正确的。  \r\n    // 我们就可以把它放到一个Session里，并执行。  \r\n  \r\n    var sess *tf.Session  \r\n    sess, err = tf.NewSession(graph, &amp;tf.SessionOptions{})  \r\n    if err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n  \r\n    // 要使用占位符，我们必须创建一个Tensors，这个Tensors包含要反馈到网络的数值  \r\n    var matrix, column *tf.Tensor  \r\n  \r\n    // A = [ [1, 2], [-1, -2] ]  \r\n    if matrix, err = tf.NewTensor([2][2]int64{ {1, 2}, {-1, -2} }); err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n    // x = [ [10], [100] ]  \r\n    if column, err = tf.NewTensor([2][1]int64{ {10}, {100} }); err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n  \r\n    var results []*tf.Tensor  \r\n    if results, err = sess.Run(map[tf.Output]*tf.Tensor{  \r\n        A: matrix,  \r\n        x: column,  \r\n    }, []tf.Output{product}, nil); err != nil {  \r\n        panic(err.Error())  \r\n    }  \r\n    for _, result := range results {  \r\n        fmt.Println(result.Value().([][]int64))  \r\n    }  \r\n}</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae38950535137-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae38950535137-74\">74</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-2\"><span class=\"crayon-e\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"fmt\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">tf</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"github.com/tensorflow/tensorflow/tensorflow/go\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"github.com/tensorflow/tensorflow/tensorflow/go/op\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-8\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-9\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 这里，我们打算要: 创建图  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-11\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我们要定义两个占位符用于在运行的时候传入  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 第一个占位符 A 将是一个 [2, 2] 的整数张量  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 第二个占位符 x 将是一个 [2, 1] 的整数张量  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-15\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 然后，我们要计算 Y = Ax  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-17\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 创建图的第一个节点： 一个空的节点，位于图的根  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewScope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-20\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 定义两个占位符  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-24\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 定义接收A和x作为输入参数的操作节点  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">product</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MatMul</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-27\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 每次我们把一个`Scope`穿给操作符的时候，把操作放在作用域的下面。  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 这样，我们有了一个空的作用域（由NewScope创建）：空的作用域是图的根，因此可以用“/”来表示。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-30\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 现在，我们让tensorflow按照我们的定义来创建图。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 把作用域和OP结合起来，创建具体的图。  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-33\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Finalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 这里没办法处理这个错误：  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果我们错误的定义了图，我们必须手工修改这个定义。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-38\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 这就跟SQL查询一样：如果查询语句在语法上有问题，我们只能重新写  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-42\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 如果在这里，图在语法上是正确的。  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我们就可以把它放到一个Session里，并执行。  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-45\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sess *</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-47\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SessionOptions</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-51\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 要使用占位符，我们必须创建一个Tensors，这个Tensors包含要反馈到网络的数值  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">column *</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Tensor</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-54\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// A = [ [1, 2], [-1, -2] ]  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewTensor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e\">int64</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// x = [ [10], [100] ]  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">column</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewTensor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e\">int64</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-63\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Tensor  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-65\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Output</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Tensor</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">A</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">column</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Output</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">product</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-v\">int64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae38950535137-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae38950535137-74\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0104 seconds] -->\r\n<p>代码注释的很详细，希望读者能阅读每一行注释。</p>\n<p>现在，Tensorflow-Python用户期望该代码进行编译并正常工作。我们来看看它是否正确：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae47874365232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngo run attempt1.go</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae47874365232-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae47874365232-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">attempt1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这是他看到的结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae4c513574211\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npanic: failed to add operation \"Placeholder\": Duplicate node name in graph: \'Placeholder\'</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae4c513574211-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae4c513574211-1\"><span class=\"crayon-v\">panic</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">failed </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add </span><span class=\"crayon-i\">operation</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Placeholder\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Duplicate </span><span class=\"crayon-e\">node </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'Placeholder\'</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>等等，这里发生了什么？ 显然，存在两个名称都为“Placeholder”的操作。</p>\n<p><strong>第一节课： 节点ID</strong></p>\n<p>每当我们调用一个方法来定义一个操作时，Python API都会生成不同的节点，无论是否已经被调用过。下面的代码返回3。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae4f865510537\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport tensorflow as tf  \r\na = tf.placeholder(tf.int32, shape=())  \r\nb = tf.placeholder(tf.int32, shape=())  \r\nadd = tf.add(a,b)  \r\nsess = tf.InteractiveSession()  \r\nprint(sess.run(add, feed_dict={a: 1,b: 2}))</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae4f865510537-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae4f865510537-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae4f865510537-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae4f865510537-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae4f865510537-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae4f865510537-6\">6</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae4f865510537-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">tensorflow </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tf</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae4f865510537-2\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae4f865510537-3\"><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae4f865510537-4\"><span class=\"crayon-v\">add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae4f865510537-5\"><span class=\"crayon-v\">sess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">InteractiveSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae4f865510537-6\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sess</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">add</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feed_dict</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>我们可以通过打印占位符的名称来验证此程序是否创建了两个不同的节点：print(a.name，b.name)生成Placeholder:0 Placeholder_1:0，因此，b占位符是Placeholder_1:0，而a占位符是Placeholder:0。</p>\n<p>在Go中，相反，之前的程序会执行失败，因为A和x都命名为Placeholder。我们可以得出这样的结论：</p>\n<p><strong>Go API不会在每次调用函数来定义操作的时候自动生成新的名字：操作的名字是固定的，我们无法修改。</strong></p>\n<p><strong>提问时间：</strong></p>\n<ul>\n<li>关于Tensorflow架构，我们学到了哪些东西？图中的每个节点都必须具有唯一的名称。每个节点都用名称来标识。</li>\n<li>节点的名称与用名字来定义的操作相同吗？是的，但还有更好的答案，不完全是，节点的名称只是操作的一部分。</li>\n</ul>\n<p>为了详细说明第二个答案，我们来解决节点名重复的问题。</p>\n<p><strong>第二节课： 作用域</strong></p>\n<p>正如我们刚刚看到的那样，每定义一个操作时，Python API都会自动创建一个新的名称。在底层，Python API调用类Scope的C++方法WithOpName。以下是方法的文档及其签名，保存在<a href=\"https://github.com/tensorflow/tensorflow/blob/a5b1fb8e56ceda0ee2794ee05f5a7642157875c5/tensorflow/cc/framework/scope.h\" target=\"_blank\">scope.h</a>中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae54055064625\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/// Return a new scope. All ops created within the returned scope will have\r\n/// names of the form &amp;lt;name&amp;gt;/&amp;lt;op_name&amp;gt;[_&amp;lt;suffix].\r\nScope WithOpName(const string&amp;amp; op_name) const;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae54055064625-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae54055064625-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae54055064625-3\">3</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae54055064625-1\"><span class=\"crayon-c\">/// Return a new scope. All ops created within the returned scope will have</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae54055064625-2\"><span class=\"crayon-c\">/// names of the form &amp;lt;name&amp;gt;/&amp;lt;op_name&amp;gt;[_&amp;lt;suffix].</span></div><div class=\"crayon-line\" id=\"crayon-596562760ae54055064625-3\"><span class=\"crayon-e\">Scope </span><span class=\"crayon-e\">WithOpName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">amp</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们注意到，这个用于命名节点的方法返回了一个Scope，因此，节点名实际上是一个Scope。Scope是从根 /（空的图）到op_name的<strong>完整路径</strong>。</p>\n<p>当我们尝试添加一个具有与/到op_name相同路径的节点时，WithOpName方法会添加一个后缀_&lt;suffix&gt;（其中&lt;suffix&gt;是一个计数器），因此它将成为同一范围内的重复的节点。</p>\n<p>知道了这一点之后，为了解决重复节点名的问题，我们期望在Scope类型中找到WithOpName方法。可悲的是，这种方法并不存在。</p>\n<p>相反，查看<a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go/op#Scope\" target=\"_blank\">Scope类型的文档</a>，我们可以看到唯一的一个方法：SubScope，它返回一个新的Scope。</p>\n<p>文档里是这么说的：</p>\n<blockquote><p>SubScope返回一个新的Scope，这将导致添加到图中的所有操作都将以“namespace”为命名空间。如果命名空间与作用域内现有的命名空间冲突，则会添加一个后缀。</p></blockquote>\n<p>使用后缀的冲突管理与C++的WithOpName不同：WithOpName是在操作名之后添加后缀，但还是在同一作用域内（因此占位符变为了Placeholder_1），而Go的SubScope是在作用域名称后添加后缀。</p>\n<p>这种差异会产生完全不同的图，但它们在计算上是等效的。</p>\n<p>我们来改变占位符的定义，以此来定义两个不同的节点，此外，我们来打印一下作用域的名称。</p>\n<p>让我们创建文件attempt2.go，把这几行从：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae58296279974\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nA := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 2)))  \r\nx := op.Placeholder(root, tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 1)))</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae58296279974-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae58296279974-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae58296279974-1\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae58296279974-2\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>改成：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae5c698343165\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// define 2 subscopes of the root subscopes, called \"input\". In this  \r\n// way we expect to have a input/ and a input_1/ scope under the root scope  \r\nA := op.Placeholder(root.SubScope(\"input\"), tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 2)))  \r\nx := op.Placeholder(root.SubScope(\"input\"), tf.Int64, op.PlaceholderShape(tf.MakeShape(2, 1)))  \r\nfmt.Println(A.Op.Name(), x.Op.Name())</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae5c698343165-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae5c698343165-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae5c698343165-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae5c698343165-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae5c698343165-5\">5</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae5c698343165-1\"><span class=\"crayon-c\">// define 2 subscopes of the root subscopes, called \"input\". In this  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae5c698343165-2\"><span class=\"crayon-c\">// way we expect to have a input/ and a input_1/ scope under the root scope  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae5c698343165-3\"><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SubScope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"input\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae5c698343165-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Placeholder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SubScope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"input\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PlaceholderShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MakeShape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae5c698343165-5\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Op</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>编译并运行：go run attempt2.go，输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae5f068470524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninput/Placeholder input_1/Placeholder</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae5f068470524-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae5f068470524-1\"><span class=\"crayon-v\">input</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Placeholder </span><span class=\"crayon-v\">input_1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Placeholder</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><strong>提问时间：</strong></p>\n<p>关于Tensorflow的架构，我们学到了什么？节点完全是由被定义的作用域来标识的。作用域是我们从图的根到达节点的路径。有两种定义节点的方法：在不同的作用域（Go语言）中定义操作或更改操作名称。</p>\n<p>我们解决了重复节点名称的问题，但另一个问题显示在我们的终端上。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae63804330457\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npanic: failed to add operation \"MatMul\": Value for attr \'T\' of int64 is not in the list of allowed values: half, float, double, int32, complex64, complex128</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae63804330457-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae63804330457-1\"><span class=\"crayon-v\">panic</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">failed </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add </span><span class=\"crayon-i\">operation</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MatMul\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Value </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">attr</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'T\'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">int64 </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">allowed </span><span class=\"crayon-v\">values</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">half</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">complex64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">complex128</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>为什么MatMul节点会出现错误？我们只是想增加两个tf.int64矩阵！从这段错误提示来看，int64是MatMul唯一不接受的类型。</p>\n<blockquote><p>int64类型的attr ‘T’的值不在允许的值列表中：half，float，double，int32，complex64，complex128</p></blockquote>\n<p>这个列表是什么？为什么我们可以做两个int32类型矩阵的乘法，而不是int64？</p>\n<p>我们来解决这个问题，了解为什么会出现这种情况。</p>\n<p><strong>第三节课：Tensorflow的类型系统</strong></p>\n<p>我们来看一下<a href=\"https://github.com/tensorflow/tensorflow/blob/r1.2/tensorflow/core/ops/math_ops.cc#L1048\" target=\"_blank\">源代码</a>，寻找MatMul操作的C++声明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae66990386569\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nREGISTER_OP(\"MatMul\")  \r\n    .Input(\"a: T\")  \r\n    .Input(\"b: T\")  \r\n    .Output(\"product: T\")  \r\n    .Attr(\"transpose_a: bool = false\")  \r\n    .Attr(\"transpose_b: bool = false\")  \r\n    .Attr(\"T: {half, float, double, int32, complex64, complex128}\")  \r\n    .SetShapeFn(shape_inference::MatMulShape)  \r\n    .Doc(R\"doc(  \r\nMultiply the matrix \"a\" by the matrix \"b\".  \r\nThe inputs must be two-dimensional matrices and the inner dimension of  \r\n\"a\" (after being transposed if transpose_a is true) must match the  \r\nouter dimension of \"b\" (after being transposed if transposed_b is  \r\ntrue).  \r\n*Note*: The default kernel implementation for MatMul on GPUs uses  \r\ncublas.  \r\ntranspose_a: If true, \"a\" is transposed before multiplication.  \r\ntranspose_b: If true, \"b\" is transposed before multiplication.  \r\n)doc\");</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae66990386569-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596562760ae66990386569-19\">19</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-1\"><span class=\"crayon-e\">REGISTER_OP</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"MatMul\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"a: T\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"b: T\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Output</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"product: T\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"transpose_a: bool = false\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"transpose_b: bool = false\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"T: {half, float, double, int32, complex64, complex128}\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetShapeFn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">shape_inference</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">MatMulShape</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Doc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">R</span><span class=\"crayon-s\">\"doc(  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-10\"><span class=\"crayon-s\">Multiply the matrix \"</span><span class=\"crayon-i\">a</span><span class=\"crayon-s\">\" by the matrix \"</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\".  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-11\"><span class=\"crayon-s\">The inputs must be two-dimensional matrices and the inner dimension of  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-12\"><span class=\"crayon-s\">\"</span><span class=\"crayon-i\">a</span><span class=\"crayon-s\">\" (after being transposed if transpose_a is true) must match the  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-13\"><span class=\"crayon-s\">outer dimension of \"</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\" (after being transposed if transposed_b is  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-14\"><span class=\"crayon-s\">true).  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-15\"><span class=\"crayon-s\">*Note*: The default kernel implementation for MatMul on GPUs uses  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-16\"><span class=\"crayon-s\">cublas.  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-17\"><span class=\"crayon-s\">transpose_a: If true, \"</span><span class=\"crayon-i\">a</span><span class=\"crayon-s\">\" is transposed before multiplication.  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae66990386569-18\"><span class=\"crayon-s\">transpose_b: If true, \"</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">\" is transposed before multiplication.  </span></div><div class=\"crayon-line\" id=\"crayon-596562760ae66990386569-19\"><span class=\"crayon-s\">)doc\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>该行定义了MatMul操作的接口：特别注意到代码里使用了REGISTER_OP宏来声明了op的：</p>\n<ul>\n<li>名称：MatMul</li>\n<li>参数：a，b</li>\n<li>属性（可选参数）：transpose_a，transpose_b</li>\n<li>模板T支持的类型：half，float，double，int32，complex64，complex128</li>\n<li>输出形状：自动推断</li>\n<li>说明文档</li>\n</ul>\n<p>这个宏调用不包含任何C++代码，但它告诉我们，在定义一个操作时，尽管它使用了模板，但是我们必须为指定的类型T（或属性）指定一个类型列表中的类型。实际上，属性.Attr(“T: {half, float, double, int32, complex64, complex128}”)是将类型T约束为该列表的一个值。</p>\n<p>我们可以从教程中阅读到，即使在使用模板T时，我们也必须对每个支持的重载显式地注册内核。内核是以CUDA方式对C/C++函数进行的引用，这些函数将会并行执行。</p>\n<p>因此，MatMul的作者决定仅支持上面列出的类型，而不支持int64。有两个可能的原因：</p>\n<ul>\n<li>疏忽了：这很有可能，因为Tensorflow的作者是人类！</li>\n<li>对尚未完全支持int64操作的设备兼容，因此内核的这种具体实现不足以在每个支持的硬件上运行。</li>\n</ul>\n<p>回到刚才的错误提示：修改方法是显而易见的。我们必须将参数以支持的类型传递给MatMul。</p>\n<p>我们来创建attempt3.go，把所有引用int64的行改为int32。</p>\n<p>有一点需要注意：Go绑定有自己的一组类型，与Go的类型的一一对应。当我们将值输入到图中时，我们必须关注映射关系。从图形中获取值时，必须做同样的事情。</p>\n<p>执行go run attempt3.go。结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562760ae6b277759829\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninput/Placeholder input_1/Placeholder  \r\n[[210] [-210]]</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562760ae6b277759829-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562760ae6b277759829-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562760ae6b277759829-1\"><span class=\"crayon-v\">input</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Placeholder </span><span class=\"crayon-v\">input_1</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Placeholder</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562760ae6b277759829-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">210</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">210</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>万岁！</p>\n<p><strong>提问时间</strong></p>\n<p>关于Tensorflow的架构，我们学到了什么？每个操作都与自己的一组内核相关联。被视为描述性语言的Tensorflow是一种强大的类型语言。它不仅要遵守C++类型规则，而且还要在op的注册阶段只实现某些指定类型的能力。</p>\n<p><strong>结论</strong></p>\n<p>使用Go来定义并执行一个图，使我们有机会更好地了解Tensorflow的底层结构。使用试错法，我们解决了这个简单的问题，我们一步一步地学到了有关图、节点和类型系统这些新东西。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111491\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111491votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111491\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('自学的程序员如何找到好工作？', '2017-07-12', 'http://blog.jobbole.com/111497/', 'd8f9f8f08d6737cb4a3e4987ebbc04cb', 'http://wx1.sinaimg.cn/large/7cc829d3gy1fgqaiwbj8uj20nj0d3757.jpg', 'full/47088ef57f09c838c2a3bc97ec1b49801c291a32.jpg', '7', '17', '6', '开发,职场,,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://brianknapp.me/how-do-self-taught-developers-actually-get-jobs/\">Brian Knapp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：2016 年有位年轻的程序员在 Quora 上提问求助：</p>\n<blockquote><p>我今年 17 岁，从 14 岁开始编程。我主要关注 Java 语言，并在 AP 计算机科学这门课上拿了 5 分。我相当精通 Java（比如语法、主要类、GUI/JFrame 等），HTML5 和 CSS3 也不错。我感觉自己缺乏很多有用的技能，来帮助我在人才市场上推销自己（比如数据库的工作原理，以及我应该使用哪些工具），我很好奇其他人是如何学习这些东西的。我打算去大学拿一个软件开发的学位，但我开始感到有点沮丧，觉得读大学的目的就是为了工作。现在有哪些我应该上的课程，或者应该做的事情吗？</p></blockquote>\n<p><img id=\"pic\" class=\"\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fgqaiwbj8uj20nj0d3757.jpg\" width=\"620\" height=\"345\"></p>\n<h3>下面是 Brain Knapp 的回答分享︰</h3>\n<p>我认为你的看法错了。你觉得你需要上课，让别人来教你，告诉你答案。从根本上讲，自学的程序员能够做不一样的事情。</p>\n<p>自学的程序员和自学的吉他手有很多共同点。我不知道你是否玩过吉他，所以我将向你解释如何自学吉他。</p>\n<p>首先，这一切的开始是由于某人与某个吉他手产生了共鸣。大多数突然想要自学吉他的人，是想要成为另一个吉他手。之后，他们下定决心——“我也可以成为一个吉他手 ”，于是去了当地的乐器店，买了一把二手吉他（因为二手吉他更便宜，但也很酷）。</p>\n<p>接下来可能会有两种情况，要不买一本“吉他入门”或类似的书籍开始自学，要不打开 YouTube，开始学习如何弹奏自己喜爱的歌。那些尝试学习弹奏喜欢的歌的自学者，往往学得更好。</p>\n<p>当年轻的吉他手主动地学习某首歌时，他们往往需要观看视频、打印曲谱、练习和弦等等。然后，根据拿到的视频和曲谱，他们会坐下来尝试重新演绎歌曲。</p>\n<p>经过数小时的练习，不断重复和弦、独奏、节拍等，他们将能够以自己的形式表演那首歌。它不再是原来那首歌，但也够酷。</p>\n<p>然后，他们会拿起另一首歌，重复这个过程。一路走来，他们不断学习节拍、技术以及其他的东西，甚至都没有意识到学习的内容。在知道专业名词和理论前，他们已经懂得如何操作。</p>\n<p><span style=\"color: #000000\">最终，弹吉他变成了一种“直觉”，学习一首新歌也变得习以为常且不再痛苦。吉他的“语言”变得像你我说话那样容易。</span></p>\n<p>这一切的发生，背后是数千小时的艰苦练习。即使每天只练习一小时，也需要耗费数年。</p>\n<p><strong>那么，这和自学的程序员有什么关系呢？</strong></p>\n<p><span style=\"color: #000000\">事实上，真正成就自学的程序员的，就是他们会自己创建东西，很多东西。</span>要成为一个具有卓越技能的出色程序员，你必须创建东西，写代码。</p>\n<p>上课学习理论知识固然是好的，但很多教授不能跳出条条框框的束缚，以自己的方式编程。就算他们努力尝试，也做不出别人愿意用的应用程序。</p>\n<p>这并不是说他们不了解教授的知识，而是说，作为一名教授，他们掌握的技能是研究和理论性理解，而不是写代码和为客户提供价值。</p>\n<p><strong>你看到区别了吗？</strong></p>\n<p>我合作过的最好的程序员，他们的工作方式就是做东西，做很多东西，并且几乎一直这样。</p>\n<p>例如，现在几乎每个人都使用 WordPress。在 WordPress 出现很久之前，我就用 PHP 和 MySQL 创建了 3 到 5 个不同的内容管理系统。我写过游戏、移动应用程序、框架，还有 SAAS 应用程序。</p>\n<p>没人付钱让我做这些事情。我做这些事纯粹是出于好玩、学习或好奇的目的。</p>\n<p>我已经好几年都没有上过课了，即使上了，我也不觉得这会对我的事业有任何帮助。然而，如果我决定坐下来，从头开始创建我自己的计算机语言或操作系统，我打赌我一定能在过程中学到很多有趣的东西。</p>\n<p>是的，我可以带着那些想法上课，但在创建东西，犯下错误，以及真正“体会到”这一切的经历中，相比读一本书或听一次讲座，我能收获更多。</p>\n<p>因此，我给你的建议（如果你做到了，相比没有做的那些人而言，会带给你巨大的优势），就是：</p>\n<p><strong><span style=\"color: #ff0000\">解决一个你想解决的问题</span>。</strong>创建一个用于某件事的软件，解决一些你本人或他人想要通过软件解决的问题。每天为这个软件写代码，晚上写，周末也写，每天都写。即使你每天只花了 15 分钟写代码，也没关系。</p>\n<p>最终，你将得到一个能用的软件，这很不错。</p>\n<p><span style=\"color: #ff0000\"><strong>然后，你再重复这一过程。做一个其他的东西。不断地做。花费大量的时间，通过创建更多的东西来提升你的技能。</strong></span></p>\n<p>做东西的同时，注意在你的网站上保存工作，并将其放在一个作品集中。每次你结束了一个项目，就将它上传到 Hacker News、Reddit 或其他什么网站，并发条关于它的博文。</p>\n<p>你现在仅仅 17 岁，当你 20 岁的时候，你已经轻松地将两千多小时用于锻炼技能，你的个人作品集中也有了大概十到二十多个软件，你学习到的经验是那些仅仅上课的人无法比拟的。</p>\n<p>更重要的是，你已经清楚地告诉别人，你能够独立地写代码，解决问题并给世界带来一些新东西。这是最难能可贵的一点，也是公司在不断追求的一点。</p>\n<p><span style=\"color: #ff0000\"><strong>一旦你找到了工作，请继续在业余时间创建东西，并提升你的工作技能</strong></span>。你的提升速度将比你的同事更快，因为他们在下班回家后看电视，而不是学习、成长或创建东西。他们拿到了薪水就回家享受去了。</p>\n<p>你做的越多，你学的也越多；你学的越多，你的价值就越高；你的价值越高，你就越容易找到工作，你的工资也就更高，这是一个良性循环。</p>\n<p>所以，去做些东西出来。现在就开始写代码吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111497\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111497votetotal\">6</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111497\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 17 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('程序员偷偷自动化，每周才工作几小时却拿全薪，这样道德么？', '2017-07-12', 'http://blog.jobbole.com/111742/', 'da181fa9746cff2a3a3ca3f1b082c055', 'http://ww2.sinaimg.cn/mw690/63918611gw1f5idukigfrj20fw07yt9o.jpg', 'full/55b1132af682daa4944e35728414d9d865d4670f.jpg', '7', '4', '5', '职场,,程序员,自动化', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.sciencealert.com/programmers-are-secretly-automating-their-jobs-and-only-working-a-few-hours-a-week\">Julie Bort</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>就在上周，程序员们在 StackExchange 上有<a href=\"https://workplace.stackexchange.com/questions/93696/is-it-unethical-for-me-to-not-tell-my-employer-i-ve-automated-my-job/94099#94099\" target=\"_blank\">激烈的讨论</a>，如果偷偷把自己的工作自动化，是不是不道德？</p>\n<p><img class=\"alignnone\" src=\"http://ww2.sinaimg.cn/mw690/63918611gw1f5idukigfrj20fw07yt9o.jpg\" width=\"572\" height=\"286\"></p>\n<p>这次讨论的源于 Etherable 于 6 月 27 日在 StackExchange 上发的一个帖子，全文翻译如下：</p>\n<blockquote><p>我目前在给一家公司的遗留系统工作。这个系统真的是很老了，尽管我的角色是程序员，但我大部分工作却是美化数据。总结一下，我有一堆需求，实际上是每月电子表格中的大量数据，我必须把系统配置好，保证运行。这工作基本就是编写一大堆的 SQL 脚本。</p>\n<p>不过这并不是一份很简单的活，因为最初开发这个系统的人写反了。实际上，创建电子表单的分析师要花很多时间来验证我的工作。原因是我这活太繁杂，易出错。</p>\n<p>正如你猜到的，这活非常枯燥。然而，这份全职工作薪水可观，并且允许远程，我还可以陪儿子。</p>\n<p>这份工作我做到大概 18 个月的时候，我基本摸清了所有套路，然后我编写了一个自动化程序，并且我过去 6 个月的活，都是交给它了。所以，过去要 1 人做 1 个月的事，现在可能 10 分钟就可以了。</p>\n<p>现在的问题是，我是否应该告诉公司？如果我告诉他们了，他们或许采纳自动化程序，然后不要我了。这并不像是一个有着大量 IT 工作的公司，他们是有一个遗留系统，一直来保存所有的客户数据，他们只是需要有人来维护这个系统。</p>\n<p>同时，我也觉得自己做的不对。我的意思是，现在只要我拿到了（公司下发的）规范（spec），然后大约每周运行一次自动化程序。再上报我做完了一部分工作，让他们测试验证。我甚至插入了一些 Bugs，以便让结果看起来更像是人做出来的。</p>\n<p>虽然有时候规范需要修改，加上邮件来回沟通的时间，我每周的实际工作时间约 1-2 小时，但我拿的却是全薪。</p>\n<p>虽然我真的很享受多出来的自由时间，但如果这样不打招呼，继续这样偷偷地做下去，是不是不道德？ 这不比我在欺骗公司。公司从来没有表示他们对我的表现不满意，事实上，他们从雇用我中得到了他们想要的。</p></blockquote>\n<p>这位程序员（Etherable）说，他写了一些脚本，悄悄把原本一周的工作用不到两个小时就做完了，他开始感到有些愧疚了。</p>\n<p>公司雇他做的工作都完成了，但是由于是远程工作，也没告诉他老板脚本的事，因此他基本上整天都在陪儿子。他担心公司发现这些脚本然后解雇他，并非是出于道德原因，而是公司有了脚本以后就不再需要他了。</p>\n<p>他写道：</p>\n<blockquote><p>“不告诉我老板自动化工作的事，不道德吗？……</p>\n<p>你能想象，这大概是世界上最无聊的工作了。但是这也是一份薪水颇丰的全职工作，而且我可以远程工作，在家里陪我的儿子。</p>\n<p>所以我已经做了 18 个月了，在这期间，我差不多发现了所有的套路，在过去的六个月里写了一个程序来帮我完成全部工作。以前别人需要用一个月的时间来清理电子表格，用这个程序大概十分钟就能完成。</p>\n<p>现在的问题是，我要不要告诉他们？如果我说了，他们大概会拿走我的程序然后解雇我。”</p></blockquote>\n<p>还有一件事是：这位程序员也坦白，他会通过故意加一些错误来掩盖自动化的痕迹，“让它看起来像是人工完成的。”</p>\n<p>这个问题也发在了<a href=\"https://news.ycombinator.com/item?id=14656945\"> Hacker News</a> 上，引起了激烈的讨论。</p>\n<p>有趣的是，在参与评论的这几十个程序员中，人们分成了两大阵营：<strong>该行为道德和不道德</strong>。</p>\n<h3>你这不道德</h3>\n<p>Stack Overflow 上的人普遍倾向于这种情况不道德。一个叫 <a href=\"https://workplace.stackexchange.com/questions/93696/is-it-unethical-for-me-to-not-tell-my-employer-i-ve-automated-my-job#comment279618_93700\">Magisch</a> 的用户甚至说这位程序员在“诈骗你的老板”。</p>\n<p><a href=\"https://workplace.stackexchange.com/a/93704\">Joe Strazzere</a> 很好地总结了这一派的观点：</p>\n<ul>\n<li><strong>你用每周 1-2 个小时在家里工作（陪儿子），但是却拿着 40 个小时的工资</strong></li>\n<li><strong>你 6 个月前写的这个程序，但是到现在都没告知你的老板</strong></li>\n<li><strong>几乎每周你都在对你的工作成果撒谎</strong></li>\n<li><strong>你故意在程序里插入错误来挽救你的骗局</strong></li>\n<li><strong>你还要让创建表格的分析师花费相当多的时间来检查你的工作</strong></li>\n<li><strong>你承认“感觉自己做了错事”</strong></li>\n</ul>\n<blockquote><p>即使答案在我看来已经很明显了，但是你个人的道德标准让你得出了这样并没什么问题的结论。尽管我怀疑你知道真相……”</p></blockquote>\n<p>另一个<a href=\"https://workplace.stackexchange.com/a/94099\">程序员 SSight3</a> 承认他曾经也自动化做过类似的工作，但是他说自己不属于不道德的原因是，他告诉了他的老板：</p>\n<blockquote><p>“我的情况是，我本来是要做半年的无脑输入数据的工作，但是我自动化了这个过程并且把方法公开给了我的老板。我现在被分配到一个更适合我的天赋和能力的部门。”</p></blockquote>\n<p>他说这个自动化的工作最终使他免于部门的后期裁员。</p>\n<p>大多数站在认为此行为不道德的阵营的人坚信，即使他不能承认已经用这个脚本多久，以及他的工作时间有多短，他仍有义务告诉他的老板关于脚本的事。</p>\n<h3>错误的动机</h3>\n<p>但是 Hacker News 的朋友们提出了另一种观点。</p>\n<p>很多人认为，<strong>只要公司拿到了他们花钱想要的结果，那这个人用多少时间去完成都无所谓</strong>。尽管这个阵营的人也同意，故意制造一些 bug 确实是错的。</p>\n<p><a href=\"https://news.ycombinator.com/user?id=barrkel\">其中一个人写道</a>：“我不认为这里有什么道德问题，只有交易关系——支付工资，创造价值。如果公司用另一种方法能花更少的钱达到目的，它就会采用这种方法并解雇员工。这种事可以避免吗？这位员工正在为公司创造价值，他正在守护自己（和公司）讨价还价的底线，毕竟公司一直都在剥削员工。”</p>\n<p>另一位程序员表示他在做网页的时候也有<a href=\"https://news.ycombinator.com/item?id=14657663\">相似的境遇</a>，而且受到了负面的影响：</p>\n<blockquote><p>“他们想按小时付费给我，但是我协商要按页数付费。当然了，我是自动化完成工作的。但出乎我意料的是，即使他们花同样的钱得到了同样的结果，我们也明确地达成协议不按时间付费，而是按产量付费，他们还是很讨厌我写程序自动化工作。”</p></blockquote>\n<p>有人<a href=\"https://news.ycombinator.com/item?id=14657672\">指出</a>，在整个 IT 行业，自动化不是特例，而是规则。拿系统管理这个工作来说，这项工作是确保 IT 系统不出故障。“我知道很多系统管理员自动化完成大多数工作，他们自己只是做一些监控和维护，他们很棒，没人因为这件事儿指责他们，事实上，这是很好的实践。”</p>\n<p>另一个人<a href=\"https://news.ycombinator.com/item?id=14659048\">表示同意</a>。“作为一个系统管理员，我工作的 90% 都是自动化完成的。如果出了问题，我会一周七天 24 小时随叫随到，但是工作中的其他时间，我可以做做杂事，看看电影，玩玩游戏。我所知道的每个系统管理员，几乎都是这样的。”</p>\n<p>一个人说他<a href=\"https://news.ycombinator.com/item?id=14658785\">整个职业生涯</a>中都是自动化工作的，从没隐瞒过：</p>\n<blockquote><p>“五年前，我在一家大公司做着一份入门级的夜班。那六个月里，我几乎用脚本完成了所有工作，大部分时间都在看 Netflix，我也没花什么心思去隐瞒我没事做这件事。</p>\n<p>为此公司奖励我一次升职，然后我做了同样的事（自动化工作）并且又升职了两次。我现在的产出是从前的两倍多，我的职责是告诉别人如何自动化工作。”</p></blockquote>\n<p>一位程序员完美<a href=\"https://news.ycombinator.com/item?id=14662152\">总结</a>了 Hacker News 上的观点：</p>\n<blockquote><p>“他（发帖求助的程序员 Etherable）唯一的错误就是，没能充分利用他的才能和潜在的生产力。对此最好的解决办法，就是找一份更好的工作。”</p></blockquote>\n<p>技术人员对自动化工作并不陌生。2015 年，曾经有过这样一个程序员，他离开公司后才被发现自动化到了这样的程度：甚至连用咖啡机煮一杯拿铁都要自动化。详情请看《<strong><a href=\"http://blog.jobbole.com/95222/\" target=\"_blank\">超过 90 秒的任务不自动化，你好意思说自己是黑客？</a></strong>》</p>\n<p>有趣的是，编程对于需要长时间且难以忍受的工作来说是小有名气的。许多技术人员都这样工作。</p>\n<p>但显然也出现了这样的亚文化：一些人在做相反的事情，创造一些没有他们就进行不下去的工作。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111742\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111742votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111742\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 37</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('字符串的长度，是字符数量，还是字节数量？', '2017-07-12', 'http://blog.jobbole.com/111578/', 'debc6ba7a658bb45d6cc0ca85638cd2b', 'http://jbcdn2.b0.upaiyun.com/2017/06/324363ff7b01072ed79e2486cb2580e3.png', 'full/0350eb7e24e8ac39d26bdfcb3077783204129a76.jpg', '0', '1', '1', 'IT技术,SQL Server,数据库', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/ljhdo/p/4546081.html\">Vic Liu</a>   </div><p>对于大多数SQL Server编程开发者来说，当计算字符串的长度时，脑海中闪现的第一个函数是：Len(string)，这个“长度”，默认情况下，是指字符的数量，一个英语字符是一个长度，一个汉字是一个长度。大多数的字符串函数，例如charindex，substring，stuff等函数，其位置都是针对字符数量的，这使得Len函数深入人心，但是，一个Unicode字符，占用的字节数量是2Bytes，而一个普通的ASCII字符占用的字节数量是1Byte，当需要计算字符串占用的字节数量时，要如何计算字符串的长度？对于各个类型所占用的字节数量，又该如何计算？带着这个疑问，让我们一睹DataLength函数的庐山真面目。</p>\n<h3>一，字符数量</h3>\n<p>Len(string) 函数返回的数值是字符的数量（number of characters），在统计字符数量时，不包含结尾空格，但是包含前导空格。</p>\n<p>示例，Len 函数返回的是字符的数量，而不是字符的字节数量。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965627458f34061905796\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @str_v varchar(10)\r\ndeclare @str_nv nvarchar(10)\r\ndeclare @str_nv_cn nvarchar(10)\r\nset @str_v=\' ab \'\r\nset @str_nv=N\' ab \'\r\nset @str_nv_cn=N\' 悦光阴\'\r\n\r\nselect len(@str_v) as len_v\r\n    ,len(@str_nv) as len_nv\r\n    , len(@str_nv_cn) as str_nv_cn</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965627458f34061905796-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f34061905796-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f34061905796-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f34061905796-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f34061905796-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f34061905796-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f34061905796-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f34061905796-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f34061905796-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f34061905796-10\">10</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965627458f34061905796-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">str_v </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f34061905796-2\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">str_nv </span><span class=\"crayon-e\">nvarchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f34061905796-3\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">str_nv_cn </span><span class=\"crayon-e\">nvarchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f34061905796-4\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_v</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\' ab \'</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f34061905796-5\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">N</span><span class=\"crayon-s\">\' ab \'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f34061905796-6\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv_cn</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">N</span><span class=\"crayon-s\">\' 悦光阴\'</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f34061905796-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f34061905796-8\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">_</span>v</div><div class=\"crayon-line\" id=\"crayon-5965627458f34061905796-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">_</span>nv</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f34061905796-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv_cn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str_nv_cn</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/324363ff7b01072ed79e2486cb2580e3.png\"><img class=\"alignnone size-full wp-image-111579 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/324363ff7b01072ed79e2486cb2580e3.png\" alt=\"628084-20170328121759045-921067498\"></a></p>\n<h3>二，字节数量</h3>\n<p>对于varchar类型，大家都知道，这是单字节字符，一个字符占用一个字节，总共能够表示的256个字符；而对于nvarchar类型，一个字符占用两个字节，能够表示世界上所有的字符集，一个unicode字符占用两个字节，如果要计算字符串占用的字节数量（number of bytes），请使用DataLength()函数，该函数统计字节数量时，字符串的所有字符都会计算在内，包括前导空格和结尾空格。</p>\n<p>示例，每个unicode字符占2B，ASCII 字符占1B。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965627458f3d735206132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @str_v varchar(10)\r\ndeclare @str_nv nvarchar(10)\r\ndeclare @str_nv_cn nvarchar(10)\r\nset @str_v=\' ab \'\r\nset @str_nv=N\' ab \'\r\nset @str_nv_cn=N\' 悦光阴\'\r\n\r\nselect datalength(@str_v) as len_v\r\n    ,datalength(@str_nv) as len_nv\r\n    , datalength(@str_nv_cn) as str_nv_cn</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965627458f3d735206132-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f3d735206132-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f3d735206132-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f3d735206132-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f3d735206132-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f3d735206132-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f3d735206132-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f3d735206132-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f3d735206132-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f3d735206132-10\">10</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965627458f3d735206132-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">str_v </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f3d735206132-2\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">str_nv </span><span class=\"crayon-e\">nvarchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f3d735206132-3\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">str_nv_cn </span><span class=\"crayon-e\">nvarchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f3d735206132-4\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_v</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\' ab \'</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f3d735206132-5\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">N</span><span class=\"crayon-s\">\' ab \'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f3d735206132-6\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv_cn</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">N</span><span class=\"crayon-s\">\' 悦光阴\'</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f3d735206132-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f3d735206132-8\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">datalength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">_</span>v</div><div class=\"crayon-line\" id=\"crayon-5965627458f3d735206132-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">datalength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">_</span>nv</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f3d735206132-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">datalength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">str_nv_cn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str_nv_cn</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/f7ff564bbbb1bbb08e567f1ee128f50a.png\"><img class=\"alignnone size-full wp-image-111580 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/f7ff564bbbb1bbb08e567f1ee128f50a.png\" alt=\"628084-20170328122211139-1419020285\"></a></p>\n<h3>三，依赖字符数量的函数</h3>\n<p>对于字符串函数：left，right，其长度值是指字符的数量；对于含有位置参数的字符串函数，charindex、stuff 和 substring，是以字符数量来计算起始位置和长度。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965627458f41436444886\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSTUFF ( character_expression , start , length , replaceWith_expression )\r\nSUBSTRING ( expression ,start , length )\r\nRIGHT ( character_expression , length )\r\nLEFT ( character_expression , length )</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965627458f41436444886-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f41436444886-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f41436444886-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f41436444886-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965627458f41436444886-1\"><span class=\"crayon-e\">STUFF</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">character</span><span class=\"crayon-sy\">_</span>expression<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">replaceWith</span><span class=\"crayon-sy\">_</span>expression<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f41436444886-2\"><span class=\"crayon-e\">SUBSTRING</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expression</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f41436444886-3\"><span class=\"crayon-e\">RIGHT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">character</span><span class=\"crayon-sy\">_</span>expression<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f41436444886-4\"><span class=\"crayon-e\">LEFT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">character</span><span class=\"crayon-sy\">_</span>expression<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<h3>四，查看数据类型（Data Type）所占用的存储空间</h3>\n<p>DataLength()函数能过返回任意数据类型的变量所占用的字节数量，在设计表的schema时，为column定义窄的数据类型，在存储海量数据行时，该函数十分有用。</p>\n<p>例如，对于datetime类型占用固定的8B，DateTime2数据类型存储日期和时间，占用的存储空间不固定。根据存储的时间部分 fractional seconds precision来确定DateTime2的Storage Size，6 bytes for precisions less than 3; 7 bytes for precisions 3 and 4. All other precisions require 8 bytes.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-5965627458f45098065960\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @dt1 datetime\r\ndeclare @dt2 datetime2(2)\r\ndeclare @dt3 datetime2(4)\r\n\r\nset @dt1=getdate()\r\nset @dt2=getdate()\r\nset @dt3=SYSDATETIME()\r\n\r\nselect DATALENGTH(@dt1),DATALENGTH(@dt2),DATALENGTH(@dt3),@dt1,@dt2,@dt3</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965627458f45098065960-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f45098065960-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f45098065960-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f45098065960-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f45098065960-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f45098065960-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f45098065960-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965627458f45098065960-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965627458f45098065960-9\">9</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965627458f45098065960-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">dt1 </span><span class=\"crayon-e\">datetime</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f45098065960-2\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">dt2 </span><span class=\"crayon-e\">datetime2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f45098065960-3\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">dt3 </span><span class=\"crayon-e\">datetime2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f45098065960-4\"> </div><div class=\"crayon-line\" id=\"crayon-5965627458f45098065960-5\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt1</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">getdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f45098065960-6\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt2</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">getdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965627458f45098065960-7\"><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt3</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">SYSDATETIME</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965627458f45098065960-8\"> </div><div class=\"crayon-line\" id=\"crayon-5965627458f45098065960-9\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">DATALENGTH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">DATALENGTH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">DATALENGTH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dt3</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/65ccc2c189f61e5fd1b6b6c0669ae320.jpg\"><img class=\"alignnone size-medium wp-image-111581 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/65ccc2c189f61e5fd1b6b6c0669ae320-300x17.jpg\" alt=\"628084-20160919162750918-586033428\"></a></p>\n<p>如果对time的精度（Precision）要求不是很高，保留2位毫秒，使用datetime2(2)，比其他类型节省存储空间。</p>\n<p> </p>\n<p>参考doc：</p>\n<p><a href=\"https://msdn.microsoft.com/en-us/library/ms181984(v=sql.110).aspx\" target=\"_blank\">String Functions (Transact-SQL)</a></p>\n<p><a href=\"https://msdn.microsoft.com/en-us/library/ms190329.aspx\" target=\"_blank\">LEN (Transact-SQL)</a></p>\n<p><a href=\"https://msdn.microsoft.com/en-us/library/ms173486.aspx\" target=\"_blank\">DATALENGTH (Transact-SQL)</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111578\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111578votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111578\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('30 岁转行做初级程序员是什么样的体验', '2017-07-12', 'http://blog.jobbole.com/109944/', 'df681e6513a624d137705e1cd73fb5cc', 'http://wx3.sinaimg.cn/mw690/7cc829d3gy1fgn22fpk57j20m80et77o.jpg', 'full/1fa2a48d2861decd9ce91a980d2cbf42c7800763.jpg', '0', '4', '2', '职场,程序员,职场', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/being-a-junior-developer-at-30-38309f1daee8\">Eva Lettner</a>   译文出处：<a target=\"_blank\" href=\"https://sdk.cn/news/7081\">SDK/鲁行云</a>   </div><p>改变职业是一件吓人的事情，有时候还会成为一件危险的事情。年龄越大，危险就越高。从头学起一样东西，难度总是非常高，尤其是当你身边的人都比你年纪小，而且比你成就高的时候。我在30岁的时候进入科技行业，在这个旅程中我收获了难忘的经历，见到了优秀的人，并且得到了许多机会。</p>\n<p>今天是我 32 岁生日，我想要在这一天回顾过去一年来的旅程、机遇、新朋友和那些让人窒息的挑战。</p>\n<p><em><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fgn22fpk57j20m80et77o.jpg\" width=\"690\" height=\"460\"></em></p>\n<p style=\"text-align: center;\"><em>（2017年5月，我在 We Are Developers 活动上演讲 ）</em></p>\n<p>二十几岁的时候，我觉得自己到了 32 岁的时候一定已经找到了自己想要的东西。我曾经憧憬自己成为一个幸福的女人，有着美满的人生，自己喜欢的工作，穿着美美的高跟鞋，而且给自己制定了详细的未来计划。</p>\n<p>但是现实和梦想总是存在着差距，我今天脸上的妆还是昨天画的，穿的是老公的衬衫。我的生活的确很幸福，但是和我当初想象的却大相径庭，而我的职业才刚刚起步。我从来不穿高跟鞋，因为我觉得它们不舒服，而对于未来，我根本没有计划！</p>\n<p>我用了很长的时间才进入了科技行业，一路上有眼泪，也有沮丧。本来我的理想是成为一名语言学家，我希望环游世界，在各个知名学府里翻译古代文本。后来，我的母亲不幸的得了癌症，一切对我来说都不再重要了。病痛折磨了她两年半的时间，在这段时间里，我的生活也停滞了。我感到无比难过，大学不再重要，我的学位也不再重要，我刹那间迷失在生活中，漫无目的。</p>\n<p>虽然用了一段时间，但是最后我还是从悲痛中恢复了。我突然想到回去做曾经喜欢的Web设计工作。我之前一直很喜欢Web设计，但是从来没有想过将它作为我的职业。于是我开始学习写代码，并且找到了一个为期两年的项目，我在这个项目中认识了<a href=\"https://twitter.com/mmatuzo\"><u>Manuel Matuzovic</u></a>，他是我的老师，并且我们最后成为了朋友，我也将他视为是我的导师。他不断的给我设定挑战，并且挖掘了我的潜力。</p>\n<p>大约一年以前，我成为了一名全职开发者，我想要总结一下这一年的经验，并且和所有人分享，一个30多岁的人是如何进入科技行业的：</p>\n<h3>大家都好年轻！</h3>\n<p>在我刚刚入职的时候，我是公司里年级最大的人，而且还是一个初级开发者。这种感觉很奇怪，尤其是在我之前的工作中，我曾是管理层的一员，管理者一个超过60人的团队。</p>\n<p>我一度觉得自己完全无法赶上身边的人，他们都比我强太多了。这种感觉如今依然会时不时的向我袭来，但是在我找到自己的强项之后，这种感觉就没有那么强烈了。</p>\n<p>因此我的建议是：找到你喜欢的东西，让自己获得提高，自信来源于练习。</p>\n<h3>冒充者综合征真的存在</h3>\n<p>编程的好坏是装不出来的。对于我这样容易担心的人来说，把代码发给同事去审核就像是一个噩梦。我总是觉得自己是个loser，觉得自己永远都没有进步。在我看来，克服这种感觉的关键在于沟通。我跟老板说了我的不安全感，并且请他评价了我的代码质量，以及询问他我这一段时间里是否有了进步。每当遇到不同的问题，我就会去提问，不断的从他和其他人那里学习。很幸运，我的老板和同事都是很好的人，他们让我敢于向他们提问。</p>\n<h3>身边的人很重要</h3>\n<p>和其他工作一样，作为一名开发者也需要积攒人脉。你的同时、客户、用户。</p>\n<p>我在科技大会上见到了很多优秀的人。这个行业的气氛真的很不错，人与人之间彼此尊重、彼此学习。当时，和其他行业一样，科技行业也有丑陋的一面，但是我感觉到了人与人之间的对话。我们还有很大的进步空间，而且我们都在不断努力。</p>\n<h3>不仅是份工作</h3>\n<p>在之前的工作中，每天下班之后，我都不想在去考虑任何与工作有关的事情。而在科技行业，下班后我不是直接回家，而是去参加各种meetup。而周末的时候，我回去参加hackathon，各种科技大会我都会参加，有时还会自己组织一些活动。</p>\n<p>当一名开发者是一种非常特别的体验。离开办公室之后，你的工作并没有停止。</p>\n<h3>公开演讲是一件有意思的事情！</h3>\n<p>我是个有梦想的人，进入科技行业也想要取得成功。尽管从来没有特别准备过，但是我在维也纳参加meetup的时候，却马上成为了一名科技演讲人，在1000人面前进行演讲。也许是因为年纪大了，我现在不再害怕在众人面前说话，甚至开始享受这种感觉。我甚至还开始教其他人东西。我觉得22岁的我一定做不到这一点。</p>\n<h3>我的未来在哪里？</h3>\n<p>希望能够获得更多的公开演讲机会，更多的编程挑战，参加更多的大会，拥抱更多优秀的人，让我的职业生涯更圆满。</p>\n<p>如果你正在考虑转行，但是担心自己的年纪太大，请听我一句话：追求幸福和成功，享受你的工作，在工作中结实优秀的人，这一切都不受年龄的限制。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"109944\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"109944votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"109944\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('不再迷惑，无值和 NULL 值', '2017-07-12', 'http://blog.jobbole.com/111541/', 'ef6c307e280a8e27315c464cf98bb302', 'http://jbcdn2.b0.upaiyun.com/2017/06/aa7d9f4278af95b35311f5d41c7b9fa2-300x39.png', 'full/233e3fbaa3d4c54374b5477ad13750ab622a9d4c.jpg', '1', '4', '1', 'IT技术,,NULL,TSQL,数据库,无值', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/ljhdo/p/5128417.html\">Vic Liu</a>   </div><p>在关系型数据库的世界中，无值和NULL值的区别是什么？一直被这个问题困扰着，甚至在写TSQL脚本时，心有戚戚焉，害怕因为自己的一知半解，挖了坑，贻害后来人，于是，本着上下求索，不达通幽不罢休的决心（开个玩笑），遂有此文。</p>\n<p>学习过关系型数据库的伙伴都知道，NULL是指不确定的值，在数据库中绝对是噩梦的存在；而空值，一般对字符串类型而言，指没有任何值的字符串类型，为字符类型的变量设置为空值：set @vs=”，空值跟无值不同。有人可能会问，无值是什么？无值，是指数据表中没有任何数据。无值和不确定值，单从字面意思上来看，两者之间的定义很清楚，一旦深究，这两者之间的关系，有时令人十分迷惑（confused），这是因为，在特定条件下，无值会转换为NULL值。</p>\n<h3>一，举个栗子，理解无值和NULL值的区别</h3>\n<p>比如，创建一个临时表，在不插入任何数据时，该数据表是空的，没有任何值，对其执行select命令，将不会返回任何数据值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8e1174903840\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncreate table #temp\r\n(\r\nid int null\r\n)</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8e1174903840-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8e1174903840-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562754c8e1174903840-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8e1174903840-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8e1174903840-1\"><span class=\"crayon-e\">create </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8e1174903840-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-596562754c8e1174903840-3\"><span class=\"crayon-e\">id </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8e1174903840-4\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>创建一个标量类型的变量，在不初始化时，该变量的值是不确定的，其值是NULL：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8eb792997282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @vs int</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8eb792997282-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8eb792997282-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">vs </span><span class=\"crayon-t\">int</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>创建一个表类型变量，在不初始化时，该表变量没有任何数据，是无值的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8ef432975101\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndeclare @vt as table\r\n(\r\nid int null\r\n)</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8ef432975101-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8ef432975101-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562754c8ef432975101-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8ef432975101-4\">4</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8ef432975101-1\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">vt </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">table</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8ef432975101-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-596562754c8ef432975101-3\"><span class=\"crayon-e\">id </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8ef432975101-4\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>总结一下，声明一个标量型变量，如果没有对变量进行初始化，其值是不确定的，是NULL值；对于表变量，临时表和基础表，如果没有插入任何数据，该表没有任何数据，是无值的。</p>\n<h3>二，无值和NULL值的转换</h3>\n<p>在开始本节之前，先为变量赋值，简单的一个select命令就可以完成变量的赋值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8f3238415436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect @vs=1</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8f3238415436-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8f3238415436-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>有些朋友思维比较活跃，立马会想到：“用select命令可以从表中取值为变量赋值”，对，但是，赋值方法不是我求索的重点，我关注的是从表中取值为变量赋值的结果。</p>\n<p><strong>1，从空表中为变量赋值</strong></p>\n<p>如果数据表是空表，没有任何值，那么数据库引擎不会执行赋值语句，变量保持原有值不变：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8f6080475741\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect @vs=id\r\nfrom #temp</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8f6080475741-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8f6080475741-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8f6080475741-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vs</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8f6080475741-2\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>但是，如果采用以下方式，那么数据库引擎会执行赋值语句，由于空表不返回任何值，数据库引擎会把无值转换为不确定值NULL：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8fa377092679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect @vs=(select top 1 id\r\nfrom #temp)</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8fa377092679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8fa377092679-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8fa377092679-1\"><span class=\"crayon-i\">select</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">select </span><span class=\"crayon-i\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8fa377092679-2\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp)</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>诧异吗？无值和NULL值的转换，居然从不起眼的变量赋值开始。<strong>注意，当不返回任何值时，数据库引擎不确定返回值，就把无值转换为NULL值。</strong></p>\n<p><strong>2，从空表中计算聚合</strong></p>\n<p>空表是没有任何数据的表，计算聚合会产生怎样的结果？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c8fd351194063\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect count(0) as count_all\r\n    ,count(id) as count_id\r\n    ,max(id) as max_id\r\n    ,min(id) as min_id\r\n    ,avg(id) as avg_id\r\n    ,sum(id) as sum_id\r\nfrom #temp</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c8fd351194063-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8fd351194063-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562754c8fd351194063-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8fd351194063-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562754c8fd351194063-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c8fd351194063-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596562754c8fd351194063-7\">7</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c8fd351194063-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>all</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8fd351194063-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-596562754c8fd351194063-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8fd351194063-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-596562754c8fd351194063-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">avg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c8fd351194063-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum_id</span></div><div class=\"crayon-line\" id=\"crayon-596562754c8fd351194063-7\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>当统计数据行数时，返回的是0；当计算聚合函数（max，min，avg和sum）的聚合值时，由于无值可以聚合，数据库引擎不能确定这些聚合函数的返回值，因此，数据库引擎返回NULL值。</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/aa7d9f4278af95b35311f5d41c7b9fa2.png\"><img class=\"alignnone size-medium wp-image-111574\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/aa7d9f4278af95b35311f5d41c7b9fa2-300x39.png\" alt=\"628084-20170620110230601-1550885802\"></a></p>\n<h3>三，聚合函数忽略NULL值</h3>\n<p>一般情况下，除了count(0)，count(*)之外，聚合函数都会忽略NULL值，而统计非NULL值，如果读者有疑问，可以查看我的博客《<a id=\"cb_post_title_url\" class=\"postTitle2\" href=\"http://www.cnblogs.com/ljhdo/p/4950586.html\">TSQL 聚合函数忽略NULL值</a>》。如果只知聚合函数忽略NULL值，而不知空表也会产生结果为NULL的聚合值，轻易得出聚合函数不会返回NULL值的定论，那就很尴尬。楼主曾遇到过一次“意外”，在一次调试脚本代码的过程中，我遇到max聚合函数返回NULL值的情况，当时一脸懵逼，直接怀疑自己之前的所学。</p>\n<p>当聚合列值都是NULL值时，由于聚合函数忽略NULL值，因此，当计算聚合函数（max，min，avg和sum）的聚合值时，由于无值可以聚合，数据库引擎不能确定这些聚合函数的返回值，因此，数据库引擎返回NULL值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-596562754c901683541076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninsert into #temp(id)\r\nvalues(null)\r\n\r\nselect count(0) as count_all\r\n    ,count(id) as count_id\r\n    ,max(id) as max_id\r\n    ,min(id) as min_id\r\n    ,avg(id) as avg_id\r\n    ,sum(id) as sum_id\r\nfrom #temp</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596562754c901683541076-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c901683541076-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596562754c901683541076-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c901683541076-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596562754c901683541076-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c901683541076-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596562754c901683541076-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c901683541076-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596562754c901683541076-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596562754c901683541076-10\">10</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596562754c901683541076-1\"><span class=\"crayon-e\">insert </span><span class=\"crayon-v\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp(id)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c901683541076-2\"><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-596562754c901683541076-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c901683541076-4\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>all</div><div class=\"crayon-line\" id=\"crayon-596562754c901683541076-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c901683541076-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-596562754c901683541076-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c901683541076-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">avg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-596562754c901683541076-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596562754c901683541076-10\"><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#temp</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>聚合函数（max,min,sum,avg和count）忽略null值，但不代表聚合函数不返回null值：如果数据表为空表，或聚合列值都是null，那么max,min,sum,avg聚合函数返回null值，而count 聚合函数返回0。聚合函数的共性：<span id=\"mt3\" class=\"sentence SentenceHover\">Null values are ignored。</span></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/67f68fb73135e2a336466ab69fe7df28.png\"><img class=\"size-medium wp-image-111576 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/67f68fb73135e2a336466ab69fe7df28-300x37.png\" alt=\"628084-20170620112538616-1090159798\"></a></p>\n<p>不再迷惑：<strong>当不返回任何值时，数据库引擎不确定返回值，就把无值转换为NULL值。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111541\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111541votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111541\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('我是如何开始踏上 bash 脚本编程之路的？', '2017-07-12', 'http://blog.jobbole.com/111509/', 'f65b12bcb444cfbc3d0109311fbdd75c', 'http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg', 'full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg', '1', '1', '2', 'IT技术,,Bash', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/5/how-i-learned-bash-scripting\">Sandra Mccann</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8617-1.html\">Linux中国/xllc</a>   </div><p>我前几天写了一个脚本。对于一些人来说，这句话听起来没什么了不起的。而对于另一些人来说，这句话意义重大。要知道，我不是一个程序员，而是一个作家。</p>\n<h3 id=\"toc_1\">我需要解决什么？</h3>\n<p>我的问题相当简单：我需要将工程文件进行分类。这些文件可以从一个网站 URL 以 .zip 的格式下载。当我正手工将它们拷贝到我的电脑桌面，并移动到一个已按照我文件分类的需要进行了结构化的目录时，一位作家同事给我提了建议：<em>“不就是写个脚本的事吗？”</em></p>\n<p>我心想：<em>“就写个脚本？”</em>——说得好像这是世界上最容易做的事情一样。</p>\n<h3 id=\"toc_2\">Google 是如何解救我的？</h3>\n<p>同事的问题促使我思考，并且经过思考后，我进行了 Google 搜索。</p>\n<p><strong>Linux 上使用的是什么脚本编程语言？</strong></p>\n<p>这是我第一个 Google 搜索的准则。也许很多人心里会想：“她太笨了！”是的，我很笨。不过，这的确使我走上了一条解决问题的道路。最常见的搜索结果是 Bash 。嗯，我听说过 Bash 。呃，我要分类的文件中有一个里面就有 Bash，那无处不在的 <code>#!/bin/bash</code> 。我重新看了下那个文件，我知道它的用途，因为我需要将它分类。</p>\n<p>这引导我进行了下一个 Google 搜索。</p>\n<p><strong>如何从一个 URL 下载 zip 文件？</strong></p>\n<p>那确实是我的基本任务。我有一个带有 .zip 文件的 URL ，它包含有所有我需要分类的文件，所以我寻求万能的 Google 的帮助。搜索到的精华内容和其它一些结果引导我使用 Curl 。但最重要的是：我不仅找到了 Curl ，其中一条置顶的搜索结果还展示了一个使用 Curl 去下载并解压 .zip 文件的 Bash 脚本。这超出了我本来想寻求的答案，但那也使我意识到在 Google 搜索具体的请求可以得到我写这个脚本需要的信息。所以，在这个收获的推动下，我写了最简单的脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654977a8f76724316340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\ncurl http://rather.long.url | tar -xz -C my_directory --strip-components=1</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654977a8f76724316340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f76724316340-2\">2</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654977a8f76724316340-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f76724316340-2\"><span class=\"crayon-e\">curl </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//rather.long.url | tar -xz -C my_directory --strip-components=1</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我迫不及待地运行看看。但我发现一个问题： URL 是会变的，根据我要访问的文件的分组不同而不同。我有新的问题需要解决，这使我进行了下一轮搜索。</p>\n<p><strong>参数如何传递给 Bash 脚本？</strong></p>\n<p>我需要以不同的 URL 和不同的最终目录来运行此脚本。 Google 向我展示了如何使用 <code>$1</code>、<code>$2</code> 等等来替换我在命令行中运行脚本时输入的内容。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654977a8f83660291707\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbash myscript.sh http://rather.long.url my_directory</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654977a8f83660291707-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654977a8f83660291707-1\"><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">myscript</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//rather.long.url my_directory</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这就好多了。一切如我所愿，灵活，实用。最重要的是我只要输入一条简短的命令就可以节省 30 分钟无聊的复制、粘贴工作。这个早上的时间花得值得。</p>\n<p>然后我发现还有一个问题：我很健忘，并且我知道我几个月才运行一次这个脚本。这留给我两个疑问：</p>\n<ul>\n<li>我要如何记得运行脚本时输入什么（URL 先，还是目录先）？</li>\n<li>如果我被货车撞了，其它作家如何知道该怎样运行我的脚本？</li>\n</ul>\n<p>我需要一个使用说明 —— 如果我使用不正确，则脚本会提示。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654977a8f8b216351481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nusage: bash yaml-fetch.sh &lt;\'snapshot_url\'&gt; &lt;directory&gt;</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654977a8f8b216351481-1\">1</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654977a8f8b216351481-1\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">yaml</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fetch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-s\">\'snapshot_url\'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">directory</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>否则，则直接运行脚本。我的下一个搜索是：</p>\n<p><strong>如何在 Bash 脚本里使用 “if/then/else”?</strong></p>\n<p>幸运的是，我已经知道编程中 <code>if/then/else</code> 的存在。我只要找出如何使用它的方法。在这个过程中，我也学到了如何在 Bash 脚本里使用 <code>echo</code> 打印。我的最终成果如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n		<div id=\"crayon-59654977a8f91452704388\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n		\r\n			<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n			<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n			<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n			<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\nURL=$1\r\nDIRECTORY=$2\r\nif [ $# -eq 0 ];\r\n then\r\n echo \"usage: bash yaml-fetch.sh &lt;\'snapshot_url\'&gt; &lt;directory&gt;\".\r\n else\r\n# 如果目录不存在则创建它\r\n echo \'create directory\'\r\n mkdir $DIRECTORY\r\n # 下载并解压 yaml 文件\r\n echo \'fetch and untar the yaml files\'\r\n curl $URL | tar -xz -C $DIRECTORY --strip-components=1\r\nfi</textarea></div>\r\n			<div class=\"crayon-main\" style=\"\">\r\n				<table class=\"crayon-table\">\r\n					<tr class=\"crayon-row\">\r\n				<td class=\"crayon-nums \" data-settings=\"show\">\r\n					<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59654977a8f91452704388-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59654977a8f91452704388-14\">14</div></div>\r\n				</td>\r\n						<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-2\"><span class=\"crayon-v\">URL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-3\"><span class=\"crayon-v\">DIRECTORY</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-p\"># -eq 0 ];</span></div><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"usage: bash yaml-fetch.sh &lt;\'snapshot_url\'&gt; &lt;directory&gt;\"</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-8\"><span class=\"crayon-p\"># 如果目录不存在则创建它</span></div><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'create directory\'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">DIRECTORY</span></div><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 下载并解压 yaml 文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\'fetch and untar the yaml files\'</span></div><div class=\"crayon-line\" id=\"crayon-59654977a8f91452704388-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">DIRECTORY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">strip</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">components</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59654977a8f91452704388-14\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">Google 和脚本编程如何颠覆我的世界？</h3>\n<p>好吧，这稍微有点夸大，不过现在是 21 世纪，学习新东西（特别是稍微简单的东西）比以前简单多了。我所学到的（除了如何写一个简短的、自动分类的 Bash 脚本之外）是如果我有疑问，那么有很大可能性是其它人在之前也有过相同的疑问。当我困惑时，我可以问下一个问题，再下一个问题。最后，我不仅拥有了脚本，还拥有了可以一直拥有并可以简化其它任务的新技能，这是我之前所没有的。</p>\n<p>别止步于第一个脚本（或者编程的第一步）。这是一个技能，和其它的技能并无不同，有大量的信息可以在这一路上帮助你。你无需阅读大量的书或参加一个月的课程。你可以像婴儿学步那样简单地开始写脚本，然后掌握技能并建立自信。人们总有写成千上万行代码的需求，并对它进行分支、合并、修复错误。但是，通过简单的脚本或其它方式来自动化、简单化任务的需求也一样强烈。这样的一个小脚本和小小的自信就能够让你启程脚本编程之路。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111509\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111509votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111509\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('每个程序员都需要知道一些游戏网络知识', '2017-07-12', 'http://blog.jobbole.com/111711/', 'fac35b12c02fb27f44780851ac24f152', 'http://jbcdn2.b0.upaiyun.com/2017/07/c39de1bb884eaa81287bd08dab06403d.jpg', 'full/41b4657e9821155bd3325ef1334ebce10189b7f6.jpg', '0', '3', '2', 'IT技术,游戏开发', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://gafferongames.com/networking-for-game-programmers/what-every-programmer-needs-to-know-about-game-networking/\">GLENN FIEDLER</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/u/1859679/blog/911474\">wier</a>   </div><p>这是一篇翻译文章，主要针对游戏的网络设计，目前主流的网络游戏实现方案都有讲解，如果对英文更感兴趣，请查看原文地址，你若是觉得有翻译不妥的地方，欢迎留言指正。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c39de1bb884eaa81287bd08dab06403d.jpg\"><img class=\"aligncenter wp-image-111712 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c39de1bb884eaa81287bd08dab06403d.jpg\" alt=\"084635_zdwT_1859679\" width=\"900\" height=\"500\"></a></p>\n<p>作为一个程序员，你有没有想象过多人游戏是如何实现的？</p>\n<p>在外行人看来游戏很神奇：两个或者更多的玩家在网络上分享共同的经历，就像他们真实的存在于相同的虚拟的世界一样。游戏看起来犹如一个巨大的魔术，奇妙而又刺激，但作为一个开发人员我们知道，真实的情况和我们所看到的并不一样，那只是一种错觉。你感受到的共享现实，实际上是在那个时刻内，由你自己的独特视角和位置所感知的近似情况。</p>\n<h1 id=\"h1_0\"><strong>Peer-to-Peer 帧同步</strong></h1>\n<p>最初的游戏是通过peer-to-peer来联网的，每个计算机通过网状拓扑的结构的彼此连接并交换信息。你仍然可以看到这种模型存在于RTS游戏中，而且基于某些原因它还很有趣，也许是因为它是大多数人认为游戏网络工作方式的第一种方式。</p>\n<p>处理游戏信息的基本思想就是把游戏的数据抽象并转换成一系列命令消息，当处理每个转换的时候就直接演变为游戏的状态。比如:移动单位、攻击物体、建造建筑。这一切都需要在线的每个玩家机器，从一个初始化命令开始之后，都运行完全相同的命令和转换数据。</p>\n<p>当然了，这只是一个过于简单的解释，同时也隐去了很多细节，不过我们通过这个基本的思路可以知道RTS游戏的网络是如何工作的。如果你想知道更多网络模型，请点击:<a href=\"http://www.gamasutra.com/view/feature/3094/1500_archers_on_a_288_network_.php\" target=\"_blank\" rel=\"nofollow\">1500 Archers on a 28.8: Network Programming in Age of Empires and Beyond</a>.</p>\n<p>这些看起来是如此简单和优雅，但不幸的它们有几个因素限制者我们。</p>\n<p>第一个限制，要保证游戏状态完全确定一致的是异常困难，特别是保持每台机器上每个转换输出都保持相同。比如，一个单位在两台机器上有略微不同的路径，在一台机器上早一些到达并开始了战斗，结果反败为胜，而在另一台机器上，由于稍微晚一些到达而失败。就像一只蝴蝶扇动了翅膀，然后在世界的另一边导致了飓风的出现，随着时间的推移，一个微小的区别就会导致两边完全的不同步。</p>\n<p>第二个限制，为了保证游戏的所有玩家输出一致，这就需要等到所有玩家的当前回合数据都到达之后才可以模拟播放这一回合动作。这就意味着游戏中的每一个玩家都需要等待网络延迟最高的那个玩家。RTS游戏通常代表性地通过立即提供音频反馈与（或是）播放吟唱（过渡）动画来掩盖这段延迟，但是最终真正影响游戏的动作要在这段延迟过去之后才能进行。</p>\n<p>第三个限制，因为游戏中状态改变的同步是通过发送命令信息来同步的。所以为了游戏中玩家状态都一致，需要所有的玩家都要从相同的初始状态来开始游戏。这意味着每个玩家必须在开始游戏之前先加入房间然后一起开始游戏，尽管理论上也可以支持让某些玩家晚些加入游戏，但是在一场进行中的游戏中获得一个完全确定的起始点的难度相当大，所以这种情况并不常见。</p>\n<p>尽管有这些因素限制困扰者我们，不过这个模型还是很适合RTS游戏的，并且它仍然存在于今天的游戏当中，例如“<strong>Command and Conquer</strong>”、“<strong>Age of Empires</strong>”与“<strong>Starcraft</strong>”等。原因就是在RTS游戏中，里面包含了上千多的单位，这些单位都有自己的状态需要同步，而且他们数据量都太大了，很难用来在玩家之间交换。别无选择，我们只能通过这些游戏状态改变的命令来同步。</p>\n<p>所以以上这些就是 peer-to-peer 帧同步的网路游戏模型的介绍了，对于其他类型的游戏，最先进的技术已经开始出现了。让我们现在从<strong>Doom</strong>, <strong>Quake </strong>以及 <strong>Unreal</strong>经典游戏中开始一起观察动作游戏的技术演化。</p>\n<h1 id=\"h1_1\"><strong>客户端/服务器（c/s架构）</strong></h1>\n<p>在动作游戏的时代，以上帧同步的限制在<strong>Doom </strong>游戏中变得更加明显，尽管在局域网中体验还不错，但在对于互联网的用户来说它体验太糟糕了：</p>\n<p>尽管可以使用一个猫（调制解调器）把两个<strong>Doom </strong>机器通过互联网连接在一起，但他们一起游戏会异常缓慢。范围从无法游戏（例如:14.4Kbps PPP 连接)到稍微可以玩(例如 ：28.8Kbps 猫运行一个被SLIP驱动压缩的数据)之间游戏联机都异常缓慢。由于这些连接方式只是边际效用，本文将仅关注直接的网络连接。</p>\n<p>这个问题是因为Doom网络部分本来就是只为局域网而设计的，并且使用了前面介绍的peer-to-peer 帧同步模型。每一回合每个玩家的输入的信息（比如关键按键等）都与其他人进行同步通知，并且任何玩家在播放这一帧动画之前，必须得等到所有其他玩家的关键按键信息都被接收到，才可以去模拟播放。</p>\n<p>也就是说，在你可以转身（转换），移动或者射击之前，你必须等待延迟最大的猫（调制调解器）玩家的输入。只是想想上述那个人所写的“这些连接方式只是边际效用”就会让人咬牙切齿和沮丧了。</p>\n<p>为了改变这种现状，只能在局域网以及大学网络和大型企业才能获得良好连接而进行游戏，是需要改变这种网络模型了。在1996年，这变成了现实并被实现了，John Carmack当时 发布雷神之锤，他采用客户端/服务器（C/S）架构代替了P2P模型。</p>\n<p>如今游戏中的玩家可以不必再运行相同的代码以及直接相互通信，每个玩家的机器是都是一个“客户端”，他们都通过一台叫做“服务器”的机器进行通信交互。游戏的最终状态确定不再依赖于每台客户端机器来共同确认，而是由服务器来确定最终结果。每个客户端如同一个哑终端，用来展示一个近似值的表演，真是的游戏状态是运行于服务器之上。</p>\n<p>在一个纯粹的c/s架构中，你不必在本地运行游戏代码，而是把一些例如按键、鼠标移动，点击等输入信息发送到服务器。服务器会在游戏世界中更新你的玩家状态，然后再封包一个包含你角色信息以及临近玩家数据的包回复给你的客户端。所有的客户端在每个消息更新的间隙做一个插值预测，以改善在每个状态更新期间，物体可以平滑的移动，如此，你就有一个可以联网的客户端/服务器架构的游戏了。</p>\n<p>这已经是向前迈出了极大的一步。游戏的体验依赖于客户端和服务器的连接，而不是游戏中延迟最大的那个玩家。如此可以支持玩家在游戏中自由的进入和退出，同时由于客户端/服务器降低了平均每位玩家的带宽，从而可以增加更多的在线玩家。</p>\n<p>但是这里仍然有一些问题存在于 c/s 架构中:</p>\n<p>我记得我交代了所有从DOO到Quake中关于网络的决策，但是重要的是我正在使用错误的假设来做一个好的网络游戏。我原先设计的目标是网络延迟&lt;200ｍs。人们通过一个好的网络供应商连接互联网，从而可以获得一个好的游戏体验。但事与愿违，世界上99%的用户使用猫(调制调解器)通过 slip或者ppp 进行连接，而他们常常都会通过槽糕而又拥挤的ISP。这会带来最低300+ms 的 网络延迟。一个消息要经过，客户端&gt;用户猫&gt;ISP猫&gt;服务器&gt;ISP猫&gt;用户猫&gt;客户端。上帝，这太逊了。</p>\n<p>OK,我做了一个错误的设定。我在家里使用T1 宽带，所以我只是不了解在PPP网络下的生活。我现在就解决它。</p>\n<p>这个问题当然是延迟。</p>\n<p>接下来John在他发布QuakeWorld的时候将改变这个行业。</p>\n<h1 id=\"h1_2\"><strong>客户端预测（<strong>Client-Side Prediction</strong>）</strong></h1>\n<p>在原来的Quake游戏中，你会感觉到电脑与服务器之间的延迟。比如，你按键向前移动，在你真正移动之前，你需要等到数据包发送服务器然后再回复到你的客户端，你才可以真正的移动。按键开火，在你的射击之前同样需要相同的等待。</p>\n<p>如果你玩过任何FPS游戏，比如:Modern Warfar,你会发现并没有延迟发生。那么fps游戏是如何做到在多人情况下，你的动作看起来并没有延迟？</p>\n<p>这个问题被分为两个部分来解决。第一个部分是客户端移动预测，这事John Carmack 为 QuakeWorld游戏多开发的，后来被合并到了Tim Sweeney的虚幻网络模块。第二个部分就是延迟补偿，它是有Valve公司的Yahn Bernier在Counterstrike所开发。那么在这个章节，我们把焦点放在第一部分——隐藏用户移动的延迟。</p>\n<p>当写到关于他即将发布的QuakeWorld计划的时候，John Carmack 讲到:</p>\n<p>我现在允许客户端可以预测用户的移动，直到服务器的权威信息回复之前。这是一个重大的结构变更。客户端需要知道关于对象的硬度、摩擦力、重力等一系列基础属性。我很伤心的看到，客户端仅作为一个终端存在将会离开，但作为一个实用主义者，我必须超越这种理想情怀。</p>\n<p>那么现在我们为了消除延迟，客户端需要运行更多的代码。它现在不再是一个只把输入发送给服务器然后再把返回信息进行插入的哑终端。现在客户端的机器可以运行一部分游戏代码，它可以在本地预测你的角色移动并且可以即时响应你的输入。</p>\n<p>现在当你即刻按键向前，你的游戏会立刻向前移动，不会再去等待数据往返一次客户端和服务器之间才来回应你的操作。</p>\n<p>这种方式的难点不在于预测，这种预测工作，就像正常的游戏代码一样 —— 根据玩家的输入，及时地更新游戏角色的状态。而难点在于，当客户端和服务器对于玩家角色所做的事情（动作）核检不一致的时候，客户端如何基于服务器信息进行更正。</p>\n<p>现在你会想，hey，如果代码运行在客户端——为何不以客户端的信息为准？客户端可以自己的为角色模拟运行代码，并且只需要在每次发送数据包时告知服务器这些信息。如果每个客户端都对服务器发送相同的信息，告诉服务器“这是我现在的位置信息”，那么将会带来这样的问题。客户端会很容易被黑客攻击并控制，这样在RPG游戏中，一个作弊便可以立即躲避对方技能击中，或者当你射击的时候瞬间移动到你的身后。</p>\n<p>所以在FPS游戏中，尽快每个玩家的客户端可以预测他们自己的角色进行操作移动，但最终每个玩家的角色状态绝对以服务器为准。就像Tim Sweeney 在所写的文章<a href=\"http://unreal.epicgames.com/Network.htm\" target=\"_blank\" rel=\"nofollow\">The Unreal Networking Architecture</a>中描述的一样：“服务器才是主人”。</p>\n<p>这就是有趣的地方。如果客户端和服务器产生了不一致，客户端必须基于服务器的信息为准并更新，但是由于客户端和服务器之前有延迟，服务器的修正必然是过去的动作。比如，如果信息从客户端到服务器耗时100ms，然后返回又耗时100ms，那么任何服务器的的修正都是客户端200ms之前的行为动作，这个时间正好是客户端预测角色移动的时间。</p>\n<p>如果客户端每个动作都会被服务器修正，那么你将会看客户端被拉回了原先的位置，如此客户端将做不了任何预先预测的运算。那么我们如何解决这个问题，依然可以保持客户端提前预测？</p>\n<p>解决方案就是在客户端创建一个buffer，然后用来循环保持角色的状态以及本来玩家的输入。当客户端收到了服务器的更正信息时候，它首先丢弃掉buffer里面比（服务器回复的）更正状态要老的状态信息，然后基于（更正的）正确的状态重放存储在buffer里面的输入信息，重发的这些输入信息的范围是从正确状态到当前预测时间之间。如此实际上，客户端只是看似无形中“倒带和重放”当地玩家角色运动的最后n帧，同时保持世界其他地方没有变化。</p>\n<p>这种方法可以让玩家感觉在控制游戏的时候没有延迟，同时也改善了客户端和服务器之间代码运行的一致性——在同等输入的情况下保持一致的结果。当然了，修正的情况很少发生，Tim Sweeney 如此描述:</p>\n<p>…对于客户端和服务器最好的是：所有情况下，服务器都是权威的。几乎所有的时间，客户端模拟的和服务器的数据都是一致，所以客户端的位置很少被修正。只有的少数罕见的情况下，例如一个玩家被火箭击中，或者和一个敌人（怪物）碰撞上，那么客户端本地的情况有可能需要被修正。</p>\n<p>也就是说，只有当玩家的角色被一些外部事件影响玩家的输入，并且这些不能被客户端预测时，玩家的位置（行为）需要被服务器修正。当然，如果玩家试图作弊，必然会被服务器修正。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111711\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111711votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111711\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n	</div>');
INSERT INTO `jobbole_article` VALUES ('漫画算法：什么是 B 树？', '2017-07-12', 'http://blog.jobbole.com/111757/', 'fd842a72622552f4dffcc903ae3af9b5', 'http://jbcdn2.b0.upaiyun.com/2017/07/f4156a04d1ce10e1d6b6e119ce1fc3db.jpg', 'full/3f0be7614d3c4b769873121d69a7e1ad5ae8b755.jpg', '1', '4', '2', 'IT技术,趣文小说,,算法', '<div class=\"entry\">\r\n\r\n        			<div class=\"textwidget\"></div>\n		\r\n		<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<blockquote><p>伯乐在线补充：本文提到的「B-树」，就是「B树」，都是 B-tree 的翻译，里面不是减号-，是连接符-。因为有人把 B-tree 翻成 「B-树」，让人以为「B树」和「B-树」是两种树，实际上两者就是同一种树。</p></blockquote>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f4156a04d1ce10e1d6b6e119ce1fc3db.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fc713400ca8ce73e4d4f7b656974a270.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/98d1b3066e41fa6e28ad131e4f04f2d5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4cb37c6fcae8dbb405cb4b8ed10112aa.jpg\" alt=\"\"></p>\n<p>————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/70f82597c6205ae0b915cf9446605986.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fbb934ec8ef90054d26303d34bb27a24.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/616f5e86b4cf206dcfee036fd55e9602.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce70b97a696efa28520a19e5adea080c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/54f122a98313bd4f61c2e95d9858eaf6.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/06556ae2f9f1dbf3bc798b350a97290a.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b159585a12d50e1fbfffa2d892fde68f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/40fb54cfbec0e48c40e3f01d79f2cc3e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/89cca300c77afb89a592d252de98f012.jpg\" alt=\"\"></p>\n<p>————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f2ab28eb6aa7b3efce6c000aed8ccba2.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29249cf3f3edddb4eb738a4b05eff361.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0264f0d13bce4acf176e0e67412e02d8.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/093de5649072fa0e9118d6b47ea4c39f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0aa46ad4cff77069122a89d83238dd02.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1516c8202da7f5df1ba479edeff75d9e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/70d834f21e6e7a482270817f1ef9b66a.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a5c3760c3b6375ab7f3db270c833205.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/423081a186bb730f6246d4fc88fe8397.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/35e21257dd7649cbf648f8a12c9526bf.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/be4e8c9eea941021983b3a0ec2e30fe7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c8115df892823961e16b58e50f2745f7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3fc378e0a26f0a455b5de0c2b9085d0e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2540a2a93236be26570e7cfed001dd0c.jpg\" alt=\"\"></p>\n<p><strong>二叉查找树的结构：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a48d291a87e8f7451d7096f06c28a266.jpg\" alt=\"\"></p>\n<p><strong>第1次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c3afbbed4dc8d9ab0eb28f36c525eb64.jpg\" alt=\"\"></p>\n<p><strong>第2次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eaaadd8563fe9c2ce028b356b4b1b972.jpg\" alt=\"\"></p>\n<p><strong>第3次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29510bc7455978e0a4b76538c481d211.jpg\" alt=\"\"></p>\n<p><strong>第4次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e776aad15f9db6791ed4ece4cebf179b.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/519a5ecae2049027e151f56404221cd6.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/57a3d2232bdc3602101d26de6af70629.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfe811439d5a4b83908d1aece65b2858.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a551a5af0899d0f4487d5174c879fbee.jpg\" alt=\"\"></p>\n<p><strong>下面来具体介绍一下B-树（Balance Tree），一个m阶的B树具有如下几个特征：</strong></p>\n<p>1.根结点至少有两个子女。</p>\n<p>2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 &lt;= k &lt;= m</p>\n<p>3.每一个叶子节点都包含k-1个元素，其中 m/2 &lt;= k &lt;= m</p>\n<p>4.所有的叶子结点都位于同一层。</p>\n<p>5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3bdde769e986c29df17ee5a05e2283f5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1053258e35bc3a11daa6a35c0a4876a5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7b6f7416cab11f23fa141cbcbe5ae97b.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e4bab35b22e04f408f20d9d78dd1ada7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1da23fc560320dd7fc33c4250f7bc62f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a18c14c033cc7773cbc5417b47c8433e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e00c03897682ce16665f1fc6a103fae5.jpg\" alt=\"\"></p>\n<p><strong>第1次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a9bff5a34ad1b721c406d49aa5f71c7f.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和9比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e7aad0107f143df4d294f6d4ddc2efca.jpg\" alt=\"\"></p>\n<p><strong>第2次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/55f9ffb7ec69c5624d3d38c3e487619f.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和2，6比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7181bf7db0d93d67a6d19e98bdec086a.jpg\" alt=\"\"></p>\n<p>第3次磁盘IO：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c7d939ddbd73ea5a28ab7c895e996d1e.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和3，5比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e00c658824f6979d5c2a6526adcdd07.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a8d6dd48be32ff61f0a20955c3f1231.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e067432832fd13a46e588a4165f6f2e9.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/150acc7b44a31e028d53b97e44e6a7f7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/301f7f8c3add3183aa7fcc85a6ac584c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/07469afd080afb68036063ba808965f1.jpg\" alt=\"\"></p>\n<p>自顶向下查找4的节点位置，发现4应当插入到节点元素3，5之间。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b19105d47fd35c8b0d1e7ed2248bdaa0.jpg\" alt=\"\"></p>\n<p>节点3，5已经是两元素节点，无法再增加。父亲节点 2， 6 也是两元素节点，也无法再增加。根节点9是单元素节点，可以升级为两元素节点。于是<strong>拆分</strong>节点3，5与节点2，6，让根节点9升级为两元素节点4，9。节点6独立为根节点的第二个孩子。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1a708a324257d422e594224c6f7afad4.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/60daf22a13c44bec7cd0384a04fe9e12.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ebf569b446c84c77405395ea1503477c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ed7fea3cc0eeab4fac24420dfa6a57c0.jpg\" alt=\"\"></p>\n<p>自顶向下查找元素11的节点位置。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ca7856622c48d55fbf9502f4ef8219b7.jpg\" alt=\"\"></p>\n<p>删除11后，节点12只有一个孩子，不符合B树规范。因此找出12,13,15三个节点的中位数13，取代节点12，而节点12自身下移成为第一个孩子。（这个过程称为<strong>左旋</strong>）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f5f4b28523d3d381b63c11b7ab3ac7d3.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8d567b18da9582a3dbed613232117001.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7041d2780cb7fa9bf64af19b6476dc2f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/04191ffe9d9fa92c54b4375b8b3da210.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fd1168e35ccc3953584f971f38c75b5.jpg\" alt=\"\"></p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111757\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111757votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111757\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n	\r\n	<h3 class=\"widget-title\">\r\n	关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a>\r\n	</h3>\r\n	<div class=\"alignleft\">\r\n		<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">\r\n			<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/7ce4028f2cece3294efcb3e5caa73af1.jpeg\">\r\n		</a>\r\n	</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网公司的码农一枚，喜欢算法和面向对象设计。个人微信号：13522239721 个人订阅号：dreamsee321欢迎一起交流讨论！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bjweimengshu\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/bjweimengshu/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 94</a> · <a title=\"个人微信：bjweimengshu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n	<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n	</div>');

-- ----------------------------
-- Table structure for zhihu_answer
-- ----------------------------
DROP TABLE IF EXISTS `zhihu_answer`;
CREATE TABLE `zhihu_answer` (
  `zhihu_id` bigint(20) NOT NULL,
  `url` varchar(300) NOT NULL,
  `question_id` bigint(20) NOT NULL,
  `author_id` varchar(100) DEFAULT NULL,
  `content` longtext NOT NULL,
  `praise_num` int(11) NOT NULL,
  `comments_num` int(11) NOT NULL,
  `create_time` date NOT NULL,
  `update_time` date NOT NULL,
  `crawl_time` datetime NOT NULL ON UPDATE CURRENT_TIMESTAMP,
  `crawl_update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`zhihu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of zhihu_answer
-- ----------------------------

-- ----------------------------
-- Table structure for zhihu_question
-- ----------------------------
DROP TABLE IF EXISTS `zhihu_question`;
CREATE TABLE `zhihu_question` (
  `zhihu_id` bigint(20) NOT NULL DEFAULT '0',
  `topics` varchar(255) DEFAULT NULL,
  `url` varchar(300) NOT NULL DEFAULT '',
  `title` varchar(200) NOT NULL DEFAULT '',
  `content` longtext NOT NULL,
  `create_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `answer_num` int(11) NOT NULL DEFAULT '0',
  `comments_num` int(11) NOT NULL DEFAULT '0',
  `watch_user_num` int(11) NOT NULL DEFAULT '0',
  `click_num` int(11) NOT NULL DEFAULT '0',
  `crawl_time` datetime NOT NULL ON UPDATE CURRENT_TIMESTAMP,
  `crawl_update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`zhihu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of zhihu_question
-- ----------------------------
